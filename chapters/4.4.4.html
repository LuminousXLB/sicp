<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <!-- Global site tag (gtag.js) - Google Analytics - START -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-156801664-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-156801664-1');
    </script>
    <!-- Global site tag (gtag.js) - Google Analytics - END -->
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="description" content="4.4.4&nbsp;&nbsp;
    Implementing the Query System
  " />
    <title>
      4.4.4&nbsp;&nbsp;
    Implementing the Query System
  
    </title>
    
  <meta name="csrf-param" content="authenticity_token" />
  <meta name="csrf-token" content="EMTEijVc2kiiKUH4nYH0lQG3pLPfMowQ/Stg//t6DCo0e5pWMQwamnTvIdmVZqY/MqSx2IYYE+2bpNV6UNSMwQ==" />

    <!--<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
    -->
    <link href="https://fonts.googleapis.com/css?family=Inconsolata&display?swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Droid+Sans|Droid+Serif" rel="stylesheet">
    <link rel="stylesheet" media="all" href="../assets/stylesheet.css" />

   <link rel="shortcut icon" type="image/x-icon" href="../assets/favicon.ico" />

<!--    <link rel="shortcut icon" type="image/png" href="../images/lambda.png" /> -->

    <!-- for support of progressive web app, see github README, DISABLED!
    <link rel="manifest" href="../static/manifest.json">
    -->

    <script src="https://code.jquery.com/jquery-3.2.1.min.js" 
		     	  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
	          crossorigin="anonymous">
    </script> 

    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
    
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>

    <!-- <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script> -->
    <script type="text/javascript" 
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/latest.js?config=TeX-AMS-MML_HTMLorMML-full">
    </script>
   <!--  <script type="text/javascript" 
      src="../MathJax/MathJax.js?config=TeX-AMS-MML_HTMLorMML-full">
    </script> -->
  
    <script src="../assets/application.js"></script>
  
    <!-- Rendering inline LaTeX -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"] ],
          processEscapes: true,
          jax: ["input/TeX","output/HTML-CSS"]
        }
      });
    </script>
    <!--<script src="/mathjax/MathJax.js?config=TeX-AMS_HTML-full.js" type="text/javascript"></script>-->
    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.2/html5shiv.min.js" type="text/javascript"></script>
    <![endif]-->
  </head>
  <body>

    
    <!-- support for progressive web app, see README, DISABLED
    <script>
      if ('serviceWorker' in navigator && !navigator.serviceWorker.controller) {
          navigator.serviceWorker.register("../sw.js").then(function(reg) {
              console.log("Service worker has been registered for scope: " + reg.scope);
          });
      }
    </script>
    -->

     <nav class="navbar navbar-expand-sm navbar-dark bg-dark fixed-top justify-content-between">
       <button id="btn" class="navbar-toggler collapsed" type="button" data-toggle="collapse" data-target="#nav-sidebar" aria-controls="nav-sidebar" aria-expanded="false" aria-label="Toggle navigation" title="navigation">
         <span class="navbar-toggler-icon"></span>
       </button>
       <span class="navbar-brand-short"><a title="Go back to front page" href="../index.html" class="gray">SICP &mdash; JS</a></span>
       <span class="navbar-brand-long" ><a title="Go back to front page" href="../index.html" class="gray">Structure and Interpretation of Computer Programs &mdash; JavaScript Adaptation</a></span>

       <!-- edit the search engine by visiting: 
	    https://cse.google.com/cse/setup/basic?cx=015760785273492757659:nc_tznrzlsg 
	       -->
       <form class="form-inline ml-auto" id="xxx">
         <div id="search-box">
	         <script>
	           (function() {
	               var cx = "015760785273492757659:nc_tznrzlsg";
	               var gcse = document.createElement("script");
	               gcse.type = "text/javascript";
	               gcse.async = true;
	               gcse.src = "https://cse.google.com/cse.js?cx=" + cx;
	               var s = document.getElementsByTagName("script")[0];
	               s.parentNode.insertBefore(gcse, s);
	           })();
	           window.onload = function()
	           { 
	               var searchBox =  document.getElementById("gsc-i-id1");
	               searchBox.placeholder= "search web edition";
	               searchBox.title= "search web edition";
	           }
	         </script>
	         <gcse:search></gcse:search>
         </div>
       </form>
       <span class="navbar-brand-short">
         &nbsp;
         &nbsp;
         <a href="https://source-academy.github.io/source/" title="Go to the Source language(s) definition(s)" class="gray">S</a>
       </span>
       <span class="navbar-brand-long">
         &nbsp;
         &nbsp;
         <a href="https://source-academy.github.io/source/" title="Go to the Source language(s) definition(s)" class="gray">Source</a>
       </span>
     </nav>
     
     <div class="container scroll">

            
        <div class="collapse" id="nav-sidebar" role="tablist" aria-multiselectable="true">
        <!-- insert a dummy entry, to give one extra line of space -->
        <a class="navbar-brand" href="index.html">&nbsp;</a>
    
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-1">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-1" aria-expanded="false" aria-controls="sidebar-collapse-1">
                <a href="./foreword.html"> 
        Foreword
    </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-2">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-2" aria-expanded="false" aria-controls="sidebar-collapse-2">
                <a href="./prefaces.html"> 
        Prefaces
    </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-3">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-3" aria-expanded="false" aria-controls="sidebar-collapse-3">
                <a href="./acknowledgements.html"> 
Acknowledgments
    </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-4">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-4" aria-expanded="false" aria-controls="sidebar-collapse-4">
                <a href="./see.html"> 
    Index Crossreferences (for proofreading)
  </a>
              </span>
            </h5>
          </div>
        </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-5">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-5" aria-expanded="true" aria-controls="sidebar-collapse-5">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-5" aria-expanded="true" aria-controls="sidebar-collapse-5">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./1.html">1 
    Building Abstractions with 
    
      
      Functions
    
  </a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-5" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-6">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-6" aria-expanded="true" aria-controls="sidebar-collapse-6">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-6" aria-expanded="true" aria-controls="sidebar-collapse-6">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./1.1.html">1.1 The Elements of Programming</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-6" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-7">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-7" aria-expanded="false" aria-controls="sidebar-collapse-7">
                <a href="./1.1.1.html"> 1.1.1 Expressions</a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-8">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-8" aria-expanded="false" aria-controls="sidebar-collapse-8">
                <a href="./1.1.2.html"> 1.1.2 Naming and the Environment</a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-9">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-9" aria-expanded="false" aria-controls="sidebar-collapse-9">
                <a href="./1.1.3.html"> 1.1.3 
    Evaluating
    
      
      Operator Combinations
    
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-10">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-10" aria-expanded="false" aria-controls="sidebar-collapse-10">
                <a href="./1.1.4.html"> 1.1.4 
    Compound 
    Functions
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-11">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-11" aria-expanded="false" aria-controls="sidebar-collapse-11">
                <a href="./1.1.5.html"> 1.1.5 
    The Substitution Model for 
    
      
      
        Function
      
    
    Application
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-12">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-12" aria-expanded="false" aria-controls="sidebar-collapse-12">
                <a href="./1.1.6.html"> 1.1.6 
    Conditional Expressions and Predicates
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-13">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-13" aria-expanded="false" aria-controls="sidebar-collapse-13">
                <a href="./1.1.7.html"> 1.1.7 Example: Square Roots by Newton's Method</a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-14">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-14" aria-expanded="false" aria-controls="sidebar-collapse-14">
                <a href="./1.1.8.html"> 1.1.8 
    
      
      
        Functions
      
    
    as Black-Box Abstractions
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-15">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-15" aria-expanded="true" aria-controls="sidebar-collapse-15">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-15" aria-expanded="true" aria-controls="sidebar-collapse-15">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./1.2.html">1.2 
    
      
      Functions
    
    and the Processes They Generate
  </a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-15" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-16">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-16" aria-expanded="false" aria-controls="sidebar-collapse-16">
                <a href="./1.2.1.html"> 1.2.1 Linear Recursion and Iteration</a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-17">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-17" aria-expanded="false" aria-controls="sidebar-collapse-17">
                <a href="./1.2.2.html"> 1.2.2 Tree Recursion</a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-18">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-18" aria-expanded="false" aria-controls="sidebar-collapse-18">
                <a href="./1.2.3.html"> 1.2.3 Orders of Growth</a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-19">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-19" aria-expanded="false" aria-controls="sidebar-collapse-19">
                <a href="./1.2.4.html"> 1.2.4 Exponentiation</a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-20">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-20" aria-expanded="false" aria-controls="sidebar-collapse-20">
                <a href="./1.2.5.html"> 1.2.5 Greatest Common Divisors</a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-21">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-21" aria-expanded="false" aria-controls="sidebar-collapse-21">
                <a href="./1.2.6.html"> 1.2.6 Example: Testing for Primality</a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-22">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-22" aria-expanded="true" aria-controls="sidebar-collapse-22">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-22" aria-expanded="true" aria-controls="sidebar-collapse-22">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./1.3.html">1.3 
        Formulating Abstractions with Higher-Order 
        
	  
	  Functions
	
      </a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-22" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-23">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-23" aria-expanded="false" aria-controls="sidebar-collapse-23">
                <a href="./1.3.1.html"> 1.3.1 
    
      
      Functions
    
    as Arguments
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-24">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-24" aria-expanded="false" aria-controls="sidebar-collapse-24">
                <a href="./1.3.2.html"> 1.3.2 
    
      
      Constructing Functions using Lambda Expressions
      
    
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-25">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-25" aria-expanded="false" aria-controls="sidebar-collapse-25">
                <a href="./1.3.3.html"> 1.3.3 
    
      
    Functions
    as General Methods
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-26">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-26" aria-expanded="false" aria-controls="sidebar-collapse-26">
                <a href="./1.3.4.html"> 1.3.4 
    
      
      Functions
    
    as Returned Values
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-27">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-27" aria-expanded="true" aria-controls="sidebar-collapse-27">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-27" aria-expanded="true" aria-controls="sidebar-collapse-27">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./2.html">2 Building Abstractions with Data</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-27" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-28">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-28" aria-expanded="true" aria-controls="sidebar-collapse-28">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-28" aria-expanded="true" aria-controls="sidebar-collapse-28">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./2.1.html">2.1 Introduction to Data Abstraction</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-28" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-29">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-29" aria-expanded="false" aria-controls="sidebar-collapse-29">
                <a href="./2.1.1.html"> 2.1.1 
    Example: Arithmetic Operations for Rational Numbers
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-30">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-30" aria-expanded="false" aria-controls="sidebar-collapse-30">
                <a href="./2.1.2.html"> 2.1.2 
    Abstraction Barriers
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-31">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-31" aria-expanded="false" aria-controls="sidebar-collapse-31">
                <a href="./2.1.3.html"> 2.1.3 
    What Is Meant by Data?
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-32">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-32" aria-expanded="false" aria-controls="sidebar-collapse-32">
                <a href="./2.1.4.html"> 2.1.4 
    Extended Exercise: Interval Arithmetic
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-33">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-33" aria-expanded="true" aria-controls="sidebar-collapse-33">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-33" aria-expanded="true" aria-controls="sidebar-collapse-33">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./2.2.html">2.2 Hierarchical Data and the Closure Property</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-33" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-34">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-34" aria-expanded="false" aria-controls="sidebar-collapse-34">
                <a href="./2.2.1.html"> 2.2.1 
    Representing Sequences
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-35">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-35" aria-expanded="false" aria-controls="sidebar-collapse-35">
                <a href="./2.2.2.html"> 2.2.2 
    Hierarchical Structures
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-36">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-36" aria-expanded="false" aria-controls="sidebar-collapse-36">
                <a href="./2.2.3.html"> 2.2.3 
    Sequences as Conventional Interfaces
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-37">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-37" aria-expanded="false" aria-controls="sidebar-collapse-37">
                <a href="./2.2.4.html"> 2.2.4 
    Example: A Picture Language
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-38">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-38" aria-expanded="true" aria-controls="sidebar-collapse-38">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-38" aria-expanded="true" aria-controls="sidebar-collapse-38">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./2.3.html">2.3 Symbolic Data</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-38" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-39">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-39" aria-expanded="false" aria-controls="sidebar-collapse-39">
                <a href="./2.3.1.html"> 2.3.1 
    
      
      Strings
    
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-40">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-40" aria-expanded="false" aria-controls="sidebar-collapse-40">
                <a href="./2.3.2.html"> 2.3.2 
    Example: Symbolic Differentiation
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-41">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-41" aria-expanded="false" aria-controls="sidebar-collapse-41">
                <a href="./2.3.3.html"> 2.3.3 
    Example: Representing Sets
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-42">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-42" aria-expanded="false" aria-controls="sidebar-collapse-42">
                <a href="./2.3.4.html"> 2.3.4 
    Example: Huffman Encoding Trees
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-43">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-43" aria-expanded="true" aria-controls="sidebar-collapse-43">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-43" aria-expanded="true" aria-controls="sidebar-collapse-43">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./2.4.html">2.4 Multiple Representations for Abstract Data</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-43" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-44">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-44" aria-expanded="false" aria-controls="sidebar-collapse-44">
                <a href="./2.4.1.html"> 2.4.1 
    Representations for Complex Numbers
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-45">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-45" aria-expanded="false" aria-controls="sidebar-collapse-45">
                <a href="./2.4.2.html"> 2.4.2 
    Tagged data
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-46">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-46" aria-expanded="false" aria-controls="sidebar-collapse-46">
                <a href="./2.4.3.html"> 2.4.3 
    Data-Directed Programming and Additivity
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-47">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-47" aria-expanded="true" aria-controls="sidebar-collapse-47">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-47" aria-expanded="true" aria-controls="sidebar-collapse-47">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./2.5.html">2.5 Systems with Generic Operations</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-47" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-48">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-48" aria-expanded="false" aria-controls="sidebar-collapse-48">
                <a href="./2.5.1.html"> 2.5.1 
    Generic Arithmetic Operations
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-49">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-49" aria-expanded="false" aria-controls="sidebar-collapse-49">
                <a href="./2.5.2.html"> 2.5.2 
    Combining Data of Different Types
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-50">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-50" aria-expanded="false" aria-controls="sidebar-collapse-50">
                <a href="./2.5.3.html"> 2.5.3 
    Example: Symbolic Algebra
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-51">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-51" aria-expanded="true" aria-controls="sidebar-collapse-51">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-51" aria-expanded="true" aria-controls="sidebar-collapse-51">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./3.html">3 Modularity, Objects, and State</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-51" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-52">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-52" aria-expanded="true" aria-controls="sidebar-collapse-52">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-52" aria-expanded="true" aria-controls="sidebar-collapse-52">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./3.1.html">3.1 Assignment and Local State</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-52" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-53">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-53" aria-expanded="false" aria-controls="sidebar-collapse-53">
                <a href="./3.1.1.html"> 3.1.1 
    Local State Variables
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-54">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-54" aria-expanded="false" aria-controls="sidebar-collapse-54">
                <a href="./3.1.2.html"> 3.1.2 
    The Benefits of Introducing Assignment
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-55">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-55" aria-expanded="false" aria-controls="sidebar-collapse-55">
                <a href="./3.1.3.html"> 3.1.3 
    The Costs of Introducing Assignment
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-56">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-56" aria-expanded="true" aria-controls="sidebar-collapse-56">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-56" aria-expanded="true" aria-controls="sidebar-collapse-56">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./3.2.html">3.2 The Environment Model of Evaluation</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-56" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-57">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-57" aria-expanded="false" aria-controls="sidebar-collapse-57">
                <a href="./3.2.1.html"> 3.2.1 
    The Rules for Evaluation
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-58">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-58" aria-expanded="false" aria-controls="sidebar-collapse-58">
                <a href="./3.2.2.html"> 3.2.2 
    Applying Simple
    
      
      Functions
    
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-59">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-59" aria-expanded="false" aria-controls="sidebar-collapse-59">
                <a href="./3.2.3.html"> 3.2.3 
    Frames as the Repository of Local State
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-60">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-60" aria-expanded="false" aria-controls="sidebar-collapse-60">
                <a href="./3.2.4.html"> 3.2.4 
    Internal
    
      
      Declarations
    
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-61">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-61" aria-expanded="true" aria-controls="sidebar-collapse-61">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-61" aria-expanded="true" aria-controls="sidebar-collapse-61">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./3.3.html">3.3 Modeling with Mutable Data</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-61" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-62">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-62" aria-expanded="false" aria-controls="sidebar-collapse-62">
                <a href="./3.3.1.html"> 3.3.1 
    Mutable List Structure
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-63">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-63" aria-expanded="false" aria-controls="sidebar-collapse-63">
                <a href="./3.3.2.html"> 3.3.2 
    Representing Queues
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-64">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-64" aria-expanded="false" aria-controls="sidebar-collapse-64">
                <a href="./3.3.3.html"> 3.3.3 
    Representing Tables
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-65">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-65" aria-expanded="false" aria-controls="sidebar-collapse-65">
                <a href="./3.3.4.html"> 3.3.4 
    A Simulator for Digital Circuits
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-66">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-66" aria-expanded="false" aria-controls="sidebar-collapse-66">
                <a href="./3.3.5.html"> 3.3.5 
    Propagation of Constraints
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-67">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-67" aria-expanded="true" aria-controls="sidebar-collapse-67">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-67" aria-expanded="true" aria-controls="sidebar-collapse-67">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./3.4.html">3.4 Concurrency: Time Is of the Essence</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-67" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-68">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-68" aria-expanded="false" aria-controls="sidebar-collapse-68">
                <a href="./3.4.1.html"> 3.4.1 
    The Nature of Time in Concurrent Systems
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-69">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-69" aria-expanded="false" aria-controls="sidebar-collapse-69">
                <a href="./3.4.2.html"> 3.4.2 
    Mechanisms for Controlling Concurrency
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-70">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-70" aria-expanded="true" aria-controls="sidebar-collapse-70">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-70" aria-expanded="true" aria-controls="sidebar-collapse-70">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./3.5.html">3.5 Streams</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-70" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-71">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-71" aria-expanded="false" aria-controls="sidebar-collapse-71">
                <a href="./3.5.1.html"> 3.5.1 
    Streams Are Delayed Lists
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-72">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-72" aria-expanded="false" aria-controls="sidebar-collapse-72">
                <a href="./3.5.2.html"> 3.5.2 
    Infinite Streams
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-73">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-73" aria-expanded="false" aria-controls="sidebar-collapse-73">
                <a href="./3.5.3.html"> 3.5.3 
    Exploiting the Stream Paradigm
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-74">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-74" aria-expanded="false" aria-controls="sidebar-collapse-74">
                <a href="./3.5.4.html"> 3.5.4 
    Streams and Delayed Evaluation
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-75">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-75" aria-expanded="false" aria-controls="sidebar-collapse-75">
                <a href="./3.5.5.html"> 3.5.5 
    Modularity of Functional Programs and Modularity of Objects
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-76">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-76" aria-expanded="true" aria-controls="sidebar-collapse-76">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-76" aria-expanded="true" aria-controls="sidebar-collapse-76">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./4.html">4 Metalinguistic Abstraction</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-76" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-77">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-77" aria-expanded="true" aria-controls="sidebar-collapse-77">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-77" aria-expanded="true" aria-controls="sidebar-collapse-77">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./4.1.html">4.1 The Metacircular Evaluator</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-77" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-78">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-78" aria-expanded="false" aria-controls="sidebar-collapse-78">
                <a href="./4.1.1.html"> 4.1.1 
    The Core of the Evaluator
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-79">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-79" aria-expanded="false" aria-controls="sidebar-collapse-79">
                <a href="./4.1.2.html"> 4.1.2 
    Representing
    
      
      Components
    
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-80">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-80" aria-expanded="false" aria-controls="sidebar-collapse-80">
                <a href="./4.1.3.html"> 4.1.3 
    Evaluator Data Structures
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-81">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-81" aria-expanded="false" aria-controls="sidebar-collapse-81">
                <a href="./4.1.4.html"> 4.1.4 
    Running the Evaluator as a Program
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-82">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-82" aria-expanded="false" aria-controls="sidebar-collapse-82">
                <a href="./4.1.5.html"> 4.1.5 
    Data as Programs
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-83">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-83" aria-expanded="false" aria-controls="sidebar-collapse-83">
                <a href="./4.1.6.html"> 4.1.6 
    Internal
    
      
      Declarations
    
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-84">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-84" aria-expanded="false" aria-controls="sidebar-collapse-84">
                <a href="./4.1.7.html"> 4.1.7 
    Separating Syntactic Analysis from Execution
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-85">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-85" aria-expanded="true" aria-controls="sidebar-collapse-85">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-85" aria-expanded="true" aria-controls="sidebar-collapse-85">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./4.2.html">4.2 
    
      
    
    Lazy Evaluation
</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-85" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-86">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-86" aria-expanded="false" aria-controls="sidebar-collapse-86">
                <a href="./4.2.1.html"> 4.2.1 
    Normal Order and Applicative Order
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-87">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-87" aria-expanded="false" aria-controls="sidebar-collapse-87">
                <a href="./4.2.2.html"> 4.2.2 
    An Interpreter with Lazy Evaluation
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-88">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-88" aria-expanded="false" aria-controls="sidebar-collapse-88">
                <a href="./4.2.3.html"> 4.2.3 
    Streams as Lazy Lists
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-89">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-89" aria-expanded="true" aria-controls="sidebar-collapse-89">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-89" aria-expanded="true" aria-controls="sidebar-collapse-89">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./4.3.html">4.3 
    
      
    
    Nondeterministic Computing
  </a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-89" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-90">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-90" aria-expanded="false" aria-controls="sidebar-collapse-90">
                <a href="./4.3.1.html"> 4.3.1 
    
      
      Search and amb
    
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-91">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-91" aria-expanded="false" aria-controls="sidebar-collapse-91">
                <a href="./4.3.2.html"> 4.3.2 
    Examples of Nondeterministic Programs
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-92">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-92" aria-expanded="false" aria-controls="sidebar-collapse-92">
                <a href="./4.3.3.html"> 4.3.3 
    Implementing the
    
      
      amb
    
    Evaluator
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-93">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-93" aria-expanded="true" aria-controls="sidebar-collapse-93">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-93" aria-expanded="true" aria-controls="sidebar-collapse-93">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./4.4.html">4.4 Logic Programming</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-93" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-94">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-94" aria-expanded="false" aria-controls="sidebar-collapse-94">
                <a href="./4.4.1.html"> 4.4.1 
    Deductive Information Retrieval
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-95">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-95" aria-expanded="false" aria-controls="sidebar-collapse-95">
                <a href="./4.4.2.html"> 4.4.2 
    How the Query System Works
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-96">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-96" aria-expanded="false" aria-controls="sidebar-collapse-96">
                <a href="./4.4.3.html"> 4.4.3 
    Is Logic Programming Mathematical Logic?
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-97">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-97" aria-expanded="false" aria-controls="sidebar-collapse-97">
                <a href="./4.4.4.html"> 4.4.4 
    Implementing the Query System
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-98">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-98" aria-expanded="true" aria-controls="sidebar-collapse-98">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-98" aria-expanded="true" aria-controls="sidebar-collapse-98">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./5.html">5 Computing with Register Machines</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-98" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-99">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-99" aria-expanded="true" aria-controls="sidebar-collapse-99">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-99" aria-expanded="true" aria-controls="sidebar-collapse-99">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./5.1.html">5.1 Designing Register Machines</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-99" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-100">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-100" aria-expanded="false" aria-controls="sidebar-collapse-100">
                <a href="./5.1.1.html"> 5.1.1 
    A Language for Describing Register Machines
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-101">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-101" aria-expanded="false" aria-controls="sidebar-collapse-101">
                <a href="./5.1.2.html"> 5.1.2 
    Abstraction in Machine Design
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-102">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-102" aria-expanded="false" aria-controls="sidebar-collapse-102">
                <a href="./5.1.3.html"> 5.1.3 
    Subroutines
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-103">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-103" aria-expanded="false" aria-controls="sidebar-collapse-103">
                <a href="./5.1.4.html"> 5.1.4 
    Using a Stack to Implement Recursion
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-104">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-104" aria-expanded="false" aria-controls="sidebar-collapse-104">
                <a href="./5.1.5.html"> 5.1.5 
    Instruction Summary
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-105">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-105" aria-expanded="true" aria-controls="sidebar-collapse-105">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-105" aria-expanded="true" aria-controls="sidebar-collapse-105">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./5.2.html">5.2 A Register-Machine Simulator</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-105" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-106">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-106" aria-expanded="false" aria-controls="sidebar-collapse-106">
                <a href="./5.2.1.html"> 5.2.1 
    The Machine Model
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-107">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-107" aria-expanded="false" aria-controls="sidebar-collapse-107">
                <a href="./5.2.2.html"> 5.2.2 
    The Assembler
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-108">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-108" aria-expanded="false" aria-controls="sidebar-collapse-108">
                <a href="./5.2.3.html"> 5.2.3 
    Generating Execution
    
      
      Functions
    
    for Instructions
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-109">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-109" aria-expanded="false" aria-controls="sidebar-collapse-109">
                <a href="./5.2.4.html"> 5.2.4 
    Monitoring Machine Performance
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-110">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-110" aria-expanded="true" aria-controls="sidebar-collapse-110">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-110" aria-expanded="true" aria-controls="sidebar-collapse-110">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./5.3.html">5.3 Storage Allocation and Garbage Collection</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-110" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-111">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-111" aria-expanded="false" aria-controls="sidebar-collapse-111">
                <a href="./5.3.1.html"> 5.3.1 
    Memory as Vectors
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-112">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-112" aria-expanded="false" aria-controls="sidebar-collapse-112">
                <a href="./5.3.2.html"> 5.3.2 
    Maintaining the Illusion of Infinite Memory
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-113">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-113" aria-expanded="true" aria-controls="sidebar-collapse-113">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-113" aria-expanded="true" aria-controls="sidebar-collapse-113">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./5.4.html">5.4 The Explicit-Control Evaluator</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-113" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-114">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-114" aria-expanded="false" aria-controls="sidebar-collapse-114">
                <a href="./5.4.1.html"> 5.4.1 
    The Core of the Explicit-Control Evaluator
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-115">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-115" aria-expanded="false" aria-controls="sidebar-collapse-115">
                <a href="./5.4.2.html"> 5.4.2 
    Return Statements and Tail Recursion
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-116">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-116" aria-expanded="false" aria-controls="sidebar-collapse-116">
                <a href="./5.4.3.html"> 5.4.3 
    Conditionals, Assignments, Declarations, and Blocks
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-117">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-117" aria-expanded="false" aria-controls="sidebar-collapse-117">
                <a href="./5.4.4.html"> 5.4.4 
    Running the Evaluator
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-118">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" href="#sidebar-collapse-118" aria-expanded="true" aria-controls="sidebar-collapse-118">
                  &#10148;   <!-- ➤ (because this one is rendered blue on mobile: ▶  -->
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" href="#sidebar-collapse-118" aria-expanded="true" aria-controls="sidebar-collapse-118">
                  &#x25BC;    <!-- ▼ (because the corresponding one is not rendered) -->
                  </a>
                  <a href="./5.5.html">5.5 Compilation</a>
                </h5>
              </div>
    
              <div id="sidebar-collapse-118" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
            
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-119">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-119" aria-expanded="false" aria-controls="sidebar-collapse-119">
                <a href="./5.5.1.html"> 5.5.1 
    Structure of the Compiler
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-120">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-120" aria-expanded="false" aria-controls="sidebar-collapse-120">
                <a href="./5.5.2.html"> 5.5.2 
    Compiling
    
      
      Components
    
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-121">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-121" aria-expanded="false" aria-controls="sidebar-collapse-121">
                <a href="./5.5.3.html"> 5.5.3 
    Compiling
    
      
      
	Applications
      
    
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-122">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-122" aria-expanded="false" aria-controls="sidebar-collapse-122">
                <a href="./5.5.4.html"> 5.5.4 
    Combining Instruction Sequences
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-123">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-123" aria-expanded="false" aria-controls="sidebar-collapse-123">
                <a href="./5.5.5.html"> 5.5.5 
    An Example of Compiled Code
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-124">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-124" aria-expanded="false" aria-controls="sidebar-collapse-124">
                <a href="./5.5.6.html"> 5.5.6 
    Lexical Addressing
  </a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-125">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-125" aria-expanded="false" aria-controls="sidebar-collapse-125">
                <a href="./5.5.7.html"> 5.5.7 
    Interfacing Compiled Code to the Evaluator
  </a>
              </span>
            </h5>
          </div>
        </div>
        
                </div>
              </div>
            </div>
        
                </div>
              </div>
            </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-126">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-126" aria-expanded="false" aria-controls="sidebar-collapse-126">
                <a href="./references.html"> References</a>
              </span>
            </h5>
          </div>
        </div>
        
        <div class="card card-inverse">
          <div class="card-header" role="tab" id="sidebar-127">
            <h5 class="mb-0">
              <span class="collapsed" data-toggle="collapse" href="#sidebar-collapse-127" aria-expanded="false" aria-controls="sidebar-collapse-127">
                <a href="./making-of.html"> About the SICP JS Project</a>
              </span>
            </h5>
          </div>
        </div>
        </div>
<div id='permalink-msg'>
<div class='screen'>
  <div class='alert alert-success'>
    <strong>Permalink copied!</strong>
  </div>
</div>
</div>
<div class='chapter-content'>

      <div class='chapter-title'>
        <div class='permalink'>
        <a name='top' class='permalink'> 
    4.4.4&nbsp;&nbsp;
    Implementing the Query System
  
        </a>
        </div>
      </div>
      <div class='chapter-text'>
        <div class='SECTION'>
    

  
  <div class='permalink'>
<a name='p1' class='permalink'></a><p>
    Section&nbsp;<REF NAME="sec:how-query-works"><a class="superscript" id="4.4.4-sec-link-4.4.2" href="./4.4.2.html">4.4.2</a></REF> described how the query
    system works. Now we fill in the details by presenting a complete
    implementation of the system.
  </p></div>

  
      <div class='permalink'>
        <a name='sec4.4.4.1' class='permalink'></a><h1>
    4.4.4.1&nbsp;&nbsp;&nbsp;The Driver Loop and Instantiation</h1></div>
    

    <div class='permalink'>
<a name='p2' class='permalink'></a><p>
      
      
      The driver loop for the query system repeatedly reads input
      
	
	
	  expressions as strings and parses them.
	
      
      If the expression is
      a rule or assertion to be added to
      the data base, then the information is added.  Otherwise the
      
	
	
	  expression
	
      
      is assumed to be a query.  The driver passes this query to
      the evaluator
      
      <kbd>evaluate_query</kbd>
      
      
      together with an initial frame stream consisting of a single empty frame.
      The result of the evaluation is a stream of frames generated by satisfying
      the query with variable values found in the data base.  These frames are
      used to form a new stream consisting of copies of the original query in
      which the variables are instantiated with values supplied by the stream of
      frames, and this final stream is
      
	
	displayed:
      
      
      
      
      
      <div class='snippet' id='javascript_96_1_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=4&prgrm=PTAEGUEkGEAVQFLlAFgHTpQKCyUAzAVwDsBjAFwEsB7YgZwICdqBbCGeJVNARl5yJkqtUAFMAbgEMANoUnlRAClKsADrVHFyAGjHFxASlABvLKHONR5Qo2KhKdAPrTKCxjOVqNWg2fP+AgH5QFzcZRylZJRUWdWJNcl8A5NAALnsnYkkWaK94nz8U82DpamoAa0JVRzoATxYAI2ppCJlCJTrG5sdqfEcsnM9Y70TdTUNCovSHR0lVVRdSeRpiIbiEpKLi0DmF2sUJNvklQQoVx1EAD1VLOjoVtZGDMf1nya2UlzpyHr7I9roikkjAA5hdrrd7rRATF1j4XoZNltpk5qKpRO5yNRGI4Yg1KFlhKtYU93slgodZMdFGiMfJsbjWPjCecsbN5otlrRHvlRnoJh80hlGcQACauFYeEm8pFFCmREXiolSvIJBGylIo5zZBqiyTgm6iO4PaUbMlBUAsSTlUSOU5ExTSHV6xyqYHZKwYmr1JrSGGq+HmwUfJ2NF1NUX7U3w-ka5JauiiACO7TIuWGMqD20pNWTqdIHTzmgLNXIxxyWn9GY26qzQpmDVKpHKPLNgvl4Ub1Gbra0tcFWss1lspfLCV7iTrHZaQ5sxFHCgr5An-Y+Wvt51FolITsxJoDiQAkAEp2J-tSN7RHFud442Sp6GWtNft9IJ89Y3WtTfd1ziQe4wtHMf3dB1ox0T8B2FSRjRBYgl3fU8cxg+44IQ8DV2RMRGGYRgV1AAAiEhymIagAHc7DqLRJEuUAAFo6LPI4FAIgwAG4sAAXwEEgzhEXZpH2QRdGBEE6CMUx-EofBQEUGYbkoFgJXEW1L1WQQDAkslZ1sHYOVqV1GEU5TVN4h1hJ2UFxI4-xOLEP1RHsGS5KcEkSFFO0zIeDStJSB9vlAW5CGkchQAAXiYqkFEUNTHAjISSDeYNkqKK4FDFC59EoZh4PHOsUuDWK3XcHI3EBDTtHygqPlEuhKuqhr-Fi8ZstoBCfPY7SrDnYUdPnf4lCCkLAJSYI+taKIRXS5chsnFL0nc0R8AJURRRs8w7NEByTDJDFcJikhdCI4gSPIuw1NAchanRejGIE2pWPW0BuO4rALq+H5egmgEDmuOrYx25I+stOYgVBcKAD5IrkaLRPVMY-s616LpzB8lUlN8MIByT-GBmZyEYQhyAAC32SkYdyMUJVocJDXFJZovAj9xk0-LpwpzwqeVFp-KLLR30wrDyepNHqayFoZDcFkVIF2MOORryRBzRMU2LDpyBYch-pZwGpOcmZRFiK7c1VtNFG+TXxN8opgcW5b4jWyZNu26TZJmJ1vgXQ3xwtrXNN1lJgeF6LlsYT3vjHfnffE7QWae577MTAPkn80LQ-DjWfgG8LQCq4OTmyjPI+XaPnjjoNXZcxxxoGmLC5+X3vtEf2ccFYH04bzOm-jgJnaT1uPiDhUVfzJQqoCW5O+LwFS9j14e9sp2uJ4oQVhCBxPr6EgUMoODVvNn1mnE5PgatVQD66aRIcIgAqbfYIdm+CN0TpfWs5e3sVyilnnagiZfHcoEVhVjhIkE+3VdIzBHmrRCwZgiSFIKQQgLBgrUnHgEXYmhRT1QasQYK0gcHVTPubH+PR-4gT3NCQhjVQDQLTF7JcICnis2DN+V8QDuRMzZuvb4igKF-m9Jfd8I1-DpDwdIaQ8sV58TsDmLsPYsY6wHqnUA8Uc7yPKHFagkZ3zxxUU2GQDAIp0FIX-H4-CiSAnip1AIKj76oQdkYnhm9HD2N3g7R03ZDE2NxhA2R55orxQRulDyLUcoIQMX6ahNCYkBDcXvUU-10GxODCzJG0iiSRWrn4hh45FGvHAcOOwVobTZKKU3RQyT86KHGlcQ0xpOEAXVOkz+q8lYKh3mhPJB51TJxUdnCK1TOm5WfANA0kJ9zVhjOXDBD9BG+gqcMpc8zmiywGuqeOwMBpSNaTIrJFjJmgN6QPYZKyWi1wOVeV+qyma6GSR8aplz+ptFtHUiZjSpmjHuY1Fm0SYkzN8UU0AdsVqO1engNSDB8DMDYFAOAiBkDoD4AAJgyWvd2rg6SYwAoUnq+NJAghBKtZwG98IEVCFix6y93qYvcOcl574TAngnn40AxNRCSFFIoMslBsWfM0jsi6+LCXEo+vhEmtoywgmthYVl8lJDZUZQAMiVWyjlXKmbhTChFCVd4CWCq-sKAY6ZQEysCnKpwUqiUeTFVjAixqqUKzacU60tpjUX19Ga4GYr7UemfrQw+0gWkXWuS0L67rNUD2Buyzl3KFV8tNcGw1MwlndP5biyBlqCXWpJbwu1qatCOt2ZkgtDdA2MqjaymNXKeVvmrXG3lwiBXUsNaWpu4yjRQn-OmytQL621obQm5hSbnXCieRWyYeMs0iptaSu1qdJDPieaxUAAAfVd+VhU5ttT0wiUgjKSEbLaZdRh12bunduudu6CKxRPQa0dTyzkTsBT1UNvx+gekUP2+NTapEXUfWMt5nbDlPADtG9Vg7INM2bU6vZJTbQLqXewyhqxjW6EAxCYDtAvWsp9Yh8xyG-z+rQ6ADD9Su0jr2e7Z0+ogMNO7aasDFq9UztzcuO1oZdS0cw-Rot70aOundKVL0oamEyiY0C4hb7w0el0N+xt0H0n8bDPqeKz7ZV9ogwOgdin71wdddqFTHb6OKGKh6MquhrEZrsD6zjLo6Ndv9WZ4TYdLPaNqJRzJMxb2EbAji4wx5-CTuY1a0VV7PlHR84AlDfHDVRd-ESD9gxI3BaBR9bJ+B8I8CU3Fr+ACEvnGc56MO6mNM9XS5YTLWNkU5dHfFjh841MpZZWljeGX8IAGZat7Pi3eagIoI5IZ3KV81kmDP4fyw1yp1V6soaSyap4fyPjwcM1x4zXbps0NmwIorZUBbfPMNtxLTWAIwbRSIGY40I6LjTYx1uU6WOXrzdeq7ZYbuFu65k2pPGNvNbK7peTQ6ZSefRa5Wg6MaZA42NZ4UoXZ3PYi4RUW3N1srBXWe4MW6wsI6OUj8HYtwjXe9h9v9hrkcY0MqtSgDMFvifu7htrlWsufbXuTyHA2+bsf84Ub1jOlr4Rq6T0dbPxazBChiaWtPof09a57JnWMut6a804OhBZzaZxlQ9uHbH1eayOqr0QsXR0G9yZWXXYDjBBZfQDrTP7fZnYuh3U3JdM7Hxlz1etpchd7Mns7mervNesoHV7lto6DZGwMgb83buefMfEW+EP3EhVOA9lPd7LvLaB6BTMePkHS4g4u04DRI2tfZux1zxHBENFG72RorROi-v-bsID4R3vMkreL0TpcOHZfLir02co-qu8bCV6Dno6JMQMjxASP8FbAvmFS3ipw29GAGVpJPnE0+WQfMYxjwUDYZ+r-H3SLEm+mQz78-ytvY+V9r4n-SM-jQL8gbp-P3OLWl+PfL2S2-x+N+Mif232IBr2VzikPzvxPyn3PyALn2ZWtzsCx3hwr1xyr3AL-wfwAOZCIxZxEHXwwNDRLwZzl35yxmy2vxECdzwLFEIN73a2qxwMom3HB3QOoMb1G3Kz5yq13UVw-guhWwEmp1n2ah+xWBElBGQQSFR2hB7w4N4QIgEIZjR10GEPI1EMshBAkOfAc2AQLzsDwNP0wOfyvDZAUNnzYJUX0OxBzksJxAIKZk2WY1-xsMMJgK4TgRBlKVMIdBW3dRsKShSS2DFUoPv1YNOxEXMHSH4I5EEO8IM18Pv1P38ICM+FJWCLpFCP5SW2SOSETDRhYI1TCNH0L3ZAWBiJf2l1j2zwvW-3zWiMUNoBALXhUPeQY1A3dxt1jR01O3ILsFEikPoFK3A06J-S6P5TO1wDAEhSYFYHYHhS4CRTQA63OwQMtUJhJn2EuBkMzS0WaA5VWE2Pf3bFAEuHynSD2mxEUEuCOiaF2MXTEGuG3AUGwXNQLEoBUlFCLWLTXhWzUlMyE2K3+iCWxkX10jwy8Hck8mdWfnuV2wxEBPcw2VDyozB2GAhN+PwC2JWK-yQJiiOjcgyjUkaIoLy1hJKwxJhwq353wF0DIKRMyVijU3JN7VkJ+CZ2pNAEFzpKaLyzCTanHCZJBJs04NxNAB4Ng3bwMxrgZQfGmkxOcUUAIilKiH9RlJHy5OKKVPaEUAGjlMQJ13WUIk1MNwYPYJHDGVVP5h1Jhxbx1N0L0B3GoHuGIDBF5JGWXCUUFMuh-XLiTzi3rjtBKiUA9I-w6K5R9KwBUV1UNlUGNldKXBznjw4i+JEB+MDI9SPnQxeRjxDLsDdEVVE0zKiHfl9Lq0DLOXKkDIkjgKbzVVjWhQ9BNPrJyCbgrIbKZSt3gK9MbSbObiKNkUuBCUynEFajdPTKiVI0MUsxgleQKWZNBM0BBBJjHOPm1QimkAXKXMiHEm4TzLwlTM-QLInL9A-AaGnKHPCKFHXOdKXNEyMAAB4QgNziZtTvFuFzi8ICIsRqAQZiBah1DNCtZaEqhSjVp0gCJQAABqQ4xqb4IyZ06SfYW8yCwiI6ZCg7WhAmAkEEBCl848i8s4nCC4z8soAgUQMif8xhIC6I0CwiNCmJWCrCnCpCqC-1cCqC9Chi+C-AfYLc8Y96MoSoaoN9WuUNY5SYFGfQZwMoc+YMooENH+Zcws7M4MB7XPW89CikSS0oNEA4MgUoJ0l0rKcJccNJdC9IUNLVCKT3QNbcmJYIetXisy2hBS4PGyj8AdXinxFIbiLYSucYSyy6dlC4CPIckc7vZOLYd8sco6EgJodyUAB1Ly5IPuRyAeLYFRHsnOJ3Hs3SwwBeQOVlExRdGKMs0TEqhsrIhqHsls8qnIZtLYHyxeHM-kKSnS8M5M3ouZYShlUSo8sSgICS8QVqmS2coMeS4qw83iiKm2OPfBZci8rYTSoa7Skah0gy0K4y-mUymJcywNAK6yy+WymhYIRMH4Byyco8haqYZy4q1yw69yn9Ty-KhOCuZyfy1cwK15EKuMio5KKK3q46OKsUBKj0W6HYB+JcKlBqxOVKqqDKwMrK-0nKgFNuQqhS6qsqnspIlJaqgaVsuqpK3uJeZq8YYa3KlpCFL+KFGFWYzgRFXgDAZY4UBSJSKgFSSEmRA6YgLPT-bXIIw6QiFmkyIk3MoyVmt420RSBYYnN7byRKCTD3W3bsxKFpFRIWtm0yZ1JxMVc0H1atf1fwatFKbG-wH1WtA28wWtY2pbH1Xci20AXc623W0lclDee2j6J2ooH1HPfBf1H2iRQUE28wH1cUOgBYSQB6XQUO8Ov8j4IO+Ugid8i2985KeOn1K0EmWYBoOgZ+DO4mLOhgLYNOl2iC+2-wS43QDza+WiKC2O4uuQuiMu8wCu0AKusKKGWiRiOum2l2uiW-C22iAIdu-wRiQe+uvvJ+XQFIFutuju0AG+Vu8wcehU4AJu2SK41uowYe2iMAbu52uQgAUjXpnq3rnoPsXtAGXoIlXLLpPuroCo8x7rkIAEJtVb6N7Z7jjQBX6IpH796+87zj6P7T6v6HzzA-6vaXa7ywom677t7QBoHwGr6IYgHK6QHaIoYkGn6+8IYYGp6Ag4G57cGsH-6FTn616v6h7MHv7-BNjzROo1axaTIObEtRNwogxiFq1dB1aJaWGdCOJGHjINa+GrxqAGgAArR4oxDh0GQQa+W2phjW-1FvDqSq-wHh9myFTqCM6EUKDRhDXRxdQCtc0lH1EFB2f1cx1aeO7I4Ol2yAYge2VwSO8wBxpxq6Gx2x9O+QfO2ASAC2vOxwPxzx7I7xzOgAUXtsCfCZCeSJ9QADlJB4m17En4mrqYkGHdGHbFHeGJs2GwoZHz5SBr561SAPx9GBsnw-YBGsmKmJs8b2GthiFinh6W8ynymcn2b8N34Oq9I9hDIhHeH0SBbRIPo5T7pHACRXExQMRBIsLHBxHJApATEjIYzNsCoKmpb1ylwhDEo1GUhRmN52JkheDDVTqqgNq+T+Y5S0osFLnRzklMFqCKnYpDz0L1HOmDHHwjHyzYmMF5gsFTNPmRHf4JGpG7kAi6nDHRksy-n-AozvqjKrnEgdl1zQpdUQRShTyWgfqtAc5znqhcXlxtGLobhuxO1HBVZV85JiBVAiZ0MMQmh7gPHk5K5-a3wCQ6XEgzUAho6nR9gCIGJGJg4rC3AlJCRVpbpG6kqUrprzAVEkwc5ipExKX2hqXOWiZCb-A+WI6FShXGJRQjIVJGAQhpL7BaWiYpWGIoaigdX9gSBlXbQqX9gkx6qig2WnAUIMQHRXWeWihOUPJCZ1yegcQvXGAHQw3jt3NFBfXnreWHAY6FSABBO4b1teANyVrEUAPUMsVRactAG17ymGuV5IO1vV-VxiZ181OgYKQCit61o6Qtj4O10sSwbIdZ4MWCjlFgRwYhe5TK9ug7B14EFV51ypQ8N-AkQbKgakJMZQysuF-wfOVVjEF1l+LCtFq5AmbtxQePTSN17ypeRqhfR3f0xdOgMiDEGlrls1BVpVkdp1tV-YDVlFyYeGj0JxZdsdud2hDdqwLdttlgXd-BA900rE3PHso6j4YIe1b8jO0gYmLC7N+QSQAiU44FWlh9ld9V75rQSgWduTCDSD-dnZMlgsO4bD-YAAckjcUFsfMAAB0sAg2lAnmPI2R8BsQgP49dAAASWoPjjzf2aqKj-XXlBIKlMjilsdmj1N8Nuj+jpjljoEAFjKDjrjv4xVXjwgPjwwQT7hhVPCbTvjgAL00inqY+SDY76ztA094-EH09AF47M+E8alE8InuCvPICpR0cfHNa5cMjUFCgigIgAEUn3-OiZUgCIkyLpnXrwjWvQVrFBb2smX2lWYU1mX3AujYkqPX+g5qX2W4gwy3BWGJoYH9LoMRxXjhRQpWm3ZW0r-A72IpHXKPr3NXnrSv9Xs3EuTWVrIvQoK2m342w7+XFBh2w5H3V2Y3QOAh8vI2HhfWS2MFRRA3gpbQGRFvuRtvGto3Y2qpSuU3Exw3021vM3vyc3JA83EwC2tWNpi2muUhuuK3QAq3ZoGB63G7G37vS2E3+XW2d30Eu3she3QZ+2EbB2aFJvR2n3x3J3cOZ3oof2sbF3zAv24ef2DLN35wQfuOQOSOgxj3kh4vDWJacRkuZWP5Se+uybtG8Aq2X3UhDwJi+m7n1PGAgOP7dAfVUPrjWLSBWKPjWYGeIuPvUhWfrOOf8eJEeeXa+fCIGgBehfWI5e5CFeq9lejphffA8Apf+tOPOfHR5fVeE6le8SVePxefWLzekdLfdewB9fbOjfrf+ereXbBftfTfXfFetfCIdfJfVP2ODeNOffNeLf3e5Dhe1e+8NfbeCJPf-fWIHe2e1OQ+XeTf+eLevePweOE64+-eCIdegA')">const input_prompt = "Query input:";
const output_prompt = "Query results:";

function query_driver_loop() {
    const input = user_read(input_prompt);
    const q = parse_query(input);
    if (is_assertion(q)) {
        add_rule_or_assertion(assertion_body(q));
        display("Assertion added to data base.");
    } else {
        display(output_prompt);
        display_stream(
            stream_map(
                frame => unparse_query(instantiate(q, frame)),
                evaluate_query(q, singleton_stream(null))));
    }
    query_driver_loop();
}
</pre></div></div>
      
      
      
      
      
	
	
	  Here, as in the other evaluators in this chapter,
	  we transform expressions of the query language given as strings
	  into abstract syntax expressions. The function
	  <kbd>parse_query</kbd> that performs
	  the transformation, the predicate
	  <kbd>is_assertion</kbd>,
	  and the selector
	  <kbd>assertion_body</kbd> are
	  declared in section&nbsp;<REF NAME="sec:query-syntax"><a class="superscript" id="4.4.4-sec-link-4.4.4.7" href="./4.4.4.html#sec4.4.4.7">4.4.4.7</a></REF>.
	  The function <kbd>add_rule_or_assertion</kbd>
	  is declared in section&nbsp;<REF NAME="sec:query-db"><a class="superscript" id="4.4.4-sec-link-4.4.4.5" href="./4.4.4.html#sec4.4.4.5">4.4.4.5</a></REF>.
	  The frames resulting from query evaluation are used
	  by <kbd>instantiate</kbd> (declared in
	  section&nbsp;<REF NAME="sec:query-syntax"><a class="superscript" id="4.4.4-sec-link-4.4.4.7" href="./4.4.4.html#sec4.4.4.7">4.4.4.7</a></REF>) to instantiate
	  the query's pattern variables.
	  After the query is instantiated, it is transformed back
	  into a string by 
	  <kbd>unparse_query</kbd>
	  (section&nbsp;<REF NAME="sec:query-syntax"><a class="superscript" id="4.4.4-sec-link-4.4.4.7" href="./4.4.4.html#sec4.4.4.7">4.4.4.7</a></REF>)
	  and the string is displayed.
	
      
    </p></div>
    <div class='permalink'>
<a name='p3' class='permalink'></a><p>
      
	
      
    </p></div>

    <div class='permalink'>
<a name='p4' class='permalink'></a><p>
      
      
	
	
	  To instantiate an expression, we copy it, replacing any variables in
	  the expression by expressions that represent their values in a given
	  frame.
	  If there is no binding for the variable in the
	  frame, the variable represents itself. If the
	  variable is bound to another variable, we need
	  to instantiate that variable.
	  For
	  example, if 
	  <kbd>$x</kbd>
	  in <kbd>exp</kbd> is bound to
	  <kbd>$y</kbd>
	  as the result of unification and
	<kbd>$y</kbd>
	  is in turn bound to&nbsp;5, we need to find the representation
	  for 5. If the value is a pair or literal,
	  we use the functions
	  <kbd>make_pair_expression</kbd>
	  or <kbd>make_literal_expression</kbd>
	  in section&nbsp;<REF NAME="sec:query-syntax"><a class="superscript" id="4.4.4-sec-link-4.4.4.7" href="./4.4.4.html#sec4.4.4.7">4.4.4.7</a></REF>
	  to construct an expression that represents it.
	    
	  
	  
	  
	  <div class='snippet' id='javascript_96_2_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=4&prgrm=PTAEGUEkGEAVQFLlAFgHTpQKCyUB7ABwFMAnAQwBcBLfAOwH1LyAjAG2IBpRCBXS0OToATUAHNilXGABmpfAFtQAYwAW5QpTKgAzKAAUAZ2LKa9XWh2WAlDhm86p2nUGHD+ZfoDWxAJ7dSE3xSYUNrUABvLFAY0EDKXlIXakMGOl42Nn1A5WDQ21jCwoB+UAdhYhlqOmJhaKKigC5QYgBHXnIsn39QVWJyYX0+geygkLDrAoaS3v7BnLyw+umY5vI3D28-bmZqLIXxyYBuLABfOwcncwVyHyZWDn1wqMLcukMBNg9O+-ZiUAAvKA2ClKPoAEQAKmYf0h4OsJ0K9kcZhcX3wXl4hC2vgYAEZuN0GAAmZ7LIpvD6gQy8FgwjiA1zuTxEgmgXZZL7KH704jHcmFagyAwpBjlSrVWpGWm8yaRAXTeKJFziqo1YSI6anFpsYzylavehUg6iIHrZk4kk7ch7aV0h58hEKhpKpKgUWqyXzMbCKYGlalT3q53+1bsm37H1OlbnQqx2LIq7Jd5kMGswl+K2gABunV4fP100pAhp9r+jPNm3T4dtXJ5Dv5KyFItSQalpdlZND1Mk91r3zYvw4nBD3Z4NtI+hBH0tbMIE8txO4ubY+cmI7HY45U4HQ8d0a1Or1L1DxbiPorGxZmaXNayHYbB-9zf0HpEEvVo1yITlJ8KAEgVmMSg+3vGUHRHQDNxWedqEnWDJyJW8VzXDdoM3bcHz+SYnSgmJtWIXV-j-MdgNAr88mXPM+U1f14waejQEYxNUVAYQUnnSg1H0BQu0VSRlVAJQARE0BwXRTFCHBUcGlKCSsRkpohMBUTwWqYxSEoaToNKdTU0UwpmjIeRJwUbhwQcLw6HwAB3FwiDIKhnFAABaFzwz+eFaKY8lXRcdjDE4tQTnOLAzwcihUT3RkbjuXknhOM8JAEIEIqc+g9wheSpKdM8+BSggSEi5xMrUlNNK8i4UWc2LiAYFhqnYugxH0XNSGoCCc2oviYj88c4Na8h2s6lCaLOLAWOchqRGqMQGDajq-n0aamrEHrzwSN1hkGFbZqdc5JvMXbmvm6jlsavbC16gS3W3Y61pCibLlY+6GGqBg5HIBRiEG4a-m4T7vvWvrK08BbOsBsaDue5ziAADy0ERfsW4cutXLhQEh4GbpcBCeNuOr7uRkbuoBiggcep7qvMUVmDECRhAYacwVyBRCHoYg6EoHY+nuNaro2wTRTx1n2ZqLnwgAMkl2YRlFjmJZUoFKF5unKcO5JUjoL6fvl8XKGxzbNb5hmmdBfQ9c57mxO177KtCvANcMTH5CUKA4EQZB0DxNA8SqpMWhQqhdcUMWre4Tnsx6vrRRBLQKCyS2JZkuTqHjn5Rot0OFYNmTmlFW2Q7ZnO-WmOT8AxLEGEMXwFBYfBB0zmu64bhh8BkNIdaz4v9esCO6CjvP3VSDRCBBblUW7sPk-9UpR7YXx9GIIOtH0DWGHhwhAjcZwp5L-uo7Q9DmbbjvRsMfQhrmzft8MZwL6Tg2D8mIfRTSyhggYVnpvSug997lOgc8zB30O-T+39qi-yYPgBg89qAT13o-PuLQB6lwaPnVIbx2Kok6P-K2aCiilGXj8LBadnC4Mfs-V+qQ2BfRYMIcgG84Zb2IDvegeCZ4GlKLVD6MN2G0Lrgwhg85yaSDINXWu9ddQcKfgZTcAj6GMPrsIReSCqH+gwdXNo+ZHBF2nrnWeQDBzGHaJzZQP0TE6PMdXZgWhvpcwftnXu6iDSaPYB4LwMiCEzGIYOdxyhPGUJQYPDRw8GB+RscHexLMnH4MAb48JONIl2KtjIlxKxNHrwqMoWhxV2FILwqAeJK8fpZJMIOD+X8jTMC5gwbJidYkS3SdMTR9Shq-y8cUn4bS8l-yCZHbxsRNHmmoGIOg0TOmGISSMsZEz+moKHsZYIaSxKWWsnZakvgubkDhq5dyviOhaHtv7Vi89F7Im4FfMIV0XzC3agoMh2Y6oazXg4X8CoQaEDHriLe1AHk0Cebw6mf8LmCFIGIMItECJEXdMKV8mDs7lCBUmV5dB3kNDPNvDIBUDkgPXso85byj7oVDPDRGjNI5wXoBMuRJKkR8MYCInW8cL7Ij7rSulMQrnEs5aGdelL5DjNSWyxsRQY6pAiZnLFbADHdlKJK6iVSuapOlbK0MzQ2wamWNC48ColmTlBRZOgVlbIuA1uyXwJA9mCC+QvSqsRzihXNSfdup10YX03oYZ+AtBZuhuNiK+gIAB8RjDk-Svs-COzDIXjSpgHBJpCcENJ7uHYJhshapEoKQfgqhF64tXom8hg4WHsQnno-eabBmxCISUrOM0k1KssaktRabFJGVrYW+gPxOjx21gC8tzi03qwZUYrRpjdFGEoAoSgXq00C1uakYgbNKC4ibROj406Jg+tiH1TV3kdX-AXUzdYIEPhRNSRumd6L+JG1DXiuCHxklLovVOq9nABn7qPMREMZ4qikEfZet1+ZGQGXzaUh9p7bHPq5pOzdfcP0hiPQq9Ga8IM2OnUBx026XQ40xmhwDo1vJxi-dhsVuGElrvMfoDl54ANQeiRfS9YR32oKIw68kjqTnORdR3BwMzPzNykdckifV-VGEkQ3YNYlIR8Z3mM2ocJuCCYbjGp1I7DDckYPgfgdTyntNRI4lNisRO4dFJRgdcTQxz2UMoXgCgMggJozakgIgeXdnSJkNzoYxMaaEG3HTPTf5eqc4UczT6GNeJfuqsJgXJ5IMUqnGcsWSrKeTfoqLoSPNsGHcC0d-jAmNOtgMgWZ4CWMny-VfAKivHeTPHWXUjJfNaYC3p3pF8CVPhUNUso2s5PqmdkCHjYpet33k4MerMbCh9TA8tKrPQyWcwpQPKlQqYMTa87yulsnRv9e4CFzbDQBn7S4+YBJESz0pJg-MqOAtRME0SUbTD1HoIzYiTfVhd98mFeQUdnL8aVywL63Mwr3qSJnlGoyGb-HomYaYSwthfTvvP28vxiRLdG5nWh1bNHUivFUXRsj3yuHCOxvNQk5LX2jNFdQQLVHqWnsU8YKlvHRSDsxBm4z2H72Ed4-25uAZG30IIam7hvdsbHYMudnIRQEAYDwCQKgX2aBiQneNnHRyaWS63dM5m8g9NahmxnEE8SacNfHOdabhOT2kGREKET29219DbiQcduNrEeGF3E+j9NbpmYQkLuCJTEm2Cu-NfT11nubcmYd3MJ3EZIt-dYqKLHV3vva9vbTPXps-fG5T1pY75q8844bl49PglHfbgr-Hl3-Joa5aL6NOHt9EFp+j+X2P25nffdr6rmLrWOlR-txmk2Buc8g7EsWIQIFGfwlAAAHzn4pTP+vGZj6p+ZcGfxdM5P084WfC+l+65X4bmJ6+xJlJ37045bvnKc+Z4PnduHw8d091X20NfHrms5437nn3EdU+jlwzfyyC7wAJ7xv2uHu0n1qUZ30ELnx3zCbw+2cB9zRHNnBGgOn371RED1AHgLRkQN-xQMT2cljjoSESIMp3SyunFRH1X3NmNwUQoOYWb3oHNxHSYMYSZW+njmL2kQf2ulvR82D1Pk7m+m4GAMiwLw4PIKUTm1Lz-D6kkNAPS3APNR4U4KQJ524LEX-W4A6zL193QM0MoLoFwJ0JZX0Lm1DxHVFAv1yQH1b0KSHzdGX2zwYPH3BHsN3zYOkNy28N6TEIs2MxcLQMfUCBkBWTxD8IDgCKgQsLIEM2oLbyMPCMqBWVJE-xHTiKigJQUNCOBFBESUiKCR0BiNYnsOgUbRqSwJyXyJFyEKgOqSn23wcMng5RyJKkjyRw5Q0NkK0L-2ezpU6IygSP-V505RGMYDyI-1J1sIlSSQu2g1P2SOWFoLpncKN08PO3oytnYNyzexYOQKoK10UKAI72r27xIJpgRXrSLXqMfwzyP02JWJznMk7W1kHFMP30X1DDcNHw8LPwwPoGwSLXCz2PKOcg+J+BLXgRAQEN9TCJAgiKiMhPMGhMHEpG0WbVbzWNwxPhRKCUyPGnNQxNgRlTID7WoCeQeMRMKLSJKPHzKOuONnM1gwNhoJ1zoJP3ZPMnM32IDjCyWIi0vWeFiDxJjxGEwlfR73NT-To3PRgyY0AMlMGGVKyIONYUg0VJnXZOEwlMEmlLgw1IDlFCXU0FXWxPXVfX1MeOHyyz1LRLVxPXBKVJtJVPtIyBAPj2VJsNy1FHy1pLpP+PoK2KBPywFJei5C8Eq2qwRLpMkJdxNPd3u0DOFPwUMKRIhAjKU12IlhZLCTAVICqTrkgTiycLtwaOHz41IFxCLJLJ-nLIAPn1+OfFSB-lrLbiKioHAUUEbJbwAOTNINbG1k7PrIgSpJON7kiGcKrNcOeIBLDP0XMhrLrO7I-mLInN-kjOHPqkgTHPXN7NLMnP-2SNnLtPnO5LX2XLEg7LXMcg3IbLLL3ydMKgfM-nv1xLnKROKNRKHPMHlJAjSiRnjL6gJPSKJNfOMCwS7MchAq-IvJ-MJKZL9IDh4TgQQXYX5SOIR0uXBTs2x1MNtMQvpLBHBAwu3IBgZQGOcDwrEAItqSItQtYnHL7OfIykqQoqbNWMNHeAECLMZHrM-MHIKLfCGnvMiiPP7KnMs0MXQttThMng9y7iLPZTZ2mD90AtgooHgrAKrTDHkrHkUt3mUu+lAUPNIDUvUqKE0rQ2AsGDUT52gmgpBO0qEAcu72Yt3K4oHJ4sEOHw2MXNeP1nMh8t8P-LNWotMNpKUIuPfyuJJJHSvhoqNBivOKlPjxUJLnAIl2BSl1dllw9gV29ksF71pmzRVkXjhlQLCXrgbn6D-mqtZ0MThjbRaFIBMn0DhnMjqo4CEBaGYRMC0GEACBMGIGpNqGv3UPuxeTGNnQJVBwKL92BOLiRQ1kDxozmqsJUUJzr1NIRVWpEGRUnhkBqpDJ5JkHeMRSOvWtfPXjmrXhqvAsiMutAGiIisxmoryNOszNIt-NeuJL2oqKiuW0FQmR+pSKQvSNeuZLmNyx4WQ3zDrURg5MhtIohERuIFwLeBRtfNFExsGnRjOoXNDLBFGnMkxp3PMExqVRRsJrXF+skNGjUJHTMS+DvhOgFWpVSWKzRu3AQyBuci0shiXhpzRsdwFrCm6xVjqnNJXQ3lBu5q5kZCyxOAgJcB4RFtS1nXPhqrxm1oQNYTutET4NZVETFPFO-NlkGCxg+shkwzNp1gtpiAKO3FtrhvjQRkWwVuzBWwmQNrRnmvWFlrFqWs5jEBVi9yE3CBEkG3DsjpXCWCs36lMhmtESjpU3x2Y1ABYGDp9v0tAGaA4Gakju1vCAAB5gR47VBCak6pkOrllwQP58AhIhBfAwV6KGNqQsQjLahmhwRQAABqZqklD4dqZqIUReMuoesScyGe-bMe2aSe2ujLVxdqzqpuiuTGYgGyDuhimdbuhSvusSeezlReiemQKe4Pa5Ye3Age4eherNJey+lery8wbKPgp7VLRa+lXLSOJmCubEXmkMMPTTDO3ULO9aFYWgh0su-bIhAeABogUWnJfADm6+RW1bMEI7fbZoVLJWa28BuuklUoR3ROgujJakMBzCa+5BbcchzrOMRDOFSOAhmWjeZdXELmrBqB6YfVcBlcugeucoPAnWe1Q8QiXVbsX9URRkYW9O4XUMPqJrNeE27W1Rp2wXaCe28+DRoGRh9jJhq2-+9EIB1jD205PrT+puYPfHH+hMVmxB0x0Wm7EiX+wUsBgO8h0jK2guL0ohihsuYJJBsx1B9Bn2v2nm1BQJ9BTZdHAhx3OBzlUoMiMhzoHWzoGJpSFRmh9HbO+h9J0VBiEeooF8Vh2O9kXmOWrhzB6JXhw7Buycb+1ZIR7TEQUR76a1PPcR4pyR79aR7rSGORtDEWxR-0ZRsB+29RrGLRzcHR6iR2-RtjfCDjAokxwBlx13XKpMfKmXd2eXL2JXbAdWsJX5f5Ca463eNlTkp4q882Q1M5x5LG18x5-tN6NmDgaJDpa5s41UuPW0EVSmPKe5J5y5o0RkP3Z0Za7aXA2IbaMcKymy9AjkWFmIDkBFrzZahCVFlOjFqF4w0EHF5mPFjS9AvxzIXA8ltgf0RFwoZagKMecgXwXAhl2hdug0Wl2IZa-VVF-VbsTlmIZam4FWWBFgQwQPYV1QUV52FYAV9G8EQenF2ILq7gXwGOkNXZYe9luV5alyJVmIFV0ANVqTXZdybVzF9AlyVc1F3ZQoAEENGIdyW1nV9AxTaYQ141+10AXZSEI1mIF1mccEYAfVgwbqo19V710AMAc1-FwNgAUhDY9Yjd2Tjb9dAADbItjqVaTZNYIbVYtcDYAEIRJs2w3PWNXQBi2gR83Y2yLy7E2y3k3QBK6Yga3SXA3y6AR9Wc2vXdlO3W2M2IQg0G3VWm2HXw2C2yKg0u3uAige2K3p2B3J2IRC2Q3I27Xx3C3YhqrnRcputXmLn15tbAQQwxNtpuAD3AUnY92+KeAQW3n158AWAAArIagbU9jQVFKTLF+9ia3AyQkVOVooS955SXJ0KW29kD6oqfAbdG5azVXAzVID6y5ayAOgNUNOZl2dtDjDldZD9SoVqgKV2ASAVFyVhgEj-DtnQjkVgAURxfI9o6o4O2WoADlyBWOQ32PWOsmSUb2qQoPMDTaT2VgxNlApNHdlBkFBPmiHF+OBAZO+KWjz4RPpgxOJO4rE51w72-lQXMCY0TmzlhFf2r2GVUU6LmYaqjP3pxRSAF5ZoGBn3yBcwNN2pNAhjNwoO-kx5ljvmiUaMr5LOjgigLHnJgIq5uGJkaqFsjrIvUkOVR5Ft9AoOj3r69sDtFOz1aky7ZnChEukYUvqKn3X3TBZ0nKdPznAUhPdbcvYh2HqmImwb8FKYOABB2GxAvhc6vjamrZGsBJCBGulawRwPzURFjAGBTFOynlSB65jBXw6B8plwyBZvMP1ozxWhGQxu6pJvF5qh8pOsXxpuVuV1K3VI75i789SNWWmWIQ3J3It4PAPtQAdv3QFv+BHW3IvISnChrvF4HAtuJv8xaz9BWhjgmISMIhGIj1zRUxd5Qf6nBBhBGZs0OA25iyYfNJd4Mfcj5D4flnYUDAju0HMPTugRwRzuISfHYhfvbu7v3JsfnIBgKhRA6fPuERwe+nIhGID0ruOI2Xae6fnugf27VVnZWe2f8ffubFAgvoPODQx7+gFAGAxMaMhn7W+d-uhpxudu5feV1IaiOpV5WgyYnbmPCgwNAeyBF5jfqRZpWuMoFfZesscJOtOMTmHvzE3BLfge9v+AluZvie8P504UqX5v9uEeafwQ7u70Nz2QyAHk+1ag9k9XXeIef1usNugQAedffeDZJe+ebuo-o-hB2ppvgRAHXv8pk+JeQwafNf-1tvheQeinSmQ+R43BYf2F4eqeuUkfwkMg6pP4Gf2Fh-pjceW+VhI+ABBDvzH8wJnpPj+NiKgcgHO4OtAHpooHntx6YSP8XoXq32jbFMX8Xu+zfyfgv1dLNRX3X+X6-r6ZXz91X2R9XrbBbrXxvq36jf8QpfXqfQ3n6Dbyxhm9YgFvHXjb3Qb28mc9-BQHAS9Iu98e3PcaHbjlJoYhAhgGyGQDD78A1uGfTbh-2967c3uefckDIx1iwcwBTfCAXb0kAO8YBcAzIC3xgb+NIYxDAMDbBbrCs1As0ZfswG0ihJ6+2vJvn-y5gACQeEhWPKwJwgFkRBNAEBJvBN5AwBYpJIgHmmYQI8j0m+R4JvGvT+hSsF0ZqOVgMFzR3oozZhIoLGjdgj0mqc6DNGair0xw02ZhPj2Iyc8Ig55TcODmohGC7Bc0TOPdFwhNg2+p0P6I8GZo99oGuGXIIQEXjM0XBEjGFEejxjM0EeSjXDDwgQgpVEcMQoYLHh0HpdrKm2aIYvH5rqCJ+oYbflGzAAQ4UgggQounDYD7Y7sdwdXFbmipxCaMjEGMCGB55JCFwOg1ISRRFiqDchIwAYdwGKH-MsgAwgxvhDT7dgnBhARAasytqTCdBlMbPsL3mjLc0GP0AAOTY99AhQ0AAAB0sAKPcNF8m9qVIZAwQWAVllVajs5Q0EPYRvh2HGBKomwq3tsID5zcDhs-MEMcLOEXDL4Vwo6jcLuHJcFwvAZcMgh6B4wYRoAAAF7adThAofLozAhGkBYB2YR4ciJwicpXhYkInh8MCFFItK6AzAZOAOFgjMRMCW4diI9bcBlq5AO+iwDvrKA76wgeENYD2FOg8AXwqbu8P2EYiqiDI2AWW2ZHoFWRPVDkVyJ5FEjwQXkIAA')">function instantiate(exp, frame) {
    function copy(exp) {
        if (is_variable(exp)) {
            const binding = binding_in_frame(exp, frame);
            if (is_undefined(binding))
                return exp;
            } else {	    
                const value = binding_value(binding);
	        if (is_variable(value) {
                   return copy(value);
                } else if (is_pair(value)) {
                   return make_pair_expression(copy(head(exp), 
                                               copy(tail(exp)));
                } else { // value is a literal
                   return make_literal_expression(value);
                }
            }
        } else if (is_pair(exp)) {
            return pair(copy(head(exp)), copy(tail(exp)));
        } else {
            return exp;
        }
    }
    return copy(exp);
}
</pre></div></div>
	  
	  
	  The
	  
	    
	    functions
	  
	  that manipulate bindings are defined in
	  section&nbsp;<REF NAME="sec:query-bindings"><a class="superscript" id="4.4.4-sec-link-4.4.4.8" href="./4.4.4.html#sec4.4.4.8">4.4.4.8</a></REF>.
	  
	  
    </p></div>
  
  
  
      <div class='permalink'>
        <a name='sec4.4.4.2' class='permalink'></a><h1>
    4.4.4.2&nbsp;&nbsp;&nbsp;The Evaluator</h1></div>
    

    <div class='permalink'>
<a name='p5' class='permalink'></a><p>
      
      The
      
	
	<kbd>evaluate_query</kbd>
	
      
      
	
	function,
      
      called by the
      
	
	
	  <kbd>query_driver_loop</kbd>,
	
      
      is the basic evaluator of the query system.  It takes as inputs a query
      and a stream of frames, and it returns a stream of extended frames.
      It identifies
      
	
	syntactic
      
      forms by a 
      
      data-directed dispatch using <kbd>get</kbd> and
      <kbd>put</kbd>, just as we did in implementing generic
      operations in chapter&nbsp;2.  Any query that is not identified as a
      
	
	syntactic
      
      form is assumed to be a simple query, to be processed by
      
	
	
	  <kbd>simple_query</kbd>.
	
      
      
      <div class='snippet' id='javascript_96_3_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=4&prgrm=PTAEGUEkGEAVQFLlAFgHTpQKCyUB7ABwFMAnAQwBcBLfAOwH1LyAjAG2IBpRCBXS0OToATUAHNilXGABmpfAFtQAYwAW5QpTKgAzKAAUAZ2LKa9XWh2WAlDhm86p2nUGHD+ZfoDWxAJ7dSE3xSYUNrUABvLFAY0EDKXlIXakMGOl42Nn1A5WDQ21jCwoB+UAdhYhlqOmJhaKKigC5QYgBHXnIsn39QVWJyYX0+geygkLDrAoaS3v7BnLyw+umY5vI3D28-bmZqLIXxyYBuLABfOwcncwVyHyZWDn1wqMLcukMBNg9O+-ZiUAAvKA2ClKPoAEQAKmYf0h4OsJ0K9kcZhcX3wXl4hC2vgYAEZuN0GAAmZ7LIpvD6gQy8FgwjiA1zuTxEgmgXZZL7KH704jHcmFagyAwpBjlSrVWpGWm8yaRAXTeKJFziqo1YSI6anFpsYzylavehUg6iIHrZk4kk7ch7aV0h58hEKhpKpKgUWqyXzMbCKYGlalT3q53+1bsm37H1OlbnQqx2LIq7Jd5kMGswl+K2gABunV4fP100pAhp9r+jPNm3T4dtXJ5Dv5KyFItSQalpdlZND1Mk91r3zYvw4nBD3Z4NtI+hBH0tbMIE8txO4ubY+cmI7HY45U4HQ8d0a1Or1L1DxbiPorGxZmaXNayHYbB-9zf0HpEEvVo1yITlJ8KAEgVmMSg+3vGUHRHQDNxWedqEnWDJyJW8VzXDdoM3bcHz+SYnSgmJtWIXV-j-MdgNAr88mXPM+U1f14waejQEYxNUVAYQUnnSg1H0BQu0VSRlVAJQARE0BwXRTFCHBUcGlKCSsRkpohMBUTwWqYxSEoaToNKdTU0UwpmjIeRJwUbhwQcLw6HwAB3FwiDIKhnFAABaFzwz+eFaKY8lXRcdjDE4tQTnOLAzwcihUT3RkbjuXknhOM8JAEIEIqc+g9wheSpKdM8+BSggSEi5xMrUlNNK8i4UWcj5AnIBQGA0EgRAYCo2HIXx2zZNqOtqBhDFJQsYj891UnSTIjDxP0AzYwjeuEfriSeRTmgQoY5km6w0PQp5AQAPmpSg6oapriBanrOsGWr+gazCpu29DHv9C6+oG-lzn-T7PoaLAWOc6otFIDhyGzYhWrmy7Ju4F6FreobzwSN1RXG+8psU0oYcW5bQ1Whdhiu+6DIaXaAQOgGyGB0HwfayGiegzGBqeB6nuJ8JScO47yMMKb3qqpMOZuhgZHaygbmxZFuDCeGRuFqgtEYa76qMI7BbF-QJepXm-vMWXKHl-qVaVxXeOlgSkbGjJ70N3j0dAFGVvdOhAcpsGYf0OnYnx5Xjq2j2YhJg7df143vcFzDrZwkK+dY2KwZYap2LoMR9FzUhqAgnNqL44azZcNbU-Tv4qNXGizl+y5WPjkRqjEBgC4dfQq8TsRs4RwSvabmunXObWXE7pO6+oxuE6703EZcbd+5bqPe9AKeGGqIWKAUYgU-INOM7keqCxIkbK08eui9ALeV+78vqvMYgAA95cGQ-h0zkvuBPnffNz8c4J42445HpO143o+KE+TP2XqXUKs9r63wXjIBglJQRnTBPfLgbEqDkBAdvVuZ4p6MnnovF+-9C4Pxfk+Nu5sxTvjVFKKe01pilEgWdO+69CHIOEKg9Bp8HacUBowG4XFVDD2rgPIBAjm5bRQcwdhYDo7-VSMwMQEgFrTjBLkBQhB6AIJ2H0e4Lcx6CVFGtFRaiahO3CAAMlMbMEYhj1EmJUkCSgWi5FR3PvzZG299DWOMZQVuI1RRyIUQwJRHjFBGI0WJOg29KrgIrs5LhZAeFUG4nEpI0M2HH1AT49+L87FiRkBGWo2l-SlHBHkvYBSHZtA6FkZJdBUnMBobJdJ29YgO1FEg-QNSGlFDoTfBh0DYFGngU7Dpct4l1LQU0jhONRoMDWp00A5iZlrVYfU22NSGC8O4tuTpzMWaxG3Cs8gvs9nTHWZs-hXsdl+xOYUL2hzjk3KesQrphlcn5OEOCZxs9DA1w4JQDKIcr6ZPHh-ScV9uABztpbM+LjWJqBMF4RqjBzSpmcPoFFmlnDcHaGQXEnFsX5lILiYh8MzznIYIEGkbACpnMSfwnFRLZlUG4Bi1E3Brk3IZcSjJ3kRrkspRkFKqlSkcA+bbe20yflJz+QC62X8+EUuIFS7xXyYnmGSgbY6OI2TdEGiRM8hhGTJW1RmXwpJeXvzfBUShV1wilBRqAZohhVUX2TBUK+DAiT4BkCM7xuikjrRGJxXmsLnIyEkGoRqbhUVGl9dwyRwLBIaoTtfPqrLnCGDjfEs+s9k3vivmm6NmLY3zN3u-DVIcU0eq9T6nZYl030BcsbKJ0idYJyjRpVEmaakJv9S4Y2QsRZqzpis3gwk9rXPhcoRFQgO0xroPoUdZlxx6zGZM4BdNw0Kobe8LNKT10htnrHNIxAbKDwAY8JBAQMhgyaiCbkUVqC+j7UJb+aR3GGF8AoFg+BBzevfSvAhDZQAAGoxIMHBKBjlsRao1yFL4bIN7GqEEIPe9KjAn0hr+XEJDuQHCA0ZAABhOKG8wNQz2kCQ3e6gD6SpPt2rvXD+B8PaCBJRjgAyWOkFA6APEFqQXsbBnhp2ZAXX80CBEle57mGpGqIhjgmCjQCEE8h1DNH0ML1NHbU9FKqMobQ4+wYJDZ4qzBjZToXh9DX0IK3QovjUjtOs+ED2pRj3kekw3az16OPUdoxlTDHtmj6IXE5lzoL9CmYYOZtglmvZOYeXsyL0XLPbniy86YRkr6EG8oxEaSWLPyakaR-yxBmqhAYPQKzWXKU-PoFRC9yCSUkRM4EMzBXX5NmFK+BzTDPO-gMi+SpnQgNH0dPDbseXKPEG8jGI8xE-ZYJwb-WueDQFWYTTN0M9nyHWq9I3dLm5Sh5KItB15+WYsiJroPEu+2SExiwP+AiRFxv8RBcFz+BZoOlHO7FjaY2AA+-32StaiwV1LkxoPNGO8YTb+FyS5ffj9qrhAavOBhRA3pLUhSzPwG4agfwRsPyAb2-VSm57LaW4IlbjB8FXoPd5F8ABCGZbZBjUNs7EEaDh4MbLpZdoRQ9qHsseUUYn9PQDw7m+6LrbTesE6Ab+R6eBIQq5DFginQJcE07W2L4hsPSEuGZ1aj8VDlsHe6WUOgPPzmE64Kdg089hFC-tysYhgWWiY8YQ14u+YNuS8InqF8FQyupEq2LunzzIigGV6rlYI0SnvM+f757JE7Pv3oSIW3PvGs8vh2XYrlvrd88IHOW8TW34guySJIECeylitDMUkV5TplDeqaX83R3QGtJ6w1jpU0JcN491A7Hai8cE5L9wQgZeMnd48+PwatsM8LRH7jn58-J9shJdHsAKvISz7mf3xZ734KklttzmQuIbfbMJiLu8HTSS7JZufy-fPLk39v6GS5D+XfQWeQ7WvoqSeoUeAvchqcgigEAMA8ASAqAaAeIaAxIrayQqQIIgMw2niCCiaZC-ifUQSGBTs5kqBjkbALas8RBFAg4wi+BfqEQhQFe7cG0241Bh6aqLgbmH6X6P6bAWBaIoIEIkmxA4IksnBv66OrB1IIhf6MCAhwSqiNiNB9BboXsTBIS8hLBrqMy5o1AYgdAK8wyzBL6fi5A8iuBfB1B5kWhOhehWkOa4hlhuhCC-UkhshoStiZaIKyhEYgagwKhchXiOEthGh9h1h12+YDA1mqOlWBh7hDBIw24vhrh3i6hriqQFQyg7UxUURqh-hhhsixhASeB2RYS4IxYQgIEaRGR6G8IoAgOikRhJhiiZhRRBBYkSC4M6R68VR4QtRoY9RBRTRfhxRvc7RlRqILaBeFRnRUUn636v6LhahQ0I0MxXBFW0h7inhtozBWs4hkxmRjAQC4R1WSqtWC60RywI0GxWQCRahyRMcb6pRTsIxUxaKAh2ehxKOxxaOL6QSJRSmZRTxexQhds28bxERnx9AYhGhoo7U36rC7xkRpxzRChnOlqeRDRgSAxiRhB9ULAcJYJeO9ApB4hMJuJ5ATKoCgMThsxuo8xORf4fKGgRgkhqxAGyClxtJmB2xGhJJcJP6wgCGZxKJHhjBXh1x-htxzkx6PJZJ+JJxIyFJZAhg3AfJvgPBwIfB4kOJeJRxBJdAQJ84CppASpc8+A-JkJKRQsrBAJ6GHJbheEA+QpeiaJ-RM45huSVpuxXRM84hwxnpUUMhgpjpboSiiqPqbpU03pGhvpJgoxJUBp28gMmagZOcIKIZgQYZSJ3A5qZcs80ZHRexDAKptpyJQZvBHwoZxZ3AOggR-MeZg4-yAy7wzAjxFRxZapx6Dx5RMZzxlWHsdZPZjAAZSJCW3YUpWpMpOpcp0G-ZBZ8ZK8iZbZj+3YM5GmRZWx5prEoofkBsVAxA1hbZixqJ2iLpyimZYk25Hwu51hRJGh25spaKyZFxIpmxw5G5MijZ7EqI6Bw5uRx5phrpZ5vx1cX5g495hJ3R-2dRzp-5p5gxLRQFn5zgPwl5Wg15NZcK9AiF9APwHx7ED6q8j578aZlQlZvG6FzkbwWFESg4lIlSCCB59JRFoIFZbp2ZPc4hlF1AIFjU1K8STkoMDF5xTF5Z6ZpF1ZYmm5qQxgOKjgq8HwCgJZBuMyOBjRM48llA5k0l+YslN5-MWlZ0ygYMKFe5CCma6lzwLSpZliPhXh5l5FbaRpIExl+56lUsjFwpIwrl9lLglKTlzAqFplysClblQlIK4cwV3lMye5mguI+lslQVlAIVVlyMlsCVYQkZFp7U5Zzl9FXlh5b2FsE04ViVEp5goo7AHglmyZSlfRMFpF4IFV06ullcXIiKa5P5MRShz5WQWxGVdxdwjVlmOVbhihZZYIDVrVQJw1Kq+es8ooaU-ypAAy361QNp0R9po1LOESjKC1wQy1Vca1P5PRz4qQB1O1RUVAe1KiB1qIbZfV75Dg68uIu1S111q1t161dBaeBVf5qlsFWJYkj151jki1+171zgzV75Z1z1F1oNb1ESH1HVG131Tpv1GJAFcFGlYk0NFWsNV1igN1ENkVL1VJXBglKNwZzFol4ZkVVQjluNjkme1VI0xFGZmNWZkVxglFDNFATNHVm1rNYlb51wb6vmNpwxYFtSggpAYgY6jhktSVVlPxYtYxz8VpktLKMtctjxCtwt9keNr1BN4NGUDZKtD5-NhoTZhUINwQjIJNyxcxzB-GqNQNMNNthtK1CN5tmNHer6dwZtlW7BgGL1I5H+QSdN5ZaUfNPtEO0yx6AdC6Qdq8IdS5Ny4dcEkdF10diRodH+hQXNmFPNQggw65El75Cd5NKZqNKl6N-18hFh+m6mYxtN6tk53tOd+VsRNlL5Md915g68tcCtldSl7JYpnJetMygm6KRaqIaptVf109naWK55N6kN5gbw6RvAcpgmap7JO9kVKmRZO9v5KMEWopXh+9vtytbA5mvgsiU28IDso9F9N6kcs1dh+muIZJU9gmBKuKTKq6+6XKS8GCpKZO6R-QjAgmjIEm28c+HAsmC6O93kZ4z+iqyqjIRMaDNuwDPaP+MQG9q4cpEDs6O9qd6EwDeum1aDAq1KOSABzeRSUKmQFSKEu5DAXKhWhZppApwMUDr95DT0UqYgMqCscqNDSqgqpVLgW6kagm3aoy+65eFNLgea7qfU8je6dAkVajqaC0mjpam1FacqVanqmY3qWjYi4IgmTa1s4xs8d6uIBjijUtyjVlA6usw6m40D7M1yjjjUumjwv9K68aB6gjCYEaqggTSqWjCaE9PyqiHGnDuDLjkimqN0apHjQ6jJfZoC+0Dpj0A6p050EMUoP+aoC0O6maKTgDrjGS4ToYkK-jmjNToTzyDTMQL86T9UE9lAvgJAyOc9qQa0oWg+cWWW5uRkpAJkyO5klk1kdkHuHxup7I-TghkVbw8siVgzv5IzEztsqW+zLe0zwQszgNdAVktkLgktKg9AWzhg4xIBrBYB8gSgUAcAiAyA6A8BeISBLQbDWgpFZ02Y2c225B35PtMkckXFxBoRBFw5MkQWY07izBULwI+AGIWIpNv6cLTJ1JLJQ5Pt3AwLB2SLqmBm7dahaLjjVmALq8EtbdWRRLLQdAILHThQIZ-6QCmaA98J4Ju6zBxLrLsdBoZLJN8Nh1kLTDxAdL+g4rRtXtJt+A5LTdlL-hQrILiLMynFIFbZaLMrPwOrSFPVZ5JLWr0J45fLuperTDx6vcU4lrc5kgZA2LNJgr+DMQ0p3D-Ji5LLmr-oZLcVhlNrBodCK4-UdF8VQbRl-lJlTsSZw5GrpLMyg1IbM0Brg4qbbpZrAbk9ucO5AV+hCL0r4bF5sb+52bwr5rqQK5iNPtyNob-zeYu56sHpMZTAyrnZIxvrOborMyfparmB+r4bA7TLANvbKwZLwR9FqLJbPw07Rb7NfrybxkpzbpFkFzCz-avgTs5AV8rk7kGbHQWg9jH9qGCGGsA9it0uLYsyacCgXF1AVM9ryI-WLo78-jKO1AD7NAz7rBrbUtV7T4T2geMuqQ1i5QlprqAHb7FIZOtDBUR7LbwxRZr77L0ES+4RrLcE9A+5HrBowxTrC5aH+HKwV76HTy6t2H8gDhwyr7jYRQ2225wiCH5uMQpQzH1EjZWzowyqbHjqluu26otEIH82DQq7k4GsG7lzizJmazB7ggn9lUsQ5w0S3JzFXL1Ema1mxpJL42DJ2IA9+TSHgLA9SbxLWW6V79GhGbH5j72FJrS7ennVyBTAlGDiCGJn8LwFxrd7tQTd8LzLJLvtXnwSPnDnjZcVdd6ry7rDzbgLRrEXnQ3C-FgXOdSbZdl84b0baVSb8ML4oo0VfTEbMlwbXlHOVdborOOWUuBXKB6wflV5uVosJVFXSloXEdjXhbYIXlnAJLNXAeYnRYZOnXBsClcLmD3YHXGdXXcbPXLXYQfXwr+udXiq48uLo36lcLsH-oMsM3Y3IEQC+uonL277IKtnOXfsvlBbc3ZlC3W0-XIYjEqnfznLMCj1eOOh7Ykh17SlasDtbA+TUIH3PyX3wgcIwh1JVnanel3IjAzGXZ+Z6GCbPtv5OXs7TD5AygygY6GQLbfjKGDCFHKMFH-3cPFW-A1pXaFH+dkbhlN31hKPOdIrfbooo7iJUrTDQS7PrrbZkzzDbAmX1z4bWbprwrYDVtKpOCrV3rApw5KDZOdYuojIhg5PCPVPGajcPDJCqDESn36ohqQIb35C9hUoSvVnKjTbq4LbKpFnUCwLOHtHYI5vNPedIP2hBvwuedj0wXQvVva3yoDPM7YvILL6x6nHN2HsoXd5jLHP6Xy7E9tnC70XYSzn5IZ4QCjIoXyfcLVrxDiby73k9hrruLOfAPvrYuj3lvR31n-Mtn7PQL4vJExfAPuLPP5fgrBTJyoXPPBxkti5pH4nwrrvRQVfVl1X+eTzrqLzEB7z0BXzcBlgfzfi7nqgCGQKv5P6v6kD+gG-tsV8FSJzYK5kW-fDSzJgWgwgAQJgxAT7BSE9dr-7RHipypPDeXLn6pM4vxchkHvcQhfsz-I0q-35IZccy4hUUBBxagvshmaNcOuZEgELQ-+LdV1OSQTKKl1YapQWjIG4ARkwBUZK0qh0wFU0SK2A0AGxQLwS1qOuHeijICIEiUSBVZB-m+gj75gwuWzOgeNRYGCFuAmzTAn3Vc5cC14JcGATXSCRi5rG+bIBGvR8qSCuOvA4ZArhfTskFcifRwF8GEZYdswjvfcmn0t6pZlueA2svt3wS6CrKcWAwecDPAOIwYRXXEA7xo7WFGQKMEjEejfT4IAexpblmqTWgeDs80PCgaAldaZomsX1MwRtCobsUoygQ7lurAyRR5LKVlbcBEL+aYd7B1A4ZL4MfjGkWA6wGwU3wFpnQxADiPFlwSljV5gQhQ4oSuCWCD41odrNbJkOqFiIchxgTQfzw4BJxihHg8IAAB4KhnQ-hE0MXxH8IQ-yfAK+joC+BpastRntSCxBqZagzQSDGBmgywYk48GEob+ilhgYgSywrvtBDWFiANhTQ-nhJ1GEYtj4p6aYdrUSpzDG6iwsSDxlWFHQ4MF+TYbqHCA7DzITwlmIcOOGdAJgfvbKCX2EQA93+5ICBKy0CQYtsQpghoN8jh7vDPBAItrpbxSoTRuhX2P1tCKIBWY1BuOK7GkKd54iQW-HBoE6kkI5IvYmIlmKUC9hDCWYTqREZhB+5iJtwJw47iGEGyssck1g8IqomK5EjrCqI2IGcLBHnMf05QYEivGU6HhBup3ODlbSrzHxjBa2Mfrt3fiq8hAsQuBh4J1GnwR+SIaIVp31GOhORcYTasCxxGwiLBfzFvsyVBGSFi44IpEOIStHogbRofVPAmHEJaiF0jQlEQqLRGFV7wrIrEe6JhF4j0iBIgeEKPorBdIcEhaklSI2g0inopQMiPSIBHFwyRSkP0WfVtDdDrQtoDkU932GxBuR2YXkVolsGaDtBmBIMaKJGHiiN2kokQNKP+BuQmQHvNCsdylzeiGgZ4ZUaNxMEGCJsmoxEV0z1HEJDRCYY0SXGCEZI7sKnPPJbwjG4jHuwBWQM83SSz8oCnzWAvAWwAF59E97R9n+2g6vtO62BfInVSk5fsf2d-aQTwDPG-swY37VDHN3FoOBQW78dkvR2cR5RXxd-KDkmEN6f8wQzoH4vjCBKew5gY4XOhBNGERhYJMQDkAhMfw-EEIqE0FBhKgkaklEOEpRHhOmA-F0RJBbgORP9CISfiAUVDB1CBJ0SaY1EzCRqQk6oSJO3YGiRqV4RRNWADzTgLxMagsBDUKwbiV-xAw4TYgu-bgKqXyb7swMUw0AOJPGouQpJ-scFKADknsx927kJSSpIhAuRXaqE-doUHZgxB3IpkgyVCHUkGBNJ2kg6Pu0hBaSYg1k4ALZJklaS2Yjk6PC5OUmsSv+AAUg8n2TvJoAfdoFL8nWTq8UkzyQ5PCk5JVSAU8aozhEixTQp8k0AKlKBBJT8JX-HoSFNklhT92fQmILlNIkakehAIdSXFOKmgAqpZU6yXtEKleTMpB0RqclIhB7Rqp3AIoLVLalAgvJnU8EIzlskJSzJ7UrKbECBTOhcoZOB8eeLBjDEPBgIEMGrHxiT5gJF4sCXNKtoLS3xoEqKPgBYAAArC-obzWmMlkQ+TLCVtO4HWUCxWQejohKKD7SQJoBJ0GFHml3TIuzZW4Ubz4I-FWcQJVnC9Nvw-FIAdANUFxV8CwTIZ0MvpmDJFw-EhJsASAKhNRmQAkZjyFGVQCiYABRHCUJPxnYy06GpAAHLkByZtkymeTNzGPRdpVIN6VTC7YrSAQl07EMoHyZexlAYiZmUJj+LxtGZAgfmb9P+LctVpKwNWFzPZjsleZfMn6Z2Ss4F5P2P0l9g4E1oiNQQapfxovHFBAxfAV2E6SDHWDKA04mgd2OhFFkfiOA1hb8do3Q4D0lECIIoLX1YjAQsWcY4ZGqVSFUDiRHsYpoMFFnLSfuXvPZKLNZmsj2WgcjpGrKtLHSzppgY0i7gjmCzDuWnUmfshrECi7Bfs4Uc4mwx8iRGx0n4F7IKgezCAdYhwfRU+mzwDSrQ4BqDFIA-pjAr4OgPlGXBkAW5MMxTFbVaCMh65YMThtUHygkIXwTc7uX0yymqQfkHQmwgqKYkdRDJXYlHB4GOKgAuUjsfKBZLcheRyxMQReQhgcCDyOGhKBDK0GOBMR+xjEVbjun0AXy2uAwfRkhj2p3yd0sve+QxwaDjyu5BIqedlLEizyEE1RAcUUEPnLy3I7kHdIIGEAVBRAkCyBXvJO4RBnu-YkMOAvBAIKuxm8hDoaiwW7zlxB8jiDTG6YKBLZoYAdF41-x5NSYp2Y+evAblnzyFNydSH9PTiAtWgcTdDl51Pm4p75ksX5JIFlRaoUYARHLG7NiTyBDKbgXhUSjbkdycwv8n5IjPy5gc0gqVEefwB25gLiFS8zBV2JM621AYD7BGrUAPZqSSEyCtXGTn7lAgT5w89uVov1wYKEFbENOE3PRZEAt5-AcxQQucW6Kj57chhUPKYUPyVuaiu+Q-MbExAn50TCrEtTfkz0SoRZMJQZAwUABBJJf3VgVmL-k4icgHPFyFoBZRDENBd2BcVYKN5Z888MqjwX4LdhJSg0IfNIXMKKF1sXnNiD9hV4J0T0ehUaRCV8KHs9pVhWUXYWrxOFB6TOaKLpayLz5Ai6VEIrEYiLoUb9e7BaMYgUD9uQgQwDZDIDyKtFEvKkLYvHD9LZl+ymapbSpAvxwJPC5JvMpEaLKWloikhNtlPrXLfa4IayK+j4Q1x8lhSPtn0sYV8KRlTsMZfwoenvLpGVvY9gMrkVco0mxsXuUcuulAhjUfTAZlyisa3Kz5jS7bKznvmvtbYCTT8WcvhXrpSF-PVoMiDYGBVMVCKiOM4nsVny64Si1eAAHJWU+gPOgAB0sAU9QOR2yFjBAyFJPLSUVLlDQQ2V5kCebjnWYnAmV-9GVa3I5Uz0uVH+XlfysJ4tQGyMgYVSMk-i8BlwYiHoGtENWgAAAXuuBiC8qigAqnVXquzCyTuAlqiVY9ClWtFWVlUKCL9C2XvBdlk4DlVqoWj2rSAZC+ydwGVq7CWAuw5QLsI+STA2VToPAAqsZRKr2Vdq5VrqtDVxSI1GpcgFGpjVxr4Q1gd1eCC8hAA')">function evaluate_query(query, frame_stream) {
    const qfun = get(type(query), "evaluate_query");
    return is_undefined(qfun)
           ? simple_query(query, frame_stream)
           : qfun(contents(query), frame_stream);
}
</pre></div></div>
      
	
	The functions <kbd>type</kbd>
	
      
      and <kbd>contents</kbd>, defined in
      section&nbsp;<REF NAME="sec:query-syntax"><a class="superscript" id="4.4.4-sec-link-4.4.4.7" href="./4.4.4.html#sec4.4.4.7">4.4.4.7</a></REF>, implement 
      
	
	
	  the abstract syntax of the syntactic forms.
	
      
    </p></div>

    
      <div class='permalink'>
        <a name='h3' class='permalink'></a><h2>
    
      Simple queries
    </h2></div>

    
    <div class='permalink'>
<a name='p6' class='permalink'></a><p>
      The
      
	
	
	  <kbd>simple_query</kbd>
	
      
      
	
	function
      
      handles simple queries.  It takes as arguments a simple query (a pattern)
      together with a stream of frames, and it returns the stream formed by
      extending each frame by all data-base matches of the query.
      
      <div class='snippet' id='javascript_96_4_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=4&prgrm=PTAEGUEkGEAVQFLlAFgHTpQKCwMwK4B2AxgC4CWA9oaAM6kBOApgIYC2A+iwA7dOEATDgKYAbFgE8mAgBS0AjABpQI8VKG0ATAEpQAbyygjoZqXwMa5Wh0L5RoufO2Hjr4wH4VYydI5aZzm5BAFyg3CzkDDIAFqyyCtqKLkEpxgGgALwAfHSMrJw8fILC3upyeewcpBEOCUmpDY1Nqao+GjraANxYAL5YAJCDg0F4RGRUloSkTAyirABuTCVq0o7Krep+OvrJJkxmFqBWNna1Trspnhu+-oGNoeGRMXGOiRfNoOnZR1MzcyyLZZtGTvD4Na7tAL1MEfL45ejMSrVchnbRo7p9UYkCjUXKIzi4cSkNg8GQEQjKWi6AyuUzmGiElikaaEPwVNjlfEcEncMlESno3pY8a4xnM-hs-Gc-LU3Z0w7HWz2aXsO4NTxK0Sg1yhci-WYLJYQkEwoyxFjxdlvU2fXTfMUsyX5FWcZG1K2CzEgUCUPgMJkTKosABGc2U3HwpFALEEoAA5vssN7cAxKGxQMRojxpgxQABmT60Jgimh5tBlvPOYU4mgsWi0SjEGQAayYEmUzGIlAYAipO1p+3pR2smpkne7vbVqU8RBEuD10m1xlCTAAjvgWA5W+3QObZHux8WJ1S0UujJ4D+Oe1Sz6BQnWG03t8o3Yeu9fPThySXQCTW0HQyYdIaWMLtCHoUBREbTcALmTJIKsUgZAAIgAKmqQDUOQrpdm-GtIMoShm3wXltw4JRQDI7YQKCMCINofBgwwuCMmjetGxbNtyJfGoZCg4gYOYphBVSchcE+Y5ZyYedCFWBimJDOY0X7Jp5RoKSZOkbpUh6UAxCLFTGjoqMrwEeCHw4qieJRORGKEkTVMHBVrA0hdZFMqcYRnQRpLc29UlCV8PO0lI+lcMLjDwiYfiLBgkLIiirNAeZN3wYTDLcYy6DsxSmHM9iny4ijX34wTcocoIxIklyfM0+IcsA5SaIaItSCDGzStEWCmGhG0jEeKJREQziJG4sIIiiJKUtENK0V6vq3BK6Cuvsiq3F0-S8ua1IstM-LHxGjhNGs2oGqUnDmiqmRJNqty3wnJr3n6VJWva06FMApJnoW4wBpkP6ptS4T5p+oJX3k1acO+owNtEAztqaV6gqPHtlGm2aQsaCKgmx0Bcai3EBCscJSEzGQ2FlVI1N-TIMlY5CoKIkjkP8jwCKZ7hWaMUJ0zp+m9Vi0gWa8mKZlILm7z0hhUyiNhlGQohm0ISgAHcaF9GYA1xABabXQCE7DMbxuUnJoInaBJzMMRwLKNf9Gtuvgv8liEgJuiyhMo1Yu2tdZV2GcI4juENrAsojL2fT9X3upQgWxZD6toudjhgz1InCDjGQUoYchcrRoHKeMam-uz3PPuSgvrYJmhU8EPU4w4UvcpkWv07jQujGpg9W-rnC+mr0Ae4zxugZbtPe4y6nXyH9uq7GfCZ44PUOBTdggKb8vV7YdLmupiymw3sNQC34S5+xaKmAADxZWRD56iuZvvk+O72A4aD+5OZ6zlgc7zh-ZuUM-a2idcRXxvkvXAHA6KIX4EhO+6wmQsEAf6beL8soz3govZeJ9v6-03ig0+Js37Dg4K5WSsgZ6eSCJ4MB-Bb4-zLkfAQiDkFryoW4B4TIcyshJKTaIY867D3RkBShCDqisNQcAgexxqhxgTEIIa9AZBdjYNwagsCXyxCDO3SepsSF-RUWo2SUxdAADJTG7heIY9RJjaasVIFo2RUj57RUVGvZRaYjGwJftTGRLA5G+EUUhaxxjSDy0IGvEOmIB4k24dyJkZNYkzApCoFhx8CE+L0SfOxoBkK4BqNIYWjRPB5IKQIIpDQVzrk3P9LhySxEsHYa4Tw2SjC3l1NYO+tTxQWCaWzWhxQxJQOoLQGBUxuncIaRI4S7T9ETQmcksxFjjh-WYdUPp55xo9J4Qk-hr4km9JBqDfWvE1mNKOaDA5Oy+HPAtAsw5EtjmuAPGc60TybTPw2ZLUpKJCnOPPriUZGc5ikGoE6dgMhL6ZOIX9S+yg4SgE1H3L8LjcSZmLM2LgrIHxiwmDIHFcUJjKHXDMUaJNiVpQYKNZ+GUsq8MzBwZgDFRARyufEm5JKqUcHJWxQWRLQCPKeZy6lGSjbU3pdERlTBmVezprk-Jvzym3g1KcWZQK4wgrBQiZ0EqpUyuRSAmgntwUcm3IlNs1FdhZVoPBT2I1zUSB0GKvRN05x3T7Cq+wktaD-J-GnK+HAyKUFwN06F9JbmyBJp+Q1x99gMoJTWWg9yUk0t3no41-rL6+ATRMJNVzkUDwzT5LNQgc0jOTWGw4xrtUQszYGriwaK3yzLYQbWNa2BRJRQChkacuD1lxeWq50zK00HbSvIkPITQfDWfgXmWRBXouIJimMfa+XUBkDOuWWzJnpLYRclIuA42SpbXmupFhh0GoHsnWSKsR54LmLgxh98GB2CWIUIaAkHbkAECO38LB-wRO3nICQbBgyUC6sGmw7i766AANS5I4MhUAsHBWuARPXMSEgxyvq4LwD90dv3RpBSYHDXYiA5nggABm6DGm9jKcPvvIJ+wM37gJylI5QcjMx4IvrmMMrjuZ4PyGdcQ3jSwyP6l9fhZggGlh32sHqbDSlaUjJMgxvDTGCNmVYnRsTuHuD4a-bIC6kVUU0DyEsFWm5mwyCvtwF+A5iHHC6XZ3QEtPDXqYLelzl9uAdnUwZzTRmvk6jmU8Vz7nxpPAsxwKzogbMHlc28n6MW4s2dfElkLy49K+aNrjKezBLPWaU4Q6JZmvBFF7BwdddmmWjOoPne9T8MkZQHql4rO9tRXWcww5uwkHMpCumuDcDh4F6UeqaAraUjY6T0nDLajz0GYPHsPbBBDbPDpm45JzNU3XkJbll4px9NxFlQxw-WhXYvFcXsIg7JmsYDFhvDfyvjrB-XSmdzw7X4sRts8pAAPv9i7TAis-Yy6eBaoR8nza2zDXY+W9HfZs7V6V9XCCXvKwMoQQy1H1nIIBR9f9hHDpU+BKMGDWJYNZDgsbQDdhXQAIQkLIasShA3O56KIJh9lZMbuj1EQK95rhie7skYL4wT28rdc6b1gnwimo2m9KhZX2p0ErbjMtwRDc1vQaBpt7U1Mmeut8vtyhkWue4FGhKwnn0zuND54-ARbdktC9FzMmEK5r50Jt0fEXdPwpzYMldEQlXrDrpF7TjJ1JQBK5V1TPRPy5jlLy4Hhb8fiFY59-fP3or4dChjRbq3uz-oUW4MdN3v7sl83lWUip04a+KrrykKpI2S-hh0Mqt3syetNZL25poNCveDMgbj0ZBPuCl-L8-bvMve9l-70drHEDuWUDx+P8vE+Scx7AMr1CM-uXzIn0ssLUR5+d8LzzvZvEj-7ptPsnQt-TQX+tweG-dubSv4f+-00nzZmJ7+fnsmGZjaimGmBADAPAEgKgGgPIGgJoF2n6tYENDmDUiEt4rojttovIhwEEh4qojYmErksgZrKIJ2gPMQf6F1LdmgbYnoK4EQkOAeK+DQaQNGlev+ksLJsBqBuBr+rgchLJshJSCBmBqIBjt2nQCIeBtVpAlwSwb+kwbxPIeIYgauuQHGIQNvOMvIRgUOH4gEgosNCwc2njhoVoULAWuVg+OoZobAn4FIQ4DoWmsQooTZK4Y4Z4gQWiJ+APNYWYXYcIhwCjnjuuk4QwYcO4TIMwZ4aEt4VJq4tYCIMQOIPbHimEY5nodYLItgbgcYbksZDGG1EkSkb7NhKAIDrePoTkUYTERorknfCUMkT-KUboBUU0FUYEjUfgaEvLNXI0SUTWJ2jGsUc0Q7LQA4XgV4rQckNTOMTwRBrIe4pEcoZYRISMakWCoEcEWjpMV4YZF3C8K+NEd0d4mweVsnAUVMP0aMXirJvnI-EEb5nVhMHwcNMhJcUUcWAMRMEIYimvPcWlI8dwM8dQCofhMcOIKBswkCSCYQLsbEfsS6lkf4tUUonkQzOwMGNCdsT8asT+JCViSwAfgQjmPYfMUmukRzsQpOnMaITIVBtvMoMsbUSYj4eVgSdCWBgIFhpSa-IwYcbxMcVMawWcRIcnByUSTieuuECSTMLQMoFyRIK8UohiVCZKU8ajj8eGM0dvDmPKYPJQNyWCQkSvGZtcRsXCU4dDOLlSZkVgZ0WiSyYQXkmaesS0WfD+H0W6Q7HIU6cqW1MwCGnkU4B6fhF6V8TcWCjKWvHqfCegc4UOEElKkGU6coE6kKAPOGU0RaSnIaTyX6boYcEmYGXGVMMoJWKGdFFmStJQMMmToUf0aWawYWTQBcapg2d6XihLNWZGayL6ScSYo-m4OKZidiRqSEXCWdj2TmdGbqXKU2S7jCNOdHIqQuaKaoWpGyEyEwOYQuYiZgdkQ6cEqmbkpufQNueYWQeVpuVKZaQWTRAcXckKV4cabiMcGBETDWKgfeeEZYMiQYTgV0cKfLB+eQF+V1LeWUW0Y0B0YYY6QOc6aBeBVudMJeXifhEhRMDBMCdIEFkBLydTMWdJE2coCGRmeVphdQDBHRMNrAnuQ+XokRSmQhWmehdFJRREl1JuNwgGIsPRTMYxYhMmSRfmK+X+X4LRSQEBPQGwM2QxQeSiUeeULJfLEWCSlJVeRIWpWlFJShTubAkmjJXJcYAJS4QKTZEZWyRIfOAwPQHpbuUZX2PJfyXco5WxbiEym1OeahQZcpaQE5aZUOODMSP5e5eJTudwKQKNNpfwMQNJSFQFUXEiScMqG5ZWW+UgXWF5dUD5eMm5fuXaaOMFbJSePERlSnPxDZryXyc5PaXBceSxbkqGI2M2JpT+M1UurmdyfxRkREeZR4QhVZT+J-JVeUBefGb+QhCqR1a1ZSDlfpSYmVeJT7KCgwMMqBnqL7PRdaZNTdD-KNCtd2OtbXFtTodBQ0McCdVyodWtSoidTWAueleJUQPtdVlHKtcdZtQ9VafQb1eJYefVSJQrBEtde9UdXdV9biU9SQldQdWDbdWmPdWkfeTtX9SQgDYBfBcBU1ZtaDZrB9RDREoMWFZHPjUdbSeBj1UlcQkxSJWRf3OVjZXZT7IIFTbaUWUJSWXkemQzVpUeMUCzbINVYRZzcRXkRWfnuwf+Ixsxuun0becoD-HGLOnYbeYldTYmW8TLaUYAmaQrdGAwMreYTCZqSMmJaTfbODYjZDWCqCvpoZsjYNaThBDdfBDdWSaIY9btTVK9e7YTadX6Z3snNrQ9deu4jdYuULrgUzW1ILWuV8jzBwfbUFnimHUBhHUOQtNHZEMzVHKzfIZnU8kWB+W9ZrPnX6eueCdYCHY7cKR3K9nVZjQ1djchDXdQG1WGXreOTsQRXosyYNSTUrSbRORST+RrX1U+YKUoRXebccGJviv2oSqCS2ejYpYDS2vLGJh3exdQMkfgDsWJgof1SVkNdJjhquYfSvYqKcFEVPTZIfRDkdvwZuFZhIFkS+kwNhLMpEUFK+nEZLVYXhqNESfPWJhSqSgftsuA1yqmlaqphmP8KyGJjxvwGvHek+gpnCYfUbFlBfkynYBHKzM-sXsKpA5Mt-qBLvTND3Yg-RkpIXc0KQ-7uPepIQNzvgyyjkv-kqgPoiqqk0CuOjNuRwMKiVl1TybQ4fQw2COqpqqyO2jIHg9KgQ5XVWUenQ9KsmiTgmVWvsEvMWr4GJqetsiTUWiICWho8Y9wr+tWuyNdMWvWgdSGvmpva+m2uyEMb4UA5Y1oxXivWOmKJOlzMg98IKu+sAxoyVtqVAxXgw4enwj40OhXgakAd2iAamOmFAHAIgMgOgLAfIAgfhEwEI9MCJfwPMPXclRQd+YNWeJ4NU1QaPPIWeB0gyfhYHU-YHCRB7dIbdhTQsW0wucoOUxsq023XebU0duE7ZiU0BPLd3bXV4cM4QBU9I8YEmZBsIkmkPWrUM3pCs4-QFCQn7dbUTYs7EXU3pLMzICcxtWc7bbWeM3syMy0yQhxTU3XZc8U9RdQJ+VhQNdjS8-cCQhKcPT3R0+qH+v+NXHxKOUSbOfsDMD03DEMxQ+s3C+I88wc688cDFVJQuV89NBJepXFXIJJXFfZb5QXfsxUzi9YDNQS4vkSwy3kUC5UiQmefNbuc00yzBJy+NdoSeWy0c8cMud9X6ajZC98zNNuXyN2v0VULWR8Y2dS8K83iQp2aERC-XtK+aQHY1WqyECQn4bYYK5M1K0Sya9y0K9i8CzMDLEDYrMrGrJIVMCwJfKALrFc6lNuZ44AwZlhuSIrYberUcOJNdG9jnGwGBeQICDC+SBNm4HvN48CeQNGxQHG2ZnK8G3GFSJjJLmG9VOtWorOKad2nK4m64LtMo5w6xNKxuKU30auQm2s2CEvuU5ENQLuWi40H0Qi7GS2z2w0ErfKUO6kPLSs526a0hAm2tOzeJZubdhw6wazJ4Iu0DHWSyEhMu1lqECzgIPm6nhlEYPa92Nm7kk66rAyOVlFXwJ63rOEyHBLgAxIRs5Als7Zr5vqSM8e+KqSErZkDkPW7K0rcs6szltwHmy+z+Lq+8wCwQWB7+jIi+g4lhsB6U3B9yswETJ+u04NYh18jQtc5hzRepc3UszSwnd6zKxh78zG1RVxSyskrxXh3XYh0tdR8SzpaS45YhxlNLkEaolFVx7FfFSVZW0m5zrdOQinptIWxGzgVlZS3lQlRJ2jeh3MzndlQK0hG5YoCM7J-Nse5Q2TsfFp2yLJSPI-PBP5Bp2SOZ95Qtbp6p-pwc7DvJ3PabFZ2lPZ7ZdlZZ-LuzpJ8QjHRZ21MIu5wWwjEENTLq3i6S48p5cp-5X5VSK5xU5F3nmVq+0JZBi9aYftv06GzVa2aSP04B7kqhPl6MhodIFhMIeSebbQAJKyJxp8dmb7KPU7To+JfF6x14Z3iwMQMQLOnYLK2E7wHQq25qK2zSS19VpGHq4mq22huS0sI5+YV13XYcyK4kRGRaYy0-cNJq-IxMcobMpqBx7qyyzaxU87eTnmZgpVZi-ITg-A51DaqxM1yum10t7mi3HmfdhmPA9VzYdIJ91NbHZAqD7V7IB90D7F9c4qcM0PkIB26mNO3xMtKO67gtDD+QvqWO31CM+bbq-y7leRz0ZRyvcnOu47hLHZzeQs1q-h5R6T5awV9awawc-d--HlHW9c1awERu7eVixl7sCa8i950BEL1cf03syLgZ5NRF9B0U0Syd2Uzz81JL-09Lxuvt9HPL9S2i3Zyd9L2C+c94itzCCM9b24Er2jfu8AqkyWOk2AVk5AbkzAeWIUyaYwJGNEFhlClffS4RIg5CgvpC5fLMqe1EHCk1WH6wDQHZsWNMAIB2MWEwLG4UubcnDC-23KQqXmXxz15DyhNYqW9XEIY8gX7ZUX9yex+RRIe+Z4ZX1m7gEh-+aiTOyBa38UFXyTX2zqYi7ZWSP6cJbgKRYP2ac2+PyWZP6ADzTGhO-MFO7uR3yvbTQvxLdl8NUnXTz52BFu-6ShAf5-coEf94tDZ52-Hr-LiH43bgSLshGf9vR5V54EZf+Mvf6X5EYF1dyQCgjqogik7DHruR-al8MsbnJvp6XM44IIBk1RLNAL6BZQHESwCKsJ3R5dtYE8ES7r71xB591sRXAEtKl-R-RiBfPKDrzU9IEJkWSaVNL9RYaWI7kdOagWGVoEfsGBJlNGq+FYH4Dk+qPEAavzAF0UKB00fUsGDrDoCtek1OYBnAcTcFRCfYavHILjAKDxBhHKLLLCTo4IxBJ2RIIPCkFCCqOqghQUV10AAAeSCPwDUH8INBneWPihFBSUA-0hACQAbSNoGVsoGmaQKECQzwYzs6GDOJhkUHgY+w8GX4v4JtKmgghcYEIRoKo6ODkIzg2NCrA8Eq0pgNqBiD4IEB+DkM0QmELEJCHmD8hkQ-IYEMYAYZLc38OGKo1xCMwg4UvPpg4RL64RMcKzHAoRF5AIDx25Wb7nCT0G1DjOMXZKqOHMGfYaWnQ30LZkAGr564QgtfnRRJ5nZQg5XavAeHGELQLwLwewZDjoAtdb6FlBwmlxOQ2QEhmXUSOG3KY5I0BgnSKqNCwHTsgurgRwf03lhEAwMs4P4tvCfahQj20XTKPAyrxmc-OK8dbA722xDh+hZIWgUVxhF7o0WJ8aXvQKjwXDn26nDoYzG6HID+BvKGwk0NHhvCH4rQ1wAPHKZTDsRd3AEQPGhGDDiu6eQqjfU2F9QaEmIroTMOSJzDh4jw8AQc0OznY1hcqDYccP5HNI6AejA8OIPuKijss0I8GCKJOg1DSq2oXSF1iuErMbhWiDAQ8NAHYDpizQV4S0IvaEBPhsYWTPezxH+EpgvwnGP8P8hZRgRoXeAdAOaCzEDhSIuEc-Dt6kiOBQMFEWwiB7hQ88GI+YBSJmHi8vQYAauG70yYQEcm0BWAtgBjQrIo2MbTNuWwTYFVaqGNaOvyFySpt022fN-u-FTEZslgabAzE5y2qZjnKE9WQLwKIDRow4pY7PmW1d7wRcCoIfgnuF+LGA9wHwSOmX2SE1BexRgN0AOIuT8EBoo4rQROK7FvEgkM4oJHOJSD8Fr69gX4uuNECNBBx-Bc2AZkkC-F9xagHcZOLeKx9RxsfZoLuLeK8Jj0wYWgEITvFcAHxDQG8SqVgwzi0g8fJUhVw9bwZ3BoAd8UhGQjawvxRgSFMoF-HfAPWesQCcBJQjawXqVKUcR61cDfAjAesNCQhLQjgTPgP4u0DkA9aoRQA8Es8SqWAB4TIJpEwiaAA9ZgAyJ84lUgAFIqJBEv8aAGYmkSjAOEvmF+OonQSiJOSJUuRJAkM46Y-E9iTBNADiTWIIkpiSBIsFsSoJtEj1lYKMDyTVxbxCwRkHAkCTVJoAHSRpJwlZBlJNEjiTkGMmiSUIWQXScoDcD6SLJrEGidZOQgM48JdEtwBhJknGAoUoIHCM2LTZpilgfRIrpkG1CTo9w4YFsemNd4BT4GBY4KW2IdiUBgwAAK1T6fcIppIckBVynExTz+zA+sbxFnaDi3AiUssclNzQ4RQ4CUgqXWXPKZCOxw0fgvu1+L7sypUdN4pAEIAyQwKEgXsT1L6lRVOp7yfgs+NgCQBRxE0yAKNKeTjSmQkqAAKIzjnxS0uaccn4IAA5FgFtLwk7StpMomEPFNM4VTWxyrMKRkGym8hiAFXA8MQAMFnTAQHxKDoFMLHPT2yVxLZuFNSCTpbp3wZYnNDCD1SXpNUrxgGyw5BTKp8bPMUrSCS-pwm+jUhD5FmASB5haUgEHWGIA5xIqU6MEE9PLGqI5g5hasY2LWZwzEIXQNwKr2iitRumPIuir+nba6jMeEsQoN7gJlVStUxw5QN-k5kXSFRbMybqzU5l9FUpGUsgIT2OT8zPp4XP0RtOMC3DtRCwkQYtXzzEZbhGqVKTBAZlTB4IdM7gCrL1FIQwZ5WGUkWBEaUpRoiwBgGBiLD2Nw4aMGYHbP6loJ4Gq4eCObKWCiM9Q4cIHldBtkuyoqMkuVMhFGRyCLCwwlQMTDUCISvWwJRsKjlADCofg4cTCbrENgFDjAx4yQIo0IBezLZpKGQKuHRB4x-huMATi2mLlqdjAFoIQHpiOpVyW0mLEuYGOMABznZcw4ObJNyThzYEZRAEa4BzlYZQJusL1i2mjACARAZkMeWPMzlRdcYUXbUMPLjmzzk5VsvYDKhtSzy55bcowMPJNR4yWo7IeJLyEeRV550P0IgAXNEZosBY1QKYLnFKargL0azDToXKpTFzKQ9cORofKRT-0gxu-fCAnLir1gP5WGX2ZGCdm2yu5v45qAJ1HCQKRSUcleaPL1joduw+sGYNGyJrSB72YEoHkvJ2juzPZP8C2T7PzmRg950ci2LHLQV6wBAOcG2ezG4CpzIw+CjOdQpXnXyyF3sq2dXOoWVzF6D1VuVHNcB1yNG1WNak3OEWBhVyrc9zkPJjm5zkIAAQVkW4g65eC0FKkmqCGCiwaAG0etDtHNBUFO8vWCnOXbbzzFkQoxS0GUXRU7GXMMdEEx-wEJAOqGHhbZT4VFyBg1pe+YUSflAQX5yTN+bM3AVfy6AP8-YFqjsb-y526I59rjGX7mcYwtAFWDMAdlULeeHs1iDfP4VIKgeDoghBD3fmiMQlsjGJfIziWnA1oDdUcCfBvC8MBCLgiVPXF0UsAm8RrLxeQoKX1lH5srEJQeEaX-0gFtMisXxnKVWyyG9SN3Cal-QBMJ0pIbsu4tCYLQx07M4oMaAoYyRS0Gi8CMXOmVJMvRFDBFIjKMaHKIGxyqPNIw9FWhgE+SiBoHNXxAQAA5AmhkC48AAOlgHnqbKhAdtXAN2A5AzdSJKk5SDCFeXyxnlRYEOI8q5Qwq3lHy75b8tfT4phZAK2skCoYAcg-o+ANGAYJ3B4rlAAALyBmgAflbgf5YqxXjAqs4UE0ld4QWhQr6inc2FVDDaShc0lGSqIO8oxU0rsVHIH8coGfqRDgwkQ4gJEPKRohXlOEb0PCutlsqkV-KwFXSuFVDjOl8scVSBSlXYRtALK5CIbCAA')">function simple_query(query_pattern, frame_stream) {
    return stream_flatmap(
               frame => 
                   stream_append_delayed(
                       find_assertions(query_pattern, frame),
                       () => apply_rules(query_pattern, frame)),
               frame_stream);
}
</pre></div></div>
    </p></div>

    <div class='permalink'>
<a name='p7' class='permalink'></a><p>
      For each frame in the input stream, we use
      
	
	
	  <kbd>find_assertions</kbd>
	
      
      (section&nbsp;<REF NAME="sec:query-match"><a class="superscript" id="4.4.4-sec-link-4.4.4.3" href="./4.4.4.html#sec4.4.4.3">4.4.4.3</a></REF>) to match the pattern
      against all assertions in the data base, producing a stream of extended
      frames, and we use
      
	
	
	  <kbd>apply_rules</kbd>
	
      
      (section&nbsp;<REF NAME="sec:query-unify"><a class="superscript" id="4.4.4-sec-link-4.4.4.4" href="./4.4.4.html#sec4.4.4.4">4.4.4.4</a></REF>) to apply
      all possible rules, producing another stream of extended frames.
      These two streams are combined (using
      
	
	
	  <kbd>stream_append_delayed</kbd>,
	
      
      section&nbsp;<REF NAME="sec:query-streams"><a class="superscript" id="4.4.4-sec-link-4.4.4.6" href="./4.4.4.html#sec4.4.4.6">4.4.4.6</a></REF>) to make a stream of all
      the ways that the given pattern can be satisfied consistent with the
      original frame (see exercise&nbsp;<REF NAME="ex:q-why-not-append"><a class="superscript" id="4.4.4-ex-link-4.69" href="./4.4.4.html#ex_4.69">4.69</a></REF>).
      The streams for the individual input frames are combined using
      
	
	
	  <kbd>stream_flatmap</kbd>
	
      
      (section&nbsp;<REF NAME="sec:query-streams"><a class="superscript" id="4.4.4-sec-link-4.4.4.6" href="./4.4.4.html#sec4.4.4.6">4.4.4.6</a></REF>) to form one large stream
      of all the ways that any of the frames in the original input stream can be
      extended to produce a match with the given pattern.
      
    </p></div>

    
      <div class='permalink'>
        <a name='h4' class='permalink'></a><h2>
    
      Compound queries
    </h2></div>

    
    <div class='permalink'>
<a name='p8' class='permalink'></a><p>
      
      
	
	
	  We handle <kbd>and</kbd>
	  queries as illustrated in
	  figure&nbsp;<REF NAME="fig:query-and"><a class="superscript" id="4.4.4-fig-link-4.6" href="./4.4.2.html#fig_4.6">4.6</a></REF>
	  with the
	
      
      <kbd>conjoin</kbd>
      
	
        function, which
      
      takes as inputs the conjuncts and the frame stream and returns the stream
      of extended frames.  First, <kbd>conjoin</kbd> processes
      the stream of frames to find the stream of all possible frame extensions
      that satisfy the first query in the conjunction.  Then, using this as the
      new frame stream, it recursively applies
      <kbd>conjoin</kbd> to the rest of the queries.
      
      
      <div class='snippet' id='javascript_96_5_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
function conjoin(conjuncts, frame_stream) {
    return is_empty_conjunction(conjuncts)
           ? frame_stream
           : conjoin(rest_conjuncts(conjuncts),
                     evaluate_query(first_conjunct(conjuncts),
	                            frame_stream));
}</pre></div></div>
      The
      
	
	statement
      
      <div class='snippet' id='javascript_96_6_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=4&prgrm=PTAEGUEkGEAVQFLlAFgHTpQKCyUB7ABwFMAnAQwBcBLfAOwH1LyAjAG2IBpRCBXS0OToATUAHNilXGABmpfAFtQAYwAW5QpTKgAzKAAUAZ2LKa9XWh2WAlDhm86p2nUGHD+ZfoDWxAJ7dSE3xSYUNrUABvLFAY0EDKXlIXakMGOl42Nn1A5WDQ21jCwoB+UAdhYhlqOmJhaKKigC5QYgBHXnIsn39QVWJyYX0+geygkLDrAoaS3v7BnLyw+umY5vI3D28-bmZqLIXxyYBuLABfOwcncwVyHyZWDn1wqMLcukMBNg9O+-ZiUAAvKA2ClKPoAEQAKmYf0h4OsJ0K9kcZhcX3wXl4hC2vgYAEZuN0GAAmZ7LIpvD6gQy8FgwjiA1zuTxEgmgXZZL7KH704jHcmFagyAwpBjlSrVWpGWm8yaRAXTeKJFziqo1YSI6anFpsYzylavehUg6iIHrZk4kk7ch7aV0h58hEKhpKpKgUWqyXzMbCKYGlalT3q53+1bsm37H1OlbnQqx2LIq7Jd5kMGswl+K2gABunV4fP100pAhp9r+jPNm3T4dtXJ5Dv5KyFItSQalpdlZND1Mk91r3zYvw4nBD3Z4NtI+hBH0tbMIE8txO4ubY+cmI7HY45U4HQ8d0a1Or1L1DxbiPorGxZmaXNayHYbB-9zf0HpEEvVo1yITlJ8KAEgVmMSg+3vGUHRHQDNxWedqEnWDJyJW8VzXDdoM3bcHz+SYnSgmJtWIXV-j-MdgNAr88mXPM+U1f14waejQEYxNUVAYQUnnSg1H0BQu0VSRlVAJQARE0BwXRTFCHBUcGlKCSsRkpohMBUTwWqYxSEoaToNKdTU0UwpmjIeRJwUbhwQcLw6HwAB3FwiDIKhnFAABaFzwz+eFaKY8lXRcdjDE4tQTnOLAzwcihUT3RkbjuXknhOM8JAEIEIqc+g9wheSpKdM8+BSggSEi5xMrUlNNK8i4UWc0ViAUTRcTeAArS5UX0YgAA9CDCSJzwSN1RXSTJ2q6sIjh8ljnKqUgPgYZrWpG7rnj6wThkGTqlvG85JvMQJZvmlFDEWnqIhWt1tw2safKwHbklSOqGoYAKWuq+hjuWvz3VSIaskuhEJtaqa4Nm56Fr+3rPrW96tpuwHduIEGUhe0wjvB07Pou0b-tC27QBqMQqFqBh2jIXx3ohgS3Shv6Ydh16XCa8hc0MZRSGoTQGA2vbDGccn0cplxqax2ncea-Bqn0A6Ue4ORyAUYgGA+QI5b4mJPtq+rKEa+hkbaqXKCWUNSll+XFcoZWFEU5oxYlvaQP1o6HesND0NiYgUMJ4n81IMnpv2nWFqdyDXdDE2FaV-peKdUK8FuwxQDkRQIBgeAkFQNA8QzqqkxaD2tElxRCHoYg6EobgS+zVX1dSEEtAoLJcnq4vS79aY5OoOufhQ4gC6bmoW5k5pBrlnvG6L-vKFb2TgXwDEsUV3wFBYfBB27oxF+Xwd8BkNIR978eS8n8u6ErwevoYDRCBBbk9cL5vJ5k0pL7YMn3bzQn9Fuzmuu53mx-v52LQT7OwMg0acIFt4MG7kdcgpAxDf0IL-I0+8AHH0rlPJSoo0qUGCHNRQLBqjpToCgieGCZhv1XB-bBuDG4ELoEQpg+AL6ECvtQG+f876kLQWQ2IQ9UhvHYqiToJDD48JiKUCheCRAd2cMI-+E9uFn1FGwOWLBhDkAQUg4h8jRGPyErcBWt0pyqPUQwecFB5Z1wXkvFejtOGiJdiHIoKil6mOXsIMmOiW6KP9HwxWbR8yOFHvYge-oJErn8STIJRgAkl2UOHZgWh5alzsX3BxQDT6+PPuwDwXgRGhINOEn4OTlB5K8WXDJYjQB+L8mbQmySwTlKqUUwctSPj1MPvkipFcql+K-hUZQKjipvSaXhUAeiKEdHzv0kwg4cFSPaaXJ6syumAJ6Uo1IAyhlENWRMiJWzYE7PKT4g0fjzTUDEHQBpuywm5x+Ocy51zjmVLPsZYIXTzKWWsnZakvhS7kA6q5dykzCaVRxnDFwz9fYOG4LAsQJ1lgvlFIg6gCgZHZkMRCz+DhfwKk+lCsxbM0U0AxQwIxyJYVwLGssAiRF3TClfPwu+5QyVYuRLihoZ49oZAKiC6ZEKGDuOhXQEBTjQydS0CITmJ84L0GuaAsVCcBXmJHnXI67LHGKoNHCwwmqtXTC-hXWVVzOnssbEUauDBalr25WwB+Y5SjWuolIyVYJbX2u7M0NsGoaVHmIgqN5k4KViS+bZFwuMtYkCBYIFhL9KqxHOOC+mwJQQMEgdA463DCyxE+jcbEcLAQAD47mUPznC7h5dhZnGzqxSRAiZH0DkSE7pwDs1nTukwUg-BVCvzzsE6RQjByINqGwj+TTuFVNAC0qZ-bBGyMHJSWJpdVknNOSWmdBcB3zovnasg9CSXBLSd4ypIUa3OUkcYKJ8SjCUAUAbLNJEkX3U1riS9gTr0fDvRMNthRPreu8rSvUT6GAqNmu0pJnTP0Gw5fxfqLg+U9z9iBcDdVIO3ug5wHpAG-U-tiGeJDZs71QOooyAyCHP7A2Q4k1Dy6oNhEw8A7ygoGWiidauRDlHCMgW7jB-0n0CNQeI+xpjCacMkRWJ9C9S7r0KrVgjKjHSUk3q-c7LDIZGKJrPeYcBaad4OAeZ+QwG9bGq3bfo7ERmbFsCLWJSE+m3AXPVHCbglnN7UqTTnFmQg038GWYMw5qJUkHxbm2y1b64mHuCx6wpghlDKF4AoDIH9ZMxEviXYQerQw-Uy-6PNRhuSMHwL5g5wz3g5dItJhJimDarMmFbc+JWjnNsne3GcjWoquZXrV+rP1T10xzpIkpZTm0PvJGeIVjIhuCvwB41Z3kzx1l1IyLzhXiuzIC84I6QqnwqCNAIezPNLm1HjkCHTkCDuOalIt6lv6Bbro-kKytkrhDSuzMa6513yv6rHBdo7oRuApe+0UHp0ctPwYiW06jTyRuVNC3d2KCs2P5n0LJ8jtSuYIx5iM5rE6+u40kQZ6HR6W2VzbWebujJyOE8PkJ-MmjMccOJ2sxj5IDPWM3rTnu1OlmdYbjjnM1FuHeU+t3PHEKS1+e2bfYno3Chs955z-Q7WSq85XeM775HlcZW7vThz2Omdff1T0w3Y41O3bg2Ud8apah9djhC+OiclBQDgIgZA6BM7EjB+fWujk+dM7hxb0UzAxASBe+Aj5Ykff1zBf11iUeu7UVWb1WIvk7tQ23E00HseaqpGD6HkDoII+UD6PcMQpnLUISTwAMir7MEYTSVJAmLwrYPYvk3D3lknkilq89E3D888E9D5Yx+z9cAxu9O+8-L3d8Pg+R7ghc8ZtgWfcYK8gUPyLACA+rTmPoDPzWV-i9FNzxpzXt8DVz+QEPffC8D5PzH3GJ-2ddYb93tPu-tzp4jLV-k21xdP51wxz120TPzfwty-1tH3yZ1-y91FC1xAP9zAMEiDyv3z37xh3BGLCEBAngPhFAAAB98DFIUDr8w9b8MDcw2YHRJcNt6A8DCDiDL9SCC8ZwB8Zl-NSsR9cZ4Dn8-cosq47s18d4N8hgP9v9M9QduD1tStOddcscED+Ds1IYxDIDxCD9D9k0EcFlmAll4D9AN8qJ2M5DnBp8LdZ8sDdDpCiEF88YR5DC6cgD5CNCc5lETENFHDGdFC-we9UCb9WCMCXE1F3Cf4Gc6DJDxdAjTEVVLEyBeCgst9vD4cNB14rNdMJ8uA69BgoD+CYDcZIiNEhUu9lhlCRhtxsiAEYDR8XAtD8jjC3pojJAyBdVQBttz80RC9xI3C6i6AbCGi1VuBts28XDUh2CpdPCEixlU9A8mC0DyCZcxJRjaCejwjk1FiZCRDX8pjBIdNAgZAI88QVic41iGE+imiijzdtjU1diI9SRT1cZjiopCjNiLi3QdjKgI8dBDjWJRjGFtDsDJdzic0ki7gLCcCrC2pZMHiSoNicdZMaiuiPC3pAcYgoSMpTiZoV1kSlV6YaCZCnj1ChjWJWMBY6kINl1ni5NpjS9Zj-D5jwRIdqsH9xd0cQjgDASzMIC+CKjCSc8pE51G0uTSE2jz5e8yDaSotzJ61B1uj6CiDQwSCaTT86SpTt0UMGkmTk0VSBTCUR0b5N8hTEizCrj3jnkDi7jxctT6EF0jQl0lSvDiiZ9jS9jnlbjq1RZ6B+SrSd06591qAMV2TPo3jnSYdPieTzBRRwtokoMBCqTRSWCwQoNzJIz4kNTPNKtSSaMatozk91dKSd9Sjv9oyvigYZoFMySEz0MEUgTwDd86Niz4YwModD4jo6ylC7tMJKz6yO0HotZIl30e5WzDTkDvoMh7xOzzT28a51gyzMzlNoM2yqSfo99CzOznCiTUght2SzMFS-C7T75zIhtUzWIpt8TECtiqYVDBTREuz9E7hNy1TRFhTZ9DyXMmyW4wyO1qFSA8El5CFpcvDJiXiO19MfY00ioqAaF8E-zxihSGD5SNzCFQKvyfy6EmsmcJzhixR6EkLwKcFvzaFoL9cALChzyO04z0C6SQLcRkKCLfSwiML1zBVELqLcLILfy6KFCJiSKgKRTfCxS9yFExJUKcLHI8KULCLliGLnJkLVcKS8zXinT9ibyCM0oRAtzAzFKXSbzjABEwLHI1K5KzMgyPi1znItDn5R02pDVWT5DKUxAEsadET3hTDLiZxwQLL2E6CZYBUnK7KHKlknL3MvcaKoKOLfiPK0L7TDR3gBAvzGQZKl85tSLz4qK9LIo2LUL-yAFFJShzLY1LLeYtCRCvzRUgdChw8VLwKDL1D6s8rWFPLiEiq94SqTcQ4KrONVLBhx0sT0IdKPS0qhAuqCTq0qjz4IqsqDSHTYy+L4yI93L8qGqjypofKbKYLHyhyLyCzbRM8pLzA4Vuj4jJrqz8ysjv9yjSFKi7d6YHd5AncU5Xd05M4dBYDc8u1i8yYOoXKL9psV5+hiFPrcyYsOp6tA19AOoDzZ4OAhAWguoTAtAMtzx4k-TaguDxctCjF0TmjHtYckCFK3L-4WVboF8UtMaBiZseg1M-9Jyfyi5Ca2UvqyKZqKrJTmUpUiblLlVDkYiMSZAGaU1ZpriZBuAzS3Txcv5CjeanzFKhbQBXSqajifKZV5ATVl1Jbcb2iBb3iZbQyRrcYtCkd+1XU+bZ8DabC3gjbdqO0Db9AeNhSdz+KbbBcxJTabyDaXVOlbb1bMjlzbQeNTLzA4kvgeY6B4EjVlbrkelhSLoWd5bvjOMw52pW0vbqYY6wo9t2QS8ezcQw65VD5GResvd0aLEByl9mjoE+bK9ecy7qIgr7ji64jP5i7loU8eKoYw5lL66M126czAazNtx26PyYbntXt3tINS7DCsb1gFZI6vaOAQ7i8Ui3NwgRJTsS4xAF6VxDZblK8i694q6J7AEWAp7XtJ1mg5717VBF6TNQAAAeYENejezoLemLUG8EHBfAfROgXwQQOBfyg2akLEVhWoZocEUAAAal7ugiVmqDECFDJirvCAgZsNAYgaxOgZDrgcdt1Dq1DCMlIBMghHfoTmIBsh-vsoaXjhpHyuAbEnAcgc3HQdgZkHgdLsQbEnMjobQfNhgcwc3sqLyNnkkl4MV151lwTHFwrhA1nmxBnpDFXwKyvt1APtwxdDu0GlHMUefvQgkRPikaIETsGXwGDtDqVtzuXRByxOaF50b29oQaxNKChj4csepAUcwlYetF9qfvNQYhDBfArhseb05hfRHvDvWrI3wfeVEZDToGXnKFsOHx2zjDEwMnw2LsZAIwTrN1DE+hW0bpHgbvbtatDk7prryflm8aKA02SskfRBkdTtGvlyXxEaX0MLEZRIkd0dqcTtJ3E3EeTVyf3oF2wZUYtTUZHOGjsacR0ezD0bqcMeMZCbMbBAsacSsaXxsahkmZDlKDIkcafsMMnRWCsdccLPcbvCwYmBE3wnoZiD8ZPgCczuCZzpVsnhGcKFBqiYshiaKxEHif+DciZEc3VMSdE0ImPBSfTrDnSfjuLu6ZBdUYt1ybDgKabqKf9GRa7qbvhZ8jjGqc6ekbhdt1kHtwTluuThdzTndwwBesJVRXRUxXpmxRFQXOHOpN3KZfMhRWJWRqWvMC5fpYYFRSvkzJ2XZRZc2tOttDNT6zyiJQFbjkZHD2dFnzWhsNiDWjHFKucQ6I5DVZiA5E1cy1nwQj1fHDgkNeVY6PAVNfAQtemFn3UcyBsMdeswNC1fKo6ICivnIF8BsK9ZUW-rdaNY6MDT1cDW7HddiFnxuGLwvhYEMAXxjdUDjfjhWEjZiFnzAdNdiDBu4F8GXuLUBQgcDfTf5rBHBBcmzZiFzdAHzZs0BXchLeDbcpcior1cBUKABGLRiHcg7dLdn2c2mBrbra7dAEBUhFrZiH7Y6OACrYMHBtrYLbHdADACbctbcoAFI53h2l3AUN3J3QBp23KV7s2d362bH83m3y2ABCESU9hdkdwt0AW9oES99d8tm+7dh93d2+2IN9+1jom+gEKts90dwFIDmIf9sBDowtL9vNn97txdq9iEQtYD7gIoUDp91DyDo9m9ud5dztxD692IT650XKdO-lg9VlHEquwEEMPLNabgSj5G6jpMalWVulqjr+fAFgJqOGk7ej5I5EGzY1uVg9GwzkplnCE3Zj0lOOJ0NOmKngMTlj0Ek7MtqcDo71Gw71Utsq2fSAOgNUDuX19Dwz4zrWPToHaNqgZN2ASAPVpNhgezqz77Gz2NgAUVNac489c-1VnwADlyAAu52guAvDmxVyOlPZOFZQS4i6OVg8tlAbMoZlBAEYu-iUkouqQMu4voEEvpgkuUvLzJZ1xlPOPVO9tsDqUGnY1cQMvyUYUyHwE+aCVqgsKKhSAX4YGGBGZmZWZ2YwQSaVPSUhWOAGlRWcU0XmvQR-oSKPNWJgJ55nnrk+aJV0tFmXmUdoI0s1KGuBVBmeqYhcuqued3HZNdvBh9ucSeO+PpYbnoITuYr-jy60XAms7NuGks8OABBAmxAvgj7BwVu86gQlvCBPvOkFPcZzFjAvZSYoEyBl5jBXw6B8plxEejGTPTMzxWhGQYeFYSYfYUf8odsXwMVSAkeTPn3VIeY56tJTNCh-WfWIQ3J3JEEPBMdQBCfv7qh8oe23IvIHumeyYHB8e4eifWhjgmIxNGJgNzRUxeZJeGfYgBgXsu0OA01vz5fNJeZtfHjyb9Alern6UDByfKetZqegRwRafD48DemGhheWfWf3I9fnJVfaggVnfBfANiINNkmVhHeK3nf3JufzwaQ7V45g+BfsXhezYLZtvQwI45YGA8sUsoWu2erRfYFYfueE+tV1IdCaAP5WgZYsXpuENxeyYS-qQYGfuMok+FB9DRycIdtNNRr2f4k3BK-if+B0eKfMfLO21gMlzef+BeMihA-Wf7s8L2QyA0V90PfWf41QW6V7fdslPcegQxfc-R-J5jfJ+p-hA2ZyeZ4iB3RUf+BPfo-9+OIA39As+ZoCfvYq+KnmMWwL43AFe3ole3mVfhA1eMgCsXBK7zeggDGAhRI3gZED4ABBT-jrz2r-8PeOCNiFQHIAtEp6aAZfgxH96hgD+zvLns-zD48pI+UfZBlgINCx8G+efRPubEjgp9kiafNJhnxDgP8c+z-FHP+DGQF9sC1AYvqXxHjrgUsFfXPtX2MZ19GAVAn6C32N5VNGIo1AjEIEMA2QyAPfV5iRBx549s+T-UmKoJ2ypMR46nYQewNEG19JA9fWgXLCb6ZAKmlqJcmHC0ZtwxI1kfRFxFUAwMUBzAbSFklYHaCie3A0uLwPzjV826xdCYFnnygQhBqyDIwaTDNo6xxYIqE4FgG37P8Ee-fZHgAHI9e+gMqqAAAA6WAdXlzhYQbd5kMgYII32yy1t4OcoaCBkPMhm8jGxASqCkPh6NDMh2Q3IQUKKH6BLuvxcoaQEb6V5eAy4QBD0GGHcAAAXmV3yECg+hZQioTbTzZTCcITieoWJHaHNDcIMQG6JxkUHKDJwWQkoVKgWGDDh23AWfOQGQYsBkGygZBsIHhDWAMhToPAK0NAqbD9ARwkgCcKYQDDG+D7C4R0SuEHlbh9wx4esPBBeQgAA')">put("and", "evaluate_query", conjoin);
</pre></div></div>
      sets up
      
	
	<kbd>evaluate_query</kbd>
	
      
      to dispatch to <kbd>conjoin</kbd> when an
      <kbd>and</kbd>
      
	
      
      is encountered.
    </p></div>

    <div class='permalink'>
<a name='p9' class='permalink'></a><p>
      
      
	
	
	  We handle <kbd>or</kbd> queries
	
      
      similarly, as shown in
      
	
	
      figure&nbsp;<REF NAME="fig:query-or"><a class="superscript" id="4.4.4-fig-link-4.7" href="./4.4.2.html#fig_4.7">4.7</a></REF>.
	
      
      The output streams for the various disjuncts of the
      <kbd>or</kbd> are computed separately and merged using
      the
      
	
	
	  <kbd>interleave_delayed</kbd>
	
      
      
	
	function
      
      from section&nbsp;<REF NAME="sec:query-streams"><a class="superscript" id="4.4.4-sec-link-4.4.4.6" href="./4.4.4.html#sec4.4.4.6">4.4.4.6</a></REF>.
      (See exercises&nbsp;<REF NAME="ex:q-why-not-append"><a class="superscript" id="4.4.4-ex-link-4.69" href="./4.4.4.html#ex_4.69">4.69</a></REF>
      and&nbsp;<REF NAME="ex:q-why-interleave"><a class="superscript" id="4.4.4-ex-link-4.70" href="./4.4.4.html#ex_4.70">4.70</a></REF>.)
      
      
      <div class='snippet' id='javascript_96_7_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=4&prgrm=PTAEGUEkGEAVQFLlAFgHTpQKCyUB7ABwFMAnAQwBcBLfAOwH1LyAjAG2IBpRCBXS0OToATUAHNilXGABmpfAFtQAYwAW5QpTKgAzKAAUAZ2LKa9XWh2WAlDhm86p2nUGHD+ZfoDWxAJ7dSE3xSYUNrUABvLFAY0EDKXlIXakMGOl42Nn1A5WDQ21jCwoB+UAdhYhlqOmJhaKKigC5QYgBHXnIsn39QVWJyYX0+geygkLDrAoaS3v7BnLyw+umY5vI3D28-bmZqLIXxyYBuLABfOwcncwVyHyZWDn1wqMLcukMBNg9O+-ZiUAAvKA2ClKPoAEQAKmYf0h4OsJ0K9kcZhcX3wXl4hC2vgYAEZuN0GAAmZ7LIpvD6gQy8FgwjiA1zuTxEgmgXZZL7KH704jHcmFagyAwpBjlSrVWpGWm8yaRAXTeKJFziqo1YSI6anFpsYzylavehUg6iIHrZk4kk7ch7aV0h58hEKhpKpKgUWqyXzMbCKYGlalT3q53+1bsm37H1OlbnQqx2LIq7Jd5kMGswl+K2gABunV4fP100pAhp9r+jPNm3T4dtXJ5Dv5KyFItSQalpdlZND1Mk91r3zYvw4nBD3Z4NtI+hBH0tbMIE8txO4ubY+cmI7HY45U4HQ8d0a1Or1L1DxbiPorGxZmaXNayHYbB-9zf0HpEEvVo1yITlJ8KAEgVmMSg+3vGUHRHQDNxWedqEnWDJyJW8VzXDdoM3bcHz+SYnSgmJtWIXV-j-MdgNAr88mXPM+U1f14waejQEYxNUVAYQUnnSg1H0BQu0VSRlVAJQARE0BwXRTFCHBUcGlKCSsRkpohMBUTwWqYxSEoaToNKdTU0UwpmjIeRJwUbhwQcLw6HwAB3FwiDIKhnFAABaFzwz+eFaKY8lXRcdjDE4tQTnOLAzwcihUT3RkbjuXknhOM8JAEIEIqc+g9wheSpKdM8+BSggSEi5xMrUlNNK8i4UWc0ViAUTRcTeAArS5UX0YgAA9CDCSJzwSN1RXSTJ2q6sIjh8ljnKqUgPgYZrWpG7rnj6wThkGTqlvG85JvMQJZvmlFDEWnqIhWt1tw2safKwHbklSOqGoYAKWuq+hjuWvz3VSIaskuhEJtaqa4Nm56Fr+3rPrW96tpuwHduIEGUhe0wjvB07Pou0b-tC27QBqMQqFqBh2jIXx3ohgS3Shv6Ydh16XCa8hc0MZRSGoTQGA2vbDGccn0cplxqax2ncY+QJyAUBgNBIEQnsI8hfHbNkKjYBWicMUlCxiT7Boye88T9AM2PlxXhAYDWnkU5oEKGOYjANtD0KeQEAD5qUocXJel4hZZVtXBjF-pJcwh2DPQ8PjdV03zdJJ1zn-BOE4aOmk3dOgtFIDgmeIOWo6V7g-ejjW+O1gWvrSPX7cN6ZSkL9XiUt0NrYXKHDFDiPnYBN3qgzrPsxzuvBjD6DB5jp5HYj6ZO7dwOJfItucJCnA8FuwxQDkRQIBgeAkFQNA8X3qrU+IFDCf0XJ6voH3KG4H3sxLnXUhBDPOnPxRCCv9Pq6KOTqBfwcULEDfpfGoX8ZLNEGhLIBF8P6gMoN-GY2Vza+AUCwfAADqJGBQWgwc+AZBpCgcA2B19rC3zoPfcB5dpYgm5G1GBn94EyVKNQsmJ88xn1upzLq3Neb0LgaQlo5DSHD0KNOECeCGCAKOuQUgYguGEB4UaIhDCBF30mJQ0UaVKDBDmooFg1R0p0GUfwphLRT5aH0FonRF99F0EMUwfAUtCCEBoYY4xJCyEUP9BA1Ibx2Kolfnwkhpi2GDj8X-ZwgT34MM8Qg2IPiGCq1QcIcg8jFFGKCWA-0pRYo51ulOCWLAUkMHnBQBQkgyDINQego6mT4ET0nrEJJRTUloOEGTOpqihEaNSMYEmjhoHRJMdksxPw+n5gGUYNoEzlA5w+ITcp6dalDI8YIrxBoEnsA8F4dxWSDSlFCQwLZygdl1NiT0hgflzbMC0IssEnSQkrkuQLa5Czr67JvmsuJYZRScIqMoVWxU3qdLwqAR57CLF-JMIObRuj3jMHTnLAFHyunrJWAk-5gK3EPJGYczFMjsUrPTuc7xVC3DUDEHQO5KLwWDnNBSql7yzlfMocZYIHzzKWWsnZakvh07kA6q5dyoSOhaEqjjOGLgWH6GRNwGRYgTrLBfKKBR1AFARP7gwfJyJfwKk+iwkpbN1U0E1dqhwcrZFjWWARIi7phSvl8dE8oWrJUyocLqhoZ49oZAKiKjhkqjn4HaW6ugwjGn+k6loWWd84L0GpSIyenDSlQIzkdHVDTw0rHlYYDNmaGicJjfIRl6cQ2Lz1WXUUVzAGjBpGwRhY5ShVuonCqNYJvV1u+YZMo741S1Foja48Co2WTllWJLltkXC40oL4EgQrBDOLYL4SqsRzgSvpsCUEDAJFSOOrErWpd+ouBuNieVrtRmrjPvK2Jt9hZnCPqxQ54SAlZGZWo-dj8mCkH4KoVh5jBkiAifQH4CjajUFoYMkBqy1GdtAAcv9b8APPrheMplRL6ksqbue0V-7-GRLpXWsgdiTUQeIV-WJS8U4PqeShyZHwFCUBzV8-dyr7r1WnebaZPtZlGEoPRiY+7CifTbBqckA7-gscSesEC8zbnvLowxj1-FD1YY4cDaTNy6pyd4wpzgajvJiYE7EM801ZryckdRRkBk-WQrU682TJb5NhF00I7ygp7WVpedWkz6n6PmdXI6QzLoy7eeub5wBrmV1HmIgZT6hyaPcYTXtdTbylk8b46QvTIZGKrvvc5MRW78EOHpZS9s2CaklzOkejQWDqlsDPVCIr5KSvCDhNwQwZXdRx1y+YFmQgt38CRVi1EyzINf3fRW3pnHJk4pGeQZQyheAKAyGfBN86ZbCFzf6H6m2DTHqMNyRg+ABv4qBe8Hb3Z4tzI03ckbpH4HqMw6KE7hLRv1pGWI-Qz2ortdqyimDzQfoUdxoc45py0N7pImeNpvhGSg8DcGzp3kzx1l1IyXrh3jvQoJcN-Q0OnwqCNAIRrPNmtryBPliRxOGVShR1awTZdrNAOhzeqNZtC1xvebT87ebuxU9J9wVbPPCjQaB5K89zzD12c0yW19QjxvKdyRL5Ufn8z6BEYz0YkuuYIx5sCtDqL+RruPk84rxb7ng6Y5DwnOYLNAg16bu5Kuc7a-JXr17BvvKm6qTgp3+gHfX29+glFVF-Pkd8mXcLd7KPOTxVj07HLLfki9z9n31avslRT0HzpAueca-TxlQBaSde8P19zzNaiy-dky-T5TwmKMr0lWvDeSgoBwEQMgdAB9iTdbuokv+jkX36-l4JUUzAxASDNh95l4l+8UDYOK6P5hn4D99503qsRw-KahtuTpXXF+97HxPvvM5mWUD6PcMQFWP02zXwAMlv7MEYa+RJAjPznMfov12QPKSi4fA1UiH5ExT4W7gh2LlIL775CS3A5xgFAKZ5sBX5lwfagFQLghtYdZ76iwdYFYEI-5r4kSQx2w7766YFi6ij+4y5D4EETYX5H7AGvbmQUFaRda4xMGB6D7u5-6CxEERi2wjDEHu5lrbRi5sGF4u664ZJUGb6rQ8G2gCF3ZCE97lz56SGcHUHKaj7kDj5AGggJ7gjFhCAgQqHwigAAA+phikmh2hk+uh0+uYbMDog22OzgJh5hlhABWhdBthIBUKAKzh9AEBuMKh7Bv+f4n08BOBsBfBgw8hKihukBwRYh3CxebuChWshB-BvBsR-C8RkBiuBhiKKh+gsBIe+YReruoaXBG6M4+hhOhhThp2aBeMUCpRzuyRFRpBX+T8hSxS4hJeahywH6gBNhJ+IBzSvR7REhC+uM4xqSya5SGc7Bt2Ki6RZce2EREiJRj+MRvBu+LBYusx8OHSUhsQGROxchuxJBnRqciuhxfRb08xFSM03AeOVRyBdxkxLh3AjxqaLxQavg1xrEvyAaRR+BoK0h-+tBOhoxDBYkvhQ2Lh+x668J-hjAUR+BEJaIm6gQMgCeBsS8uMKJp2JSBKCxZAyx-Cbx2JlQCepIBJYuRJ9i0OoRmJ1RIEOJCeOgSJqc8JDiyGCKRh0KLJNegk+RdRhRcebiIijJUU6JpeIitxPRqS9xRigu68IJkpUUPx5JweapMpJUzJexn+qcHmkuMm0u5uAxpxNBwxx+lpd25kVy5pdy0xYuVyKpwpB6MhmRtou+xpQJjqiGeGnpXpkJtp9BDpYkT6eG5RUx4QbhoYVhXhMJkZtRQZQGg4zp18rp660ZGZhqoG4GIZn0+WHJzK+Jd6uMeZdiYSRoU29pKxYRSB1JuJzKdJlZYu1ZPwnQGcRG1A-cxZzZs0ZZFuXJ-pNUk2-S3G8mD8Npnh0JYI8m5kl2OZqcl2UuN2aW8C6+YK1pW+sh942m8RhJtmWZDm2miqe53pAcF53JrESWG518R0jms5ymmEt59JXRnMbGuIl2W5l5oZveP0-5d5E5kmpm12Wm6WqxGh30lc756WgJYFoOIZlW5c4Z3hsJ4IoOq5rEcOhpJxV5VMB5f2n5Nx0BRyXIOyZ5256hgkyBOFbWkFX8455gmiRUVA1ieiBidCVB4JIpkJRWpAuIVipAuiqCPF-RaRCZz4qQtiMiIlHF2iYlNiklqRKiZFAZYodiwlW6SlXFElfZ6llJEQ-FRFB+85IxDZcCnKOliljkyl4l8lqIuFyFBiulolTlalqhaRplhQrJSZC5eh8lHl+lKl3FRldArl5gnl8BqFJZLZeJoF5gIWaUIg8VQ57JNJbZyVLgxgfieljk6VGJAlWJw52Vo5SF1wFF1CYGbiBanx9AFqYgi2AeKpAFgFbJEItVtCXx6p9MsZzgzVrViK7VVV9kYVXlkVfJPVL2vl5I4UYVjIsVHWKK3kH6Ql9lkUBlzlUlKiikOSNVC6dVbUiuURolYaQuoiuhqVHFxVVxVsUBdws1p1FF51YVl1V1MQH2t1RVgw2eap6E+V9AZsaV-1VxrFveL1e1Jlgxc51hdpeh0NARuV-VSYg1xlJCMF15+g2RJCqN8qGN7wg5+5PpWQeNX8uRDe9MTe8gLe287ee8B8OgSho+X6Z+ZMHUiBsFga6C-QRiXNu5IyHUj1w6+gHU5kaCfNQgLQXUJgWgG254sy-ZtQgRYuiu+S2pzxoAzOiepVXVtRl8zqt0aBCaWtjGutmWwhX59CxtrqMg3NI+HhCNP15kttssJtqNSapJTxaajtbopZNJMg3AFZ1tPJAazJDtVJ5VuJwdoA7ZYdrEBa5CsaZuMq-tZVWVsd3AY5UeuMiuTa-mCGraGdBthd+YTRbwJdmlYF5dQCgCpdgVVl+ggCjpnm1E0VLgddLa7yDdVR2+vBDd41giAK+APMdAci7Oadb6dF50vBVtkBIWcghCM9rJ1MLmd6Z4b+35j0U9dyjIgOShGtZScBHWjGUipdNs8B591EVqidU0J9SxMqJ9y0G++tUMy95SXtj9O6n9BYp0b95ld4z9UCw9kaPsbOKdRa1K19IeFt6wzucus9aIPsYgZ+NWOCPUL+wIqD6DK4SwoYpQNsx9hCsDNunWLxCDnM3SmGHAE96D194QAAPDg-Q6oC3Z0AQ7iqQCZBCNovgFAXQDDvKiNQxtSFiC4tQLUM0OCKAAANRC3hxizVBiBChkyMPyNiTmSaNqnKMT1qMcOdb-YtA8Psrgj8PrzEA2SCCyKiNrw0jHXSNiQ6OTx6OqMyDqNn3hAKNNGyMKO6MewqMGP4O5EzH4AYhYjsG+7wEQ7kjA7kKJLhPYir0rCiwHYYM1JwMVYrAfrAWMNqkHIJPojJOOBfDj2T1QMc4lrQZqnNDwEqRAitxeMFPbGGNcPhx1PpOYRePWi2ghP45xghgvh3wNPsjn4PTsZ71Y0kQrBi0xNjp0BoLlDNHgEDORaESDrdjGYn2MhL0n3tQb3djhHpN-1P1-2fXhqnO-0v1rP4Siasl3yJNEAHP3yQ1MgMpRPVrzMrixNIhi6PPFMvPZMJhi7o4ZO6hZOBZFC5OVz5OTyFPZhPMlOj3lPUPZip3Uo1OTx1MdajNNO1btPoSlBkRQz4Mh4wborUhdO8GMO9NZD9MRb4SKNFDDPkKjPb0TO4hTNjYzPTBzMda2VLMiArP-BuTvOUoum3NMRRZQuGjwrrw7NAh7Mr2HOhjHNCAgPlJnMv2V6hhXO32auOiMs+SDP60AtJNAv16yCN4Kubyt47wd77wYCs2pCqrGoq0ur0ylrY1hmWWI2jrghusarECd08BGrBsMBqouIWn1Xuo+vcFk2lp755ThvEaetJhk5dXOjIFrRNGxBrRjgXNNK6HmMRh5sxAciFu5rIEITlvjhwRVvZsltiJ1tiKNvTDIG6yZBNFdt1YGhFvfUlsBQuIKxNHDtRz+gDsG3DrlvDrdhTvIE3Bn5SwsCGBoFLuqArtrwrALsltyN1uxDi3cAAlnqCoKMw6gC7s1EuQHsxBHugAntdygCCruQXtXtgjgguSbXluCqFBPsxDuS-vvsQitZTwS0PvhBPuCqQgPsxDAfgjAC3sGDgePtuyCpgBvvVslsACkSH97qHz7oA2HsHl7WHNRL+B7+HkHaHozAJZHH7AAhCJJRyh9R4R0x0CHR02zUUw3h6x6e6ACwzEFxx2yW0wwCLe1RwJ+J8J-By7Hx8e2x4Km7LJ-RxCC7BJ9wEUFJ1B6ABp6p9x4x0h4R3+yp6AAx7EFzc6LlNbkG2m5wtfYCCGHtmtN8amx66vDZ-K3Zx5wGvgCwE1PLWTs59VsiGejW+5-3E0QPbaDquuAZD56ao3k6GFLZ5FznAUWI+TrocgcJk0cJlO1dcgZAHQGqH-EulpyV2V9OoV0Lou1QJu7AJAOWxuwwE17VzzvV8uwAKJ1utfdcdd5rIEABy5Aw3SHo3w3FLjSXnVIiXGX4p0mZ9TnKwe2ygZ6UMygAi83-JhhVqKbaqEbmXTuwXq31W63T7MXL664Ybh3abmXVqkBBqO3ZqdAzVYipdBq1Q2lFQmcvgKjDAjMzMrM7MYIZt6Xkb9UHAdysboaurMQ8qH340-lRurEwEkT3LYIpd4D0alTadIi3s6VL3AaZDgNMQO3x3tLBPziED+gxPA1-ngXKMOe4aFPi3J3g3hQHLP5aLGLJCFGHAAg29YgXwLAPwmPaOAkhAvP0D7yKXuMpSxgxM+Yul-cpAaCxgr4dA+Uy4ZAGv5XFWZ4rQjIivOcJMwlWv+U+OL4av+v065nqkPMdDzBUL47CsEIbk7kCiHgOuoA5vMO1Q+UAHbkXkzLhQbvZMDgpvyvpM+grQxw0rGzxEjEEm5oqYvM8fwLCPwgZsX6HAW6YlafmkvMRfUUzJmfxrNvevY95XDvQI4ITv2ZWfRQEfHvnv7kpfzkAwFQog7fIf2MMrEQ2Wg-IYrfn7fffvKvMO7aYjff-fxrEf1ynsauF2HsQcDAe2Caf9rsgNUfMiSv-vK-ea6kAp1AZ8rQ3A5znPwuf6MfFvF-1IKjgvGUs8CgxResOE+OOWkB3vsybgd-ZMQPvwF17q8a+NXZjO5jgrDQgB92V3hxCjht9hU5iYIOyDIDqoiMtQIVDey-4j8VgRvE3vvzN5T9Le-AKVmP3b5sQ2YavYEEkzThB8++y6aYK3z34zQiBsfCvkM0gFSw3A6fN6Jn1laxBu+lyDIDnB0Sd83o4gxgOX0bChgx+AAQR4HF9zA3fTAdojYhUByAOtBBmgEYEMRcBsg+Ae73H4UD-e54WtLPzn6+NdBBoRfq-yP6r9PYG-arFv0VYuxBcLAg-sQKwBJxYgJ-QwmfwsQP8r+8PFTFoAAFx82sT-SQC-zX4Sx3+mQT-sa2yx3p-KJ5GaCBCECGAbIZAEgbRQWrW5jeQIaPofxgH45tmUCTNoznCEP9ymz-RgHYJ+gyDOqvbQ1oSxrhiRrIUBLiKoBUbqDmA2kUlB4LYEW8-B6cAIUAgf4f0T6EwYes9HwDVBPsSMVqIxlOav9G6rGR6KDC9ZbCUYMGUoD9Eeo9wyAfcAeCbClCrYqhh-ELDsLBA3CnMCrKBEvyDjCJQU2nNjnMIWEPk7hiwwwMjB0wPCtWawrrPlAhDBBfGlwqfmOyRjzDQ0JwLAMUKn6SJq+mvAAOSl99AX1AADpYA8+QCQnmbFhQyBggb-bbA+0U5yhoIKI8yLbzHohsnQCI0mEiNAGoj0RWInESIL9w09ZYhI4kXTwXC8BlwAiHoDbAFGgAAAXjd1ADYiig+IvkkSNIBv9swx7bgBKIpHhwqRYkGkcYEqhQQbotmTIdkMnBoiuRBIxxPKLf4oduAyBcgL4xYC+NlAvjYQPCGsAoinQeABkar2RFAJjR62OUbyMtEG0bRkte0Y6OdEajwQXkIAA')">function disjoin(disjuncts, frame_stream) {
    return is_empty_disjunction(disjuncts)
           ? null
           : interleave_delayed(
                 evaluate_query(first_disjunct(disjuncts), frame_stream),
	         () => disjoin(rest_disjuncts(disjuncts), frame_stream));
}
put("or", "evaluate_query", disjoin);
</pre></div></div>
    </p></div>

    <div class='permalink'>
<a name='p10' class='permalink'></a><p>
      The predicates and selectors for the
      
	
	representation
      
      of conjuncts and disjuncts
      are given in section&nbsp;<REF NAME="sec:query-syntax"><a class="superscript" id="4.4.4-sec-link-4.4.4.7" href="./4.4.4.html#sec4.4.4.7">4.4.4.7</a></REF>.
    </p></div>

    
      <div class='permalink'>
        <a name='h5' class='permalink'></a><h2>
    
      Filters
    </h2></div>

    <div class='permalink'>
<a name='p11' class='permalink'></a><p>
      
      
	
	
	  Queries formed with <kbd>not</kbd> are
	
      
      handled by the method outlined in
      section&nbsp;<REF NAME="sec:how-query-works"><a class="superscript" id="4.4.4-sec-link-4.4.2" href="./4.4.2.html">4.4.2</a></REF>.  We attempt to extend
      each frame in the input stream to satisfy the query being negated, and we
      include a given frame in the output stream only if it cannot be extended.
      
      
      <div class='snippet' id='javascript_96_8_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=4&prgrm=PTAEGUEkGEAVQFLlAFgHTpQKCyUB7ABwFMAnAQwBcBLfAOwH1LyAjAG2IBpRCBXS0OToATUAHNilXGABmpfAFtQAYwAW5QpTKgAzKAAUAZ2LKa9XWh2WAlDhm86p2nUGHD+ZfoDWxAJ7dSE3xSYUNrUABvLFAY0EDKXlIXakMGOl42Nn1A5WDQ21jCwoB+UAdhYhlqOmJhaKKigC5QYgBHXnIsn39QVWJyYX0+geygkLDrAoaS3v7BnLyw+umY5vI3D28-bmZqLIXxyYBuLABfOwcncwVyHyZWDn1wqMLcukMBNg9O+-ZiUAAvKA2ClKPoAEQAKmYf0h4OsJ0K9kcZhcX3wXl4hC2vgYAEZuN0GAAmZ7LIpvD6gQy8FgwjiA1zuTxEgmgXZZL7KH704jHcmFagyAwpBjlSrVWpGWm8yaRAXTeKJFziqo1YSI6anFpsYzylavehUg6iIHrZk4kk7ch7aV0h58hEKhpKpKgUWqyXzMbCKYGlalT3q53+1bsm37H1OlbnQqx2LIq7Jd5kMGswl+K2gABunV4fP100pAhp9r+jPNm3T4dtXJ5Dv5KyFItSQalpdlZND1Mk91r3zYvw4nBD3Z4NtI+hBH0tbMIE8txO4ubY+cmI7HY45U4HQ8d0a1Or1L1DxbiPorGxZmaXNayHYbB-9zf0HpEEvVo1yITlJ8KAEgVmMSg+3vGUHRHQDNxWedqEnWDJyJW8VzXDdoM3bcHz+SYnSgmJtWIXV-j-MdgNAr88mXPM+U1f14waejQEYxNUVAYQUnnSg1H0BQu0VSRlVAJQARE0BwXRTFCHBUcGlKCSsRkpohMBUTwWqYxSEoaToNKdTU0UwpmjIeRJwUbhwQcLw6HwAB3FwiDIKhnFAABaFzwz+eFaKY8lXRcdjDE4tQTnOLAzwcihUT3RkbjuXknhOM8JAEIEIqc+g9wheSpKdM8+BSggSEi5xMrUlNNK8i4UWcj5AnIBQGA0EgRAYCo2HIXx2zZNqOtqBhDFJQsYj891UnSTIjDxP0AzYwjeuEfriSeRTmgQoY5km6w0PQp5AQAPmpSg6oapriBanrOsGWr+gazCpu29DHv9C6+oG-lzn-T7PoaLAWOc6otFIDhyGzYhWrmy7Ju4F6FreobzwSN1RXG+8psU0oYcW5bQ1Whdhiu+6DIaXaAQOgGyGB0HwfayGiegzGBqeB6nuJ8JScO47yMMKb3qqpMOZuhgZHaygbmxZFuDCeGRuFqgtEYa76qMI7BbF-QJepXm-vMWXKHl-qVaVxXeOlgSkbGjJ70N3j0dAFGVvdOhAcpsGYf0OnYnx5Xjq2j2YhJg7df143vcFzDrZwkK+dYwxqjEDhKAykOAA8+OGs2XDW5PuADu3LadUK8G195QDkRQIBgeAkFQNA8Vr6PnOIFCqGIfRcgUQh6DOyhuDO7M05G0UQUBzo28UTuaid6bZOBagR8HFDW-bifu+npTkfqpfx67qeZLk-AMSxfrfAUFh8AX6ijBPs-B3wGQ0k3seO53ygtpaOh+5k5pRSakFuVRJ+K9d7+lKL-Xw+gm55hburS4UViDJ0IIENwzhAEvzfn3X2T1pwgTvgwRehh9DkFIGIBg8DEHEGQUaVBk9X69w-pML+o0GBpUTqQBg7cWDVHSnQahq894tGblofQLDgjsMUJwug3CmD4EaoQQgf9uG8KnnQz+-pv6pDeOxVEo9l5oP4ZAwcmi57OB0dvGhKi16GSYe1U+whyCkIQUg2O9AlGv34bFMGxcpz1RYHYhg84KAKEkGQY+p9z4EN0TQzBLMGg2N8fYs+whwGRNXhYxhopjDtDOsoLez8on6JXP1No+ZHCt0ySUnJBsW5BKdhEsxqT36qINOohg7APBeFcZY2IpQDGtK5B0lJTs0lqKYX5KpWgalgkGW4kBAifhjI+NU7urjhnNKYcXcGyh2rFRcdM6weFQAFKgUIjZFQtnSLEe8ZgTtNlZD2aslYLSznbMUXso5g5nlENefUoZjSulhh-sgsQdBJmdPeY1IFILlnTIedMIypATIrLEpZaydlqS+CduQZOrl3IGI6FoSqoVi6CDkWwcBGsiFiCln+F8opEHUAUMYqmXjkS-gVCNMB-jSAMqZZ42BKCKXELCLRAiRF3TClfBo7e5Qhb8pcaytOsQzxIIyAVPF0CNmJPJQ4aJMSVjwPlgtPucF6Cgr9k9DZATN6AwIay5meqViUsMPah1DQNnGvkFCp2MC6CR3ZRnUZGc8GXxVWwGZ3ZShjMXpc+WYJQ3hpxmUd8apagiqPMRBUxlgg+vMii2yLhiWUF8CQHFJL5G+EqrEc4RK5VolBMw+++CIEIOdX8+GCNBJq0pftOZq5oGUosb3FtBcG7mF6UY7Rdyfk9zbSRQeqQjr8FUOA9VQiJ0mMHOQ9i-9clANoX8-5MQemCK3iIYx9AfiUmKdC6d6D6EO1XaerRG7GphrIJImgoNOkWKjr9WtvailZNKcrBQlBW0YPhrS1IxAO5FsAxUsposwNspWCNNsGpySir1FBhg7UPjjJg8sj4oGJjttiCNR96s4L4cWRMojSGwicAwd5LDGaVhniqKQGjSHg2rn+ECAylHOPcaWd64jyGmP0O8oKCVooo2X2EyBcTvG1yKtQwGxTBtQMqeINJqt6ayMugDb08p2TW5+yQUp5gdHakgYk8xkMjFq2jrrfh3BDhzTUGBe2a+4TFUjTVoYXzbAe1Qg85C2ocJJbBeFWcFz1JuSMHwPwW5XzUR1LyavU2iNkipFM8Bt5oZQHKGULwBQGRoHmtOiIF1-oUa1YNIFxLzCUufJ2e8Br3Z8uVNo4R2zeyGGJtFG175mXgGzOwfoEbUUgthKnWN1+h7QDNBRr+4lvS2nKAGdOix8MzxasZJtrwrT8BJM6d5M8dZdSMkMM15LIFpvOAIVqp8KgjQCHC7HbzoRGTYIbWKSREXBhXdi4UCjJ79BaqHYa0hH8TVerBCDzrrruyfa8+qVt5qUeFAwSOv91Ux2FIWdZvrUyduzt8gGjxDB5N8fdtBSjYyyFOJQfcg9a3-29M88C0FMKKeGiuTmaijJKPc4Rzphx5DKE8LZw5woYvQk3x04QyFkzFfn2-ULvjP7Kc5a1-mDnBOXC9Me7s8nEGSIK9m0rxeU2TAvJm8FzXWOGiUdN4waNzOKHOJl7e5HDqMH++7HL8jAb0O-qLrWwwpd5BKCgHARAyB0B12JPFoec9HLzb3f5gNopmBiAkAtSbfPxIZ4oGwQl+P+bD0z8rvZkRCi68El7bcA3Df8zz+QAvfVi-k8oH0e4Ygc967pQuevAAycfswRj15EkCfvYN8-t9YhvIJnTsuCU793ovoIkXgkkUEyvVfWLU4P2U4Lw-BKTf35vcE0W5t4+Jdb8+-2z-r7nQGlvEZOmP--YCr7CO7+Te5sg+heuGu+JeYukylexKUB3c6uWeaCG+boX+toqBiBUSfq5wsBqu8Bnuji3urOt6yBLg6B+gret6vMx+-0qQ7uQBYOueC6XeYBveC25kxYQgD29uaWzg8IoAAAPvwYpFviwRAeTuCLmNyg6Klu1nwYIcIUwdvuATOCXqctwbIb-kbrNFsjwUnE7vXn+CNM-rfPfG-mQQNiOsSu7hLl7tLvQenHrmQRQQtlgfFtThwTcnQWflRHxpLizvQJfm6Nfh4VwTobIdwN4frmDLYT7poR3qkHEn4jEUQS4UNPOqAT3mIWwWJIkfYskfQDAf+rkf4l8kEoDAgRltnmkVThoFfHNq-pvNwOYZQZYUUT4n4lqvYR2igRtNuM4dnlQcStTsUfkTwlamUWQK2i9iQbPDOOJO0XkQQdLnfuOIEsElxtwC9svjQbKkbjIaNlUREAcsAblhkTvioeIWoWEdwoUVoVcQ7iVG-gYScbMSBIEDIEilNFHMSvcboYwOMesZUUgR-nrn9u8UiqSN8f+r8e1idmds8QwaCfWuCXzjoK0XcbWrchciEbcl0d0S4O4e9pwfsQAh7DCVIk8X7h7MMQsX4YQS4i7uSVFACTat+oyZidYZ0RYdseYHJkGr1rzsQYYYwWccoWTtkeCMTqJlpOifzEzksT7l0SNM0S4XESvlKmepOniekfnqIRcRKeuheoOKMXIUIaGCIZkfqXuuwfQM+kaQRtAbKaxIaZIpuoENutAgiQ4VfsiZUJ8U6c5C6ZekaNet6l6fia8TTn6XzpCXFsSkGYOJ0IDB+tQF+uGSNGCdGeTmiTyacd1ohqBgPCKbqZaWCOJuZPmbcfzPmQ6d3AQuJs8LEMsMqb0d-g2QGTrNRlZtKXZtSs2Z-htOJrFtgf+pZrWbZkOUWXruHCRh2acTBpoLiPmb2VOZvhbBNJOVCVoUPOsN2TZmWQxquSASjOQW2YeWqTsUdtqcWcwaWXvkdlWaxEdnCckkKS8SqQMVufzNTleQKVliCT6XMQ+ZLCTpMhebyakCImwhwlwgAgYccYiWuQDkQriFBWIqfLBSkVUfIeaakBIihcwkVFQKIjBSmWbi4V+eqchaQKhURawuhfhXBUKQhaHiPooXqeKdacipIjRYRY5PRaRTcXOUwvhbxWhYJUxakUcY3ohSASWecZxS-OZKJbRfxSReIphQUcJWhcYdeUifhiieTl8XGdCV2XxRQCIHpYBW8VmdkbGSOVocYJouZUIIMOGRGZmR8aieBQSbcGDL-NQP-AKpiaMdwJSmVvAaMX2bJa5mCOCAFUFQUdwO6gqc4GFcQhFTclFT5YVGpdBRpWRYwInLIvIoFQccCeSOFHRcEIyDpfobet5OkR5mJdVflRhYVWCkVkJH5SVQogAqfo-FBbqtjjEJNppmlJZRYQ7NTglYogNWvkNUHo9GNWZRNW5VSSNQaE5baS5ZNS0bmUwrNZJYcf2WxaKawVxfFaSmVaiI+c5ClVLoqemQOSMP0WgsJZSnSdLkCVEtUY4a2baG9ZgXjpHkbtHmXHHpXInjXHXDoGnguqQEuuAqnDMaKGfOfP0DwijbbMnA+gitmtnGJOjcDMbggiYFoMIAECYMQKmbUEfkMT1V4iyZMZsadj0Bbi8cEdKi1MXHfn7MzRsaAFDn8pRTsbojKiyoEacfJWKerDac-BLbWndTrJiQLbalLZGeCTINwMZQ5fzJqmzerBrZ5XLaAPZdQSrXsR6qassjIMbb6R8drboDldTrTvmGPE7P+ZzbvpKUGovCsW8LGsJXyTlsrovBrRaQpfoIvOZG7cQMrS4HHTGssuHTMWQeHTldkl8LHHQCQtbYARzTFXeBAlJiZXcWZXII-IXaxc3htA5ucGeAvqQrBriPnZMoyKtm4YzWsXUTfK2vghrWtMYf3dRMORbQWmsRUerGsY2U2UXV7JXUEsJYvWDE2ivbPTEC8duOvQdQamdEanDp6qCsPT4VMesNEfQjMRwLnf3r3X5ipECNfWILfSuEsF1WtNTivXfbqKfW-CwOfbDk0msk-bfcPeEAADzAhnTP2qDR2dBv2zJZqTjgiJz4DdV0C+CCAZWTLR40jXW1DNDgigAADUhyLMtUccQo4CYDJDYk5ktDLuFDudVDcDuog2IySDEIqDpcxANkWDYgmVYG1IWIpVBDYkDD5DR0lDMg1DMW4QpDKxRDpDjDUjzDMjrDEwB12UCByuxhu2JE62H8uGB82I1dbq-6t2Qg39I9bDhmRQ6RJ5YDLuPSRj6Ipjjg2dccgD8OoKuOLuzQxhD90+V0cjzjwTGjS2jyCWVjmEcj1otor9jYWoIYL4fcQTTdC5cGbdXtwe+Nk4ej3FZ85Qdst+r2cYBmJE7G72Mem8jImmX9Ie-oRhiW09m8U969S1-oK9OmtqM9ZTVamGLxfcxjRAJd-cB1VuwWujwWPh+j5Ihj2YIz7j-cdjT+LTJ9Wu0VoYDjls1jkT0wLjizbjJdWy+AOdedh9Nt3qfjLMATwWQTXsTjLMpQZEXsr9Ph+zDQATLTsTc2jGxdiT-T+EZD0wqTH86TA+mTrdlzCOam0wnDBTFkdARTIgJTQSpacBTslah4hEx4BkHGaxdTFdPdjTBozTVj3Tw9rTS9nTBo3Ta9fTem+EgzRdwzxz9dOAoNSY4NseFcCe1cyeGA8NXKPKn6fKRuPqR50tt5UdGs4I9KjKYrCdPA3KirtNDADK8ipOiirKf1tdr13+Cqv6eUqrvKux3Lv2u+zo1++MKxnscwY4w1sQ1+HIdrMQHIjrLq1+CEbr44cEnr1rPt2Cvr2CAb0w1+yMlsKxkbmQ-oTro1PtAU8iHUKxSbNMcbXrPtSDbrSD3Y8brxEINw-ejULAhgd+RbqgJb0eKw+b1+xDvrsQ+ghNvgbMB02KpDmDoAtbPtLkDb-szbrboA2K7knb3bcxLkzVFa3AMQ2KhQ7MMQ7ks7Y7cVUW0wTb3ALbPa2KkIoAo7mbcxwAfbBgA7W7oAYAe7gbcxAApEe+u7u4O9ile7uzEMuxCHPg23e5u+zNinPve-u3FQAIQiQfsnvfugBAdAgtv-sQjgO3ugdtugCQMxBQeXtxXgMAh9ufsPuIdAh-uocQh7RwcbvYcHTIevvgh7QYfTuFBYenuUdkfQfggAdHtDtFDzvgexCpzOi5TVMKtmsbLD2Aghhqz4zcB8divmvpY8eC7ifqsbL4AsAABW5N0eAIwntRyIPa3rprSrTRANWQCq+bRQsnzKUeToYUvHOn6rIRqnBb1+6GKx6GRn2O1+kAdAaoc8U7MQbnHnRaznKO1+FbDAsAkAbrQXIX-nrqgXVAlbAAor60F7F5Fw6tfgAHLkCpdHvpepefNPTSdUgmdgw4mCdqcrBqzKA9pezKBvyFeXKLK1L5cCC1c4n4JCdle1EVfszmHrgquivWdEkNcnDj1lpkoitqumcSuCrxygga2crVAA4VBAy+BeOKcgzrDKDcqaD07QS1eascCTI6s6q0uUrYIIhFBxbDfARHzZPeoa170tQ3dggezVaDC1cCcxbcAu6xDNcDdKZxPPdyL736BveYkKfKemCY4Oo-dXLEkD2dMZMt3eNH2ry-oJzsgD7xwKc-CPc3YCSEBI9XNgjmfEoBLGAMBZK8WgykBnzGCvh0D5TLhkA0+eeKpnitCMik9gwU-gLVD5SvYvhU-M9FrgeqSxzX0yl2NpsdQQhuTuSIIeDe6gDc+Oz5QLtuReQgsNBS-gIOCc-k-5g0X6CtDHBMQVOMQ4bmipgoLG9wsxADALSI0cDMJsKW+aQoKu9RSdE29MvioGCC9nOeci9Ajghi-dx8GVPTDa8y+y-uQe-OT2+1A4ox8a+saRBOYVMhhR-ggx9uRK8G+YPxrR45-q9AtsQcQ0wGzHTbf+jGwMBqx+wr37Rfe69EJk-c-V96rqTXI0DQKtDJV9O0uPr69kDgJ9-UhxwJxJzWz6Aow4SvbObDfy85JuDD+G+8-8CM-U8B9+eQaybrlZDr+LaS-l-S-Z+5+ro1WAyMofqJ+y-YvAu4tsZFjVPs9Ah6-t+H+l9Z8x9sTcpU-AgmMVe-AJPiXx95R8W+XGLnvnyN5JMGgFvNwFbxcQ287G8uYQA7wyBgxREcfFxNgMYBe9YBBoLPgAEEEBbvcwAn1ECJw2IVAcgELXPpoB7+RQVPhHy14n9wEZ-H-sr0L4gC7+5kRgSsG16V8boHfGvtbDr61EG+hLUmFjggFt9oBWAb6LEC76cFqAvffvpvHXB+wh+7fMfuc0n4Kxp+s-P1DGEGaMRhummIQIYBshkA6efPPbC-w56t8oBI-WwfwFewEtN4tnbQdAN0ET9JAU-KvkYMaoikTyK9BBgaFKD740GRbNQHHGoHMBtIIyWQc4LX4w8nYqgoRGPwXprEJgOVGoGIH7RCp1BQSIQfVA1q19dY9fTcI32kEHIigMbLIN4JcH5CW4C0dvk6mS6bVx+udfQaUIUDUt9wCgiId0Pjj+CDBVfdegoMAgrZLYkEN1JPWNgjp8oEIayFpHMhNCaKKxFoVoHM7v98+eCJnmc1bgAByD3voE2oAAdLAI71bgvcLkMgYIP0Pqy7tiOcoaCMcPMj+9jAlUPYSPwOFb9aepw0gWCEuHXCMBhCQHi1GKoPDSA-QtaLwGXBvweg8I7gAAC8euoAK4UUDuHQjHh0dDdmiJwgswPhYkL4fHVwib0LB7wawZOFOGQiFouI2EZ+24DX5yAijFgIo2UCKNhA8IawMcKdB4BfhlPQ4YCJxEyIYR-Q5tiyJ9psjlKnI7kbyJJHggvIQAA')">function negate(args, frame_stream) {
    return stream_flatmap(
              frame =>
	         is_null(evaluate_query(negated_query(args),
                                        singleton_stream(frame)))
	         ? singleton_stream(frame)
		 : null,
	      frame_stream);
}
put("not", "evaluate_query", negate);
</pre></div></div>
    </p></div>

    <div class='permalink'>
<a name='p12' class='permalink'></a><p>
      
      
	
	
	  The function
	  <kbd>javascript_value</kbd>
	
      
      is a filter similar to <kbd>not</kbd>.
      
	
	
	  Each frame in
	  the stream is used to instantiate the variables in the predicate, the
	  instantiated predicate is evaluated, and the frames for which the
	  predicate evaluates to false are filtered out of the input stream.
	  The instantiated predicate is evaluated using
	  <kbd>evaluate</kbd>
	  from section&nbsp;<REF NAME="sec:mc-eval"><a class="superscript" id="4.4.4-sec-link-4.1" href="./4.1.html">4.1</a></REF> with
	  <kbd>the_global_environment</kbd> and
	  thus can handle any JavaScript expression, as long as all
	  pattern variables are instantiated prior to evaluation.
	
      
      
	
        
	<div class='snippet' id='javascript_96_9_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=4&prgrm=PTAEGUEkGEAVQFLlAFgHTpQKCyUB7ABwFMAnAQwBcBLfAOwH1LyAjAG2IBpRCBXS0OToATUAHNilXGABmpfAFtQAYwAW5QpTKgAzKAAUAZ2LKa9XWh2WAlDhm86p2nUGHD+ZfoDWxAJ7dSE3xSYUNrUABvLFAY0EDKXlIXakMGOl42Nn1A5WDQ21jCwoB+UAdhYhlqOmJhaKKigC5QYgBHXnIsn39QVWJyYX0+geygkLDrAoaS3v7BnLyw+umY5vI3D28-bmZqLIXxyYBuLABfOwcncwVyHyZWDn1wqMLcukMBNg9O+-ZiUAAvKA2ClKPoAEQAKmYf0h4OsJ0K9kcZhcX3wXl4hC2vgYAEZuN0GAAmZ7LIpvD6gQy8FgwjiA1zuTxEgmgXZZL7KH704jHcmFagyAwpBjlSrVWpGWm8yaRAXTeKJFziqo1YSI6anFpsYzylavehUg6iIHrZk4kk7ch7aV0h58hEKhpKpKgUWqyXzMbCKYGlalT3q53+1bsm37H1OlbnQqx2LIq7Jd5kMGswl+K2gABunV4fP100pAhp9r+jPNm3T4dtXJ5Dv5KyFItSQalpdlZND1Mk91r3zYvw4nBD3Z4NtI+hBH0tbMIE8txO4ubY+cmI7HY45U4HQ8d0a1Or1L1DxbiPorGxZmaXNayHYbB-9zf0HpEEvVo1yITlJ8KAEgVmMSg+3vGUHRHQDNxWedqEnWDJyJW8VzXDdoM3bcHz+SYnSgmJtWIXV-j-MdgNAr88mXPM+U1f14waejQEYxNUVAYQUnnSg1H0BQu0VSRlVAJQARE0BwXRTFCHBUcGlKCSsRkpohMBUTwWqYxSEoaToNKdTU0UwpmjIeRJwUbhwQcLw6HwAB3FwiDIKhnFAABaFzwz+eFaKY8lXRcdjDE4tQTnOLAzwcihUT3RkbjuXknhOM8JAEIEIqc+g9wheSpKdM8+BSggSEi5xMrUlNNK8i4UWcj5AnIBQGA0EgRAYCo2HIXx2zZNqOtqBhDFJQsYj891UnSTIjDxP0AzYwjeuEfriSeRTmgQoY5km6w0PQp5AQAPmpSg6oapriBanrOsGWr+gazCpu29DHv9C6+oG-lzn-T7PoaLAWOc6otFIDhyGzYhWrmy7Ju4F6FreobzwSN1RXG+8psU0oYcW5bQ1Whdhiu+6DIaXaAQOgGyGB0HwfayGiegzGBqeB6nuJ8JScO47yMMKb3qqpMOZuhgZHaygbmxZFuDCeGRuFqgtEYa76qMI7BbF-QJepXm-vMWXKHl-qVaVxXeOlgSkbGjJ70N3j0dAFGVvdOhAcpsGYf0OnYnx5Xjq2j2YhJg7df143vcFzDrZwkK+dYwxqjEDhKAykOAA8+OGs2XDW5PuADu3LadUK8G195QDkRQIBgeAkFQNA8Vr6PnOIFCqGIfRcgUQh6DOyhuDO7M05G0UQUBzo28UTuaid6bZOBagR8HFDW-bifu+npTkfqpfx67qeZLk-AMSxfrfAUFh8AX6ijBPs-B3wGQ0k3seO53ygtpaOh+5k5pRSakFuVRJ+K9d7+lKL-Xw+gm55hburS4UViDJ0IIENwzhAEvzfn3X2T1pwgTvgwRehh9DkFIGIBg8DEHEGQUaVBk9X69w-pML+o0GBpUTqQBg7cWDVHSnQahq894tGblofQLDgjsMUJwug3CmD4EaoQQgf9uG8KnnQz+-pv6pDeOxVEo9l5oP4ZAwcmi57OB0dvGhKi16GSYe1U+whyCkIQUg2O9AlGv34bFMGxcpz1RYHYhg84KAKEkGQY+p9z4EN0TQzBLMGg2N8fYs+whwGRNXhYxhopjDtDOsoLez8on6JXP1No+ZHCt0ySUnJBsW5BKdhEsxqT36qINOohg7APBeFcZY2IpQDGtK5B0lJTs0lqKYX5KpWgalgkGW4kBAifhjI+NU7urjhnNKYcXcGyh2rFRcdM6weFQAFKgUIjZFQtnSLEe8ZgTtNlZD2aslYLSznbMUXso5g5nlENefUoZjSulhh-sgsQdBJmdPeY1IFILlnTIedMIypATIrLEpZaydlqS+CduQZOrl3IGI6FoSqoVi6CDkWwcBGsiFiCln+F8opEHUAUMYqmXjkS-gVCNMB-jSAMqZZ42BKCKXELCLRAiRF3TClfBo7e5Qhb8pcaytOsQzxIIyAVPF0CNmJPJQ4aJMSVjwPlgtPucF6Cgr9k9DZATN6AwIay5meqViUsMPah1DQNnGvkFCp2MC6CR3ZRnUZGc8GXxVWwGZ3ZShjMXpc+WYJQ3hpxmUd8apagiqPMRBUxlgg+vMii2yLhiWUF8CQHFJL5G+EqrEc4RK5VolBMw+++CIEIOdX8+GCNBJq0pftOZq5oGUosb3FtBcG7mF6UY7Rdyfk9zbSRQeqQjr8FUOA9VQiJ0mMHOQ9i-9clANoX8-5MQemCK3iIYx9AfiUmKdC6d6D6EO1XaerRG7GphrIJImgoNOkWKjr9WtvailZNKcrBQlBW0YPhrS1IxAO5FsAxUsposwNspWCNNsGpySir1FBhg7UPjjJg8sj4oGJjttiCNR96s4L4cWRMojSGwicAwd5LDGaVhniqKQGjSHg2rn+ECAylHOPcaWd64jyGmP0O8oKCVooo2X2EyBcTvG1yKtQwGxTBtQMqeINJqt6ayMugDb08p2TW5+yQUp5gdHakgYk8xkMjFq2jrrfh3BDhzTUGBe2a+4TFUjTVoYXzbAe1Qg85C2ocJJbBeFWcFz1JuSMHwPwW5XzUR1LyavU2iNkipFM8Bt5oZQHKGULwBQGRoHmtOiIF1-oUa1YNIFxLzCUufJ2e8Br3Z8uVNo4R2zeyGGJtFG175mXgGzOwfoEbUUgthKnWN1+h7QDNBRr+4lvS2nKAGdOix8MzxasZJtrwrT8BJM6d5M8dZdSMkMM15LIFpvOAIVqp8KgjQCHC7HbzoRGTYIbWKSREXBhXdi4UCjJ79BaqHYa0hH8TVerBCDzrrruyfa8+qVt5qUeFAwSOv91Ux2FIWdZvrUyduzt8gGjxDB5N8fdtBSjYyyFOJQfcg9a3-29M88C0FMKKeGiuTmaijJKPc4Rzphx5DKE8LZw5woYvQk3x04QyFkzFfn2-ULvjP7Kc5a1-mDnBOXC9Me7s8nEGSIK9m0rxeU2TAvJm8FzXWOGiUdN4waNzOKHOJl7e5HDqMH++7HL8jAb0O-qLrWwwpd5BKCgHARAyB0B12JPFoec9HLzb3f5gNopmBiAkAtSbfPxIZ4oGwQl+P+bD0z8rvZkRCi68El7bcA3Df8zz+QAvfVi-k8oH0e4Ygc967pQuevAAycfswRj15EkCfvYN8-t9YhvIJnTsuCU793ovoIkXgkkUEyvVfWLU4P2U4Lw-BKTf35vcE0W5t4+Jdb8+-2z-r7nQGlvEZOmP--YCr7CO7+Te5sg+heuGu+JeYukylexKUB3c6uWeaCG+boX+toqBiBUSfq5wsBqu8Bnuji3urOt6yBLg6B+gret6vMx+-0qQ7uQBYOueC6XeYBveC25kxYQgD29uaWzg8IoAAAPvwYpFviwRAeTuCLmNyg6Klu1nwYIcIUwdvuATOCXqctwbIb-kbrNFsjwUnE7vXn+CNM-rfPfG-mQQNiOsSu7hLl7tLvQenHrmQRQQtlgfFtThwTcnQWflRHxpLizvQJfm6Nfh4VwTobIdwN4frmDLYT7poR3qkHEn4jEUQS4UNPOqAT3mIWwWJIkfYskfQDAf+rkf4l8kEoDAgRltnmkVThoFfHNq-pvNwOYZQZYUUT4n4lqvYR2igRtNuM4dnlQcStTsUfkTwlamUWQK2i9iQbPDOOJO0XkQQdLnfuOIEsElxtwC9svjQbKkbjIaNlUREAcsAblhkTvioeIWoWEdwoUVoVcQ7iVG-gYScbMSBIEDIEilNFHMSvcboYwOMesZUUgR-nrn9u8UiqSN8f+r8e1idmds8QwaCfWuCXzjoK0XcbWrchciEbcl0d0S4O4e9pwfsQAh7DCVIk8X7h7MMQsX4YQS4i7uSVFACTat+oyZidYZ0RYdseYHJkGr1rzsQYYYwWccoWTtkeCMTqJlpOifzEzksT7l0SNM0S4XESvlKmepOniekfnqIRcRKeuheoOKMXIUIaGCIZkfqXuuwfQM+kaQRtAbKaxIaZIpuoENutAgiQ4VfsiZUJ8U6c5C6ZekaNet6l6fia8TTn6XzpCXFsSkGYOJ0IDB+tQF+uGSNGCdGeTmiTyacd1ohqBgPCKbqZaWCOJuZPmbcfzPmQ6d3AQuJs8LEMsMqb0d-g2QGTrNRlZtKXZtSs2Z-htOJrFtgf+pZrWbZkOUWXruHCRh2acTBpoLiPmb2VOZvhbBNJOVCVoUPOsN2TZmWQxquSASjOQW2YeWqTsUdtqcWcwaWXvkdlWaxEdnCckkKS8SqQMVufzNTleQKVliCT6XMQ+ZLCTpMhebyakCImwhwlwgAgYccYiWuQDkQriFBWIqfLBSkVUfIeaakBIihcwkVFQKIjBSmWbi4V+eqchaQKhURawuhfhXBUKQhaHiPooXqeKdacipIjRYRY5PRaRTcXOUwvhbxWhYJUxakUcY3ohSASWecZxS-OZKJbRfxSReIphQUcJWhcYdeUifhiieTl8XGdCV2XxRQCIHpYBW8VmdkbGSOVocYJouZUIIMOGRGZmR8aieBQSbcGDL-NQP-AKpiaMdwJSmVvAaMX2bJa5mCOCAFUFQUdwO6gqc4GFcQhFTclFT5YVGpdBRpWRYwInLIvIoFQccCeSOFHRcEIyDpfobet5OkR5mJdVflRhYVWCkVkJH5SVQogAqfo-FBbqtjjEJNppmlJZRYQ7NTglYogNWvkNUHo9GNWZRNW5VSSNQaE5baS5ZNS0bmUwrNZJYcf2WxaKawVxfFaSmVaiI+c5ClVLoqemQOSMP0WgsJZSnSdLkCVEtUY4a2baG9ZgXjpHkbtHmXHHpXInjXHXDoGnguqQEuuAqnDMaKGfOfP0DwijbbMnA+gitmtnGJOjcDMbggiYFoMIAECYMQKmbUEfkMT1V4iyZMZsadj0Bbi8cEdKi1MXHfn7MzRsaAFDn8pRTsbojKiyoEacfJWKerDac-BLbWndTrJiQLbalLZGeCTINwMZQ5fzJqmzerBrZ5XLaAPZdQSrXsR6qassjIMbb6R8drboDldTrTvmGPE7P+ZzbvpKUGovCsW8LGsJXyTlsrovBrRaQpfoIvOZG7cQMrS4HHTGssuHTMWQeHTldkl8LHHQCQtbYARzTFXeBAlJiZXcWZXII-IXaxc3htA5ucGeAvqQrBriPnZMoyKtm4YzWsXUTfK2vghrWtMYf3dRMORbQWmsRUerGsY2U2UXV7JXUEsJYvWDE2ivbPTEC8duOvQdQamdEanDp6qCsPT4VMesNEfQjMRwLnf3r3X5ipECNfWILfSuEsF1WtNTivXfbqKfW-CwOfbDk0msk-bfcPeEAADzAhnTP2qDR2dBv2zJZqTjgiJz4DdV0C+CCAZWTLR40jXW1DNDgigAADUhyLMtUccQo4CYDJDYk5ktDLuFDudVDcDuog2IySDEIqDpcxANkWDYgmVYG1IWIpVBDYkDD5DR0lDMg1DMW4QpDKxRDpDjDUjzDMjrDEwB12UCByuxhu2JE62H8uGB82I1dbq-6t2Qg39I9bDhmRQ6RJ5YDLuPSRj6Ipjjg2dccgD8OoKuOLuzQxhD90+V0cjzjwTGjS2jyCWVjmEcj1otor9jYWoIYL4fcQTTdC5cGbdXtwe+Nk4ej3FZ85Qdst+r2cYBmJE7G72Mem8jImmX9Ie-oRhiW09m8U969S1-oK9OmtqM9ZTVamGLxfcxjRAJd-cB1VuwWujwWPh+j5Ihj2YIz7j-cdjT+LTJ9Wu0VoYDjls1jkT0wLjizbjJdWy+AOdedh9Nt3qfjLMATwWQTXsTjLMpQZEXsr9Ph+zDQATLTsTc2jGxdiT-T+EZD0wqTH86TA+mTrdlzCOam0wnDBTFkdARTIgJTQSpacBTslah4hEx4BkHGaxdTFdPdjTBozTVj3Tw9rTS9nTBo3Ta9fTem+EgzRdwzxz9dOAoNSY4NseFcCe1cyeGA8NXKPKn6fKRuPqR50tt5UdGs4I9KjKYrCdPA3KirtNDADK8ipOiirKf1tdr13+Cqv6eUqrvKux3Lv2u+zo1++MKxnscwY4w1sQ1+HIdrMQHIjrLq1+CEbr44cEnr1rPt2Cvr2CAb0w1+yMlsKxkbmQ-oTro1PtAU8iHUKxSbNMcbXrPtSDbrSD3Y8brxEINw-ejULAhgd+RbqgJb0eKw+b1+xDvrsQ+ghNvgbMB02KpDmDoAtbPtLkDb-szbrboA2K7knb3bcxLkzVFa3AMQ2KhQ7MMQ7ks7Y7cVUW0wTb3ALbPa2KkIoAo7mbcxwAfbBgA7W7oAYAe7gbcxAApEe+u7u4O9ile7uzEMuxCHPg23e5u+zNinPve-u3FQAIQiQfsnvfugBAdAgtv-sQjgO3ugdtugCQMxBQeXtxXgMAh9ufsPuIdAh-uocQh7RwcbvYcHTIevvgh7QYfTuFBYenuUdkfQfggAdHtDtFDzvgexCpzOi5TVMKtmsbLD2Aghhqz4zcB8divmvpY8eC7ifqsbL4AsAABW5N0eAIwntRyIPa3rprSrTRANWQCq+bRQsnzKUeToYUvHOn6rIRqnBb1+6GKx6GRn2O1+kAdAaoc8U7MQbnHnRaznKO1+FbDAsAkAbrQXIX-nrqgXVAlbAAor60F7F5Fw6tfgAHLkCpdHvpepefNPTSdUgmdgw4mCdqcrBqzKA9pezKBvyFeXKLK1L5cCC1c4n4JCdle1EVfszmHrgquivWdEkNcnDj1lpkoitqumcSuCrxygga2crVAA4VBAy+BeOKcgzrDKDcqaD07QS1eascCTI6s6q0uUrYIIhFBxbDfARHzZPeoa170tQ3dggezVaDC1cCcxbcAu6xDNcDdKZxPPdyL736BveYkKfKemCY4Oo-dXLEkD2dMZMt3eNH2ry-oJzsgD7xwKc-CPc3YCSEBI9XNgjmfEqIIeDe4MBZI0Wvh0D5TLhkBnyxx+eQaybrlZDVD5QobTBpsdQQhuS4qCI1WAyMofq1A4q9uvasZ2NnitCMgBLGAU-5hU-s-8BAtsQcQ0y8989sTcqgykDAgmOOz5Ri9uTYsNDc-gIOBy9gyU-gKtBJMNA4bmipgoJ29wsNADALSI0cDMJsJO+aQoJ+9RSdGu9MtFDm8QgACCbgzv5gHvovicbEVA5AQt59aApvRQkvlTXP6vPP4IfPWvNv54NIYa0e+ffPij6fKw5vBsx023XW1sDAasfsK9+0WOlvRC8vNv7s30sQ6k1yNA0CrQyVfTtLj6CvZAtvksccCcSc1s+gKMOEqvTmcWjePxZlQghgNkZA1PHPe21TMvQIVv4-SvNPKvF21TK9tnY-XfQ-1I0-kgs-tfC-r2OzE0l-S2pQ++aDRbagccifzA2kEZO3y4zW9Fe4CPvpwWoCD89OIwd-lQVJ45I3Ax-cBAAANA+hCYQMICcRTgfaAAITnjsRMBHARRrgLOjwhaWm4a-OAFXBBJSA2YPYMQO4DX4AAStQGEASBFGzA-AAMHIGgA8QAABhwgoCKyewbuJVAQHk8u+aA6PppH0CKcFOOAuYvgMoCEDhAjAsSKQLoC8CvusSH2svH4BkBFGNkagAAC8iEwgeEJMGEFiRY419GUicAkFICpB6AwwJ0BQqKC4qyg1QeoPBCaDeBeIYkMSH4HBCrBIguwZVCwCODUgXfAAOToCPe2A6-AAAlyAW2QweZAj5ko3A5ARRrAF4HX5oAPiblOwPjpMCfaAAWXNCKMI+oMXgQAHYAAHDhBiFhCxBToKIcgP0BxCZBYIeQSwA8EQgUhaQ0gNUKyGuDch+QvQePAMEjDzIpPMQIEloGWDrALQmwaIKxbtD5AiA6IWAK6EuC3BVPZIakJ8CzCxImQ3wNkImFvwGhAgkISsNaEbCHBWwyQbsO6EaQyyWIMgPQPcCTgjhww0YRcPGHmQ8hb8a-F4LYFqDShGgsgc0IeH2CcAHQ2IfEMwGJCfaAAMXJqKNoAXncEAABFJhcxQoafGKEcCyhcxCPkEjLbmRwAKsSQLwLRKTBVh4IWwW0KeFk8nBrw9AX0IGHggMRpgLETiPxGgiphHcGYYo3mGLDDBsItYeEM2HsidhE-PYT0KMAHDwE1+PkVpHMjYjFGQo7gHUOCF3CmRLIx4ZEOeEcjFRbw1MNKCKjfDs06ozEVqMFEEjPBBAiET4L8HSjmR6w+EaaPlGdDLRsghId7h5EAAVLfrcDniKMAAMjBkUbxdhRSgs5onC0FkjPBKbakSTk4HcCLBb8QIZ6ONHwjERnI5UdyOvxhj+gXgSMeZBjEKA4xzoiEPoMBiKMtAagOgIFSgFaD8x3o8QWaIVFU8AxZZVUaGPDGVjNRYkGsXWLfgABWW4YIPuEyjWRvo7Yf6JcGfC6BKQO0T7XLERixx4ICceZHjGpiIQ4IogVCN8EwjGRcIiIUWItHIisBwYlgf0HcA1BThe45LCkHrHghqBEVdcZkChHX5YAkoRRiGMCBniuBPA64XOPnFejZRbI5cUiJLEKDHx6wLuK+KjHviy2CYuKo2PSFiQJR9UJYeZCOg2gag8dLsbBKXEvDbxyo1wdsjVE+1mBT41CdGIwm8CAAbEEMNFXi5R8E4se8OtFfCNxvwhiUxJfEsTeAH4rCYMOOG4TwQ5wy4cCOWFGjux5nG8f2NXE2ihJPIk8ZCJIEwijx4IAAOpEIWAvALbFSLEgAB5EELryUncShuak8BAOIwH3i3API4yaQFMnmTFG1k2miMKklfit+f4wwBwC85liiAijJIf0CkjmRwJOY8iYuMclKj+JpYn2h5K8leALJ4IXybZICkDBheoIcIkTS8xGC+ghEOyQuJNFJTnJtE9wdfnSlmTMpPkmyVKO4A6A8QKAPEFOIACcl4yqT6Oql3jURcxcABtwPikixIsXFgPpILZGSKEyYlYlQPUBJJoxQgMiTrSgnKSKJg0xCf0KoFjT8AE08EFNJmnX5UhuQBwDQFzqKNf+lQRRudOSyYoNhfUmCYlN7EriaJQ4-afIEOlniTpnYnWp1JQDEgeYW0t6X6IQn8S8Ggkn4TyNGk-Sjp-0z8Q1O8nmQcpUol6QWOvHvTIZVooMW5IKGRRf+u4rgdNIqgBTMhuoBaQZMy7mQUhdA8wYoxpGgSZSOtNiQlKqk4y+JVo1KYSKJmqAqxYkUmamE-EPTLpccRRrdh15nQMZ0ErGTxKonqTPpdEnkdAH5mCzwQws8mdwGJBsTbhmMlSXBMVlOSNJMMzcXzKoDEysxZM1mbNPhnjS-p00zsQbIomUTzRSs-ifjIITX4I+UbcyLiOICGS54tsqgTQMEl-jFpPtSyW2KSpiRwA7QIhOtNABTiOZhYrmdRJSlISfavszIDqMDnBzRZwgAqbVBuLmRPM9XGUi7PBm8SM5Vo2qYcOzl+yxIAcoOXrF4HAy8Q3UlOXLMNluy+xJsmiWuNtHCTyRTcvEfnLbkBSUZTUtGS1P8lVyTRfcj6fxOazCAZEvM7CdMKbHmRjBZgkIJ+Jwmvj8JCgJYanJ7EQzuZsg1eevKzlzFD5Rg0wYzICn3yiJJgVQG2OUAdiKpr0xeTtJXlCBWoN8vaSKPyiyTj5p8gyS-LwnyAFhBE2ScRMlBkSF5A09OR7KtHXyGAG8iEPlOqCFTS5Ykcuf30LnFziJt1ZSiVJ3llSK8Z88zmeGV4gRSesGRkOCAACKYAw3vwEaDgghuxKG3q1GllsJjmiqOhafwKiMKtu9CrlOPFfjeQcMJ5ehZzzN459wEefNyL2nxSC8yAwvFuKIHL4S8KmIYaXrLw76gDFRCi0PuH1UVqKsBfk-XkQA4UCAy+lfWIOH2AGd9dhIfFJizwhTvCXeiig0B7xpwZAwYoiQPgHx6ElRg+9vA0JYqj6+LY+mA+PmgzsTMAU+xgNPkvwMXdhLFZfdyIX3jSl9clFfVXoUGr4hw6YxsRvrUWb6EtSYbfGniYs6FYAe+MQCAU7CgFCJb+69ZLjjhPSdDb+5zGfgrDn7P9olcYEMHwpsW68lmCUQZjWi0KrdcwUs6gJoGVxOph+bTY2HxCMIN9dYTfUMC3zqUM4IcbSgfkIkWXrdNuIEUYoQiFRvwOmzS9CE3Ux7-1jSMLMCh7Beb39kxNfG6NSz5AewVslsZHJSwjhRx8oEIC5cstWX+1zI1-MASsShUbcVlIEcOjwvX7vAt+k4OIZZXrngIioz4sKgoEen7okVVytZcSsumgADoU4g0XOJiFOg8AR-PhbrwZ6twcVV0IcQSvoBEqSVb8MlSiopUkrqVyculS9NZVnMyJRwIAA')">function javascript_value(args, frame_stream) {
  return stream_flatmap(
           frame =>
               evaluate(instantiate(javascript_expression(args), frame),
	                the_global_environment)
               ? singleton_stream(frame)
               : null,
           frame_stream);
}
put("javascript_value", "evaluate_query", javascript_value);
</pre></div></div>
    </p></div>

    <div class='permalink'>
<a name='p13' class='permalink'></a><p>
      
	
	
	
      
      
      <div class='snippet' id='javascript_96_10_div'><div class='pre-prettyprint'></div></div>
    </p></div>

    <div class='permalink'>
<a name='p14' class='permalink'></a><p>
      The
      
	
	
	  <kbd>always_true</kbd> syntactic form
	
      
      provides for a query that is always satisfied.  It ignores its contents
      (normally empty) and simply passes through all the frames in the input
      stream.
      
	
	The <kbd>always_true</kbd>
	expression
	
      
      is used by the
      
	
	<kbd>rule_body</kbd>
      
      selector (section&nbsp;<REF NAME="sec:query-syntax"><a class="superscript" id="4.4.4-sec-link-4.4.4.7" href="./4.4.4.html#sec4.4.4.7">4.4.4.7</a></REF>)
      
      to provide bodies for rules that were defined without bodies (that is,
      rules whose bodies are always satisfied).
      
      <div class='snippet' id='javascript_96_11_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=4&prgrm=PTAEGUEkGEAVQFLlAFgHTpQKCyUB7ABwFMAnAQwBcBLfAOwH1LyAjAG2IBpRCBXS0OToATUAHNilXGABmpfAFtQAYwAW5QpTKgAzKAAUAZ2LKa9XWh2WAlDhm86p2nUGHD+ZfoDWxAJ7dSE3xSYUNrUABvLFAY0EDKXlIXakMGOl42Nn1A5WDQ21jCwoB+UAdhYhlqOmJhaKKigC5QYgBHXnIsn39QVWJyYX0+geygkLDrAoaS3v7BnLyw+umY5vI3D28-bmZqLIXxyYBuLABfOwcncwVyHyZWDn1wqMLcukMBNg9O+-ZiUAAvKA2ClKPoAEQAKmYf0h4OsJ0K9kcZhcX3wXl4hC2vgYAEZuN0GAAmZ7LIpvD6gQy8FgwjiA1zuTxEgmgXZZL7KH704jHcmFagyAwpBjlSrVWpGWm8yaRAXTeKJFziqo1YSI6anFpsYzylavehUg6iIHrZk4kk7ch7aV0h58hEKhpKpKgUWqyXzMbCKYGlalT3q53+1bsm37H1OlbnQqx2LIq7Jd5kMGswl+K2gABunV4fP100pAhp9r+jPNm3T4dtXJ5Dv5KyFItSQalpdlZND1Mk91r3zYvw4nBD3Z4NtI+hBH0tbMIE8txO4ubY+cmI7HY45U4HQ8d0a1Or1L1DxbiPorGxZmaXNayHYbB-9zf0HpEEvVo1yITlJ8KAEgVmMSg+3vGUHRHQDNxWedqEnWDJyJW8VzXDdoM3bcHz+SYnSgmJtWIXV-j-MdgNAr88mXPM+U1f14waejQEYxNUVAYQUnnSg1H0BQu0VSRlVAJQARE0BwXRTFCHBUcGlKCSsRkpohMBUTwWqYxSEoaToNKdTU0UwpmjIeRJwUbhwQcLw6HwAB3FwiDIKhnFAABaFzwz+eFaKY8lXRcdjDE4tQTnOLAzwcihUT3RkbjuXknhOM8JAEIEIqc+g9wheSpKdM8+BSggSEi5xMrUlNNK8nA8BY5xDFAORFAgGB4CQVA0DxdqLhRZziBQqhiH0XIFEIehiDoShuDG7M+PPBI3VFEEtAoLIhpGmpxr9aY5OoJafhQgbVtGjaZOaUU6HIBQDsUNaxsoTbZOBfAMSxBhDF8BQWHwQd9qMd7PsHfAZDSC6ruGo67smuhppO91Ug0QgQW5VFBuu8H7qKUp4bYXx9F6vN+v0GqMuIAAPQhAjcZwUbB9aIZaKHrDQ9DpxAwGGH2wx9HIUgxAYUnyeISmjWpm6Nsh6b0cM2GGDSyhggYIaWGqdK6BFtGZNKPHVwJ2X5cV5WorlhgseoJGqcO2nGfp6H-VO1I3nY1FOjVy2NZaFcFfoR3nGdi3bvFyXYjthg2AulhhHIPmyYpwxzdR13-VKWLiAYInVdDj6I4YecKEupbXr+r7Ob9sWDM3DPw8jz7hBxku6amwOw1FYx2jG5RQdFu63a1162nzRwBpb-v29e5gtEu8bi-j26rYbmHRXYDwvBdmfu49xflGXuuA-n1I-NH-qJ7BOvG9ATWPf3j5D9ulfxp323pbThgKmUUPivoW+7rw0A1-xrRCcuFFF+g4jbFiECBYBn9Z4M13s-Ewb8VZQN-oOYB3NEHb2tqfYO5pqBiDoEfJBid3Y-BwXgghGC54P2MsET+5lLLWTstSXw41yAk1cu5LWHQtCVVCmnQQhAEY42RNwbmYgwiFndMKV8qRybUAUDtag2YU5pwAXQX8Co-L8MEdnUgciFFKNToAqmwjBA8zCLRAiRFJEtk9mDcohjuof2ROohoZ4KYZAKpwgmT9q5CIcIzMu6EWgky0CIPmUM4L0AIYEoJCYjEZRziDJanNnFM1iWOURhg0npNDE-KakT8E32cY2IomjRT7x+u4tgXcxylAqdRT240b5VJqd2ZobYNTLEsceBU1DJwmIsnQKytkXB8MoL4Eg7CtHY0qrEc4vD4lolBDLIGHNcZkyyZgiRMRNE3GxKIwEAA+Yh2t-6iIDpNDZToFmOJcD3B2Cj6C+2nnfLZJEympEoKQfgqgcZeP-g8p2g4BbsSRh3NGAdT5nxOVwq6IhHnnUHJSPuN8T73yoX1AFXsEUkOqWQc6NAlFQIDiFLqSYTm91bgPIwlAFCUE2Q3bZL5RTEGGuMylw9B60vpS4-ic0VTvjVLUby3T-jMtSKHD4B9x43w+HSiY2zCiaP+QNKopApVXxleNGl8rGYNxFUeYiIYzxqo1dy9m1FGQGRVYTOCZrr7arlTyzg+qQzioYPU1cqq7UgSdRar1vL-SaNNb681+1vJxkNYqvlgke5DzbgNGJ557VavpTq51rqYzknmWS1iLMVlinOpTPB7ZC66hmrNQSezfofS+kcsSkIHCkPVHCbgb1a3ltJVgPhhhuSMHwPwOBr80GoinjTGe2yPkcoTYQoh5BlDKF4AoDIBMk1aLGsIbJ3Z0iZC3aGatvahAy0Hag9+7w92bnjQPaVrLbpjs7jhRSwdT3oJea0g020Zwvqiu2-6UCoXNB3WwLtfCe4by3m+gO2yzy+MZOBhgvioHeTPHWXUjJD39pPfAkdtV9C+KfCoI0Agm3FvVHVIE+a2YkdjiWwYqHzG+QEm6G1vjLmhOEOE7MBSCH0YvTkoJ1HcFke4Gu-j0wG7XNzT1C+THGCatvdqihDNJ2yaErcFOnr8z6BiTa-e-MY5x3HWLTBknu2LIpc28hkG3nkjPPtRkNrLO3X9fmKOAshaqzRZg7yzaC4dpcwNJz40-N-q8-tEljH+U5moiB8zPdv2Gc7lBkivnf1fQC-oBLGU0srTfVbUTDQbVZcYPtNzBmP5ooK5uBufHoKZtiJojpXbqqLLqg1JQUA4CIGQOgDqxIpPmAWjtRyuWjN3RU1F0UzAxASA4yzWhYlFojZ4WZ25wJhvLQyyfSIhRIuCWGIMbcJ9TN8Km+QGbtQQ6ggW5QPo9wxAVqnQhKBoAABkr3ZgjG2yJIEt2U7Tdi2ts6IMXvvNU2di7c3rsYPBOdS6K3VvkuTsDS6Nb-qPdU-N2HINwRtrLSd8zOWC1w-BZbCb+25j6CO3lgnQO4akas2NjHk3Pnndm1dmcMOgtaUk3w7nIWvqg7226A7VOIxDEp9TpnOFSV84Z850r+nBaxwq3l8nIvJfi6lw+-kNzyWimK0LpV4PWeQ458faz4IwHBeK-CUAAAfe3ikIfs-mzD3MuiHRDoQaiO3jvnem9d9Dy3T9be0-JcVgXo2H0SM0UTtmJOJcjG12jXXiPWKR8V9HZXiW0ax9U6L7cKfLZp-T85ZH1uIHYbPfoEnVEvVlZz-QZngkseV+9zh+guPQB1+iw3pXHnw+sQWmHLOA+VeebV3+Kd02g+c8txXMf2ePMrb4YvyOiS85kCj-evP0-VMHrLcTkG3BC-i+O7z8z6+EP4BrkbnZBfNe2mLzPUvfDkfX-H1TTfkgyCbPw+rksjOOJKPpHF-l3twD-sktwPhoDvrqkKHtXq+kzpEN-MLskIHpdm7iHosh3meqvuZogcOmeijqThOmDlFvmoEDIAtniJfmtkQT7iVFAX-vfg-pQcstQQtqSLLoQbgZHohtthQa3pwZUAtjoPQeSowUwPgI0lfDbvAmwZWm6BXkRuAngYgjEowZ3owInpVtBB-qAY3h5tpuktoSQSweqsSgVuYSrDfnfhfnAcPnvLJjeozjHvvizvdnPhbmNuZJfGPApjzrwWtnpsvhPmwZomfraMdk4c5KKICj7NHnvugdLLPlgcHn4WJIkU8oOOAXQH7k7qGC7hkfPlkVbtikCm4bdAQWtjkYijorUKbATEIcsJolQWIRgnQSEeSvUT8MilSr4R4W0ZjqITQRgjwWcGXuYH0YOJ0EtASoomQRtPnhwVKlwRghIXEYNqkFeu3OmjNDPmzqUWCE6uZHscQLUeShcdUZPAcTtjECMVFtEfeNymnnwiGrcacdyuIp4RTiME6gxucHwhTKGg6mmoCYcapphD8ZIc4XzGyriBcemr8U8YJGdBkK8bqj0fCZKmCamiiVCV4UBmLraJCUPvEakOBkoUcWbtgeUeBlcaxPBoIVPqkS8f+jieXupghlyMvPJkfC3m6FjoyW2oEYKdsRgTLEVFQHrIoErIsarigREGgcbl4U2qQLiLrKQLYgqcgTHv7sUVScrJqdKY5HLDqfrIqZPkzlyTsYWtzFqTKRabqQbLnmTiqbtmqeiZgVDmUUlmJBqU6eaXKR9G6V3nCZSQhiacGZFKGXqcjEIaqQ1ibt4ScQtuCHqaadqa6daUyc5DmTljSaMesZ0dZt0VMR8T6maRQCIMWWsSBBsdZpMcCYTkEGEmlHWa0d6cKWMeIRSdcDySbGbE4rgfkSIjzEus5vkaiT2UAWCOCMOSrN3nkuEc4BOWIFOcFjOQOfZM6fGeGYwEbEuYmWyYaO8AINqYyIWWWkhqkW+I6TWbKZafKYebOh+mpncCeVTMjontqQEmJisPNp8Z2YMBfk+p+SnN+R-L+SDv+bVjksBdWaBdYYBd2MYA7E+V2TTrudLNBTacMSmV4ekX6UMeDOZPhfmeYKue5hEd2ewf8YdufjTnaS4KIsYRPrvh6WiRrsnlrsxdLqZi1rcm1vIB1s1N1m1B1DoANlKV8j8jjCTEKVKZ9F9P0KrEpT-KGKUCTBBX0voCTOZKpRwEIMEiQKYLUAECYMQEscIAju-jySopYf-rfj0IysIb2cAYdPYmnLjkms5TAa5RFq2XTrYiND5YsoTMpWkccaRYTOZN5WEr5ZGdRbgc5VFYAetqWTQTINwBWSFVIbgYhjINFR0TldwC2dMaMmOREvIIUtqiVZlWVfFboLhcjppnCqEuNh5fORCB1d3m8F1SlVKR1foPtNFSUXFeFmJP1cNcoSVg0oNTfONZlRyeNbhW3F8LHHQLzPknVQQu5akduK6gVaxJ8XICDodXOZ9oMCdWFERuyHdqypoLiHtVErdIyEBicFVZBanLnIPGWpshzNFc9jlkDdRECT9RdZdDvoTP9c8F6URYxXDSDHNdDSnGsujQjbEEdeLljZKcEuxpxtxrKoDfXv-usCnFdUjcKWNGILdmjkXOED9sCHTQzSuEsNpeOHBDxI5f9YzbqOTVbCwJTZxgBqzTtQzWDeEAADwS302qBjWdCc1EL6Xghyz4BqZ0C+CmKblHx1Q0gCIgi1DNDgigAADUWlsSHwuiO1QoOM0tFtYk5kTtBWNt1QYg9tSt5a4tatGt9UxANkutW59K1IWICM1AJtYkrt6S7tdtMgDtgN4Qlt3eZtltbtXyHtXtHNb+V+T0kkUeGWOWyW5IoGUMIcT02I1NDQPafaAt4N5a0aLoqZJJ0tBWms5d6IVdjgW1HtxN+1N8EmBWzQOWKkQIoubd6SpQouOdw91IddmESd1otoOdBGcYbqUiU0Y9j1VNiJ-d71KxJEKw+lxdgZdAn05QPeOOa9cyUaR9RYD16NjI51-N9WQaqmGGKNMNYNX9fICFY46NAWKS8NN9+E2aqRU0FdRAuMDMBNqWR+P0p9K4JdSIcWndldMD00Td9UhOddYNQt2D11GJmQ9dUKAY1sUD3dr8+A21u1tVB9YIQ96SI9Za29E9Sd7dPYIEM9yt9eZD0wI9C94u0ty9WQq9Eat9G9BgW9LNf2CJL1+99V3V1qpAJkAtdC59A6IgV9l0Uy3Osyh4hEPS3YJq-1z91Z6NmDoDpSH9ddgDP9WN-93YgDmNIDEjYD6911kDXdVjzWsgrW9UYlTUXWrUvWGAsl0ssi8ihKyikVziqxPpaZcVAyUT+ilxc1qTMTDAciCMQRiC8TfxvFTFtoxSXaeUui0TSxDiSY5GWVYIzoWOB23esQB2Y4AFDQWOHIzTMQHIbTe6WOCE3T3NpAfTDT124koIQzLMoz0wWOxDbA3e8z-o7TRQWOAUCM5Avg3e6zocOtBoKzhQWOfS3TfS3YBzsQWONwt2xsLAhguOVzqgNzdUKw5zMQWO5tQzsQBl3AvgzNxybCltezrzdTEILknzMQ3zoAvz9abC7kQL-T4zLkQZ3TbChQAIxyMQ7kqLwLWOra0wkL0L6LoAbCkIULMQOL4zwA4LBghlULfzxLoAYA8LYzwBAApNSwS-S2wqy2S6ABS8AT9p85yzC9vb8wi8AQAIQiRCu0uEv-OgBStAhisssLky0cuytcugBy0xDKuzPjMy0AjgvCtEtsIGs6v8sLmHLqs-OasYt0viuWuGvcBFDGvyuHJAj2sqsQgSvUsMtot2sSuxBKXOi5QPWZNVNPxg2AghjVoHaQEVNpPVOjqhsXk8AJtZNPz4AsAABWJgodAIMbGgqi9aAz6bSx3eHJxSwLRQ4bBiacDG91qbtbKcletT82WOHS3eHS1baFIL4IkAdAaoO0WzzrA7Q74yPbaFlzVAjzsAkA3TDzDAc7k7gF071zAAokM4u+uyu2JljgAHLkD7vUuHv7v8PpIptUjNtyHMDBZRsFsrDVrKD1qi7KBWzXutuXsCAftqHBYczRuPtFvPtEsclvvvtlsGKfvfV85G24jXsqImKiIszRVYy4jVCFoVCkDYx93ZvkC5i9q6KaCmHQTXs5McBHz5P+JOOxBIeggIhFBTE-XAQvRvVKNPCZWkxE2sfRLQTwwbr6Dwe4H4NW05I-sXnqEiMxJ8d1mCe3Iyw5t5ubJVYxBifyEgTA3Uc73yPsrcczxdocACByNiBfAi15H0NKPoYCSECKMEJOg-U5zGAMCtymlKKkCfTGCvh0D5TLhkDufDsVpnitCMgOcpzOc4zVD5QEYviud+fjIKuqSxwcDjR2730xA7ObOgtuRpseDK6gBhfuhef8CYtuReQidFDpc4wOAhdOf5ian6CtDHBMR32MTurmiphUwNcVqFADAcbfIcAyw6lteaRUxDdRSIadfuPWJjW+c0PDvxdAjgiJc1FdfTAVeZduTuSjfOQ9e1DsIbdgv0eiqRCMRHepdsQcS7Prcbd5e1c60tJ1T7cbcGMNAVejyBAXTEf+g239AKAMDVpJpP3otVZVfcyOdheff8bqS3s0AEytDcBY27uFAqo1dkA4xw-Uge0GfZZfI-e16Yk4QEY5r2fyDtxuAo91cRf8A+duezcTtMpSLzOeeRcrdpcXcZfgjXf-LBDshkDyIEq7dPeE933GoPVBdAjVfg+U93STdrcc-XfCC6KuePREAFf5R7clfWNrcg-qqhe3f1clINCtduDtcfydeEM0fCC9cZApzyxbcfx2+MDjcG8Giy8ACCxvw35gO3ogcsbEVA5AoAItxgaAz3RQp3Bksvj37k+X936vT35kofKwr333H3gSKfv3-36EgPhyom2vYPevWA-438UP4C1AsP8PIDmnMK-U5PaPbamPkg2P73CgePmQBPk3J3Uxu2VZ6qIEQghgNkZATP-AAXovwXoPuvqPw-0vtmj9-1tTyP4P6PtDWPcmOPH3QGzvU6JJ6NKtH5sOmtVzagHtfvzA2kD8efk-FP4n40Zf-86Pouu-MujHfObANkmzny3yA0QmwQXAgTIMb3H7tFXsbr8FApKfKBCE6Dv9fAn-fMKnUX63du8UAj-kwC-52cJet3dmDNw84AByUbvoF7YxAAAOlgD66BYBEG6GQqnGCAt8gMPzG1nKGgg4DzIMXGhukxOAYDUeWAmnrgPwGEDQAJAsgVzAoFhIjYMgGgQJwXC8BlwVsHoM9mkGgAAAXuuGIEChpOHGMQRIOzD0ClBOEdJMwLEisDjAlUKCN2mrL99B+k4PASII0GyFxBpAFvrK24BY5yAqdFgKnWUCp07KkwHAU6DwCcCXO2AgaNYJICiC7BEgpwX21cFGUPBXg+ENYAMHggvIQAA')">function always_true(ignore, frame_stream) {
    return frame_stream;
}
put("always_true", "evaluate_query", always_true);
</pre></div></div>
      
	
	The selectors for the syntactic forms
      
      <kbd>not</kbd>
      and
      
	
	
	  <kbd>javascript_value</kbd>
	
      
      are given in section&nbsp;<REF NAME="sec:query-syntax"><a class="superscript" id="4.4.4-sec-link-4.4.4.7" href="./4.4.4.html#sec4.4.4.7">4.4.4.7</a></REF>.
      
      
    </p></div>
  

  
      <div class='permalink'>
        <a name='sec4.4.4.3' class='permalink'></a><h1>
    4.4.4.3&nbsp;&nbsp;&nbsp;Finding Assertions by Pattern Matching</h1></div>
    
    
    <div class='permalink'>
<a name='p15' class='permalink'></a><p>
      
      
      
	
	
	  The function <kbd>find_assertions</kbd>,
	
      
      called by
      
	
	<kbd>simple_query</kbd>
	
      
      (section&nbsp;<REF NAME="sec:query-eval"><a class="superscript" id="4.4.4-sec-link-4.4.4.2" href="./4.4.4.html#sec4.4.4.2">4.4.4.2</a></REF>), takes as input a pattern
      and a frame. It returns a stream of frames, each extending the given one
      by a data-base match of the given pattern.  It uses
      
	
	<kbd>fetch_assertions</kbd>
	
      
      (section&nbsp;<REF NAME="sec:query-db"><a class="superscript" id="4.4.4-sec-link-4.4.4.5" href="./4.4.4.html#sec4.4.4.5">4.4.4.5</a></REF>) to get a stream of all the
      assertions in the data base that should be checked for a match against the
      pattern and the frame.  The reason for
      
	
	<kbd>fetch_assertions</kbd>
	
      
      here is that we can often apply simple tests that will eliminate many of
      the entries in the data base from the pool of candidates for a successful
      match. The system would still work if we eliminated
      
	
	<kbd>fetch_assertions</kbd>
	
      
      and simply checked a stream of all assertions in the data base, but
      the computation would be less efficient because we would need to make
      many more calls to the matcher.
      
      <div class='snippet' id='javascript_96_12_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=4&prgrm=PTAEGUEkGEAVQFLlAFgHTpQKCwMwK4B2AxgC4CWA9oaAM6kBOApgIYC2A+iwA7dOEATDgKYAbFgE8mAgBS0AjABpQI8VKG0ATAEpQAbyygjoZqXwMa5Wh0L5RoufO2Hjr4wH4VYydI5aZzm5BAFyg3CzkDDIAFqyyCtqKLkEpxgGgALwAfHSMrJw8fILC3upyeewcpBEOCUmpDY1Nqao+GjraANxYAL5YAJCDg0F4RGRUloSkTAyirABuTCVq0o7Krep+OvrJJkxmFqBWNna1Trspnhu+-oGNoeGRMXGOiRfNoOnZR1MzcyyLZZtGTvD4Na7tAL1MEfL45ejMSrVchnbRo7p9UYkCjUXKIzi4cSkNg8GQEQjKWi6AyuUzmGiElikaaEPwVNjlfEcEncMlESno3pY8a4xnM-hs-Gc-LU3Z0w7HWz2aXsO4NTxK0Sg1yhci-WYLJYQkEwoyxFjxdlvU2fXTfMUsyX5FWcZG1K2CzEgUCUPgMJkTKosABGc2U3HwpFALEEoAA5vssN7cAxKGxQMRojxpgxQABmT60Jgimh5tBlvPOYU4mgsWi0SjEGQAayYEmUzGIlAYAipO1p+3pR2smpkne7vbVqU8RBEuD10m1xlCTAAjvgWA5W+3QObZHux8WJ1S0UujJ4D+Oe1Sz6BQnWG03t8o3Yeu9fPThySXQCTW0HQyYdIaWMLtCHoUBREbTcALmTJIKsUgZAAIgAKmqQDUOQrpdm-GtIMoShm3wXltw4JRQDI7YQKCMCINofBgwwuCMmjetGxbNtyJfGoZCg4gYOYphBVSchcE+Y5ZyYedCFWBimJDOY0X7Jp5RoKSZOkbpUh6UAxCLFTGjoqMrwEeCHw4qieJRORGKEkTVMHBVrA0hdZFMqcYRnQRpLc29UlCV8PO0lI+lcMLjDwiYfiLBgkLIiirNAeZN3wYTDLcYy6DsxSmHM9iny4ijX34wTcocoIxIklyfM0+IcsA5SaIaItSCDGzStEWCmGhG0jEeKJREQziJG4sIIiiJKUtENK0V6vq3BK6Cuvsiq3F0-S8ua1IstM-LHxGjhNGs2oGqUnDmiqmRJNqty3wnJr3n6VJWva06FMApJnoW4wBpkP6ptS4T5p+oJX3k1acO+owNtEAztqaV6gqPHtlGm2aQsaCKgmx0Bcai3EBCscJSEzGQ2FlVI1N-TIMlY5CoKIkjkP8jwCKZ7hWaMUJ0zp+m9Vi0gWa8mKZlILm7z0hhUyiNhlGQohm0ISgAHcaF9GYA1xABabXQCE7DMbxuUnJoInaBJzMMRwLKNf9Gtuvgv8liEgJuiyhMo1Yu2tdZV2GcI4juENrAsojL2fT9X3upQgWxZD6toudjhgz1InCDjGQUoYchcrRoHKeMam-uz3PPuSgvrYJmhU8EPU4w4UvcpkWv07jQujGpg9W-rnC+mr0Ae4zxugZbtPe4y6nXyH9uq7GfCZ44PUOBTdggKb8vV7YdLmupiymw3sNQC34S5+xaKmAADxZWRD56iuZvvk+O72A4aD+5OZ6zlgc7zh-ZuUM-a2idcRXxvkvXAHA6KIX4EhO+6wmQsEAf6beL8soz3govZeJ9v6-03ig0+Js37Dg4K5WSsgZ6eSCJ4MB-Bb4-zLkfAQiDkFryoW4B4TIcyshJKTaIY867D3RkBShCDqisNQcAgexxqhxgTEIIa9AZBdjYNwagsCXyxCDO3SepsSF-RUWo2SUxdAADJTG7heIY9RJjaasVIFo2RUj57RUVGvZRaYjGwJftTGRLA5G+EUUhaxxjSDy0IGvEOmIB4k24dyJkZNYkzApCoFhx8CE+L0SfOxoBkK4BqNIYWjRPB5IKQIIpDQVzrk3P9LhySxEsHYa4Tw2SjC3l1NYO+tTxQWCaWzWhxQxJQOoLQGBUxuncIaRI4S7T9ETQmcksxFjjh-WYdUPp55xo9J4Qk-hr4km9JBqDfWvE1mNKOaDA5Oy+HPAtAsw5EtjmuAPGc60TybTPw2ZLUpKJCnOPPriUZGc5ikGoE6dgMhL6ZOIX9S+yg4SgE1H3L8LjcSZmLM2LgrIHxiwmDIHFcUJjKHXDMUaJNiVpQYKNZ+GUsq8MzBwZgDFRARyufEm5JKqUcHJWxQWRLQCPKeZy6lGSjbU3pdERlTBmVezprk-Jvzym3g1KcWZQK4wgrBQiZ0EqpUyuRSAmgntwUcm3IlNs1FdhZVoPBT2I1zUSB0GKvRN05x3T7Cq+wktaD-J-GnK+HAyKUFwN06F9JbmyBJp+Q1x99gMoJTWWg9yUk0t3no41-rL6+ATRMJNVzkUDwzT5LNQgc0jOTWGw4xrtUQszYGriwaK3yzLYQbWNa2BRJwMmVF4F0lpggDAeASBUBoHkKOlFAKaBMHRkyICISNF6UIPMDuvjrBDRzDU+dJizyeHXZrLqwiPGqJsaQDZHSbDuK3aend7Mg5+AkGwYMlAD2j1oA+p9XVg0Xu3kerxJjlD8GXWec9hQhoCRrL+k9GzPCgYkDIadqVZ18knRwK+3AmWjOoJB0JiRF3LouU0IJHAv3CKTT-BuaGMO5uw94gDS7Tz3BIT7UFDBhmPr1L7Gj27il6RndMGQzHuxsdrtHUFXBeBgc41e3DgGz0kLAkTGsm7PFQZvQhrqCnyBKYcFeujQHGPHHEI+5hqHL7oelZhwgXHr08eTtXPi7BgwmfCAQnM97H3PqTdJgjfUjNOZYCnSgAg4Pebw3J44RYSUkDnSpnDanpp+DXGlaLcgkv8GIEsegs7t5TC87F2jYXgMkNDI2Zs1noO8ZgiV4gZXdOFYM9YNSbJsuwPK-FmCTWsvTBy8E-LUw9PhesNXEoxBxD2zxdJ6GAqePqY3Px4bIhRtVEoMM8C1QpgjZ03109A2ivHEW2NqT22Kvqc2z-I7x7Qm7Ya1wes5A4yEB621mbCWHz3ce61ursmiszBltZ+WitlZqzoBIKYLBL6gF1pVmas7O0xtg8h5Q5G+w0SuisnObAtPkEBPZ8kj0gh7wk2SjHWOcc9sR9GBgcYqSY1hgZNH1hrGzhXuTvHL8jC7WlXYCOs2kPDafcF5Dbz3muAGUIQDkRqBPcFR8nt3LzvbxzEmvHPmRfI9V+84bEvUwffGWzi6bhV1SrfiPR+h59Ws08E14Rq2WRISZdzr53NQBkK0skOnW13i-e7BThWhAlaqwZD2-WEg+CQ71rBkOxg+jROD0RkjQMk1odoANjKr8hw8nxVTzIORef8fIwNgDZmadChjadzT2n-thd0cQmRDBIzRDg3nmLddtPcuYETcDMXLsFdk18mhfGW+KYmDBOiaXxmhe+00Fcg+PGt5H11Tc3CAyLHKwN31+FTuReSxl8obBSAp+r81BnqHVGkFGtv9LQF6D75PGnouejXcCCNh7o44lrprrrG1LrTAns34P-jikNTM3mSJEPQM1t1q1v-lSIoLJi-npHDJ7jtCMlGPOAwOAf-qbmlPBP5CAWgRgdUJAeMtAYkHAdqCftbqPPgd-sSG1MIoAY0NTNQWyPvlgUwEbOFAgfDP5MAQlpfilo8kyjQS1rlnvgAbAfRhwdHrsDHhOj+PHpAkQG9g9nJO+p5pWjQJnm+h5qIDnrkqhEoXdioQIFhJSGoXDAagPLQAJKyJQJGGduNuWtJjXkOBFuPrvtJsqtGMQMQPgGwHYEhoKoUHQhrkEJqKEW4FoTYcRvYQdudomhES9O4ZloQb-rAnlj3iYgxjdnEY4VZp4U0LusNLkdHNoR+uVl8qEJqBvhfAltVrVttqns1OgkFhIJgvxJigLiFsdkbFlJ1DaqxNYTGDEW1CUYmi3K0QbhzigS7hEkYeQgMQhOAV+oYaMsYXxMtCXgOMQiAV0UXuAtrlLq1v0YkSLkEKse9tIIfjLmcWFpYcHqdp1qkU9l9vRi4YcMnJQWbhLCAU1pRhZhNsdgNvcZOtDrdmsbrr1pkWEkflajMcIvBCAcoZCWwaZuZndlhpPpIbsMie5h+mwfivMT1nic+mvv-PfGQdsUOMIjUaAglmMYCdCU0TifMSSS+mbgyVquYWSTcW4CAZyayDbv8RifkUCbyR8LJqcQ0JSQ-sQk-sAt2pOjaimP2lAHAIgMgOgGOpoHIfhIZlpvuuVu8ZYNYLIvIhwEElXgzAaf6KIJ2gPHuraQSc4XoK4EQkOAeK+NJiCT+MnBEj+mUc+hoUsUhMhP6UwMhGYToT6fhIGZ+pAuGUaWmsQp6bxN6bSSaeCe9i8cdsaSQmaYEsNHVshMiT1vacHqWbAmyUme6YcKmTZPWVttCWiJ+APJWRtkKWZlRpibmcmR6S8K+F6cdtGtItYAKTWVSc5NouaZacWcZDGKMcWIdjWNhKAAAD5rm3h+IBIKJFmNG5J3wOG+yrkblbmmn+Izl7lMnypy4Clw4DwCnVkunJDUxxnEYJnuKNkVEFrB6PmdnomWYTmdx6JflDnNkjnB7Jzzkbbjnhn5yPxondmEDBmWnITQWLmjbxETCRmIprzwVpSIUAnUAxmuKf7GYBbCmAXPmymuHnk7kWlXl-owkMyOYmaUXYU-mgl+bOYK77AzBskZFMUrp6JaHmHvnfr3xfnemcXyGsUBZdFAXp51kDm8RgVCUQWgnJzcUUVdlEVWYuZrxK7KBdEoXDQsXkWEUik4UGWK4zCH4mUZkkILZLlYU9nNn6BTa1mZkFm7lKLFnOWYV5HlmgkBXLmBiJnUU0WHBEbMAhp1ZOBnw-ihWuWsg2V8XoGKVKU0AxXSRV5OpCgDzJV5GBaC6RXAXEI5VxX7mViJX4ShXLarZZYwVLmZXiosD-joVHkQYSxFXRwRVikwhaVyWWWAU3G9UOxpVK5r5jW3kuXFUKXSWOXHBPEiFQlCWGRG4+UMV+X7nIQrVEFCwyX4R-G6UimKVdwqU2Tpml6jmrbD7UDKbuV9lTlbWzm7UV4L4jUcXrmblNDbmXk7XXloXUD3URJdQ-5llHXRQfUPVdTmad5IZlXUyVVV4JUFXB4w1g2NXj5rVQYbV6Io11b5X9wY0g1Y6w1cAsrJIr7d7rU0TI2IRSpVXXk1U3XB5uFRa77-7CW150UA1IT-7yz8EZbBU-jC0pGrVJrc36DGAvkgWXXuj76tnB7MEQ1QG0Eo5y0pkvAkG1XRRCEQFpGiEkH43ELgwa1Q24jHC-7cDn6Jac3X4W2m20UnDKi63o2gmGZf6G1-5O300uojinAyDm234aV+rWD1GtUB3TmFmA1MXyz1Gi0LwdElXdFPVeWWJ3JqVQaW2aHtVLCR1q22LPXZVmWJ2UjPHeJLXWCCasYqIiYQYumeWTmZlKFcq13CYcaN25mnl-UR0cbt1Rwsad0RLd3Nl61W01Q-yjQd311d2Ml03N1RXeUXmx241Xa5Jt0z1D1CZz2j0cUT2ZkiaD2azD170XaL1ukt35mr2+Xr0LrITH3b2n271pgN0H0e0-gd1xlR0VWM2xWo253HxgFtQ+yCC-1DiE37nE0xpFgKbEZRzgNlVZUhlM1V6s2x6aX53ibcCSYQZa6nWWZI5U5+FVnsUjKmVKIlkSbkDgbYWAJy7kMpLkakMbZMMl6YNf07111v3z1gpiaga0MX143NEzG13wTf3cnSbOq82kIRIn32yv3sb71uVCVeHJyCN0NYZ+nuK13C63GWnMFgOyDSWzIaM0NaNWY6M-p6NSlgiGMgMIOaxIMDW3EpBwMg1OP+guPgUkWT04N4ML0iNa0u2vWMUnrNoWPHlAMEMAVBM4bO3KVZ1pnDmH2U4UaEPUZI3y3JM2TZ04bRqKkljKmpjphqlDqamjrli6mkVVD14OJwZQp5nHBPrPqsBWZNNeGXyzLe5RBwq5KtP-BTpmbFjTACAdjFhMDY6FJ+N53-j2aTV2XGWtHMnX2oVM7FDVyRmPKLPoHLPBbr6f16mM4qbM647Bn-Vr1kjywbNCBbMxNy67PK6UNtQAO4DKBo0k0hVy4KW4AvNoPvOgAwOFWMNLqS6Qlkj-NvPKAYM1O4ifGmzOnUB24vMoRfFpQ4VgQotpPLWIuHr0HNN81XPCLyzosRlANku26tYEsl2Z2yCvj0GzOLqjaUDqqoZgs65PayZ5mvhkFfNJWOM4Lcu0sHh8uhwzEOJLA2122HGQnwTVFwtzNLA4JxmH6kbBl-Sqv4XSoxMEICVkgZIy2y3X0HhAJHPRQnxsHK6GuunGvL0nI2RmucOb7Xx0LsvzDgt-7mFqubj2V1hStvG0tzAZwOJyDet2hyrBtxihvTQ3iFHjRPB2YEJhs6E+sWHGX+vuuVGQT8DRv8Kqu6AAA8ObIb-Csb-eUsf2yEoKlAv4MYbRLDPWNqDEND0goQyEoAAA1NNn1AiPXGJHBgW127kvLMOzcX2xnAO9-BYdm70yhDW7GirOk6wwftlK2wIO22OwtBO3GFO0O92zhR292+O4wP27gHBuW0y4zHem+YenGas5FA8UuhaYRLyMK9qFYTYSmx+mm5rc0EbqOAWzcTQs+4zG+yQFBGy7K1y-Rk7ikKEHGTkgeEBwtBeC8OWzcQh1++DOGydNOyeFITDOQe-oBjkpK6frbaNNB94vfkEHO-e5vYQE+rOLhdvFHqFFwUgU0FlNkqxMwUK9if+3okMVZpa6qwa2wnYykJa6RhJ6glMetDIRnYBi+76PBtic69FLibe6+uYfBQ+0YAPCp2B+p8urR8fMHiJ9+55vBX+45LI4B+G8B3hqp+Byy1Bxy0ceMn3phyDjoUhzrU56h3QPsBwAeLG-BXByEHQNh7xAW3h5e4R3jD25VCR0umR1otK1R555CezikPR3p4x8x7GOGeHrytmbAuxzjJx+Z64DxwQvBPx8mzKYwcJ1+2J963J8DOKZFHq7J58kl7jLjMAaB6+6ZwakU4mn2mU4OhqSOmOtgDGujuQJjhQGTpOkLokyvfRYY-yLkuhit6TuS2kwd6t9M0vKonMD1pxnjlt3S8HbxGzsAmHCTmt8qz2osZaaCKhXuDhcYHuB8Po8YKhW6H90YG6IDxcqhQNGDwm7mM0ED0YKhUErD0EpD992ZYqKcDhVj16g0IjyGShObLg5IDhcT2oI0AT6hb02D70wj1D2ZbwpKiGLQJGUz1wMGDaqkFT2ZZ27D2kP0xIHaDkBDt220aADz1Q9rPz0YJCsoEL3oRDnrOL5L6GdrFvWDxDq4N8EYHrFr6ryhKYSkHL6AAr98BDqhKb0YAb8hMADL58IL8L6ABDmACrwz1QwAKT28m9m8i+gAe9W8S-u+hl8z88+9O8Q58ym828ACEdMYfjvivoAcfrEQvwfKEhb3vif5voAxbRgafGPVDhbGQMv4fSfxf+fNvWQWf8vEfoAOQlf6fyEWQJfygbgZfOfLfjfhfoZMf9vzvbgOvyfxgUKoIOEL3h3b3LOKGqrmQ2omee44Yr3531cJeE-Z363JYxGwYAAVqMwMfP6SOSHodD8v4sDhV+frqEad0d9P8UzhOK2tmEGf0sOhZ98NKhU-jhU-gT2cahZAIQBkhaYJAf3AAUAPPy-8RcqFdnrAEgBg8YBkASAe8mgFMhJUAAUVh7s80BSAp5KhQAByLAPAfbwIF4CoufUcfjMRv5T9Oqs-DIIf15DEA9CB4YgLhioHnc3+FAp-mwMBCdVSMc-VIJnkYHfApKc0Z-pP3YEoEFyJeeHETnbziDN++DPbuRiCTBlYMS8VkFJFmASB64HAHfgCDrDEAc4ttE0DCG4FLAVuuDI2oQTxQq5HkygxCF0DcBs1QSrUEiO609atZgyYudwZy1awSxgi4DMwXfwdhasUuC0IITQNw7+DeAdCf6C-2CGBhKAu-ffsoB64RDJBHZRPDgNcDkcsuPgrzqemAQgp9YWiDVEkJgjUcpg8EVwdwHyEQsH+MSH+EWA4DCpG4MwJ9EWGuiEBw4aMdoay2AFoIZiq4eCC5maHCouh4cBTldEWAMAOhwA5PnKmQijJg2h1czuT0kAoRdYesdDI2AsygBhUPwcOLr11iGwwhrgdYXBiICjClg4w1cOiGS6bR9AuME-C2hkB3C8uRgC0EIHrxzBiMrGV4S2lTpvC1orgaYX0NGTn4Fh9MZYZVw+FuALhmwrYRHnrC4pcQXw6QOHiRGnDX8egIbjVwRhGAERyEJEVDgOEO4WUNqEkScIU7nDiYagE1CYMaDtp4kvIR5LxyyC8krhTQm4ZSjgw9cjAAsdbBQCQyrhpkc0R5M3haG8i3hlIeuJqlZDtoZASKFsi-mcE-gdhGWesFKNJQTDIwvQ2Yf0IgEZQT8o4PUJMLhFEith0OObN2H1gzBMco9DEVsKq4PDEC5nLKMMNYjXDtRVKXUYUO1CWirRAgHODMPZjcBDhkYTEdSKS4IiuR6BHkTqPeFJcXhKIwlFhneG1djAXwxlHYCWBCYARqYh2ApSTH+QiRAAQULFacBAIgMyKClSTVBB4-rNAC6M4KPCCR8IukRsOJEkj9hvIvYDKkpFUjD2LYlIBcIZFcxmRmeNkQ12yAy44xYw6UQMCmyCiFyucfjKKPSRsJshouQfD6Lgwbj1U8ohkcqJBHSFwoQoN0oVUcYxhaAKsGYH6MGFP9PR40eMXuIfG9EZiJ8RYpKNuGyjgU+wLVOyCVGnA1oAHIOl+IrZhla2EqeuPWJYAVIAosxb0eMJXFTA1xQEDcaawIQngmWMkUtJWPLRXIxReZZkWKCnFgg1kfhHPIKnRQ1YsU4JVEVZkolywtkkyTcagkSK4A40zPAieBGTRiiDUyE3kW0INGdCAA5AmhkC3EAAOlgB+FAQAhQgMTLgG7AchwipvWvspBhBiT5YMwjocdywBCTSUIk-STIAkmFipJZxWSfJPxQxDigyk1SbUieD4A0YuGHcH9BcmgAAAXqINACyS3AikhqipIYAch5g8vZQD5K0k2gdJB5cEQZO+h4Brx4EO8VEAkl2SlJK2YKRyEF7KBUK8EhOoe2ICHtykaIMSThG9BGSuUek1lkBDSlFAMpK8RyTlMJ4llD2wYQqcVOwjaAYpyEQ2EAA')">function find_assertions(pattern, frame) {
    return stream_flatmap(
              datum =>
                 check_an_assertion(datum, pattern, frame),
              fetch_assertions(pattern, frame));
}
</pre></div></div>
    </p></div>

    <div class='permalink'>
<a name='p16' class='permalink'></a><p>
      
	
	
	  The function <kbd>check_an_assertion</kbd>
	
      
      takes as arguments a data object (assertion), a pattern, and a frame and
      returns either a one-element stream containing the extended frame or
      
	
	<kbd>null</kbd>
	
      
      if the match fails.
      <div class='snippet' id='javascript_96_13_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=4&prgrm=PTAEGUEkGEAVQFLlAFgHTpQKCyUB7ABwFMAnAQwBcBLfAOwH1LyAjAG2IBpRCBXS0OToATUAHNilXGABmpfAFtQAYwAW5QpTKgAzKAAUAZ2LKa9XWh2WAlDhm86p2nUGHD+ZfoDWxAJ7dSE3xSYUNrUABvLFAY0EDKXlIXakMGOl42Nn1A5WDQ21jCwoB+UAdhYhlqOmJhaKKigC5QYgBHXnIsn39QVWJyYX0+geygkLDrAoaS3v7BnLyw+umY5vI3D28-bmZqLIXxyYBuLABfOwcncwVyHyZWDn1wqMLcukMBNg9O+-ZiUAAvKA2ClKPoAEQAKmYf0h4OsJ0K9kcZhcX3wXl4hC2vgYAEZuN0GAAmZ7LIpvD6gQy8FgwjiA1zuTxEgmgXZZL7KH704jHcmFagyAwpBjlSrVWpGWm8yaRAXTeKJFziqo1YSI6anFpsYzylavehUg6iIHrZk4kk7ch7aV0h58hEKhpKpKgUWqyXzMbCKYGlalT3q53+1bsm37H1OlbnQqx2LIq7Jd5kMGswl+K2gABunV4fP100pAhp9r+jPNm3T4dtXJ5Dv5KyFItSQalpdlZND1Mk91r3zYvw4nBD3Z4NtI+hBH0tbMIE8txO4ubY+cmI7HY45U4HQ8d0a1Or1L1DxbiPorGxZmaXNayHYbB-9zf0HpEEvVo1yITlJ8KAEgVmMSg+3vGUHRHQDNxWedqEnWDJyJW8VzXDdoM3bcHz+SYnSgmJtWIXV-j-MdgNAr88mXPM+U1f14waejQEYxNUVAYQUnnSg1H0BQu0VSRlVAJQARE0BwXRTFCHBUcGlKCSsRkpohMBUTwWqYxSEoaToNKdTU0UwpmjIeRJwUbhwQcLw6HwAB3FwiDIKhnFAABaFzwz+eFaKY8lXRcdjDE4tQTnOLAzwcihUT3RkbjuXknhOM8JAEIEIqc+g9wheSpKdM8+BSggSEi5xMrUlNNK8i4UWc2LiAYFhqnYugxH0XNSGoCCc2oviYj88c4Na8h2s6lCaLOLAWOchqRGqMQGDajq-n0aamrEHrzwSN1hkGFbZqdc5JvMXbmvm6jlsavbC16gS3W3Y61pCibLlY+6GGqBg5HIBRiEG4a-m4T7vvWvrK08BbOsBsaDue5ziAADy0ERfsW4cutXLhQEh4GbpcBCeNuOr7uRkbuoBiggcep7qvMeHEeEN6ZAYSlQWIOgwXB-62Kocgya+gsSLPe7GVe97IeJzmse8vq3wqNUpXuv0AxaBHWcGDnUeEbneaBxTmk4rQkgYG4uNUc6ZpO0azdW6xuE15htahqqk3dVJmDECR6enMFcgUQh6FZygdj6e41qujbBNFPGfb9mo2fCAAyePZhGaP-bjlSgUoYO3cpw7klSOg+f0VPY8obHNvzkOPYYL3i8UGOA-Mwvvsq0K8-HSgDcYY3uP1sg6FtrXMfJ-nfJx4e+YzsSZAjWptP9UpwRnvY591lp2k6fQ+6SQfmEV6ZSkh2I19FdWfu3uh99k5W6YZpmjRZtmt6oLvd55ieddDZpI4XC+E6Tn+A07bkCvkUUoF8jZUG4tuP+aF0IGm3MAm2BloIQJ7qbbaz9O792QfAvBDRMFILgfg-BWNQGGWnrPYQ4Jc4w3MIYWaHBKAZQ+IEL6+g4bl0EnjOG3AniAgAHygHSJkfaOA8B50MMPRQEAYDwCQKgNAeIlFO1YsQFCVAfol0bi0Og2YerS1SCCA2m9tFxxknJagJjByWzMWXGS38C5FzseQmIcl8AYixAwQwvgFAsHwDYs6Pi-EBIYPgRmzctH1zTmXbgrN9EOJdgwDQhAQTclRHXX2MTXGgFKCktgvh9DqLzJo-QecGDw0IIENwzhMkNzjnEvRuD4FezCYzUahh9BDTmpU6pDCjR1OyY0-ROTHFhKKlQYI98-HVHSnQQZpccmlGKauUpaVmGkGmdNOZTB8DJMIKk6g6TakuOGaMpJbx2KolMdExZFiWgrnvjNa5WQ7FnMSaKNgX0WCawqXDKpxAan0AWQHJZQkCYfTofMr5fjfnzhHgbbxvj-G6hBQ0lBY4YU-PIPVfAwhCmnN0Qk-0YzjDtFZsoKJWS7kLweT8Ml+ZHA-QZRSuqHxNHfTZp0wl8TzminYB4LwaL7G0pWfVLkQq3lEr5akPy3jmBaE5d7W5oL7lirleyxVAdhXvJJUk8pFRlBfOKsClxeFQBqo0VoMpUKGCGsHMwp57K2Z2pMK8lVDTpUfNSPaoaczhVgrFb6k18ypW8u9ckmpYg6BKoDZan45pqDRtjWGppiTjLBB1WJSy1k7LUl8GzcgcNXLuRWR0LQrdVHOXyYU5E3BulhCui+SO7UFBWOoNmOqecbWX3WtdCuggDkFIYFU6gbaaCdshdTeZdbBCkDEGEWiBEiLumFK+VIqdyhTqTD238CozzVIyAVMtpTyn+Pxbu4hJCGi01VhUvRcF6CxoxSQ8p8K+YG06ciZp17QwNqvb+6Y5T4mPpjdq79jYiiGIYHKy2h62Aiu7KUWD1EnmIzBPBxDX8yjvjlhqZYy7jwKgzZOWdFk6BWVsi4dulBfAkBLYO1JvhKqxHOG3KFwJQRtNOujTplTDBnLDuHN0NxsTdMEXS1Z1rulnLif8xd40qbOzFZc9t9AbnUp0bysO0HKCkH4KoQpJ7rWqZeSOwI7F0lUvqbE6VOTcmSfLVE55zgfiUjaIy5VmnPXhuw8Z5zVzXODk6F3JynaA1nNodOyT3iPOsqMJQBQlABPSrDs21IxBfa0di+SplCWksTCE7EPqbZ8NxiPP8dLNd1ggU1Zl7VHwCt7pWH1fzZS4IfHlRyhriXks215d5QjxEQxniqKQTrjWQKjUZAZNrY2JsKvq0-SbYROADZDFVlD6N2vjdq71nja4+38QHfNvbSWDvEG8uVwiRHuytceSyvLL7zwLe61y-LfW1tNKu6x8kbGq3mFaeEsUhco2fmCSixtJE+qiaMMigJEmoQOETdG2ocJuAQ4CQp9j0XDDckYPgfgrqjV+tRNyj1ZcdPj1FI9ylcbQx5OUMoXgCgMilOe4x1WAHQwiLYNz-0sO8dCDCUT4NcyBMc8KLTtli2lXk+82XSYJ8fVutJycin9nLEzjF1FTH7qFdK+w7zqLynHkCuUJKingmBZGgEOe3wwsJW4ovS47yZ46y6kZELgnovVchs6fbp8Khbc4ZR+qKRQIgeM2R2DqUHuFOFHuyU619u5O3xA-IMDT94-88A5uGPDDUehG4JLvPsReViKU2ox5GrZfatTfoqnA7aowZxhd-QL62tyt6YC-poaNdnMr+3MVYeU1W9Szb94AhptAja6PgOF2-kAqBf3g3kXyRh6RSEwJ2358ur1xFtG+Z1+J-HqNE31efg6-Vwr63G+wdb5Re36-LD4f65szbC1ee2sv8YKNJffSN+H+ue3+TSIBm462p+A6pWlMEiUKUicgMiUAcAiAyA6AyixIAOlcxijk7+2STeEcrs5A7stQNcoIWa4kViuBla7cOBFAO++YAakQhQY8A6mC24LiQ+HGLekScO2+XCbotc4IkS4IGOb+XBuOb+3GvBLiBBW0cw+gHBGuEhzsooe+XmH+chlcbs1ctcUq4I6hNBHG6hj+ASTB0O487BEYQwChShBuOEj07cJh-+PeK+5hrBgkVhtodhH+-IOOqhKuJOIa7hUBhBVcpBeh4+4IxYQgIEv+8IoAAAPokYpKKDoREeQfoWfMTsanMgkckakUQSQZ7JkVEQan7nkSoaxL-qYXgYsldH1HrtIUXF4XUaCn4VXs5DUS4f8oAaahrg0ZYbYdYT4dkh0Z0dcBCjES6r-voJElROjAAb3s4AIWiOQdEbbrETkWrvQKIcInzAsfmEsSvlUc5J8t8r8q4X3iEf2mEekSUTOPoVipcb0csbsWIrQRcTiu+t9IinrvLpoX+DDhoHwU-sDvMcnIMKMYsh0Z8bCjivbjccJi4K0YodYZwacZMXcM8TilcbUj8ZIGQCloHloZxjOOJF8ccX3nsQSZ+twIHhfmcakOUUEf6rIREOah4W6GkcQboaUbftPLavER8RxiybkVFDIQMRYQOq0oEDIFmniCKdFmKTsYwLSUSUiciWSSBHKVmqSI4aKUKRUVFIieyVyWsZ1rqVKjoEqc7GKbsk6swDMW6pqcCXcNMXEcabUi+iqSGmkM4gPi+i3jiVSd6aQkaayVFOqeNhFqXr6TsqacoZiZXLXm9hofgUCdTkUXyY8VEamVqmzEYdFt3q8W4WacVkMSMNCe0YyeYKKKZkFq6VmeEQ8emaXOZA2epoOHie8UkSkaGDycUWQbmQKRsS5l2V1gWVpLaaxJ2YXIOACpZqUuWbcYIVxlaePoqQadFnOW5kaHFk-CuVqbKZUHqTOc5LucFghv3GFtZhmcsH1CefKdacmUktLh9gYs2fccOWCJNuZNLkWc7NLpOUtslh+cwTEA+ZWVCdYZNrCaKR1ntmmR9lDlBWwQoStueeYNUkhVOZ0phYMQOphL1tjhMZXJlpoLiO+QRZmQOqKLzihVhdgTViBbGjRWhWEQxcRU1q+fyhKk2XRdmRkSOTZuZObl4IBS9E7omQbqSaiZwduc7C3uJQlmmasdqRCOJXsXVkqrxakOslMj7NshkuyZyaEdya2IXKQLiAZZskZbMiZQMQUQOakNstZeMo5Bslsg5UAdkopaxG+ENDZRMl5fZYXI5bJRySweZdobycJW2TouRkFR5ZFIZYoMZc4JJUyfVLMu5bZd5eFb5fUVFcfDFUkt+ZEaOW5cFZ5WlTMoVe8f5c5PlQfkeceeuaeVKlueNO3KdilUIIMG1Y+R1c+ePvqT1RxsYJcv1UjENePE+VmjabWS4C3vkkcv6sBqWX3vWvOizgvj2e8OpUIWtccrsQDLagdTtWIHtS6gdaRWRYVLVXZelT5RlI6idWyVKeSOFCFcEIyC1W-gGlLM2cjnlb9c9fVZ9QbopKUKtUOutRkjwUXLZT+mXjELXH1WlLNUmWvHDYcqdfMkjd9PoCjeAfghjYhTNYNYGWjQaFNfQPTFjdTfYXpfsvjVDYCRxRZS2T+RQR9aiFleYJtcvtcUeX1PJcoU1eYN0qGQMmLdBWid4eiUmbAbIPAdIkoMgfImgUopYFgeVfplnIUpwqSfyh4hwEIBwuEDDaAHDGvCRhwmJebf0C4JUiYFoMIAECYMQB2nPK+S3t2tGcSXij0NptKYJEIZuiINugLWTYUEHfSSHevtDNFvWdElut2jIOpYOTmWCDIB2endHXnILdRrakHWUkdSNWUtwN1SnXabaoiVnaSQtfnaAONXXaxMBg+pnrGk3eHWuZaaea3UtYpu3C3ltowW8OhpXeSRPcQHsVPaClLSmW3pbKNNnUJa2YNOjOZHPSXciYvovU-OvXJcMbaOva+RSl8AwidBnk+tqmHeaXeEUt9hNcqZTWLI-WVZgutucGeFnHVBRdlnfVngVMbvrQHSPKCVjocYCupXjP8bA6Rb1SPLUV+iPM8NFRWehSMJLG-Xaagx0mUhgxBZBWVduHg-4WoirNHSA2xW-iliuMSesIA00s3azGIFnNA7qOECJJHhw1w0w5rv1KZBCmLIg2jKtqACwCw-esSnqhwM1Fw-8eEAADzAgCOmxCM20O3gjML4Dgp0AO7dI3XJbUhYiHK1DNDgigAADUX+eCrCs0QohSKjdjYk5k7jpeTjzULj29Ew9tpAJkEI+jmMxANkc611cu5j8NVjYkXj+CPjYgfjbj9jexNj9j3jemzjMghSQjr52UtR7eeud+SIHG8SNcHi2IX9QGk1+O3DjDnQqFd2zZDFKjpeyyeilTRAL9Rq+AN9PS3d99T8FepezQeuU8mC7T+CpQmC2j+C4z9TmEDDn+24+TP2+EG2a68SU8ADFSWWuIdDoKRWN6QTmaJT2adA-i5Q+xLcQe12K6JEKwo2I8jIfVn9r9LTA63uxDfMaDvzQMcdoYkMF26DfMkGDEf2T9FT6I1Tr9VD1aD+TRlsFzK4pTCY5TXTsLL9jeTzGLuO9TEjQjJzUGrTGQ94KzHTRK3TcLfTAzcjoGsaozCz+a2+kzGFlLMzPYIEczTTCx9mKwizltyz2+UjazTTELRQ2oWzBgOzfD7IwcQDhzQzoDR2pzwTFz5G1zIgtz-wbkTISaoDLGh4N2w23YLzk8QI7zUDkBoYjR9TIL-xALfIQL-oILRDZCGzPkcY0LWLVTOLlecB06CB8gmtciqBiiyi2AD1LaY67ak6mdDgn5glPNGNDg5ko646vt+9mb8bdUY6qSoFG1SbhFnhZ9WQEGlMeUraebMdzgEeGlzoQh20exsQ20Y4qNsQQhHIrbMQHIHb3OQhCEvbIjA7Tb6xXsI7XsY70wQh9F5Lex87mQ-onb6N6xAUqS5AzGtsHEXyDuBoq7Gl4IJGvbJG3Yh7QhxsqgySLAhgohV7N7UiKwF76xtjI7sQjtoAvgvDQixa9j+7L75JLk77MQn737Emxa7kAHg76xLkoN27sQxahQAIQiMQ7kSHgHYIUIIHBgvCX7P7ttoAkIX7MQmHEIwAOHYHBHxaYA0H475JAApJR3h+Byh4RwxyR6AGR+CHw++1RxB1PN+zB+SQAIQiR8csfUegBidAhCf0dYeqPMfcCse-ugDqMxByezvrGqMAggf8dsfFo6cafccCJKf4cCeof4fCdYcCK6fcBFD6eqe2fGfWcQgic4eEfIeWcieIegK5Qh65sTpdq2r-GAghiw7bTcCBe+11tGj+dT48A1tBexcE4sAABW7tEe4XIJyIEmQ7SX2b3AqJEGh7RQ0XCb8BToYUAXBXk6HpDbtcQhpWexpWpXZeQhkAdAaoViCHoAnX3XtGbXeel7VA17sAkAvbD743Q3gGI3WcDAAAoiOw+wtzN7+kIQAHLkAbc4dbcbcCskLxdUjld1QeloNhcrCw7KASaYLKCf4neOmxEKbVtxvJdncdIXfTBXc3flvFzriJevcxf1dVdOFDq4gPeJsDyRNezqU1pvSMDiikAFKzQMBpfkC5h47tSaAd7oQPcFscBKrFuXyuvQ+ggIhFCj2TUCSEAMs93arqW3q0MqvPrQQpKqxby1fBfTpoMl6-oPdncqOuts9IwQ+2r4DpeZe8-Xr8+bEuodJrexB7NKu0-DNlyUxMIKt1RiBfAyPdnM8Bxe7U8q+gMJT63wrGAMDkruWdqkD+LGCvh0D5TLhkB289frRnitCMjm91RW+FLVD5RB4vg2+u+0bSeqQMKKPTkksbt7sQhuTuRVIeC96gC+-uiO-8BoduReQOMNAx9bv6AODe+W-5jWX6CtDHBMQVaRCMRVbmipi1Ll9quCDCD0z6YcBhKbJ1+aS1Jd8mkh1l+SuChrrB-9M9dh9AjggR8BwJF4u5+7v5-gjx-6u9-Vot+1AlpL-Z9DbV9-ZV+z9sTz+FKL9L-uSp+YZSIn9Z-3OxB59UV6b9AKA4+hisIP+QLYjPZHwoel44ZF++9P+-rqQnSNAUpK0Adjrhns-mYvmQEKSgDqQjCSQCwnv7sJecOEIPP9geqJ9KUbgKAaX3978BnetvUfoNzSxrol2WQPAYrmj6H84++rYzH9QNhtpwq6-ePsa3wh78RsIeT3kCF-4l8-e6fNXiGFv40D9WwgdqDb2BBVM0++UDflfy9ZCDC+Q0C3n-0b5eta+bgevsCkb4ktCgAwVvhkDqhTIV+wKIwYwERIqCDIQg8EAAEF1B3faWmv1EDMIuYzAaRiwzQCsCpW7A7sJYMv4p9eBL2I9Bf0v7pMPBKwW-vKjYSP8MUL-L6G-3-5jhP+AiSXAoPGw+9eBHef8OakAGxEOo1qWAWQhJ6QDlBGOeAcwkYAxDH+KAhwiGEYj-YWCvVSmkIEMA2QyADvAPmHA95e9FBaQ6AW0P4BB4LW30BtkUPSGwCBmTCRAZELmLktJW0GBipDCWAM4xI1kcFCbFmjODyA88A0M0BSFKD0h2QtmLkJ+iwDMECw6oQi3MBqATAXgZJIwBMFdJbBqIbgL7xHRUBnhvAj6CQ0nxUh0EreGkAhi6HYJDY6CMvh8M4j1pHhzgKXrTX9AvC8GZVX4ZhinhLwqEWwpWLzjXjjCEB5QpAY-0RGAoj0leHgdAPmgu9+mP0AAOS999AtNAADpYA2+P0YXvTEdQyBgglQ8lsp2U44R0IFI8yCP2MCVRiR1vMkfbypGPCaRaNekYyK6QHI70rI9kc-AGi8Blwn+HoHjBVGgAAAXv91AD0iigzIh0myNICP9swXI7UTyLwR8ixIAo+erhEgp9UmhLQycFSLlHR0FRJosDtwGOrpMWA6TZQOk2oSTAKRToPAMKNxC2j9ArokgO6L2TGjH+LHb0esU2FiV-RgY+ENYGtHggvIQAA')">function check_an_assertion(assertion, query_pat, query_frame) {
    const match_result = pattern_match(query_pat, assertion, 
                                       query_frame);
    return match_result === "failed"
           ? null
           : singleton_stream(match_result);
}
</pre></div></div>
      The basic pattern matcher returns either the
      
	
	string <kbd>"failed"</kbd>
	
      
      or an extension of the given frame.  The basic idea of the matcher is to
      check the pattern against the data, element by element, accumulating
      bindings for the pattern variables.  If the pattern and the data
      object are the same, the match succeeds and we return the frame of
      bindings accumulated so far.  Otherwise, if the pattern is a variable
      we extend the current frame by binding the variable to the data, so
      long as this is consistent with the bindings already in the frame.  If
      the pattern and the data are both pairs, we (recursively) match the
      
	
	head
      
      of the pattern against the
      
	
	head
      
      of the data to produce a frame; in this frame we then match the
      
	
	tail
      
      of the pattern against the
      
	
	tail
      
      of the data.  If none of these cases are applicable, the match fails and
      we return the
      
	
	string <kbd>"failed"</kbd>.
	
      
      
      <div class='snippet' id='javascript_96_14_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=4&prgrm=PTAEGUEkGEAVQFLlAFgHTpQKCyUB7ABwFMAnAQwBcBLfAOwH1LyAjAG2IBpRCBXS0OToATUAHNilXGABmpfAFtQAYwAW5QpTKgAzKAAUAZ2LKa9XWh2WAlDhm86p2nUGHD+ZfoDWxAJ7dSE3xSYUNrUABvLFAY0EDKXlIXakMGOl42Nn1A5WDQ21jCwoB+UAdhYhlqOmJhaKKigC5QYgBHXnIsn39QVWJyYX0+geygkLDrAoaS3v7BnLyw+umY5vI3D28-bmZqLIXxyYBuLABfOwcncwVyHyZWDn1wqMLcukMBNg9O+-ZiUAAvKA2ClKPoAEQAKmYf0h4OsJ0K9kcZhcX3wXl4hC2vgYAEZuN0GAAmZ7LIpvD6gQy8FgwjiA1zuTxEgmgXZZL7KH704jHcmFagyAwpBjlSrVWpGWm8yaRAXTeKJFziqo1YSI6anFpsYzylavehUg6iIHrZk4kk7ch7aV0h58hEKhpKpKgUWqyXzMbCKYGlalT3q53+1bsm37H1OlbnQqx2LIq7Jd5kMGswl+K2gABunV4fP100pAhp9r+jPNm3T4dtXJ5Dv5KyFItSQalpdlZND1Mk91r3zYvw4nBD3Z4NtI+hBH0tbMIE8txO4ubY+cmI7HY45U4HQ8d0a1Or1L1DxbiPorGxZmaXNayHYbB-9zf0HpEEvVo1yITlJ8KAEgVmMSg+3vGUHRHQDNxWedqEnWDJyJW8VzXDdoM3bcHz+SYnSgmJtWIXV-j-MdgNAr88mXPM+U1f14waejQEYxNUVAYQUnnSg1H0BQu0VSRlVAJQARE0BwXRTFCHBUcGlKCSsRkpohMBUTwWqYxSEoaToNKdTU0UwpmjIeRJwUbhwQcLw6HwAB3FwiDIKhnFAABaFzwz+eFaKY8lXRcdjDE4tQTnOLAzwcihUT3RkbjuXknhOM8JAEIEIqc+g9wheSpKdM8+BSggSEi5xMrUlNNK8i4UWc2LiAYFhqnYugxH0XNSGoCCc2oviYj88c4Na8h2s6lCaLOLAWOchqRGqMQGDajq-n0aamrEHrzwSN1hkGFbZqdc5JvMXbmvm6jlsavbC16gS3W3Y61pCibLlY+6GGqBg5HIBRiEG4a-m4T7vvWvrK08BbOsBsaDue5ziAADy0ERfsW4cutXLhQEh4GbpcBCeNuOr7uRkbuoBiggcep7qvMeHEeEN6ZAYSlQWIOgwXB-62Kocgya+gsSLPe7GVe97IeJzmse8vq3wqNUpXuv0AxaBHWcGDnUeEbneaBxTmk4rQkgYG4uNUc6ZpO0azdW6xuE15htahqqk3dVJmDECR6enMFcgUQh6FZygdj6e41qujbBNFPGfb9mo2fCAAyePZhGaP-bjlSgUoYO3cpw7klSOg+f0VPY8obHNvzkOPYYL3i8UGOA-Mwvvsq0K8DzwxMfkJQoDgRBkHQPE0DxJ3WOIFCqB+kvG5aOhsx66XUhBA3Ojr3207LmS5OoFfB0t6e45k5pRWbqf643xXZOBfAMSxBhDF8BQWHwPezofp+X4YfBGdPteG7j7grN55HxdgwDQhAQTclRH-C+W9BCEAgb4fQ488yT30HnBg8NCCBDcM4GBpcbaz3nmhdCXsv6M1GoYfQQ05pYJwYYZwVCD5l0AXPSYIDRRpUoMEJmihprpToPggOl8iilBQauNBXCeE+34VFbhYCEGQIEUIgBRCRGGVAW8diqJV7MPUbEMRK5eEzR0VkZhrDgH+mPkvL6LBNaYLhtg4guD6AqM3v6UotUPow1cWwWx9j5zk0kGQe+j9n66jcTbAym4-FP3sc-YQSC9EWP0WGUUxh2is2UGfdeBC4HiPvm0fMjgfoZOKdk++zAtDfTZkw8+BCUkcNSOwDwXhIn5KMS05QbTzFqKaQwPylTJ41O9vU4RHSfiDI+MMgObjGlWNARgioyg-HFVcXovCoAJkSK0OgnxjBlmDnkcWIQIFDmRPmQaaxDBDlDWUXo7ZNyTCrPuWMtmlyVjXPNNQMQdARntI8S0Ix3zfn-N6UA1JoAjKkBMnMsSllrJ2WpL4Nm5A4auXcuIjoWhW6j2cuAtgSDkTcBoWEK6L5I7tQUDvag2Y6p5z2XQX8CoQaKNxNg6g1KaB0u8dTQRxLBCkDEGEWiBEiLumFK+VIqdyi8qTIy5lDQzw4IyAVLFaCMEJKJQ4KJ6FNy01VpguecF6D-OiXqpE+yGCBL5gbKhyJdUWugqSkhTruwYKASav5syHWNiKIvAZONTro1GDSNg7juylEGaNYxiMwQqvDZC2IzQ2wamWGK48CpjLBEZeZBFtkXB53ZL4EgGL4GIMqrEc4oUi1kO-sG-MVCsGGBSWHcObobjYhoYCAAfEC1BuyaEpMAY4kV40qbOwKVoml9BdFvMDmosOAbKCkH4KoJB6rdnTtMdawI7EoE5P-iwtRSbDEDrPiY5wPxKRFNmckvpoYjITy3fQbRV7BydANoXblh6L4pNzvs-tg4ylZNKZQBQlAW2LpIhS1IxBfaUFxCBkpRhwOQcVfxCuZR3xyzTXGI8-xYM13WCBaZ1TZkfAgxMNtsQ+qbp+lUUgHwhnkbZqhqjNsIXeQzcREMZ5GPMcoyBUajIDL0fQXBQTVT4MUbQ2ETgXGQxEejWdATpG0MNsdDRl0ONMaSfUxBzT3l8OEUzd2OjRjkPZP0Oa66UmZm1PY+hhTbDjNVvJNWvF5g62MwcCCz879wlkpIn1TtRgwkv17WJSEfncG-NqHCbggWX5jprYBww3JGD4H4E8lZdzUR1NycIpdun0m3pQw80MpRyDKGULwBQGQ0G2ZiOA1WrqxzpEyO17sYWMtCC-jl25az3jdeglZuqZGZOOb0ewx9oChuvKK4fKrwJQT6AW1FZLZj52zYWZ1tgAG+VAfqlyHp87W0CyNAILVwtTv1XwIkyJ3kzx1l1IyPrWXBvPPy4w5aD3fBPhUFd7D-naidyBD5sUhc4ufle2OwoFnz1-cSSOumRrsxev+XD0bbqLWxYYfF0I3Bmu45WBC-aXmXAFKmdJsF53oO+V014lTIbbPicGXQ5xDD1k7ZSRTidY9gUw7p0thdEKw5nhE0CcT-mRmaYcU4lxgj72KcKP50JH9X4htlwHDX4SLlo3zP+xnWHRqHcnUYjbeDwVsLDurrbmn1vfeG3rl+BuSfTHE1bjKMbOdK4uR76CEKcfoVV7R3TqbKbt32Z3OQigIAwHgEgVAw80DEkp6A5ejltui-LhHV25B3a1Brmt3p4kd7Z9xbWivFAtf5kiZEQoJvBLbX0NuGb5vWJeN-ltvPbpa7glPuCJLEW2D86LQ7+tv89Elaw639vO3x+AdFDrtjM+QulYL0Xz2pf6fglX1pCnRaD+u5z0evvLh58RiGHMNv1+Zv8mhkdk-vvHH0Otzt2fLfb-bgX7nx-Geoo3uyun+G+WGoobs1ctcZeJybMuWLyqI8IoAAAPsgYpBAYXlAbvqLuZOrHVMAUgagegVvlgTOGXkss7gIrigLs5MAafg3n+H1JPj-EXFfraA-o9EWnQa-ortziAbnldH1GwVkH-ufgATQdcATMYtMnAcAfoKfFROjAru-vQBfqtjOOCLAWcpQYgdwAoYbnVH7nwUvkdqKLEnYuQMoVzh-gIYwZvlXMXtAXvuYfYkYc4FXoBi4ZYTat9AbKfoVufoIUzhoOFpruQmkHzNwMIZEgAbWv4pYVqgwcsEIT-tfqIRfOIUWl4l4VYf7j4cEkxtwFqmoQPjkW4fQMPuOEEnakUf9iYc7KKBQXlsNgwZss3m6BgdviXmQXvk0Qge4UfoBn0T9hlNPqAe0WiKCIGjIHCniIMUdsMS7vkXakkQjrpmQoEDMb0qSJwUMVanQYkevhMeoSBJsXCjoPMc7H0UwPgNIcwLIc8qseHlhl4lofASMYIrZosQIhEd9AHtBNkfEbkXwTZk6t8VFMsWQAEX+oHuCSVIcYvvUaxKKDTg5qMrYckfYZAY4dgUeuZKiaxofrsUdhzm-tYTzhic8d-iMOkQQkic5KKNuu+k8ddOASQTiT0TgWJEybOoOOUXQIQWgaGJ0aQeiXidya+jOoXMBrTgHB4UdjydKburUNQAeiyX1BsZULMZcaxIqdekaOVmKRfEEVhpqVsfTjseNEWnqR+uGmQN+rSr+gQiaYJGaecfSeYGVpkihkJgvFiZgRyWCEJuZONvKc7ONixlNpBk5s8LEJiXPqkbaL6Tqc5GppGf8kJsFvGdSYMJmSmeYDgupmiVQnmS6bdNfnmcSQ0XBghkhuVtZqWXYWyWkBkPeHJvmZXH4vZoSU5lmVSR0QXK2Xfkme2R6ZXF0mdpSf2ZXNiTvpyeKeCBOWGS9HdgiVOayTmcOWfhkVWV3lIROahmiSUWtouadpUZNiMmOaAlIqQLwk-NUItoEREG0Wsc2X5qQLiDeXebIjYYEUQcKc0g+R+V-EVFQNInwg+dAnoruQya2IXMBV+TIpBb+cac+U3q+fng4XOUaaXHmvBZ+aBdwreUhQ6RUR2aAvwghYReBfeaRfwU+S+dOaArOd0ThTPIuUBQRY5ERd+chWRTBeYF+Vtiye2pMcxmcb0nMQJYWvpiBY5EjEcRhf3lMRJRaeRcYFonJRQApeMUpWJacVqb0hcZ3jVFIQSqqcoh6mSUriSkKvVrrvyX2UxQPuZVAu4QDFavybZWIPZXAY5VeYhRBXRTcQohAhZVBbpbEOFNRaQIyEJaPk9scW+ENFxZFDRT+RSefopJ4mZYouFXgt3kXDeY6qTg0LXGmWlDpf-kms0F4q5cooVX8cVSHrjuVbJZVYMMkoHuhBpa+lpUIJ1YiSZZ6akPVRFeucugGdhXCvvnlW5fxVaXsXysCShc6U2ZubScIuRTQitUaOqbptEZtXHOIdHnyrHt3Ann3MnoPJYIAa7KulnEgnDGoaKM-C-P0IIs9VsitnDLrC0DCjmnDOZG9RwEIMrCQKYLUAECYMQI6cINQVkVIQypCYUaAFqhdscQPjKiIHKroc1ijVBujWotJZoufLKgyjIC9eydNTIOZNjfTHnMuamVagTegseeJVqbTaAFJYtQsVaokZTV-spRzTMVzZaU-lcZ5cavIN6mxoLWAa6SpZzdwMZeOojXcCzvXm8HGuzWCOCJrcQJUdrcIiTSiUGpbKNFTVhaxYNOjPiebdREzQWQ7UocbWxpbULZfomVkJbVeVkl8AwidJ6jLf8uLgreWbaIphLaxGmWLGHcca3lHWFMDlnIYbWejpjgHIyPticBIS4F4mLFtlBpQmoXjEXYoY2uRZDP4egkErGXGXpcnIMJLLzVcUEppvanXY3g3UxduC3WlkdgajjcHaahRqPsXZ0ITesIYbbuHWiKzGIFnKEUFuECJBDgvUvSuEsCtnjAXUEsvSloofJmjdPejjVcCBvabEXeEAADwX3NSb2T2nr-WwrgjcL4BCRCC+CCo+UjKdw0h5W1DNDgigAADU31FqHw7UzUQoSC19YDYk5kCDgeUDs0sDttEwf12ak4b9N8mMxANkP9vlkG1IWIYVQDYkyDTqqDMDMgcD494Q4DlRID4DKDK6aDdDGDmRnhN8kkp+juW2GNlqg9c8NcN82I8dKwE+mWB9uoR960KwAa+2sj29FqYioj6IEjjgAds0GdIdsy5OgezQW2GcTdKjSaSsreW9Fj0wxjMjmEDD1oto1jgOcYSmkqQCpjqdmC6dI9stZc2mRQ2DsjeFz85QoAQ+rjVaBGgTho7wAgkMjIsd+9Ye-oTBMj1dRdtdfMJVuO1dlC2TQMUT+EHmxxQCYjRAyCrmatgG9uo+Ajo+ihQjCYgG5TmjVT88gT0jQgKj8jsTTFJ8Q519ge6j2YFTWjKy+AgdtC0to9bGhjTqxjo+pjrewzTqpQZEVjk9ihNjDQdjPTDjmux924Ljbm+EEDDQL4nja97Iwc8GmguIfjl5-TMQwTgj8KdAYTIgETfMZaB+lah4pmvG3Y-GQSSTslcd1T5mumH2hTE249cLuTbq+T1EndOTxTPkbjjdbT4jHT-Op1SY518evcSeA8qe2AedoCHKXKjpuNeCDqZZM5U1NtAq4I1LNKdKTtuMVKHLdUnKECUZllOqjLZjfdOq-OeUPLP6dLRojItczoA+20lRsQ20Y4SLMQA+HIyrMQHIaro2A+CE2r-UsV3Y6rJxWUoIRrXserCrJ5gzmQlR9rbA-oZrA+AUEC5AvglR7rfi39BorrJ52D2r2Dpr+rJ5xsqgYCLAhgw+EbUbncKwAbGhoDRrsQ+gQNoAAOUW6K4DfrSbetLkqbMQ6b3AWbAIfa6K7kebYbGhLk75Xr3AMQ6KhQ5bsQ7kzb+bEIiW0wJbmbq9FboAkImbMQnb4IwARbBgGbZbA7YA1btrGhAApBO729O6AOigu8O6AKO2vamyu-22u6YwDjW3rQAIQiS7tTv7vopntAhHvzt6033LuXvZugB30xB3vTAD430AhFt7svvfvvujs9pPultXugB9qAfHsQg9o-uNuFB-utvooweQf3sQgnsTsHstsQegAnuxDPXOi5TA7svSsYJF2AghhhbbTcDEe0sdyEfxM8BSu0dWr4AsAABWJgJDAIFHIRyIUWBrTHnLUR3tCq64BkNHPKdHudkrnKvLdxpy4O5rA+qalRqaZrpVsQA+kAdAaoO8DbMQ2nuniG6nGn5r4IcbsAkA2rFnkAJnGnA+cbAAoka053Z6VQPgAHLkAecTtecee7MWr0dUgSd1RvFkfccrBhbKBRat7KCEIhfye1JBcCAJdvGULkeRchHRetvRFxfxeCehdXYKdOiUsErsoFcyv8oODeVexqFldvSMDiikCEq6NsfkC5gZbtSaCgnQQJf8scAjJCtMotUNA0K1dHBFA1NHbAR3xPOzJqFD30xzdsa2atZIwJekfj3E6k6pdFdwHX0jdq4IKqz6AbcsfsecdQbdUxC7fxOnId1ueFDeP3OIZ6NzNlyUwcACDeNiBfAsA-DLcFQzeEBvf+MJQZ6BLGAMCZLAV0qkDPzGCvh0D5TLhkAI96frRnitCMiQ91Qw9ILVD5SA4vhw-o+IY4eqQMIcBsxIEkSFA+uesQhuTuTYIeBc6gD4-ujI-8AxDM9eQXNFAM9IIOC4-Q-5gfn6CtDHBMQxMRCMREbmiph4JS8KOxADD0yrocBfy3mK+aR4K69RSJEq9nMSoGCk9TN6cU9AjghU9ymq8NBC9M-M-uQG-4rCAVCiDO9uT888aRCMS+90+xCO-ghe-uSc8JokOh+FsYtC+VKBBfQ9f+hQP9AKBGwhHNaJPlvdUi9DRQ-4+J+47qT3E0BoKtAOxieh7Pp4-i9IJl-UizRfcZTJ8J-7Y4SA6eaUus-ZJuBi9kAE-c8Lrm8MLGdhxEbKOE-8AYYO8cS+tO+YrPrBDshkDUrfq1AYrR-cay98bA7Y9Aii-58T8fchjB-O9sTtRw-XxEBc-5Tr-e8x8z+M859MbV99+S9+qXOSor5uBK+uIq8vOCDu8BkGQOqDwld6uIwBjAI3u-wNDB8AAgt-z17mB1ea-bhFzGYAn1jAaAAFgxC37dgT+XvDnjX3PBhpI+ofZhtgJgEP8kMK6FPgXyT40CvoafbEBnzBZZ88cyPXPi-wl5YB-wmyIvqcg6i7I6+WMR7oUHoy98JedfaZo30YDN8FA8hVsm3xN7+9xoTeItGmSECGAbIZAJHkTwlw78cenAiQf3yJ7PZgckMRTuIPz5SCG+kgJvgwPkGt9AcSjIchYOfqD4P6xsNQLNDQHkBtICyJ-nnxr5I8ZCJfIQcJxGBuDuGR2fWPaTT4mxTuVAL9LbC1hdwcmntNId9FMbggZAEYWoP4INClAcheQ+Glg3aCrxYhSQFIcwGfqJMYgf1UUHgUSGUAv0z9RbgzGkIsw2MlQugNUJ5iZC+QDQ1IHjB6EJwk4kcBcHbHIDP0eh8Q7iNuFGGHdoI24KYaIM3CzCvBpsVvIsOu5upW8qwpYaZwTB11z6xQvYPkMpj78a+80NHlMx+gAByA3voCOGgAAAOlgE14-Q1u9MeRDIGCCODWypbUDnKGgj3DcCtw4wJVCuF98bh8PO4foEeEICwQLw94Z8OoTHccavw-4YkIGi8BlwhCHoHjDxGgAAAXuuBiDvCig3wkKn8NIDyDswQI0kThCdRgixIQ-Q2rhHqEaD3g2gycI8IxE-DbitI+QVO24AuVmGLAZhsoGYbw1Jg9wp0HgGhGw8IRDw6kViLpErsxRJ5PwcDSlEyj4Q1gVkeCC8hAA')">function pattern_match(pattern, data, frame) {
    return frame === "failed"
           ? "failed"
           : equal(pattern, data)
           ? frame   
           : is_variable(pattern)
           ? extend_if_consistent(pattern, data, frame)
           : is_pair(pattern) && is_pair(data)
           ? pattern_match(tail(pattern),
                           tail(data),
                           pattern_match(head(pattern),
                                         head(data),
                                         frame))
           : "failed";
}
</pre></div></div>
    </p></div>

    <div class='permalink'>
<a name='p17' class='permalink'></a><p>
      Here is the
      
	
	function
      
      that extends a frame by adding a new binding, if this is consistent with
      the bindings already in the frame:
      
      
      
      <div class='snippet' id='javascript_96_15_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=4&prgrm=PTAEGUEkGEAVQFLlAFgHTpQKCyUB7ABwFMAnAQwBcBLfAOwH1LyAjAG2IBpRCBXS0OToATUAHNilXGABmpfAFtQAYwAW5QpTKgAzKAAUAZ2LKa9XWh2WAlDhm86p2nUGHD+ZfoDWxAJ7dSE3xSYUNrUABvLFAY0EDKXlIXakMGOl42Nn1A5WDQ21jCwoB+UAdhYhlqOmJhaKKigC5QYgBHXnIsn39QVWJyYX0+geygkLDrAoaS3v7BnLyw+umY5vI3D28-bmZqLIXxyYBuLABfOwcncwVyHyZWDn1wqMLcukMBNg9O+-ZiUAAvKA2ClKPoAEQAKmYf0h4OsJ0K9kcZhcX3wXl4hC2vgYAEZuN0GAAmZ7LIpvD6gQy8FgwjiA1zuTxEgmgXZZL7KH704jHcmFagyAwpBjlSrVWpGWm8yaRAXTeKJFziqo1YSI6anFpsYzylavehUg6iIHrZk4kk7ch7aV0h58hEKhpKpKgUWqyXzMbCKYGlalT3q53+1bsm37H1OlbnQqx2LIq7Jd5kMGswl+K2gABunV4fP100pAhp9r+jPNm3T4dtXJ5Dv5KyFItSQalpdlZND1Mk91r3zYvw4nBD3Z4NtI+hBH0tbMIE8txO4ubY+cmI7HY45U4HQ8d0a1Or1L1DxbiPorGxZmaXNayHYbB-9zf0HpEEvVo1yITlJ8KAEgVmMSg+3vGUHRHQDNxWedqEnWDJyJW8VzXDdoM3bcHz+SYnSgmJtWIXV-j-MdgNAr88mXPM+U1f14waejQEYxNUVAYQUnnSg1H0BQu0VSRlVAJQARE0BwXRTFCHBUcGlKCSsRkpohMBUTwWqYxSEoaToNKdTU0UwpmjIeRJwUbhwQcLw6HwAB3FwiDIKhnFAABaFzwz+eFaKY8lXRcdjDE4tQTnOLAzwcihUT3RkbjuXknhOM8JAEIEIqc+g9wheSpKdM8+BSggSEi5xMrUlNNK8i4UWc2LiAYFhqnYugxH0XNSGoCCc2oviYj88c4Na8h2s6lCaLOLAWOchqRGqMQGDajq-n0aamrEHrzwSN1hkGFbZqdc5JvMXbmvm6jlsavbC16gS3W3Y61pCibLlY+6GGqBg5HIBRiEG4a-m4T7vvWvrK08BbOsBsaDue5ziAADy0ERfsW4cutXLhQEh4GbpcBCeNuOr7uRkbuoBiggce6RMZho1MfkJQoDgRBkHQPE0DxKqkxaFCqB+3IFEIehiDoShuGF7Mer60UQS0Cgsn5wWahFv1pjk6hZZ+Ub9AVoXlZk5pRToL6+cURXhcoFXZOBfAMSxBhDF8BQWHwQctYdp2XYYfAZDSY3tdN3WLbFugJf191Ug0QgQW5VF-YFwPLaKUpI7YXx9GIHmtH0Q7GHhwhAjcZw47N5Xg4ltD0OnEDvdO9HDH0Ia5rzgvDGceudaVoOWhDyYw9FNLKGCBh+em9K6GLhOZNKDO815-QB6HkfqjHph8AYFPqBjouO-N6wy8Twzw+H+h2NRToJ87g-Ymnldj5ms-5YDzv9771I2C+lhhHIBhm+IQv6AvrvKeQkCYfRpuPd+Tsv4MHnOTSQZB7aO2drqQBpcDKbkgZ-b+zthBpx3qXbuod-QG1SMYdowtlAm3jpfYBM9BxkPzI4H6DCKF1Q+Lzb6It25P13i-YhR92AeC8Kgi2tDb6COUMI-BotCFXzDKKPy9tmBaE4WCaRcjQA3x+Io9hKjzYiL4QaEhYDqoZQqMod+xUAHqLwqAMRs8s45wYOYwcg877sJFs4kwj9qG8Nka-LxFihpjxERorRg4XHBNjtIwxKxjHmmoGIOgqjQn2MHAkpJKSYn+P4cZYIBixKWWsnZakvgRbkDhq5dydCOhaEqqFHOghCBRzTsibgjcwhXRfKKfO1AFDq2oNmOqOds4OF-AqEGzTU4wPav0mgQyTFJlGXQdppAxBhFogRIi7phSvlSDrcoizY7InGQ0M8BcMgFRqXPJxODWljIruhUM8NEbCB-iHOC9AUnoKeUicBMDgnfVlvXE5jzfndg6WC8F-onHi0+ck-RJzGxFClqkRRWsLlsFEWOUo6LqJ30RmCTF2LuzNDbBqZYWzjwKjyZONphS6BWVsi4RplBfAkCqU0lplVYjnAaeA4EoIvY+1GvXPOhh95XWuptFwNxsSN0BAAPm5g4n6jd95izhoQDZ40nqmJcHQu+p9nDn2yeLbGMqj6UFIPwVQadrlZzeMa+gPx861E3nPdR+8NGaJVauT1J8BkusHJSNojC1E8IIeaxSRlM4m3via9JWKyBG3mVQkuXdzWU0aYalhTCjCUAUJQCVsipXdNSMQAWbL7ZhtYQWotEwpWFD6uS7yVL-jloYO-D4SiOH6I+A205-FLUOp+lUUgPbdGVv7YW4te8s3knbU22IZ5x2TtnbXfMjIDKjuznBddfaRb1rnZwBdTZdkKJxpusd+6QIDpAqNId-o+prrvRu0a3k4xHmIgZPquba35p+ddA9eiuHHrCKenun7eWLt1Y0quwqxRG0Lkk9sSCXadJIn1OVRh0NsCVWJSEDgMnqjhNwd2yCdX8v1dSbkjB8D8ECZYse3DfHKylaimt5D83qMUsnZQyheAKAyHPIDMRI7C2EFC0M6RMjSf9DhwwdGvaMciVY948nSIAcob20DxbQm91DMYtTITeOhjVjOEzUUKMuwMzG0Asm2DZoFYaiRUjI0yPNVKs8dzGRufqvgXBoTvJnjrLqRkSmhAqZAlZtuy1Au+CfCoI0AhiMofVIYRkCGa5pdbqhwYYWdXNpxn62pP07matee87M8KUmFc09C9CuXEkZe4GJxrKxzX7U5qxQ1OjlHTqPWanuHGSu1QYHi9G+ggO7sUb-f+48vWyO63qrmhqSNZI85KkiZ5RqMl3Rt8216f5apbtvDze9ZHeRI4gj2rszqHc8TZnxGbLujX3t5PqH64MudvrF6xW3S0kRu8969+h-uMGe6EtrHWYi7oh8d+brcAdsaDu19C5qGubjPbEFt741S1EpngHOmW5CKAgDAeASBUDszQMSHrzlpbq0ci9hOo3LWimYGICQbyq4FPEszuW9TVusRlizsH6jIiFF8iV7a+htzqJW40zn5Bue1C7aCAplA+j3DWuzwSPSFyS4AGTG9mCMSXIkgTa7qlz5zNHDZ+0l1hkrKu1e8819k8ERtvrC5FzVUBPvmF4YtYJPn3vjbgnIyH+3XNQc1yD6E-XW05jy4jAZ2PrFRSPYjaj0Pbo3c841zOL3OfheNJz7d5BSeXeWrl9uev6fFf8mhjRyvo0TtuoWzXmXdfU-bgVxdlvDPzCighz34rHPUhc6L3zr3xYhAxe8VE5w8JQAAB91+KUL+rufgPwTgz+Exlf9A1+b+39P1Xs-Pf76cRDv3jSEdQ+d8sPq8efaJ8b7aZvj1H-L-U4jqdn-MjothdldH1F-lkIPnnsPv7tcKAgvp4uPkHlROjJ3mdvQPnmiJruCIgUvkEuplHg5sbKgfmOgcAc4ErgKtLB-NAkjudnnuAa7pfu7sXrnhmuZJgnQUAQtuXgKlwd-LAsbLLFXhhhPtKoJIpnhohigeboMNAa9sPvBrQdggluIRtIJJAWnt-kPlQTRuNgIeQd3kIUCmQCWnclgYKjOOJCoUYSAUQSYfAhOtwBYZnozqkHfv-qZmARELYr3gbiwdfiXrfv8vft1o0p4QQSvIni-pPmHkKoEDIAUniOEQKpEcxlFI4cCuoRoW6AhokQUqSL-mkaEV4VFHcjkX1PkZUAUjoKkTRukavO4swEgd4pUWNggSlovsfuptNtBOkSfowDERdljoUAYbYfQQAujtTPqj0SvFkWYdDtMQMQARUT-j9g7milelOptowX+JxjPrvjfqjuZP1oelpPUVzHNjwSAeoRAf3k3kPm4aPvsoGg-O0VPrrkEewYHOZE6kGkbIOJMXQGflvqGDvh7sEScWJP8Q-LpoNhccUTRrCYmjMu6jHOmmzvsSVtUUkdkikUiVzCicGu4gBj8ZfEwZariYUZcaxMSYCevMmkkE5EMncTiQkTUdknUc8ckKQtpswrOpLMwV8UcTOPeuZHmpQnwTRpKWwgNqovXPes8LEK-rLg8baEqbSc5K+vCSkvephqqX3iMPqVqeYAXG+ucYqbOgabjiVphNaaabyT-FWriLKeBkKZ8Y5u6YSVnm-OsBaXpu6ZSQEWkBkFAeniaXoVzKKG5h8SGYcZCeSebOZG5tKVzP5msT4f4SniMAoQnI6SAncLGTsbvMntgdYameRvKbvDyUfAvKQMfE7MvNEj4X4XEQXq2EbKQLiPWY2aPC2YwefuCakKPN2V7EVFQIvIoP2Qwa9j6e4UhkND2ROYPA2UvKmrOViW2baZ8QmWwfzsRmOb2euWPGmb6fVMvEeSuVOU2RuSjq9pENuRIR2SKYmfzqOcuY5KuX2c2avgWb2c-lme2eWSBAUfiQWTqWlEjLETufET2mBYDkUeNI0sYE6uOY5NBUBbBXkRyXiYDtyRsVzONhvFvAArCjcc4KsmIEJkdsCTadhSBRCCRaeQDP8sCVRTRZ4nRVGaxMedOb+RlG4sxQOQ+TtiloVF+cEIyABXhsFtmU6YeZ+ZFDeTOfeZPOZoWXVMJUXONonvWXvNMaGHzpBROZhTAT6s0MRVMh6rHLpX7PpaMb8sZbeuhRQGZa9o5R1qhSfK5UIIMOsdRtGRHNZaRaAXsYafGVfqKUmSLOZNpafhBWxRRWpRSdiUafIY8TAfOeYI3HYXFjBbkS4FoXmZfLAcTuAqTvTBTkzNTqzJYCPk6daramnHDJYTGTbBwEIPoK1XYhpXDPZrSt1SmR1f0AalqiYFoFJueJQoMrUA-gKuNiMgsc4aABVkDvJVYWCLgQHIcjnFHmJsteYQlh9shdQa8fHLteAtnG1YEdFdnH8TtSIEcn+dlSyv8odddWWZtRNjUTINwASadQ0f8hUTIJYdSX9aAEha3lzLCh8vIAikeqDV9eDdwARYFaxONpNvmP7CLKWbXnBVtVjcQEQW8ISgWZejKmDo+l9RCfue9mJETWec5ETQSvotTfjTmRlbaI+jxbDI4F8K3CdHCvDSkl5hzS4NuAutDaxDqZDOnCNuLXIfLRLI9GeDbs6ZoLiMLV8ubIyI5icHAbKqAnLc9iWqKpYXjKbaQX-BBXAqISgljFLiqcBUrVjK9XTMbNeiCnAsqc7QxXeNnD7bWS8pJtVrVv2nhmbZ0OYesHVGLRtRwM1Nrrhndp0lbsCMLGIMnSuEsBpXjItXAinZRqgRBqtbHdVhZRnUnaoEXRhuEAADxV1Z01050+rTykAmQQiDz4AgJ0C+CCBrKcXFrUhYhRzUC1DNDgigAADUvVvyHw7UzUQoacpt4Qs9RBU9s90xC9s0y9g0uohmuSHd+S4I3dmMxANkA91FCpI91lE9YkM9c9TyO9S9MgK9kda9Yk5kj9291qu9b9+9EwtZ2U9tYOz2225IOaIcXaNs2I8dKwKFdGtduoJd60KwnGXpq90x080D6IcD-N+AgtTccNOtR6XW0xzQz2KkQIcuWD4KpQcurdFDtGXVmEH91o3N0dyKDEIYL44s1D7IOulamtYdIteNO6x9k44DDKzs5QxBvuSWX6hE1K3Yq6cCjIsthdOOz6JWkW48kM9t3txsBlsOHt30XtgdxjijMGcYG14sMDRAytvNOV6WoDbseGqBEDfyNG9jeDTjy6MQiDXVVtaM9FOjnpYZyDudvyOD2YDj+DFihDs0ojpDYI5D4KlDeGAjtDH92DPYIEjD0dqBPqcSLD48bDqdl224rd1j+ET9RQfDIcAj6twj1a2tCNFsATRQg10jFkdAsjIg8j-wbkTILWqiPKh4yjP6qj4lkMGjLlct2jBob+SDBjptljQMnlMKdtoqGzjo0G+EsGLtvjsDTjROsgFVdM5OjMVOLMtO2AhtR8vScys1z1ZFYywZL5e5xlDg5kzzAyQyTN5g-zaab0AsHAqiISJynzRV6pWQSKlMeUsyALwylzQIfOzo4e20RBsQ20Y4JjDQ4eHIOLMQHI+L0m4eCEJL-UpA5LmLOBVc1LVcdL0w4ehsYZRB7LmQ-oBLRQ4eAUUc5AvgRBAr78-dBovLhQ4etKJLtK3YkrsQ4eNw2u68LAhgUeyrqgqrmWKwCrMQ4e091LsQQ1oAiWBGlSs94rerm1EILkRrMQJrZrAIyqlS7kVrFLOBLkilJLlShQzrsQ7kvr1r4eZG0wjr4Q-rlSkIprMQwbOBwA9rBgcM3ATrLroAYA7r9L1hAApIm+G+a6ANmzG6AHG9YVbka-m5GwI4lh69YQAIQiQVvJumsRtpsNtAg1tZtbX115vNupugCVKN0xCduss4H10Aj2uVtpvjvDultbWKq9sputsDugDKqzu1vzsTvcBFBTsruKpAgtsbsQh1uJsrt+trugB1uxCtXOi5TiUguvNOKm2Aghg4bbTcAPsLIk53vvACCfuouzH4AsAABWE1mWAIr7GgyyBGlLyLaaRBWhSK1rRQ-7bz7wToYU97cHrzeB4HNr4e5KRB5KyHpjNr4IkAdAao6swr27FHVHbKJHpjSrVAWrsAkAJLmrDAbHjHsOzHKrAAotS5x-xzxx1uHgAHLkDieJuSficlPQo-tUiod4GGMvsrA4bKAEZy7KCXbKddFcKKd-vYcLIqeipqfTAadadwvazrg8DGd1S4cYcV5TK4iocjL0qNxVyWEpy4jvTiikCpzJPAfkC5hKbtSaB9HQSod9JRwIlQsPJiaeeggIhFCEWsTAR2ztMpKWEh1PVZf6JAYSZIxuf-IhOGUxB6e-vdGr1bNFeDAleAcgdgcw6NaVceIPrUQQZAYtMukpMdMrYcACDq1iBfAsA-D5ciwRYCSEB9fZcG2NKwLGAMDkJjlDKkDOzGCvh0D5TLhkAbfUfrRnitCMiLd1QrdpzVD5RJYvhrf7dsqXuqStyJ0XFdOitCu2sjP5weDAGgDnfujbf8AxBuR2spchhvdpwOCnfLf5jdn6CtDHBMTfqRCMSdrmiphFzw9oOxADBvI2ocBewNlo+aRFxE-lFqGY8HM7IGC3dJP3fttiRPfmxr4kQrDg8ffA9Mjo85XCAVCiDA-A9eSI9TPI+LpI8s+xBs-gj88jN-fEqZbS9uQTMNDg9KKBBfSRf+gL39AKAMA4ZiZzPOuGWQ9DRLfnca+NbqQtE0BzytBkxWNbOla8zQ9kBpy2-UizSDcZRa-q+OY4RJZ8oNV2ffduDO+w+Xf8C7fre09mskSdpenh8WxY8xCS8c8OpSWyz9Kpq1BVIg9tpi8hhHcncm9ncw8XcA8WyU8p8c-CDtRrfWxED-f5Q5+K+1NsQcRiv6DG8Tol8u9w-cMNMXoRxuBc-jyY9dOFA48TYZB1RDyk8k-D-E8ZQVEU8GSS8ACCC-rEOP2fg8bEVA5AZdxgaASvRQS64vyv7f73Uv0vv3pf54NIWK8vCvG9J-rPl-rp1q2v5vmvn-X0uvUH+vdRob1+Rd9TepfabP+FsSW9F8HULOG7yxiidCgo6UPq73Iwe9JAXvX-goH0C+8cIlPRiAH2lwREXKQgQwDZDIBbcru3mcSsdyBBQ8zeCfJLGo2Nh4dkBZvN3kQ096Q4sBOAsMv3wwaRNIY0TA0KUG9w91lWagWaHv2YDaR+EoAnvmHyq4ixYBP0N3nLiEF4C0usMBGKHSFDuJQQbNIaCjAxhfxmAdvIGNQN-arULozUPzDYLmjvQ5ah+VGG7Q2pvgKgBOHaPYLbotAdBSMZwSYP37mC+Q9mTiLLEYASCa6r0LWPdEuymDyAwQlbPQNL7zQ9uhDH6AAHJSe+gUjjEAAA6WAPHmqmaSh03EMgYINgMcwpsl2coaCBkPMg09jAlUZIS71SFR9NuWQzfjkNyEFCihDcEoU9TKEVD9AeMXgMuEuw9BRh3AAAF62dQABQooHVyaLlDSA2A7MNUNACzDahTyeoWJEaHE1cIMQCaCQPeDkDJwWQgYW8iGGrDHW3AcPOQA3osAN6ygDesIHhDWAMhToPAC0NW5pCOhSw64dgL7Z3CcCDwlMs8NeHvDdh4ILyEAA')">function extend_if_consistent(variable, data, frame) {
    const binding = binding_in_frame(variable, frame);
    return is_undefined(binding)
           ? extend(variable, data, frame)
           : pattern_match(binding_value(binding), data, frame);
}
</pre></div></div>
      If there is no binding for the variable in the frame, we simply add
      the binding of the variable to the data.  Otherwise we match, in the
      frame, the data against the value of the variable in the frame.  If
      the stored value contains only constants, as it must if it was stored
      during pattern matching by
      
	
	<kbd>extend_if_consistent</kbd>,
	
      
      then the match simply tests whether the stored and new values are the
      same.  If so, it returns the unmodified frame; if not, it returns a failure
      indication.  The stored value may, however, contain pattern variables
      if it was stored during unification (see
      section&nbsp;<REF NAME="sec:query-unify"><a class="superscript" id="4.4.4-sec-link-4.4.4.4" href="./4.4.4.html#sec4.4.4.4">4.4.4.4</a></REF>). The recursive match of the
      stored pattern against the new data will add or check bindings for the
      variables in this pattern.  For example, suppose we have a frame in which
      
	
	<kbd>$x</kbd>
      
      is bound to
      
	
	<kbd>list("f", $y)</kbd>
	
      
      and
      
	
	<kbd>$y</kbd>
      
      is unbound, and we wish to augment this frame by a binding of
      
	
	<kbd>$x</kbd>
      
      to
      
	
	<kbd>list("f", "b")</kbd>.
	
      
      We look up
      
	
	<kbd>$x</kbd>
      
      and find that it is bound to
      
	
	<kbd>list("f", $y)</kbd>.
	
      
      This leads us to match
      
	
	<kbd>list("f", $y)</kbd>
	
      
      against the proposed new value
      
	
	<kbd>list("f", "b")</kbd>
	
      
      in the same frame.  Eventually this match extends the frame by adding a
      binding of
      
	
	<kbd>$y</kbd>
      
      to
      
	
	<kbd>"b"</kbd>.
      
      
	
	The variable <kbd>$x</kbd>
	
      
      remains bound to
      
	
	<kbd>list("f", $y)</kbd>.
	
      
      We never modify a stored binding and we never store more than one binding
      for a given variable.
    </p></div>

    <div class='permalink'>
<a name='p18' class='permalink'></a><p>
      The
      
	
	functions
      
      used by
      
	
	
	<kbd>extend_if_consistent</kbd>
      
      to manipulate bindings are defined in
      section&nbsp;<REF NAME="sec:query-bindings"><a class="superscript" id="4.4.4-sec-link-4.4.4.8" href="./4.4.4.html#sec4.4.4.8">4.4.4.8</a></REF>.
    </p></div>

    
      
      
	
      
    
  

  
      <div class='permalink'>
        <a name='sec4.4.4.4' class='permalink'></a><h1>
    4.4.4.4&nbsp;&nbsp;&nbsp;Rules and Unification</h1></div>
    
    
    <div class='permalink'>
<a name='p19' class='permalink'></a><p>
      
      
	
	
	  The function <kbd>apply_rules</kbd>
	
      
      is the rule analog of
      
	
	<kbd>find_assertions</kbd>
	
      
      (section&nbsp;<REF NAME="sec:query-match"><a class="superscript" id="4.4.4-sec-link-4.4.4.3" href="./4.4.4.html#sec4.4.4.3">4.4.4.3</a></REF>).  It takes as input a
      pattern and a frame, and it forms a stream of extension frames by applying
      rules from the data base.
      
	
	
	  The function <kbd>stream_flatmap</kbd>
	
      
      maps
      
	
	<kbd>apply_a_rule</kbd>
	
      
      down the stream of possibly applicable rules (selected by
      
	
	<kbd>fetch_rules</kbd>,
	
      
      section&nbsp;<REF NAME="sec:query-db"><a class="superscript" id="4.4.4-sec-link-4.4.4.5" href="./4.4.4.html#sec4.4.4.5">4.4.4.5</a></REF>) and combines the resulting
      streams of frames.
      
      
      <div class='snippet' id='javascript_96_16_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=4&prgrm=PTAEGUEkGEAVQFLlAFgHTpQKCwMwK4B2AxgC4CWA9oaAM6kBOApgIYC2A+iwA7dOEATDgKYAbFgE8mAgBS0AjABpQI8VKG0ATAEpQAbyygjoZqXwMa5Wh0L5RoufO2Hjr4wH4VYydI5aZzm5BAFyg3CzkDDIAFqyyCtqKLkEpxgGgALwAfHSMrJw8fILC3upyeewcpBEOCUmpDY1Nqao+GjraANxYAL5YAJCDg0F4RGRUloSkTAyirABuTCVq0o7Krep+OvrJJkxmFqBWNna1Trspnhu+-oGNoeGRMXGOiRfNoOnZR1MzcyyLZZtGTvD4Na7tAL1MEfL45ejMSrVchnbRo7p9UYkCjUXKIzi4cSkNg8GQEQjKWi6AyuUzmGiElikaaEPwVNjlfEcEncMlESno3pY8a4xnM-hs-Gc-LU3Z0w7HWz2aXsO4NTxK0Sg1yhci-WYLJYQkEwoyxFjxdlvU2fXTfMUsyX5FWcZG1K2CzHkkU0EkAayWhCYAHcOPMWAxyCwAEZzGThyMxubKBh2JaFUTkYhMiYccgCWW0-b00D+wPsJhyCRsaOUUQcSi4GwV+MRqOxpi6ADUoAARBxe6Au9qPgi9QBzci4CQyVNzLi8TPZnGs-OenBzUgmNMcYiUIjTBiZUAABm6wpXoCDobn6cXWZz1DzskLxlvu-3+uP773B5mQ9AeRuiLA4aB-T9DwxHBvUvY5qnHcdfEzegZD3NhuGofhSGUUhYiqFhx1fIx5UsaxHiiNCMKDKZdAAMlo0BzVkSjMJozIMgyUBcKWeCoIvCYjmsQgWxY6jSCIvZQME-CEKQqxSFQyh0NY7C+2EtgmF7LohX43FmHUpYE3bOZrD1Wc0wkvdCHobd5wzB8V2fY9rw4d97OXXN8wCYDjBggS8iWYMWFEP0ZCYAAPbgJJAktjiMpNKwiqLQBHIJPDLGwQzDNsErCyKUx3dzH1XAtUrcXUyIiKIkrVZpPHImQAo4IKQueC08qi60bVcJqWtCt0OrRWqmlCJKfKMPoYsOXrgtC29tMxEBQEoPgGGK-CO2Ubh8C3FhBFARDSCwJbcAYJTQGIaIeEPUAAGZPloJgfTutBbte5xdJoFhaFoShiBkAMJBTJ7KAYAQqR2KbSJOZVmD3MGqTKzwiBEXA9WkMrRoAR3wYKAaYIHGJeJjZxBhGhqRon2rh0HweGkJQG+37-sBnCalJ+G6YW6CxkvDLqg7dIaWMKybNEP7go2uZj2QhTewAKgFuZ5a08bQD83FxcoP18F5QGOCUUB9e2YWglFrdaHwaMlaYY8mb+-GJANtmURkcXs3rG3BVSKdPmOFGmDRoN4itr3opSEjQADoPpDV1welAMRHshppzb2Tm7Z+h3jZd2pQ4S72mkj-3BED9HZBpsH6Y+ZHS5jgQytSUIBsrgs4+MSaO92DXJkehgFP1w2c9AcNRHwTsU7N6gbMt62Esz5nHedrj2fdyWw-boxfZkEvUfLuR847NFJ4aR7SHw12189hLoW6sIqrd+Sl8Nhrh9H8e0Vvu+etXiXr6PwuQQE5J1tqbBoadW4L2zgTDgmhc4HzngAzebht67zLsHDmtNj5gKMP0VIZ8L550QcmAY39jANVfjAuBI9gofy-mQtwA1Z5h20ngjuidRDJxwU0AhLcyYCGUO-TsyD47ak7hNbuvMBICCsOEUgl0ZBsHDsRYshw2DsU4r2LWOtuC9kbh4UA2jdb6KMKEdRHFNF6j7qQPRMJPBWJmEdGEo0GBnSiGwZQvYiB+kIJQYMNAVozGKqAAAtCEleHZVa7HEZJEsMjaByMunxNOgS1qORtsefmuVtJp0OseVJ60bYyC0ZQbWusolp22luTiBT0m5V7A4-uUTPqlhYAGDg0Y9QyMIOOVsiZNo0LHhPMBkcGrxQGUI7mPdQCdMEBObK-S4yzO6YRE+kcSbLInFMqRuJNk9OykMmQezVkjNUTQAaxztnYgEscvMrJTotnGcmdWa0NISUjvbf6TymDKAeW8qC0yIoslkN8wRtCfkvIrO8s598ngZWOX04yELJm-NecInS0yRBFHBg2QgHVmA-QmGCxZEK-nDMkdc3EM1Wrkp9rgP21hvlhWwY3beTAcZ41BYnFlppI6MHHiI9hICT7NDTtGY8ty9QcDJWFVFULBVBGLtYaO+9ozV1NJ4XAwVHomIaM3ZggVZpHK6fMoRRzAEND6P0YBnDQGNyVRwBqE9dWuE8NS0KJNOy6AAD7eq4ga5qRqBpepdcYUIWrbXIJiTEvlAa+r4qYIS6g3MWlAv4EIKcjrKCEsFlyoRcq3knzFSanpEqS3jjudKtFiKb6Qv+bsbeABCaSKqMGXOUbEw4RApxOxJPI6Ixq5n7LNZc5Qoamj5rrcIlK8cOHJ1QYynKubwXYJtEteWG7tTFqHeOMtO7K0ysnWS7SqRI7NrQfXQdKz1WXCjoQHt3ImQKNBeOpotyR3lq6gwtwx7dWjXCsCmtEzwUFvRbO4V28sXpusNQVsQziVItA6u9dm7T0wt7FqlE0hexqxtVw7Ukc02CCA88o9aKT1dy9Dsmg3bpyPv7TIbgL9qHHrWTCslGi+yYbmAIWxjRPAYZqNhzGicOUOCY1tHQlMyUibikuuMTHdCUyIxmpsGEc0KeY0h2Ti6SWMe2MpgD6a8xqezbQcggtuDUIk1O3QoAUPyx046h+inQD0WkhQqTTRa4Pr7Qogain6HfwCzoILd9aO9qfQOkmgXX3dRi6FuLNpj03tMVxoTvG+LTPMz0zcT4ETOnCtCqSDVwrKDhFeU4KaTrUdoC886UA4CIGQOgeQaBNA80pdDTMh48aiSwsV2K1h4KISELLRSykxKeJ60E0QUS+jTJm2tesZr+tsT0K4OUMKSYDTW+JFN0yMoGSrDWOsg3Djjd7AZXslJqy1lEAd6jdA7t1gbE2Y7e3zs0B2+zT7j2uvSSZuQcchANJTAm1RAbbGpJwQIqNjg429ueKByDsHNirnPRR6DrCfgXsOE+9DksP3XbE-x0pSHNEhoAqe1jtHBzx4cCSgS8zsGCenKkqTxqv3ycqSpxip7xwRDEHEGkiYEPeeE4VMNuHckUJI77ObPa58hci+KlpUAvqyqw9kmNp+8vezfJKMLiMaufXeq19LnXCO9c86m1x6jRvVcrnm5156KuTeOVoHj8XYkiKRy96d+sjZmwaTarIXbtuBvrkxU9J3uYhGM8iszsXbPkjrJeANCPk2o--eehlRXUxHce7FwZMFQzE-cGT8myXNBLsF+V7H4v1AbtXgrGXhnTPE0s8ILn2C1hxA1gECwCvVe8Wp7fDC7X8PEeR6mNN9g0Yh8j67xMF3i2F9L-CGiw8uPA+0B91D02kceQnfu29kPELOd-Yx5eAfi-h+1gEDOcfKiOcZ-Zlnin+3e8CQynfpfneSaeKW+FYh4tAygj+EgX2hiT8WiG+w+gB3eLeIBGkYBEBlAT+P+uIxwPcReourOs+4k+gbCRgW2MOlu0+Nu2ec+9uXWeBpu1OAOuB7u+BrIH2hB0BssrkgcB+NBTgjBz0zBjerBzm2+Mw++L+r+JYXBzAuAvBqkOgAhl4QhxuIhkB8hnB8k3Bch8ut0N+AkKhnslAH41k1QheKuGhNerS7S9e9BK4JoYIhhTebBIkHBYWqQf+8By+QBDhyWDuLB60KB+w4hGh7hTQThahGBz+HB64LSxwJEbITITAaOlhR+k+FBsuCk+uCR9ASRaOa+T2CRiBKeHBk86e7Un+vOWB0MVkMiK4fWpR7OQ2MklBcuhBnitR5A9R9YxRzeZuFuLRmR8hHR1AdREwksuR0w+R+huInR3RjqzAMiy4lYkhkcMhPB8u-BQo0ycx4x9Yos7K484OqxMK6xOh7RoAih2xT2ux1AkswUh4wkFAiwqRaepxWhshwxd01R0kj0OM-AxAlY9AbARBaR5BgxuuKEwJqkvYfxRxgJBRAOcJAJSwkxyRWE++0J1Ixgbxb+FR7MWJMxDIkQ9AiRUxWE5QIJEMYJROLw0JVIShAkBK58aJaOmJxIpA1JuJJYTCHJDJ1xAOxwyR3ApATsyJJAQJfJfu6RMM7oVJRJ0k4gpJrJFJ9J0p4JmoXOrsapPxxwsYf0oUkhna0MI2Qx+u+pxAfoiJz0FpfoHSURrxUMVM4e3O1B+2jJuI8K7soUKp62ZB0hsBtpLevp4kWWAuMGq0TIoMH4NYeoxUqRJBM6E+4JRAEYTstS0ZaEsy8ZBOmuTQepcZDA6ZkZpAmZSk2Z9hn2Hp0MqZRZDYJZZZsZTxJRbp1IiZ-pUuEJ1ubRbpnitZxZQSpZDAMZFZq+CpBZwkdZGZw5WZcZlZjR7ZTpU+ZpFxvY2ZU5DZM55Zc5Y51Zy0m5u+92jpyZAZpJnxmxCpaMDApJBSxGRpaxHxGxFxVxC2T2j0tR9ZQSd5jRHZtej55xvZ3xYZAOGURU9huBvRFIjMDA44+AdOkFXJTpl2YFq+vyDukFygEYsF8FSeK+08Px05I5O5T4pZC43AS4OZP5rgKSm5+SB5AeR5VZv5Lak5A5aSjZo5BBrZlMoF94HksGR2LY05X636rg42V5N5kZ35rZaIImvF5FDkYugloewlYRZC4lJJ58t5zEbhSWYI75oxn5a00lX+fOVGgp1gKFXFplZRMpppkJWRq5VlhA1pyh6FuFPhJxeJLprsf2e5WF3h3eEhVFUhhwnOlRvusR0y8RaYMgTMjiEw0By5DlcVP0CV1Anit4rlAkVkwu+A3e5kcw0BnO80Cp746h80VhiopwWpDgLcFksl3mMBKEvYwUQUEgw2qYmkqWoAoQ4V7MpVPxGYTsw+t4hVEK-xdZcijxygk1TsrGYCacwurArIt434-AFYCySKpkeK80asacEW3Blsog1SSZTQh1fmA6c1zm4oFgalMIuVY8BVy1e0rkFk91YI11x6askch1BKdg1SHE6WWGvGlMmoImTA78SRHAc1419pT+qE-wq171elQQOW44eWrIBW7AMgf1iaANUVT2h0ToONgMQ8BMJsuwacdWnEh0js5NEgVxS5yqdc+8EMGopwvVdAwFz0XSEUHA+sjYjGTIX2Yewt7p-OTB+wl0b1Jk4tM1tmVhxNfN4Uvgt4++01MwPee5ytpcqtQg6t8tWt0BxN2NHIKtAtMCQtmtFgiQfYt4ISZtLux0YAPcdWp0DWMA8ASAqAaAbW8grul4kNtCSRXx-A8w6pzRS2DR3F-GMBvWK24KGhqUFUF+ydcdRi3Ah5r2ZqDFr2we7BrZyg4dqWqdzl6d6ojMi4M4wdY8odEFHlz1bhichAEdH1QQXBweQi++AVCFoRLdEdpd0khFs5zZ1lvOqUngtduM0wMgI925Y9rIpF5dn2xdrdQ9xwtxwkZOsdldtdJhYxdxO9X+a9EdKdipXhkFFdqQ6UbSSwPcbsXhQRO+ednCoRqNxg-+D+Dpq9A9G91g4pgJ19t6+9gDQJhxKJZJ6JUwwVRdf959ep3pwDaUico8HSSD8uJdCD1gOR1Q5JxxHBk9qDksuDeRFJmD692D0q-hwhlFrZi5e9UNs9hhVQxhthFhv9WD9w0kAR85u9N9xD9YvDLZJ98D3DxwtO5DhDcd+9kjBDgFXDeqicrioMXxXihAPifiNAXuUwLA4UoS4S09SRzt0yw1fIUFWFiFW89KO8ZEkYbAXR5AgID95IPKbgHy1dCx5ADjzx991G5jmFMF-JQqtqRwNjm9POKM1DXW5jbj1F08W4-1J1x4RjzDDu6hrj7dNoKmjOrdkQ1AKRH9jQuBz9IRmTRTDQljWT38EFeTZ02O4OrjFqoV0MCRZqST4k+ingbT4KJhLICkHTPVaWrascyQeGdqQQMwbiATfY3ivi-i6sT2opfABjVd5FEgUSlGgdAkndTY3dHU4Bf9Iqx+pIWFmQOQqTlYWFp9dtSU-J5lz0+9W9MdojJdVVnVO00QNdTDKxoxjjR9Cx0gDkvzcDJdPVU9Pzikcy8xBx-x8jplNzENkLzz9YDxWtOYLxnD69PNQdaDYDlJnJNzJ8C6jO6EopfgEDEpBLVIHav1rNwcuGc6tsJLSpLJeD0DCkOpIqJ5hwlzZImlUDKRapigJdjLwq3CRgacElbLIJ9OtsnEjcfL0rgrqpUpIr2L2oJLPThyyr0JcrcTDQkcurHJcrUaTL3LiqMKoDlLQDLqzJKrMD1LiQorYi0Sktz0uzHAqZhKIOqwr9VjLTrSvIr95zfY8s3r5mvrAgKst2e+PxtA2YrI+4DeqhxUsDNlTRnZ+Ln2lMLAxAxAcFdgodoahQ6a1TRgmo5bQbcgibDYO0dhEw4BSWYDDrnJGhjV4j1gwj49vulM423bWN3uf2ImmoOLAk+9tpYd69RaCTMyUREq3p8N0RrZ+1s7V8NNdAtbybDb08RyURFGkrs7EbwOwcG7nrx7Ubbsf8wTPLNAfLkBxdRmxQ4d+TDTCk67VbolrgF7p7Y6X738YLY7uI+9pD+DjlCj07mbvod93BoEcrvhzQfLRRjdIjvONzPxsjPrb7U7EdM7phgy48KTkLcj58CeV9WLEdasWO2didhyJHNH-dk6LrTpQiQHd7aDA7OHEk1Hr98HA7DHv9H9fL-HZHKHPbA2n7MIJdknbgzHt7d6e8DLOkNWXW7tZ06ijW3tLWftr02z2BHzuEM4RW7z9pdYK1MgxnlM4UENKjUQZWfYtYZne0ickUT00wAi6cTATj2GPxGUD9pT156BT+RLUHzVcsLEUTPcN2LqAXhzD7f9e5ETykkX-juASVGRKVuAIxyXxQUXl5DusXZImhZ5PBWXgE+XdBGTxX58nxZXL5LStT8wr7KRaXVhZxZIygehbH1hSw2r48UL-T1XxSfXmkygVkg3iXODZy8HkyJn9l3ZCkk6vYI32Vek03Ce43FJs3oXnOkyGHJA4s6NuTTX9TKRbzoXwaGrr5TBArMq53zFnqV3WAac3EpLIpTsL7p3WEzkpw54h2MHMq-r7eia0BDUQPBHIPe5ZKNH++C1m2TpJM31ApghaKcrsP5G+g8P8nA0SPDzQdT7Qgn3BTqpeOhzo8cX30Sw93SF-A44uEp+dYEMFihitP9P5P4LsK7iAP1a4P7PEBlPx3PVoQcwPS9P-rugAAPCz6LwOuz8prZ8UqWZQK0oQBINBdhRiXQLrApdIKEIOD2K+mOD0j2gz5wt2H2J4gBIb4wBOCb+z0L8o9M72Er+rCGOr3BZr5bPeLr32Fb3fEb5ONOKbxDD2C3vr2daaAH3b9qoTQDpnTR-B6-SFxSo863QjqUryNTykNlom8H2XgG4azKZqeL6+lPWn1rJnwd9mvMkT9h2C6+qECG8zyTCX3fJ4CTHL3fI37n0wqT3bQNPb1GpqzY+HZxq98KeS7X2jh2q4FM6o0n7M4QLWCjK3hpJsykOMxa24FK2iseMq3dxq80P7rn9D-62SORjJ64ND-sylkP6Ik6eHenytGFE9y0jx3jon3jmXsn1f09o-xXy-1w4StFmSJXPrzxj5b9maspYPkMxAbl8M+L-YXNX32RT8KS9fLvs9kDycYW+ffUvnQH2AcAO+2qMvLAIZgJs9otVGAfAkH5iII+rgNlK3TH54QJ+H3OpsTz9KIcFeC-dRsv32gGRVmJHdfkAnNbAD4m+HDjJxH37Vo5OjQY-hQNP6k9z+UKS-r5FR439yMB7NwNGmYr-8EBLrRaK7Vqz1YNOXtZrL7TazYA4idjbxo42capciAkdTsvN3Er8g+wleGwb41W40B3BPjbznmHQhzA0c8ZVxrZW8qUCmmySWdj4NsF+NVOMsJ+KCEuxMQW8xgJiB8BEqf1YCboFIUYDdDpCwsl2ciDkM575DEhsBWWMUNlilCUgl2aqvYBbx1DRAjQDIUYEuzxJyKkgFvO0LUDNCChsBOfgwByEDDmgLQsLsUj7TRAuA0YWgDdgmFTC6sqQUYZdi7DFC0g9nKAqG30Y9g1eoAJYbARCSrCjAFnZQBsO+D6NwkOwvYS1RCT9kch+jVwN8CMDhJ7hVwuWDGxSDHDQApwnIPo3lhfCjArw4pMAEOGfB1hdoH4fZn+G7C+hLVAAKQgjPh3w0APo1hFQjARvYCxKsMRHgjkRnGKAjCLliNoOIWIsEZsNABEjOI+IsoS1Ql4IjSRZw0AFLyMBUiahsBCXhkEOHYiyR7I5keiKyB0iThOI-RjkF5EEjikWQDkcoDcBciGREo0UdSMJEgjcRDwkUeSOMBFZQQOSKIfYxiHRMfQMPTINqBPxMQtoOo3xnqJXD8lKkZovwbgUoDRgAAVm5xppGjSQ5IUNoUJtGLAW8nOJpqMLcDRDzRbtbSM921EeC-B9eM9k-EuwjNeMygWMf6K-aXZIAhAIOF0Q2ZSiUxaY0UomNEqXY5hsASADkILGQBcx36fMUyEmEABRYoXMKrFliGEl2AAHIsAmxIIlsU2NIHdQtR+HQMRGISZK4DRGQV0byGIChsSYxAO2n2MBCRiexNkacUsFsLd1DRHhUkGOO+BX5P4YQL0YuIHEwMQxpjTxguItFi5yQgTDGvJGgLDVK0AcWYBIHmQOiAQ30YgJGBFIIdmgx47xuRQ5bBCHB5bLCrLC6BuB3Wl4M+LrGO7NcKS0BHJqgPBy6pS2xGY8bgXB56VjxthcXtUwQmyAkJDue0U6LICHNUJO4kwrkULzd0GxxgcfmS1YEnd2BoZHSJuC4h4QMa9oyWLBNOpgSs67E7yHp28ERhHoMNceHWUWAMBawj0HeIQCqSCIZgYk9MZZFnZYxjwW+ASbDT1BVJNB28ESbJNFLkigasJLDFMHVzADuhkgYpGEnCSV4-oXeUAHNR+BVInhYSVWHQOMAmSZwRAZSUsFhpYx0QoATfnoBiQkt4q-cMXN5I7QWgDaO4aMkFPsLRTcw6hUKcgk0kyTq+OkikX2HMwi90ckAlybIjUBmTzJ4SWKbiHCnSADGBUpyX5OjQiDtQrk-KQVJslCS1eHTOrAVPMlCC3ArkkmhyEbhm1H0vIF1BIKyBxZ3J-EzyY1PfF3wrEZhCgKHSxhIYKJxgS5oJJmAzg5pdACcJjS6kyBNQQ0TQX0Dx4CRLJgJH6MtKLISSpJI8ZKeZhzHEtwmQkGqmpJ2gGtXAtU3sOZMEYz1QYXEGYA4yeKlS2pe06qakDTiKTOIHk06TOEen0SWguU0yW9PekCBIwIkwxBnzsk7QypjkzQS9NhluTJJo0iGTIASnD8GUXANKsFNgyhTspRgcKbLSWBRSyZMUhmXFIdJEzmgr0gAIJMzipAgEQAIC4jK8h81QGZJTzQDtTwMoTUQTlISR5T4Z9U2yc1IxltTPEYslIJ1LNoTT8E7IPqRrIaCDTx0I068mNJWkghhgxgKaUrijCz01pKWctktK8mUgNp+wfLOyG2lVY+cqQbQTEga4Cs9otAYMDMHOlPS8ONkUGffENkEyoZmgnfhWA3Z2zxpa09GptPVk7TNBDqTUmSkRhNUrsyvS6hOBUBMgWAfGJRgbJUnjTzZUwS2ZWDWmI80UNLIap40No20oKC1Zir1LFAn4TEa1b4CW08ajVYqt4LaEyAVrHosmuAaWpMMblDyta80viODOupaTs0lYAAOTRSZA-7UAAAB0sAY1LCaw2lSgwOQlbL4YKOPgwgl5niBeY9CiRzzGpYYK6cvNXnryt5O83gMZlIq4AD5wtJ4PgEER21CYDUH+aAAABeW4zeRcF3nvzP58wE4coBAWnybQ58vsJfO6rdA2EeAH2dZH9lRAV5r84oJAoYAch1hygZCmH2jBh9iAYfXjGiCXnaQloN8laXfNEmLyZAOC7FHvI-kELERxC2AoXM8RkKOilCrSNoEQW9hVYQAA')">function apply_rules(pattern, frame) {
    return stream_flatmap(
              rule => 
                 apply_a_rule(rule, pattern, frame),
              fetch_rules(pattern, frame));
}
</pre></div></div>
    </p></div>

    <div class='permalink'>
<a name='p20' class='permalink'></a><p>
      
	
	
	  The function <kbd>apply_a_rule</kbd>
	
      
      applies rules using the method outlined in
      section&nbsp;<REF NAME="sec:how-query-works"><a class="superscript" id="4.4.4-sec-link-4.4.2" href="./4.4.2.html">4.4.2</a></REF>.  It first augments its
      argument frame by unifying the rule conclusion with the pattern in the
      given frame.  If this succeeds, it evaluates the rule body in this new
      frame.
    </p></div>

    <div class='permalink'>
<a name='p21' class='permalink'></a><p>
      Before any of this happens, however, the program renames all the variables
      in the rule with unique new names.  The reason for this is to prevent the
      variables for different rule applications from becoming confused with each
      other.  For instance, if two rules both use a variable 
      
	
	named&nbsp;<kbd>$x</kbd>,
      
      then each one may add a binding for
      
	
	<kbd>$x</kbd>
      
      to the frame when it is applied.  These two
      
	
	<kbd>$x</kbd>'s
      
      have nothing to do with each other, and we should not be fooled into
      thinking that the two bindings must be consistent.  Rather than rename
      variables, we could devise a more clever environment structure; however,
      the renaming approach we have chosen here is the most straightforward,
      even if not the most efficient.  (See
      exercise&nbsp;<REF NAME="ex:query-local-names"><a class="superscript" id="4.4.4-ex-link-4.77" href="./4.4.4.html#ex_4.77">4.77</a></REF>.)  Here is the
      
	
	<kbd>apply_a_rule</kbd>
	
      
      
	
	function:
      
      <div class='snippet' id='javascript_96_17_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=4&prgrm=PTAEGUEkGEAVQFLlAFgHTpQKCwMwK4B2AxgC4CWA9oaALYCGA1gKYD6hzA7qwG70BO5egCMANswAUfQSPEAaUP3zjW9AA5rR5YvQrVW5ACYBKUAG8soK4ual8-Ggxbt6tSQGcAnrWGVRrSlwXNykBITFmUwBqUAAiVljQKMtrVLT0q3dSQUIAc3JcTwklFXVNbV0qQgMTYwBuLABfHHFSRWU2YkoiUmZ+UABeUAAGBrwiMirQDm4StjKtHT1qowlTC1S51i6evsH2lR3CXv6YgEYGzdt7Gi2jk4bm8ZJl0HJ3VlJ6XNzmQ1YtFkJF1aGpqMxjgpSAALNhfXLrFJWfjXBxvD5qejkfjAyig8HHUwAMiJoFh9EMuPxHEJgwGQxhcO+jxwBBeU3ewUkILBNNIiKudjRnPhv3+gNIVN5ENIClihFczFi9SarImrxRCrcvDCsmYH3IhGKHQF1i6hCyB3mGkWlX0Rn2M1YWwWFWWNTWl2sbMm1FA2WYbE49FEjAkzAAHmpTekUUKaJzpOFxOGo6YkRk0gB+OhMNhOpN61NqBQum1uqo1YwZzPWABc6NYmOxxertfSOebOIDQZDYfJlMj0eMchr7YyPdYwdDEi+5FEreMbfH9dAQ69Vmagpu-pRvZncxVTxAoEoaj6duqXwiCjU+Da9EIhlAv1IWBPuH4eNAxGh6hOoAAMygBI7jML6NCAWgUGAdWzwQaA9DuO4lDEBILCeKW4GUPwhjuDGNjxo2hDKAuKJdLh+FjtmoBEIYzC4IafzUakDbMAAjvgIbocwmFkswFISAOxTYZRS7LrWObCeROF4RJmYNkhKFoRhUJYmRolyUearsn6ThMhEazmBm5qWqIqEhp8er7BKEixAAVNe4j2cqG6gD6rzmZQjD4GoPGeKwZwKBhrAAEwEakpltO4+DCE5zD7EpqH+YFanzhI5k6P48VLm5qQFCBnJ0QxTGUjFcV6kuxkrnGO7FYxHCGHl1iNGuohgdV45RTYFHPkMSUqbxYVpQu5U5SqNWogmHz1aVIm9fJK7WDms2NSx44NnOGkLc1m4Zlu3rqhyFp9JKIVBaAIWhQofCiPgkSdek3VjdZ-XIcl50jRlFnZZVE0ZAVEhFU+JWNaBsXjY9tZgaQVnpZllnxaOS2Zl2GXvGdQ0XWjV03SG91LsjKPjlt31ZVZETibtoCtcw7UJRsXXUJaMm4Yl72DQF13+up4MVZT-3toDwP0Q1fzzbJVWM6kACQmYw3Do0Q3qo5y8TGRozjQ3c7dBNE+rK6ky9Asqmrm5tR10tLQrpOs4YeN3ZE1OpAd6SuzTGYeVMhjvJipC-hItARdYtVorQdJDLEXk+WosTrR2oDR758dpA24f0pHhpgfwpBx8TOZZ6dKesWu-BfjitBykQjCEJQnA0GeF6vAAtM3PMRK5+0ZqHNA++4fu-iyWDdY3-CXhT4j7PpE+SCq3Wvvso-j-FdlJ7Hc-M20d5tEMS-uivsSFznnfwa80-CIaPt5KEMg3qAusPVbPegGjhZ3w-2le36F9PoauQ6rfFMP8r4Iihs-YSwC-6fyOt-S+f8dSOwkJAvIBFn6k2QQiFkX8aAYIMNUT8iob7JmYAoAhbhUFTUQhzIhKt3Jj3IVgmBNBIy9CfDQ9++MSF0MVBQoiaNz5wOvm-eQ99OEjm4Qw1Up9vbMHPE+D41BiwomQlUPGgCuFkMfp7Jhu5AxTj7OGYOVhhYfGEZISIRi0iAw4lxBcZiFAWKhpNIi2R7rOxahbBmxdIqb1AMIfYuDDSsE0eGUh9CnbeJDpQkWoNxbCEWgbUAOZcAhjApE2sm09z6JnLgh+SDcrF2aDLWm9MnEZGfpyNGD10mpBzJOac-YBKDiqgAHxabo-cYZSYWJqauFJ9Nqbu3dmgrJDSlH6ncFUbS0i-QsIhP8AoTZKAqMMvY0Rjswk8Kht1DBATBH-yCSEtZmjBZvFwCBAAhI2VacT9lSxYs-IgBQAoMH9tCJB+yEH3Q+b-FBChenjgfpshhoB9qeLOYVUxupVliPWAbE89lEUsR2fsvZvyDn4PCaEDZEiImZmflcmJYtKQYISZJWihBnmsFeQHexALxy5M4T8kBI56XthOektiEZWGUjWUC3FpySkdUBvROReEAhGn5cc8JUtQAIqRfiyhsQUnzj+LENyQqvGKqInMthfLOHArxS1KR2CKVUppe8tQ2NuYnLAZQzREc4gqvEIYPO7YczKvUmqlObFOLcStbecKKdknhJ9Y2MxEgrXpnHDmXVCyghghWSmANL8bUyrDYmaFybwqgpjWubl8yDAJuWZMwyahuYpttXKsAiL7IZoxFiHEUbQAkkbJrINeanmFGpboAOpMo360Sakft4VB1DqsF2l5vb3nCQHWyg2s7R3zvVicslJdPWqtdUPU1ky8itH0FkFErgJARl4TuNGEYFBGQGAAPmmKRaZH4mHuDod+KAcBEDIHQGcNAoUdIIU5FoE43EeQEn5HaoiIpvhigBBjKUYG5RAYvKITuzRTVIbHv4PJoG+RwusN3ShwlSY4ZlAUp4prp5ag8N4Xwogz1olsvKRUsQFBeB8H4aZO6aN+ACEEKj8HcMQZ3ER3mJHCScZ0ZyJS5BciEDcMcATpGhPCg+KKP4sGgRidlHEaTsn5O52gbpGgum5MylYGx2jinaRP0I002cvMRPpS0+JQzCETP6a+WwIcyjJmKOc8pmgjmFzEbxNKcTEmjONnosQUQAhLxWfAzZyDqnoPqdslpuUUVHyw2i7FseyxlSgDaSnKDPw0twYy3EMxrBctxYK6YYr45SswfS6FhDTqmE1fAnly8qH-2vFq-lysFm-AJZjM-Eb-hAhciEnZkL1JSNkZmb3brdXKwP1YN5iZVQxuPXAXN3m82wv8iW8t3MzgsvHC6zFtbiiqMO3uptqMPmpkBcTnB2Il2curaG9QFj0xFQPa8897b1AIsAY+LFnwhh6BPbUC9vzbXBPSwqSlsr4oKtI5lIh1wwgYdw4R4QPr6Hcf48xOEk45nuPtV2yjyhDA-KTd41yBQQWxtLZJ9D2HvhDBFH83ToibOjtgapianR08od49h1tlRijyeKhOO4BQPPPD0ZoIxyX+OZe+aJ7eOLbhFfK8oLz8HrxOTYOuz15YtOza5qiclqy6ONOSkq8qzrg3euudeBbj37p+P84I0RCUzoGIJYUGcL3Uwfc-fHvLg3fR3C08DzuYPKJcBh9AOFRhkXo83d+9UFXSftwMYxiH9PlXYLZ4Qrn7KlBtib2y5bov9udzTy+5b27Rp0k187zN5zY72wS9J9LkHsuu9Dp7-nps+vbAJ7GwPpak-x6F+c6d01nIe7ma+L0fTzfCI7ma+VzTWPIRxE31kXQzB9PE50Zv7XO2A8t7RGz1f27JMfHND7ZYIGT+JeTypx3FrTHBbU-T7agL-KoSye-P7BrFpErNHIA4-EA7TMA3+b-fwC-HfGUG-SLT-cgdApsFEH2JYbkX-cbShVPUPSrCPKvV4PAgg0yGxGUPfZ+Sg8vX-BQLPVUU1egyA-wEME4BUCgHgUg5A8goPUvNPDPSvMXSLTkMCTiCEYgDwUgWgP-J-aaQAo-SULINQuUBQ+6EgJUSPP0AwpQtgTAq-GURPXQxLfDDQ-iQSI2VQk7WgqPbELILfS-XfWw-CPbWzQSXwkw24fUWGSw-TGwlwvwgXHcZwtQ-CNwv0TkK-NQUgAKMwow0CKI8Qg-D4EiUQUabIxIzQ2LTw8I5goI-wh3fI4LXmII03DkD4MQVCMMR-Bww-DHJA47OUZo4gRgHAhCXoxgVgFfMgt7F-Mg4I87NgIYrI7wpTJLFPD7IY-7cowkN-OQhRc8fLHCevHwQ0eLfnW3f-TQogAQAKPeXYkEH+Q4sYxrIWJog4-gC47Y3QK4vEG463ZzYo65BUZ4gIV40gd4-YoQh-MYswY44vTQtTTol3DguIM4-4y4-gPYz4qoAYs3R4v4l4puYEtExHMQ8wSE9ohA7QjPWIG4pEwEvEg4+rH45EqndjBcNo5ECgyQqg+Emg7gnRRifgTwpeNhFk-fEvTwqQyrLgtDHRMCT-AEi8QU8Ek497UUjk5AhQGQ8jcXPMVQcsJYHbC3aAwgBQAQXIfADzA06IxUxjV0XUv7UhTrA0o0-gE0s00fHXBI2QhCBk642kysIE7U8oG0o0IUkeak-oXeUMxkyzb4xU4Gc42UnYlE700Egk47NdZaaY-020a3SjQhZE1lcddsWyXk-k14+UsQpcMNaea0+LHMkIPMhfAsqwIsjw2GAUykfvZda2bCJ8eMx8dsyYhopIj4asr4hUkkrQ2E8kkc9EqY-U10sEwkmI5-A7JzSYn440gnUHC0FggIykUmYXXDNfd-Z0DoCQJSU6V7RYgAmE53M85CC86gOUOYDEqYc0GLfAHXY0cQNXRwvc3mQ8KYrYQvQ8N7TkGo+zdKW2E0CsvNK00QYMTwVTJQYwsNIXf86Cx9MAbBF9T8N9GAeAJAVANAH9M4frKYZgXWS-DPCEHgHIgAjDH-MQ+OHMBirDJlZzeOBsMCwhDi91ROSgbyXySMnjPJJnabf3MghxQgWizixsaclMkXZixCG0IoCi-GKiuc+HLc+fNcaS-Mg2YPabB+RPDc80nSmimCjJRsL0j4n0hS3DJStSu6KimykE5eOveSoMyS3SmS9sLij-cA-AvgsbRy26evNA4KyrCy2SwDYfTcsfEKvi6ebBDKOKuPWfFEybRPDsxs1ITXbnY3Pnby6KvyxsDI5QxK8lJy8zJgzI8qiw7fKw44bK4qvSmKpozKVosg0KyyWYqKtq0qjfKaLwrAhTXiqqsK8-Rq3ffq3yqy83d3GPUcsQ4kzMWNSi3oCQGvT4OvdvXLcyga+aj4X3Bc1Mnq-wE6+y7HHytM0Afy1QFRPTZg8atatcMK9zZ6+Ekqqyvocuck6uWueuUALwY4egCMUAVuN69S3oPrM7BYIoNkR03IC06wExQg8gWgIKkQ4JJhLaoge5WMSheG9GzG4QtgFKxGxCJ090jxOmYVc5IGAK-EOiHGozPGwgAmtIbqZRZQHeKG5yzai3QvNkfS3KtIONTbaS7EagXfTs8cC3dKxXdm0WsWjIY0pXOW9le0qWr8UzBTEWgpQmh3TfPJHm0QfkbxHME2zhcK1hSUM2i2paBsG5JqJETVMpX6nCdmquQgGuOuGgU1NI88CGtueGzuY1DUyLQyoIYy4sJXG6pxZ+BnM8p0wYO9JyriTa40qS2ihxKMd0yOhCaq3g6gRi7ohOq86EpQGEVSja0giK0u-wLS4gqi-vG626pJfmzO+uiAxu8KjIuEsQnOjutiOu3EBuhUfg82voUEkQg62ijYousK+qrI+I4eqGNGlItImqxQuq7IyxR5EGYlDVcFNG0osI6aio-espVknVMe4si++YhTIIuQCyk+umrVDIbqB+rfNQzzfYYuDOjSlskapqnQ7I1+vS6mNG62xBH+2wzzTm9sZ+eBlwzzQZcFK2bVHcaqlempZRR+0a0gSI+IkcN+liIZD0zyUvabM4x6sGLKn85OybNOuIeyOhyZWTP4FyVjanAusi0wnQaobob7PPS8FqxcmMj4Fel616+gYgYgU05QKi3pMoeZBs2sGojRzMZhoRgIe8DvfPDWgs+q0BiI9nEeqLJa06xS2CuDS66oSbdnMNGoxe14aqvqr6vS7ZXxFXAJTqkYwqsbNybqBGdqfYdwPRkRwx8RpBQq05bqDhmTRqF9IYaO1gJJrhykMJmmhwoBzalXPOnlSWngaWvWyUHJ7R1W9sTJlJ-5apodCywc5hSa4atYwe8uiyt7aeWB75dJfJyQO-ecq6wkYe5p-mh6zh8p6i7xq2bqB+fYAZu8qZjzDbA0+e05EzYStixBD6q7Jxtu-lchqE9ZNxKh8isKhxmZ2iqGLZpnPJBx7ZnSuWpZx5tZ4ZryoezWzMCyqppaY5hwl2oeJ9IzHCr8cOd9Air9Yi6CARqu+8aEIoU9UCpogS8QR8E9aNPiiMMNT2nES9OIXwPwASZhKMcCXoe2HqZgcgEQ11cZ5K3GxWhPI3XndeyupUyUMA5mns7BFjGpJlvkllvichyUzYvYsEFmimn8jo283ATLNrSVphF8v0BWmfJW3AH8tgra8PWczrYWzV9k9POVzPXVozEpsp3fDVt7LV419UuFjM3p+uu2g1oEWIR1-7c0Z1n4oa+MTzbFAmFFic28-lN14ah+ZVkI31jbT15gj+cYlcuxWFNx8ikgcyXdf+Gii15grp9l7pKB7knPEBkJHNxU4SEV4eXxRkTbUEbezN3W-TR0UiMYCjLUkJLKoHFGhwtGdt05-UWc8JbZxPW1MwVIUtuzE5H4zRTzIdmVcwUdk50mCd852ZAtHsutmWiovhh2eO4QJCLzWZy0iEXIGEUCPh0wDOROI9k926KiPNfhVtrFHtm98RXdsCEpyx8QPIE9xh0AAAHkva-feWfeDVLj+tiCBMoFzEIE8CpudOsOBt8nKD+AbESBiHpUPT-meVPaZL8JiH+1Q7twNgw7yCw+fcsbxbsgg-ci4Fg9NPg5inLGQ7iCSEI-VmI-yEKGw9o1w7iDlBY-Q+yEw847I+Tb9DXm2b9cmzZe0UixooBAEr8hLczB3SEa478HjufZvrSFR3YFIjU-ag7terk68kU9TeWXgXXemaafpQbBYYveEkYfpSkjs2A6HVs9U6NjPa+hE4oZYmsWksdSra3oCks-00sVSAo6k4RMIF8DogBzcHDoyHdqwa-t8QdSGB-uLfzecR3EiYxanayq2plT+ZXCndjtXUGS7hOeM4U-DHzcLteDuep0k+pwdmk9SFNRq7PDq5uZS6sBU4xafdSXC-HPAsc6HVjWkvk+66ULTYs51o3YU2s7c+Bup0dQc7Pac+BtsFYGEhvYdkM4yHc4xc85w-EVJh88zFaj84ZposC9hGrdSJC4W-KZG6sEi9a+i9i6fHi4Skhr2YMwwY-q058QtDaHS-ciLaxQBeQcoTy6NAK74aK54RK-loHfK5lVORdiq7yam5M568wvcmfVfQhfws-SIp-WwDO0qUEFJppfJtxpFqqNyKDaLKIDlHhwxqxuMJ+M57p+xoxs0DAfiyZ6XMCwTeVumW6j5+59ZoglSY5YkGokYwHH+2sAHCWhVusEYy2jV6sC2k14X0Yy7D15fkbUN+V4+wlFN4lAt4yEYzAtIn+0d4KPbC16bI+z7k0HoE8H+y99ixg9rHd8V9iDxb17xZXGD8Y1eWhFUGEHcBYxj7j5fUzCj4+yiFN+sBPQUFV1YfBpiED7T9debkz6sGz9AFz9vVAHBrbkL6N4+2bkRN94UCsHBtSCr6sDbjb6L85Z4YyHL8r7vXBvsgr6sB77smAFL5AgJcH+r7lVH9AHH9iAAFIp+B-z2h-QBl+F+l+M5M-1+8-HVVd6-XWLl6R9+Z+N+5+z+hhj-LfXXf21-L-D--2rA7-7ePtf2BhS+D+q-wav+3+S-G9E-xz5X9wad6QASf05Y3pv+LfVIL-034wDIB9-Tlhcin5z92+EA0AFclb5koN4YPF+LT1l4W4sqgwFiMnQHC3giBZNOXssHdLS9qB9PWgZWEoDCAAAVuS1SbkD1A7NVhsb0YEiF-sbOA2sHzSAy8aB2FFUBWwIHiCmBX2BXrZEYwu1-sLtUQarUYyQBCADUfAs3ysCaDtBaRNQWLWj66BY+sASAHryT7mCjBuVEwTCFYAABRU3knwcE2DGyjGAAHL0APBU-LwR4MO5Dp8BloWQdjXbykCBg3AvyMQFYbCRiA4iEIZ0AbzNUghW8AQYkLB6N5jKZAnRjwOiFV8X8hMQgVzxoHyCpBpqYmgkOYGKJKaxpCUD+WJpBJio-AUQJ4HgRsD6AfASJoIFSJK91YlQwXuIH0wi98aqPKwLUIxj1A0gy7GgDDCEqhdmCP5CWvMIUzpI1GbCSoSQK3asdEklQsIV51WEaB5kkaNIVUOEbsDOB9TAsrsKSGwxjKbg6wEFxrbPdSm9bUjEPFaD+gHuuQcyLu38DLC+aswtQOa1eEKYyhOicnG+0UL-ERC-AXwGBCBiEBt4N0PoHCJ0EERuo7EfYBCLYBQiighobeKckBgwjURaRbAfSDiCTJP2BmLTv7x952RW4bceHKhAmSgBcRbwREfeE76txXI2w6wLSKKBEBsRrAXERIHYi5QaYmDd2GjXPI5wdsYoyxBSH+BbBdiMo63KqMrCF55R0DBmsSPM6kib+FI1VMcEKx9c0g-I+kQyNDr3lZRfoRUX8BDqWieRyXIZJgxYjmjYgloyGmyIdovpPR3IrHnyN9gB8t8R6WgL0PHCHoBItAHtH5BqTpcb0bKQUQIEhH3Rni4YxslnC+DHAhAm1diIakJg1IBmwo1MUUDzHA0-4+6RxgGGPQ1EXMGqaYYQOZHIRixfQPERyO0y6jJkhgjegzRd4Lh8R94JBmaKDF0iPRkNfJjhH9B9BMaQhe0QyMS7mxgepojEViOTE4iSxCIgkdTHdGWjQAhgQQDCP4pnh2R28B0f6O3EjiBRiItcS2LTFaibukKSZg+SNDyiQe1gRUSeRUAqjrRaon8RqKCb3iVw7ogAIJ-jbRhgeiM+CBJ7jdA9APxHuzQALi0gyXYuDuM9GsiSxNgGKObV9F+j8OSEzMPyJDFRj0xEY6sdGOTpxjwkadAFEmL5LrjWxSvGWLbkzHZYcxkgMsaulGFd1L8t40saxgrG2AD05EiQLWNFxXcu47sM7D-UfDuBOAfQTcYOJ8YEDMRQwIUSKIHH8gQmaXcJAryLEiiyx6bSscRJrEPpTkOncCpolvZ8V5QkHC1H-BglfA3UVlOiSmMYmsTsxVFMscJCsmi4GuUwYmrDjmBfkuEuI6fKQEEIKAwpw7EyL4hiwktPxCUIYJqEVAAJiEBoI0IeG0kEDJ0IebCXzW8S5SLUookseFMima03yd0T8vFMfCJT7hK4aKTKjciH0qUDtR1BuhdTOTXqNRXFnXT4khTAmvOYEOi2qCHhuJK4IyUJKrGhiJAuUh2qdnUmlTOxkgAAOSqiJADTAADpYBgpaw-4H6VwA4QwxWjCvqAKqjEwVpcoZaZ3EWmtjeAKI5ZKtPWlbSdpp5PaTtWCRHTI0jaWaTdHER8Q0Y+ABQAAC9ChoAbaWkHekHSvpPAHPiDPEhDpLpVWB6WBE7hqw8AIDWSfJJxBrTDhPZaGfwDDEz8FAVpfDsIHw7EB8OdLYwCtJVAnhbp0IlGU9Lxn7S68h0wmQPxJkfZ6AZMimVTOVA0y5QrkIAA')">function apply_a_rule(rule, query_pattern, query_frame) {
    const clean_rule = rename_variables_in(rule);
    const unify_result = 
             unify_match(query_pattern,
                         conclusion(clean_rule),
                         query_frame);
    return unify_result === "failed"
           ? null
           : evaluate_query(rule_body(clean_rule),
                            singleton_stream(unify_result));
}
</pre></div></div>
      The selectors
      
	
	<kbd>rule_body</kbd>
      
      and <kbd>conclusion</kbd> that extract parts
      of a rule are defined in section&nbsp;<REF NAME="sec:query-syntax"><a class="superscript" id="4.4.4-sec-link-4.4.4.7" href="./4.4.4.html#sec4.4.4.7">4.4.4.7</a></REF>.
    </p></div>

    <div class='permalink'>
<a name='p22' class='permalink'></a><p>
      We generate unique variable names by associating a unique identifier
      (such as a number) with each rule application and combining this
      identifier with the original variable names.  For example, if the
      rule-application identifier is 7, we might change each
      
	
	<kbd>$x</kbd>
      
      in the rule to
      
	
	<kbd>$x_7</kbd>
      
      and each
      
	
	<kbd>$y</kbd>
      
      in the rule to
      
	
	<kbd>$y_7</kbd>.
      
      
	
	(The functions
	<kbd>make_new_variable</kbd>
      
      and
      
	
	<kbd>new_rule_application_id</kbd>
	
      
      are included with the syntax
      
	
	functions
      
      in section&nbsp;<REF NAME="sec:query-syntax"><a class="superscript" id="4.4.4-sec-link-4.4.4.7" href="./4.4.4.html#sec4.4.4.7">4.4.4.7</a></REF>.)
      <div class='snippet' id='javascript_96_18_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=4&prgrm=PTAEGUEkGEAVQFLlAFgHTpQKCwMwK4B2AxgC4CWA9oaALYCGA1gKYD6hzA7qwG70BO5egCMANswAUfQSPEAaUP3zjW9AA5rR5YvQrVW5ACYBKUAG8soK4ual8-Ggxbt6tSQGcAnrWGVRrSlwXNykBITFmUwBqUAAiVljQKMtrVLT0q3dSQUIAc3JcTwklFXVNbV0qQgMTYwBuLABfHHFSRWU2YkoiUmZ+UABeUAAGBrwiMirQDm4StjKtHT1qowlTC1S51i6evsH2lR3CXv6YgEYGzdt7Gi2jk4bm8ZJl0HJ3VlJ6XNzmQ1YtFkJF1aGpqMxjgpSAALNhfXLrFJWfjXBxvD5qejkfjAyig8HHUwAMiJoFh9EMuPxHEJgwGQxhcO+jxwBBeU3ewUkILBNNIiKudjRnPhv3+gNIVN5ENIClihFczFi9SaOBAoDZk2o7g1-DxEBg8CQqDQZ1NrImr2YfFE+F03Lx0shoAhPAFyNRNE5WhO9FEUoJ-KRGQA-KAfX0-bw-fgHdSZcZg+kAFzorkBvmJjLWMOiSiURj4NSsLw+PzR20eby+fyBdM8wPGBSurPZ0CpzkLCrLDMJpNpMMLIrWmP2iSa5asZgADzUKPc7iqvcJzcIbrk-bb1glASCNtj7gkAlyU9n88X2uX-NXbtb2Y7H0oakjpEo-G2eOE5AVPYbmc3OYuvuY5Pi+b4fj436VPor6qBoizQYQV5Ni6a53hkD4foQhjkMsfrIQBVhhiO-hdNhuFVPhf4yje6EpmmoiuMIhj0Kec7MAuS7UYShGgGGThsBOS6MT4LGsJi-CKicJbVn4h7cdevFbukInMaxviGEUCkoS2vGYe4zAAI6xiQcZOkGW7ETaJZGSZxAeLZEL2SWXy9G4xzyY6ja0XpaZiJQxCMARllAVG-mBVePlbphKJCtUWT2u5krabxVlRrFNwuYlMqRahbq+ZyQn6IYzDEIxkm-l5mYAJCpKloW2mORXVCVZWfJQWEJccrCtf62lRW2mG9QIiHBW2aX+MNFVcVVNF5XRaSYfQnG5IQSVjdmE2qCta05QpA33i6-B6ji+1xEQjCEJQnA0F4xz0NOoAALRPQ1dq9MqLLPFqNBDuORAKMe7jum8uCgBInJzuQtAUTwgmWkubLGCD1gZWiQ7iYIMMUHDrDNf9hCA-wuTA5cViNC6ogGaD4Ocg2RD-PjSMo1YZFZDY7jKG0Qwke9kjNawGlFEjG7KWLGQzr02FTmu2LUOtSni1uAsSVJfSHiLitK9mQOi9r+tWALrpy7txwE8jKrpGjXofNbFaxsUHFcwtoY2HF9udNQUuSvOzta6mDPMLg35-GToAU8wVPMOY-Z9CdBNyhdV03RqCPUKApCeM+z2vUOn1Is0TzNeG7ykLuHuHjOajuLRMdpNbdDqEexODAAfG9Y7HrRzazqTqrfVa1lkTheF9bNzotnXqOemm2T4DCw7Ab0uLkaPmN-N2ZnefNLupBNfMryPlGkdqjlm-181KamvNjsPFHUFGfonD+5Bw8htFfcXJE2cZTkeKQtBSA13mlPKwBRaYfGYKCTOP87L-0AcDFm084qgEDsHDghgw7h0ptTcBEMPiMSyFlNyOUsgIORqA+uM8b7L2DvwIhCUSFmzIUApsLYsERyjpQ1IbM2h0IYQAsu+5o5DEVjQ-m2IBHZWYYI4Gch2EATwZyO2wjxySLLiwj2FCNjKQbvwjRgiPZYNSJw6mOitwN2-gZX+pkJBa2nlIphQCJAsLkQo7MzQTH92LjuOsRBlqLlWn8FxskqYowbgwNQISyyiDbnEAAVP4nafx4mxAUKWGsfci5p1ujoao3Qy5TUQp5eMtJzFuxuGmaxcCNqbVAPQYgxB8C0GUGOex1gygQkMHrbWhBlCiB6UrSJLi8kBHnj1Uq5VimDINtUv+xCoEyhKeZC2V80xFMqqUiyIUJQSA2VUGSMTkK72sKmPpohRCfxyQ1QWeYIpnUnuU3hoAhb7HCowQWlBNLISwc8u5fodRDHcKMgpEyyojWWIeIWltrDPKSYEjBgKS5EL8QqZJlJ-lhKwZYpekghY9ylv8Y2epTaSkxTXdpBtxbwvIEEwwwDKVUuUi2FU2T2Tp2-nbRhizz7j1lCA8pESmBsBUTGSQ7TxGO3dlXc8M0tk6TQqyi07KaDfwCbS0luVHnBmecI-Ykr1WrSSh7NisrqDv3mlgw18VQkeyPDtY1GS-AWuER-YMDdhFXJVTc-Z5qHloUodaw5NY7W+ptUci+jKJa4r2ZMiFBzhGmo4heJC-Uo3axbDMpl7jkGVLQSHTB-d1TNR1LgPUtADRwEQMgdAZoABMyqfoMVwpGMe8rKENxFN8MUAJS65ViBGSSoh87NB8S2oddrtLmDqoKSp5JKRfHIG2lZSqB5TAEumJ1ohwkz12fKRUaTQBbtXcXLd5cFQhCnYKme86JCLuXY2E91zOwOr2nyndKCu0-D+L2oEZ1YjWqSiOtd6dAMymDc6q97qb3MApHerE-pb33uOcjFkxcwPdUTTK5NcqVkdpg3B5DyHtKoe8c+j4YbkL4c-R8UUP7dn-t4fQbqYblSgAAD7saUl+ntDG+VymkOEFQrHTCce47R7t9G+3-oFiJr1Taw0QYfZmUBDcz11gvZIJDCGUNoeuYprDZ4cN+vfapgjC6dPEffaRtlTaN1MZY3G6a5rNMKEM+xTi1AP2VL3Q5wpTnEKHtc6AdzZrCBPu9d6JiYlsOedTaZ8xnaJPfvFNJ-jcRVIxaM3F4DPjousVVm4aSW7lmNjMyg4Z6mgjBe00u3Tqo8uiXUl8rSCWkQN1q-6Kz8qbONteBuzLrFYspokIV2w6sFDQuoz5vtA78tJpywoMbJxgHQvk68QqOSwVTM2XhswtVrDQZo58STqW-3pdiLJgLyxcvXKu+C5z1RNNUevSgncKJcC5TOEq4u92dsHOW+rF7R2ZtEI+7lOtP27tbcU0LYHs60TvaDrlAAzFD71f32qdS+I5sq8Pc1ons9qHH-mHujXaX9+N+hntpu1gN+bw2lzpsp498SI0itA9p1SlniFPnfJIxFptyjPQLPWlBgnNsTspd-clC7XLXI8tILd71dtGcmfbYl8z8G6skfWxyD4d9R7449MdujZ3ZdbLlIb4+C2U1sbE8pHjUnzuW7iNbh+-huVAfR0293Cp-DsRwksLeKnNdvdLqwcHZ1vt6e9X7qMbMz4W72+13dEeo-pch7H331Aj4e9UKIZ+lQ37i5N6DsuGfXdo71+nTkczbEsJBklqXvG+0sLlPX+yyum2d7YF7pZLjBHrEOxLsksGLN1cbz714+jRekNkU3rXrjp9THnAY6Rzjl-lcqch5f2eNuQOgZ4WBf9B-kO38KD45z-R74a+RgEy119OLP6wi-kvr-a5vwvwXB-bkBSCqXmXpfi3s7snoGHKO8t3q8O8nzq1hriDmiJ1scvvuusKn-hFP3mUggTQHupAekgrklD-vrgEM+BVOBCCF+C-OrntgdlYNgWmP4vwMfqBGQe+BQVBLtmVg7luJyJQQIMwaQboOQZ+Bwbho2CgbXh8IwQIWBGwSIVQfFhrrQaAPQU7ubv2tISQbIRBHwTdivpIYLFBEwVoawToaIdQWVvtjOqPmoTLv2nwcYSwUIXIZBAoVAVME4a+O+FusbhUojunsjtHvoTQLPk4dhL4Q3Ejp9mdFnnft6gZMPCYcxpSIAX4TgQEdEeltXmRt6hul2EsIjFtmroTPUsTM0uBsUcDNNv4UCABvBN2FUIekbNlimkTLkOUd1JUUQenJ4cIa4bzrBPkaNKkc8r0f0EMGMUpj8qoVIQqI4YIV4WYQobUq7HkfUQUeahus9mMU2OmspLsqEYIeEQLmsmseUBsUhFsYqBIDsVmkymkAceokkcce+ncfcdmAkbns8SkdZt0ZLkMZwaHqnqbqdnYf+gCY0cEanCqrbmIUCaPkgbrnEU2seLCZeIAR1uPp-tiQLl9MWjkqWuWpWkaDWqaGgCjn1sQXPAvBINON5sAb4H4LBkhHSSocpGGNOGsnHG+LSRAfmOIMxi6LOKVL0N0jYPZK-H8MBiBo4GgfjIDvQpNi1rXK9uXhILEPTNLM1GkpSgqatsqZasib-pqYzDkuOPSZLmbnYbgFbl5AzHjDku4enCrOzuNvQuadUekWDsjjaaADHkaVMALHDrgBacihXj6QoLEaOtDjCcSvLDlCGZ6WGZHhGaANkbZv1mgaKpWCvN7KGXutmbGIemRHmRIZLoWZIMIqGbYbsq6nEBWU6bcCLomiWTlFWUmUgVWX8ahGVJQIuHkDLDwCbOtNqgjjQMhgotGRjk8WWtcaOQiViZOVgM8oyFOEfoOcOTKPsNfmMMXBurOSECVm5mKlUaqWiJiNiNEpkseZWFkjKbqIqEphrJJG4MPiPguXBgeZEGWQ+W4BXOOC+ZENOu+UAeOTpl+d2ZLF0huSSutEeSFgCpNstGwPOaBeGBCLkDCFeXJKYPSEMOIHkFhTaMDEpGGBeTiPuYBdhVTDeXIi8shYOSclYKmARZhdCNRVUQADzoWEXsXEVMV8RHTxyxCviUCNyECeClHtFJQ6icz1F-CpiJAxDppZA5D5CFAcXRBxByhJBslUqqXfjqVFD8UCXXzHQ8kiX5gahcBSUdFAJHpFjlAKVxC6UqXZCGUFBFAlZaWHpKV6WzLuV5CeWhBhLdl5gFhFhKZ2pboqnBhfxrgAj5hRKoVpCnp5IcW0VIJWwzycgf7eXprEQJXhXJUkB5j9knhxmaosrpqphbp0hDC3r5VMphi3r8U1VHrpW76hJ0XIYmXGLWCeIZB4Kuj1UZywhrlqAwKVWEHcISzmU4gxXnSEC+AMzTAHowrpCmLRzlLZjPJfn7Cz5fkSA5oWIzzArMYAWPklaXWvlvH6xfn-kQUbVpCDXkz0GuiJVPjHVoQ16-Q7RRWqKLU2ixWpDxU8CfUlVuizWGzXLnVITwX8XQ1ULHZ5XdUCV1IfXFXfW9nlUwXxlmzVVMq1WhKjWNVo0FVHq2CsCtWIUIXbrtVw3YneVQg6Z9UAQUyKJgzfU8CjWrlQKTXH7TUJhI2pDckLWhKJzLXdDYRrVuA5z1KvrHD5weI4LbWKx7WAUHUzlUUnVthqbpUPXXUQV3XawPXCLPmKikYeLBivVpF5QQ3c2rr4kqqEn6hQBVrGi1oYCUkGFQzYySkOkqrmxv6zygkHEAxxB+2wxKhQlR04xsDQyaCK6jRIwh1IHMxfTPJx0B0lr7C7Kbh7rzqHrWDzriy7EZB7r3rF1WD3pl13F7rkXV2gDkV10F2zYShN0Sit0V2za5X9KHp90XJbjl0qSzY4TuCaD0CeCHrj2T2SVtgj0PGzZi3V1i1iyL2pB7oMAwiqDCDuBpLb3Qi706jZgb3bizZRBN3WC8mgCeC4XtyPQxDz1n1WB7pPRX1WA3131xKPSvTP312zZPTSHV2PSpADDtxWCvSgMv1hnqmpIKDpBf332gCPTxK31WAwN7rAAf3gzTgKDf3gMoOgBgD-1t21EACkODSDP9oA5D6DoAmDs2eFV91DhDj0eFt9jDtRAAhPSCw3g5wzQ7w0MHfQA7UZxVQwIwQw-aANxVYKI2Q5KLEJxQMB-awzIyo-I1w0o63JI-g8g49BA5w2Izo6owg6kOo0Q63EMMY4o+qdwzg0Q2A0Y9w9YHSZuCqFnVjNHYHT9E+YMABMMvOktt4-Hb45Cp48Ts3aEznVtpQMIAAFYimAqBNNxshxIN0xNwyHrp1EAWwm1WDZ24wloqjLlRNFOeyEBdT2X4V9p7r5oYKHoNN-AwPvFL21GQCEDoK4TT0IOdPdOZytNtPn21GH2sCwCQDV1jMTNDPDOwOxBjMACiTdSzszwze6AAcvQBszg1sxs+jfcZE1U20BU9jsxhot1QE9mMMsQHEresQChKc35n3F49DD435hXFcxkDc3c1icRsjCE282E886U+hvBMfqc0zBHceBKKGRjN+KwIHPwKIJ4IZawAk-QHwMCoIJNXYvrKc4neIElCnXkwU2kDC6XPUGkDkT3tcMWELWbKGVBdLAy5KO0p0uEZC1tvBXsYU1k5U9U0+Ws6kBy5SFyzCfE0k2QAym0088TucxXMK9YHzeuay6uq0GNWwLkHmMIFGKy-sAZHYPS7LLBTlKC9chJAZKwL-MYXDPwL4AZBDIQGoPPG5n0A6z0yjM8oZPsJa2wDa0UN+C6-yFgngnax65nKAMI3EIuARUrllaALPYxEULEC9K9HOAFMmqAAG28M6-PJAy9J9P5WkEm1PRIEQH69a7GEwRIIZKhtgpHGYrbUoh8AEn0D2HWwmxSP8FsOBG2-wD2P25OHDp2-1WAlzeG32T01G-SDG0ujKGxjtRkKWym2my9ArQZAO1MN238DnGu0W1teYLbYe0u1YCu+qWu+uzm77IXjqJe4W89akCuy5CiK4Hi8pKpbBrQKwMMpSvteA3sRWwIFawG++209+NU0IMvIZAoE9WS6LbilW30EUDB0eoZa0PoJ+2+9fhbM9YXD7TQBm-ZAuEhzW0G66yFu61O4M5Qi2+wP0k68G9ogBOe6m+uzQm+BnH0DDD+Lu2m8rQNarUjd6768B-69W4G3myGyx+8HPRe2m4m4IHa+GElbm8G3uw+2O4m7J8m+W862J6Ryh1bUNVzS+pux28x2LN25Hh0AEO+EO0uA5-oCO8Z1uKxwAIILjtvbuGAlSGAZxiUsRfD0UGRoACebVCensls6dltsdrvZsSccxcx3v3u+XhdtjPtYe0BgcfvZBfs-tNx-ua0AdUpAf0LifId2LVTKEQck5QeSCodweUriKGe1vpLoe2CYd5fYf9K4dafHuqh1S-ZPHMbuCcB9CMfzxetRM+tDCVugfkfSc8JRNflIotegeoflUYfxTdfZc4fPXN4f6rcCVhjyhiXb3EDQiGWJu6D0CxBrJlcgcSdOuQdjioe3rHe9b3koiabRgyARAfDfjFAdDTfHMHDzDrG85GDblcA2elCQ+TirDPXFx5dsCcB+hBRVwJvN6CayCSBY-FvsmNzOAzB-dCb4+zgKBbAQn6BGAHPMVpjkXHWzj0+CVM+o+sDo+iBBS3pY9Kttgc9c9BQTks-IztLXyzgcL0GC8Y-A-iCrrzcSe8BUeOsADkQ7Egcz1gAAOlgHMEeBoNBbBLgG+Ht-0vg-oxQtrKrwJirzHQ0Ir8h8r-a32ZIOr15wO5r1r6ALr-r6K1jib-wNl0z-gG5ihJ4EtliDiKH6AAAF4AtWC6-kuG-SzG+m9SAW9x8WxMo29xCTsGT5wHZ4AjdVPjc4jq8p--Bp9B9f0KB7p3cQG+XEC+WGDKjGCq8qjqiO+2t28SAV-Pip8dSB-ZdSN1+zYN9xDCBN8t9t+5+xCfRAA')">function rename_variables_in(rule) {
    const rule_application_id = new_rule_application_id();
    function tree_walk(exp) {
        return is_variable(exp) 
               ? make_new_variable(exp, rule_application_id)
               : is_pair(exp)
               ? pair(tree_walk(head(exp)),
                      tree_walk(tail(exp)))
               : exp;
    }
    return tree_walk(rule);
}
</pre></div></div>
      
    </p></div>

    <div class='permalink'>
<a name='p23' class='permalink'></a><p>
      
      
      The unification algorithm is implemented as a
      
	
	function
      
      that takes as inputs two patterns and a frame and returns either the
      extended frame or the
      
	
	string <kbd>"failed"</kbd>.
	
      
      The unifier is like the pattern matcher except that it is
      symmetrical—variables are allowed on both sides of the match.
      
	
	The function <kbd>unify_match</kbd>
	
      
      is basically the same as
      
	
	<kbd>pattern_match</kbd>,
	
      
      except that there is extra code (marked
      <QUOTE><kbd>***</kbd></QUOTE> below) to handle
      the case where the object on the right side of the match is a variable.
      
      <div class='snippet' id='javascript_96_19_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=4&prgrm=PTAEGUEkGEAVQFLlAFgHTpQKCyUB7ABwFMAnAQwBcBLfAOwH1LyAjAG2IBpRCBXS0OToATUAHNilXGABmpfAFtQAYwAW5QpTKgAzKAAUAZ2LKa9XWh2WAlDhm86p2nUGHD+ZfoDWxAJ7dSE3xSYUNrUABvLFAY0EDKXlIXakMGOl42Nn1A5WDQ21jCwoB+UAdhYhlqOmJhaKKigC5QYgBHXnIsn39QVWJyYX0+geygkLDrAoaS3v7BnLyw+umY5vI3D28-bmZqLIXxyYBuLABfOwcncwVyHyZWDn1wqMLcukMBNg9O+-ZiUAAvKA2ClKPoAEQAKmYf0h4OsJ0K9kcZhcX3wXl4hC2vgYAEZuN0GAAmZ7LIpvD6gQy8FgwjiA1zuTxEgmgXZZL7KH704jHcmFagyAwpBjlSrVWpGWm8yaRAXTeKJFziqo1YSI6anFpsYzylavehUg6iIHrZk4kk7ch7aV0h58hEKhpKpKgUWqyXzMbCKYGlalT3q53+1bsm37H1OlbnQqx2LIq7Jd5kMGswl+K2gABunV4fP100pAhp9r+jPNm3T4dtXJ5Dv5KyFItSQalpdlZND1Mk91r3zYvw4nBD3Z4NtI+hBH0tbMIE8txO4ubY+cmI7HY45U4HQ8d0a1Or1L1DxbiPorGxZmaXNayHYbB-9zf0HpEEvVo1yITlJ8KAEgVmMSg+3vGUHRHQDNxWedqEnWDJyJW8VzXDdoM3bcHz+SYnSgmJtWIXV-j-MdgNAr88mXPM+U1f14waejQEYxNUVAYQUnnSg1H0BQu0VSRlVAJQARE0BwXRTFCHBUcGlKCSsRkpohMBUTwWqYxSEoaToNKdTU0UwpmjIeRJwUbhwQcLw6HwAB3FwiDIKhnFAABaFzwz+eFaKY8lXRcdjDE4tQTnOLAzwcihUT3RkbjuXknhOM8JAEIEIqc+g9wheSpKdM8+BSggSEi5xMrUlNNK8i4UWc2LiAYFhqnYugxH0XNSGoCCc2oviYj88c4Na8h2s6lCaLOLAWOchqRGqMQGDajq-n0aamrEHrzwSN1hkGFbZqdc5JvMXbmvm6jlsavbC16gS3W3Y61pCibLlY+6GGqBg5HIBRiEG4a-m4T7vvWvrK08BbOsBsaDue5ziAADy0ERfsW4cutXLhQEh4GbpcBCeNuOr7uRkbuoBiggcep7qvMUVmDECRhAYacwVyBRCHoYg6EoHY+nuNaro2wTRTx1n2ZqLnwgAMkl2YRlFjmJZUoFKF5unKcO5JUjoL6fvl8XKGxzbNb5hmmdBfQ9c57mxO177KtCjW2OIEgRFSeh9HhwhAjcZwqL+1GsYFx3KECOqbM6LwPfWwVhVfVJwaWx0BabWO2g6LIE9RpOSO7PqQ-zbyYyPYiDMNd4BBYRlXveyGPbJnWnzHPq3wqNUpRYP10JmGROmMUv-WaEPiDDiPzpmk7RuWxtQ3Of8CKI5P+KN91Ujxgt+6KUoh5HthI+2qPwgAH0P9lQ4YcPd-0bdHQ3wzMd74hC9iRjGLzs+L8jz3vcMZx9qqpMWgI05ozIUDB2Y+yWpnDGo165AwFmee6VcLonRruTH6UDYFjRjgYAAhCvMU74247WQWtaOsQ+oOCFLiG4XFVBj1WqddG9C9rcFvt2GBmM0EIlAOSeeeoXyiigYNdGv4u54EhBIkMCCSFIPHnNVBOthH5kwY3QofU8Etw-O3EhndQyBjoFQhgNDuIYLYd2V6k97rWDQl3f0WMN5GSAUjDBaNlGcIbt5Ph-wXwVBdqEBg7sOEuKxs8UA4jJErD6uCHuexajgk8cXRe11l7w0RoMFxHCsaePGtITGMMjScMUBAGA8AkCoDQHiCp-9WLEBQlQXWigxZW24JzbMPVm6pBBFoCgWRLYSxknJag3SfiTz6QbGSzRRS2waWzBW4z-RyXwBiLEDBDC+AUCwfAg5J5rI2VsgJMg0iKLGdYlodA2kTPwRoQgIJuSogto0uZujN6CEIDc3wHs6laH0BrBgX9iA+3diclp5zrFmOZgcxh+ZDD6CGnNf5gL3gPNmfrU5rTJiXNFGlSgwQGCs2mulOgyKmn9IWS0L5P1sW4vxdUQlTB8AMGubcwlxKnkgouQPfBbx2Kok6Ky1FAzyU-G5UM5wfKxnsueXfUUbAvosGEOQP5cMvYAp-kCx5AqyW1Q+vkolsqNkKrAUNHW3TVnrM2bqflVswW2JWPq+VirNnCA+cCs5HKDSTNSMYdonNlAzJJfMg0pRak-G9fmRwP0w2+rqh8ep30uYwtdeizFqR2AeEjicwVIbBxpuUBmjVzS3VStiJ6hgflVnMC0PGlmBbSVBqFYOctsaq1WytVzSVKadXU0YBUZQsrirqpRdavCPCyXZo6N835vbBw4rxUaZgXMGDTrbQbDtnLRTTuNfczNY6VxLpMP2llEqi2dvNNQMQdBq0ruLTEYNe6z0Xqvce5NnLjLBBXeZSy1k7LUl8FzcgcNXLuXHfU+21TnJMo+cibgcKwhXQEavdqChRXZjqhrH5DhfwKhBm8tguIvbUGQzQVDXakwYboDB0gYgwi0S8e6WOop5blFI-c5EWGGhnm9hkAqIHJ26vqvgZ15GbW2v9Kk4BfzzlwXoFesx6FfnzjQd0mFbGbGidDLBtT6mDS-NadJy9ra2PTzUTjfB5bJ5cbYIGvRgskhQrqm8RGYJLPWc5W2DUyw6M5xaKQEy5HP10CsrZFwwdfAkCA6895lVn45MdhC-AhzRows9oYSVyc+o3GxHCwEAA+BtE6fpwslS05VNHYu6obXOmavLem1utuigWHSmCkH4KoD5vGGnVbFYOFV7E7n+rZUWm9t78v1IeV1+gwqjRp1bUm0FikjIUvGzy7rjKrNkG1sRgbqLJXqwq9m1ZM2I1GEoAoSgqWi0CwQ38tmlBcRRuOx8M7Ewkm2ZVIQr0CTCL8IY509YIFm3ECvU9877Gl6CQ6z8uCHwK1xtbSDsInB0VfYXt5mIZ4qikBhyD+zjIDKQ8x9jytQP4endB0j0FT8YjXfM2dQnAOyf2bB-6Pq9OK1nfs1TpiiS0dFD6gdh7fr9C329gzuHCaTvPescjkML9yvduBKCSFDgH2fl2RauDJEMsaCMOarZuWxKQhVz7C9tQ4TcHV1ssrDsKuGG5IwfA-B919q3c4RNdXDZCy9UdoXO6yXkGUMoXgCgMhjbYdc4BWnuzpEyFH0MmWjD24CU7zdA73hx83ILmNxPq3u6HRLDFoZS2p6PR7xSgyZwl6ipb2r+eDbDdAM0GPbA9sK4O7m-Nde0skQQYJ3wVcuReAE0Jk53kzx1l1IyO3Qhk8gSr275affG5nmNz-U3oRGTxcOav89n4J9lZMykpbTqejiZEJJ7M+mr374z9p6CO-18Xbk3f2I6K-5UwAQdptOfZt1e775UzbVWnJhDeSHctBFNVIlObNpd-R2A7VXJ9P-S7HvedVxf4IESHBAq2ezJVFVRFa9XbckVXM1PZbZM6LAxdGvAgtAwgw-QSUaVvT-PdefQdANf-QoYgmvezfQFgxgKg11Z-QoSHXgnAiA5wAgwQ7sdFW-aCGXOgt0dzSmPADWQwQpJQKAOARAZAdASpYkcDGmTpIZRyWvANT3N0WmcgemWoM2GcY9cSIwnpMDOLBwkZM6E5SIQoAA5efebcE5WAirbVaZXXUgswtEc2cEaZcEC3PXNgfwhXLghLI5b6a9RrUzHwiMa9OIgBUUCgmtOvUI-BOmU2ZmD9MSXIpwirXIkgi1FIrXNIuYK+DI9I20Pw-kaGBXKo0aXA7+cQ9wuo7who7cXwj3No-Q42Xg2orwr3E2awkouw4sIQOfA9V3egeEUAY+RSCwqwxmOYpA8EKBZ3Q9VENYjY0MLY4o82OwqdZYtPMDD-ViEQ-gj3K6PqBIw5II5okwp5UYx2EQrosQ1gp5F4+okYIYjI1oxg1ibVBYxdCY6ZKidGbo1VX+VI5eEo8EGEpYl3W47geEtApExFLI1iGVOVQ1AEqA54v8JrIo2Yy4vY+1Mk5VHo1Yv+OLUkxVRTE1Mgaoq3SY8hQAnXN4pIjGT4zI1kirBkx1PvPk5JQSUU4Y-I0Y+4mqAmJmdkgkyA-QTk76ZTbgE-Ao9EyUjU5wKI8cJTMgC7fUyE5yUUa47E0vfIyIEdKY8w1IGknYukrvMSO0o4k08UhXH0lYxgIIvol0sImHQIGQUovEf0gBQMtPI1c0rHGU2Ut0CFSM0o0kR6R2eMulE-FMt7RXCMyoUonQWM1iH0+lKrWNWEg9As7XO4TEw4oM4XaCXMqKEMj3GQoobVI08k1s2xdskqbUyQC0iQ21IcjKfMiE+XbI1Ib-cXPI0w4E5ec42k2wvYhcltLmCohXcApk5EwE1FFcuUwY8EkY60gwqrFbSbL448-o6Y90mwpcuZcyEVGrY0lk9Yw+TYt0ywi4jcr0jE+gG87WQcQHatXcgBd81bXragfrFMvqdMks49GM7MirGC286so7F8+85YJCpXDM49LM8aR2TCsCtbbpTbagVDRC0zZCqM49Msy842LPSXA2E810mYj0mcEHcyLPKC1iLPWHbc87di0JGIfCkEwYTCMnH4irNnCC0nKXTilwfeBHcs5yUXESknCXDS1Su8di63ZUq8oHTQe7H3SNMnTXKS1crWDIe8ayzSq82VInRcoy9pUzKZByxo20DSokm01NQfesryv87Y580o8EDvQSqaQfYfF1SksM2WGS88xU9ChXbVDvE7Rcg08I6Ki3H-CWFi-BKlUgOdDZWlbdSk50+Q42FXUgXEUq8qglKqx00458VNWlBqgJIqKgalRQFq3oj3dKucghIaRq3qnFMqmlaio861J0zw2qwo-89c3CwtCybWbqpqmawlGKq8glLaya-qiq2aikx0iIGq-kuy7iiKuwg6iaxyKa5qyqv0ka1iJqp486pKhi6M5ykLaHECNKJGUMpan64iv6nsblHqxyYGxK0GwilCpA5i2cqE1UpleCllXTA8xFSjMQYPbA8kmy+GmccEdGu5E0gGfjck3G-GxdQmgK8wbagal6jKWdMmh05clA8uQqR64IRkD6mI69byJreqh6yKY6wauautetbVdm+5QIxRUqkTF-QoEotnIGwYVohbISNG3DDG+W1UoIpW7s21NWgG6GigWG-Ik2u-YwKGjWsU4qnIvW8mqWjiqk0Km63YoCuW160ihSqm7GzUkG1MtSs8loi8-2joqjT8pFEOws+U1K0wpU5Q3VVQuQIpDQ0pbQipSwMYwolrFWD5OGAo0UTZLZfoIlEu0dMlOGbWt9ScOGcycujgIQQBEgUwWoAIEwYgGiuJBmlwbVdDEc3U0AE-dgq6wSdEpjc-DWKI2+Eei0vUvvQg9o0amexmdDGQUusKgCsEGQN8x5ZjOeiGhTY1HUsc7e1EqehGqMg+0ANCqOuM-jfMq+h8tM2+n5bgEiteisqmqTeQAzLmH5XK4su+7gZGm3DK1U4A-McbJzUBsEcEWB4gU0xza1N6wKstHGbg0aHer282DhZBnB0aPalwFBqrJzJRAsd+sO0EjIvBges5PtfAH+E6PTQBq9BrWhwymXX+5yNnWubhpK-ePhsKVAlWOqMyu7C-K-K2RkZvE4Eywe1U2uGvC7JLAovGdRhE6FU+tBHky1QOCIRayeraBorJJ+isgxpLH5LhDw2IJK7cSxqBz-JxRmDhmTeHGIjR3uPU9YKR0Fa+tMzmMQFWYIjXcIESIEDgZqcJlcJYGzPGIetBCJq3BExHMegJi-BvZoWJsJuhdR8IAAHmBFCfid7gb2DV83fXBBxXwB1roH7zhVpvO2pCxBuWoFqGaHBFAAAGoa6u4Ph2pmoqE0ndRwgBnTTemBm5NhnZoxmEnC9X0anJw6mllMZiAbJBAqNWnVCaQ9bumxJ+nBn0J5nRmZAPkimTnpmTm5mQ4FnLnhEJhirspDHuCa8J6Yg4DzkmYllsRhGVhHZp8iUdG0YibQwmtm9xnEnbFg1fn0QAXHAvg2H4UAGvHgG385Nmga8lZkqYWG8Ax8WlnsXqR7dfL7wfHTltwlnVEYsU4DBWk8XJGbtzLZHOH5rechDVnxmAtNlyhQBIi6X8IecDIMc0FGRBHUm5DIXTMQW7GdZDGVMuEbbQxIZ7NlWG5hWfI4wkrWk-miAPZKcUaIMTc+CYiPmYiESvm8k28EX-mjW2lXtgXyWwWlnXslrvLMgCW5N4XswDWkWWHUX2WMWwQsXbUcWYi8X1KqXfWewQJ94EmETCXpgcXyXMIqXrRbRaWudtQQwXwmXon2ReZpHcRPGgH3b8ceXPmxIHB+WRBBWdYItyjtWvMxXUDIZJXzahHjXc45XyX1X1GFWgZVW7EbHqJNWgZW3eE9X7XDWxHckVC1DilNCykdCMB87hYkMUM0NdVhMDK1yeL96HBzICMiM+6yGeBt2ts3o2YOBq1MbMMDLRSjNKY8pr2+6WM3dN9zZnR0TtpTTYhtoxxlbVbwiORAOYgOQQO490SEJIP+pSAYO-3wjmYEPmZkPph0SvW2BTScP-RQPYh0SAoblyBfBTSSPZV+8DRCOYh0SG7IOG7uxaOiykGaFVBGUWBDAoj2POPVCVgWP0S+mEPYh9Am7QBfAom8tAMBnqPBPwiXIROYgxPuBJODdAN3I5PYOFPRbIPANCgAQ8sYh3J9P5OSbzdpgVOJOpPQBANIQJOYgzOkHgAlODBxO1PDPbOwkHPQAnOIQABSVzqzjz6T0Afznzvz8EaJkT4LmzwDItyT7TkmnBESGL9zuL0AFLoERLlDkm4poL9L9T0AUpmIHLrD8I4pgEJT2Loryr0ryLnLAr1TjLoz6zpLpBnLKr7gIoGrzzwDTr+r9riEHBVzrzgz1rvBGIEu50XKVAs9ndr9jKdRwEEMBPbabgebm9lQ2b7mzbz935fAFgAAKxMDaYBFW512RANzg4-dQ1NJfcw3XAMj25I226UffcIwW8xNUJifNnRPc1NPcxY5VtY4hEgDoDVCGXI+6-B8h7u2B5VvRN49gEgEg+R8gAR5fyR6oA44AFEEPePcfMe790SAA5cgUn1z8n0nlN21HbqkF7hzedRYpVlblYBPZQA3feZQU5Rn6shdUHRKOb27pn8uFnpLNn6YDnrn8O3pdcK9z7m977p0ZRyLPDMBEXxbolaDHZsQZmAoyDN6RgcUUgPDWaBgI78gXMO3dqTQAczcPnwjG5XSytcQ1TW+OFfXo4IoE18wYCFZctq9Aos-Dx9Fit+37sCPJGPn35MFyQvnpsop0dqPwYGP-jQ7k70wJ-bTBP5nxdTR0dll0tkNit9-DgAQFlvXw7n4QP+RoEf3wgEvoPpRx2RTYwBgH1bq1DUgTZYwV8OgfKZcMgXvqH9aM8VoRkNvuqTvj5aofKRuF8bvkfu7TL1SH+WJrSMhGISjsjiENydyL2DwVVUAGf90Af-gYztyLyU5woHfj5BwKfjv-MBq-QVoY4bnb7YiRia7c0VMcQt-rfoIGECMwWsHAAJGVV-6aRxCkAqKPmQAFc5F+w-VhlD1X5AhwQ6-K2GsS5axA7+e-ffu5BgEQZgBtQIDPgOv5eYX4orFYLgPBD4C3IJ-Z-v3hcyqE6BV-bVnfwrSBAvoEfICEPC+hGIdct8TtoZ2fwP8ho7fGfjwNtTqQBeHUb5K0BUTE8igHWJ-mQA+QKDqQs0cvktz4EKB9AzeHCI3HOCuNWIh-P1G4FUEv85+-AIfj32QHw8rsv2NID5WsH15XsNA-fqNimrsgyAyGTbCQP37RZn4VAosKgQn5AhH+kg1wewI4hUc8B9A4QO1G77Ah-mZ-fKKQLYFc5cBYgrHNP0YGv9jMRQH-m4D-7uwABHrWIAMBAEZA6ouKQge7HqGMA4BhQ6gbEN37ggAAgiUKgHmAqhJAnFGxCoDkAsmxgNAEEIYghD-QHgugQwLUHngaQVmFgawOmbjCDQHA4Zv0D0H9wNh-AhPEIIlYiDbEOQiQfkKwD-gR0MgxYnIJ+gaCQko7LwXkLUGv8LcWgyQDoK4F6CDBOEXNjO0Yiq82cQgQwDZDID995+8CMIZP3EGPCrB5-A2GPg7ZoIfuDwyweoJeHNRtBfBXQfoIcqFCoWPlSGLC3rQREGmxiVQLNEGHMBtIbmAflCJRH98ayNAMbBoP3gEjvhvvd7IYlJFak5wt4YxklWEGqQYkHAYQFSKJFCi4k9ddoHykIA8iqm7ib6NrUERDQUYP0GUeEHLyAI0kb0Q5OAh-hLQZRG3XkVwkVHxxlRDoLUqSBv6yRNREmUBLqOoD6jbwBo+UQWDCRgAJEkIE0UagGhqjQA0sfBHjEICkgNRlCS5gINoQUtuRSgrcBkSDHRjuwoY6hFQG4j7w1R9w9TKmNJDpjRMISbWtEgjBxJKYkQxgfNCQF98AA5DAP0Ag9QAAAHSwCgDCsbyCTLOhkDBBPhDlVTs1zlDQRyx5kJfqw1QZOhixag0sXYIrFViax9YxsbCmbHn5Wx7YrUguF4DLhTkPQPGCuNAAAAveXnWIFAp8qybY0gHoOzBdjtxOEW1H2LEgDjjAlUKCBNHNqAjgRk4SsXOMZgLjjxwXbgOiXIDTMWA0zZQNMxFGTByxToPACOK75lifor4vxIeMXHudvx4RX8c3QAlAT4Q1gK8eCC8hAA')">function unify_match(p1, p2, frame) {
    return frame === "failed"
           ? "failed"
           : equal(p1, p2)
           ? frame
           : is_variable(p1) 
           ? extend_if_possible(p1, p2, frame)
           : is_variable(p2) 
           ? extend_if_possible(p2, p1, frame)  // ***
           : is_pair(p1) && is_pair(p2)
           ? unify_match(tail(p1),
                         tail(p2),
                         unify_match(head(p1),
                                     head(p2),
                                     frame))
           : "failed";
}
</pre></div></div>
    </p></div>

    <div class='permalink'>
<a name='p24' class='permalink'></a><p>
      In unification, as in one-sided pattern matching, we want to accept a
      proposed extension of the frame only if it is consistent with existing
      bindings.  The
      
	
	function
      
      
	
	<kbd>extend_if_possible</kbd>
	
      
      used in unification is the same as the
      
	
	<kbd>extend_if_consistent</kbd>
	
      
      used in pattern matching except for two special checks, marked
      <QUOTE><kbd>***</kbd></QUOTE> in the program below.  In
      the first case, if the variable we are trying to match is not bound, but
      the value we are trying to match it with is itself a (different) variable,
      it is necessary to check to see if the value is bound, and if so, to match
      its value.  If both parties to the match are unbound, we may bind either
      to the other.
    </p></div>

    <div class='permalink'>
<a name='p25' class='permalink'></a><p>
      The second check deals with attempts to bind a variable to a pattern
      that includes that variable.  Such a situation can occur whenever a
      variable is repeated in both patterns.  Consider, for example,
      unifying the two patterns
      
	
	<kbd>list($x, $x)</kbd>
      
      and
      
	
	
	  <kbd>list($y,</kbd>
	  $\langle\textit{expression involving}$
	  <kbd>$y</kbd>$\rangle$<kbd>)</kbd>
	
      
      in a frame where both
      
	
	<kbd>$x</kbd>
      
      and
      
	
	<kbd>$y</kbd>
      
      are unbound.  First
      
	
	<kbd>$x</kbd>
      
      is matched against
      
	
	<kbd>$y</kbd>,
      
      making a binding of
      
	
	<kbd>$x</kbd>
      
      to
      
	
	<kbd>$y</kbd>.
      
      Next, the same
      
	
	<kbd>$x</kbd>
      
      is matched against the given
      
	
	
	  expression involving
	  <kbd>$y</kbd>.
	
      
      Since
      
	
	<kbd>$x</kbd>
      
      is already bound to
      
	
	<kbd>$y</kbd>,
      
      this results in matching
      
	
	<kbd>$y</kbd>
      
      against the
      
	
	
	  expression.
	
      
      If we think of the unifier as finding a set of
      values for the pattern variables that make the patterns the same, then
      these patterns imply instructions to find a
      
	
	<kbd>$y</kbd>
      
      such that
      
	
	<kbd>$y</kbd>
      
      is equal to the expression involving
      
	
	<kbd>$y</kbd>.
      
      There is no general method for solving such equations, so we reject such
      bindings; these cases are recognized by the predicate 
      <kbd>depends_on</kbd>.<a class='superscript' id='footnote-link-1' href='#footnote-1'>[1]</a>
      On the other hand, we do not want to reject attempts
      to bind a variable to itself.  For example, consider unifying
      
	
	<kbd>list($x, $x)</kbd>
      
      and
      
	
	<kbd>list($y, $y)</kbd>.
      
      The second attempt to bind
      
	
	<kbd>$x</kbd>
      
      to
      
	
	<kbd>$y</kbd>
      
      matches
      
	
	<kbd>$y</kbd>
      
      
	
	(the stored value of
	<kbd>$x</kbd>
	)
      against
      
	
	<kbd>$y</kbd>
      
      
	
	(the new value of
	<kbd>$x</kbd>).
      
      This is taken care of by the
      
	
	<kbd>equal</kbd>
      
      clause of
      
	
	<kbd>unify_match</kbd>.
	
      
	
	
        
      <div class='snippet' id='javascript_96_20_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=4&prgrm=PTAEGUEkGEAVQFLlAFgHTpQKCyUB7ABwFMAnAQwBcBLfAOwH1LyAjAG2IBpRCBXS0OToATUAHNilXGABmpfAFtQAYwAW5QpTKgAzKAAUAZ2LKa9XWh2WAlDhm86p2nUGHD+ZfoDWxAJ7dSE3xSYUNrUABvLFAY0EDKXlIXakMGOl42Nn1A5WDQ21jCwoB+UAdhYhlqOmJhaKKigC5QYgBHXnIsn39QVWJyYX0+geygkLDrAoaS3v7BnLyw+umY5vI3D28-bmZqLIXxyYBuLABfOwcncwVyHyZWDn1wqMLcukMBNg9O+-ZiUAAvKA2ClKPoAEQAKmYf0h4OsJ0K9kcZhcX3wXl4hC2vgYAEZuN0GAAmZ7LIpvD6gQy8FgwjiA1zuTxEgmgXZZL7KH704jHcmFagyAwpBjlSrVWpGWm8yaRAXTeKJFziqo1YSI6anFpsYzylavehUg6iIHrZk4kk7ch7aV0h58hEKhpKpKgUWqyXzMbCKYGlalT3q53+1bsm37H1OlbnQqx2LIq7Jd5kMGswl+K2gABunV4fP100pAhp9r+jPNm3T4dtXJ5Dv5KyFItSQalpdlZND1Mk91r3zYvw4nBD3Z4NtI+hBH0tbMIE8txO4ubY+cmI7HY45U4HQ8d0a1Or1L1DxbiPorGxZmaXNayHYbB-9zf0HpEEvVo1yITlJ8KAEgVmMSg+3vGUHRHQDNxWedqEnWDJyJW8VzXDdoM3bcHz+SYnSgmJtWIXV-j-MdgNAr88mXPM+U1f14waejQEYxNUVAYQUnnSg1H0BQu0VSRlVAJQARE0BwXRTFCHBUcGlKCSsRkpohMBUTwWqYxSEoaToNKdTU0UwpmjIeRJwUbhwQcLw6HwAB3FwiDIKhnFAABaFzwz+eFaKY8lXRcdjDE4tQTnOLAzwcihUT3RkbjuXknhOM8JAEIEIqc+g9wheSpKdM8+BSggSEi5xMrUlNNK8i4UWc2LiAYFhqnYugxH0XNSGoCCc2oviYj88c4Na8h2s6lCaLOLAWOchqRGqMQGDajq-n0aamrEHrzwSN1hkGFbZqdc5JvMXbmvm6jlsavbC16gS3W3Y61pCibLlY+6GGqBg5HIBRiEG4a-m4T7vvWvrK08BbOsBsaDue5ziAADy0ERfsW4cutXLhQEh4GbpcBCeNuOr7uRkbuoBiggcep7qvMUVmDECRhAYacwVyBRCHoYg6EoHY+nuNaro2wTRTx1n2ZqLnwgAMkl2YRlFjmJZUoFKF5unKcO5JUjoL6fvl8XKGxzbNb5hmmdBfQ9c57mxO177KtCjW2OIEgRFSeh9HhwhAjcZwqL+1GsYFx3KECOqbM6LwPfWwVhVfVJwaWx0BabWO2g6LIE9RpOSO7PqQ-zbyYyPYiDMNd4BBYRlXveyGPbJnWnzHPq3wqNUpRYP10JmGROmMUv-WaEPiDDiPzpmk7RuWxtQ3Of8CKI5P+KN91Ujxgt+6KUoh5HthI+2qPwgAH0P9lQ4YcPd-0bdHQ3wzMd74hC9iRjGLzs+L8jz3vcMZx9pwPANaGExvIJQUA4CIGQOgPEaA8RVSTC0FCVBdaKDFlbbgnNsw9WbqkEEWgKBZEthLGSclqB4J+JPQhBsZLNFFLbZBbMFZUP9HJfAGIsQMEML4BQLB8CDknpw7hvCGD4BkGkHWFsUGMOsOgugmDqErwYBoQgIJuSogkQw-WndZKCEIMo3wHtEFaH0BrBgX9iA+3dpQ6RLRZHSNvjEZmwjRGjUMPoIac0zEWPeOo1BEsZGYK0UpUUaVKDBAYKzaa6U6A+KkcQhBeYkH6BCWEiJ1QolMHwIo3RKiokxM0f4wJd9RRvHYqiToeSraFNiKUYgK5wn0FKc4cplCCnyNFGwL6LBhDkFMXDL25if6WMkZouJtUPow3dh07h3SGDznJpIMgHCuE8N1BUvx9iDRTK6T0nhwh9FWNaQPBRxh2ic2UPQ3xTCDQ1LqSc-Mjgfp3LOXVD4SDvpc1cQcmxcijminYB4SOVi4m1J+P85QgLhloO+VUsMoo-IcOYFod5LNIVEOYfEwc8LXlIqtms62GCYWgBoakExFRlAdOKkMjRlS8KgGBYYn6pKTCDlCfU8uQgQJkoIaig2hyDTEoYFyoauSgXopBYOIVlLoktOhW01I5pqBiDoMivFhKbk-AVUqlVMqCXyOMsEPF5lLLWTstSXwXNyBw1cu5cVHQtD2zgaxJRbB9HIm4O4sIV0XzC3agoUh1Bsx1Q1sYhwv4FQg2ybiL21A-U0EDeM6m0S3WCFIGIMItF556m9akeW5QE1JhDXQMNDQzzewyAVW1iSTG7NdaGtCXdQzw0RozDBcF6Aqo2ehExcydZ4NcciOxDb0IevrUO7sJjW3yGVbigd09CjYIYPCyeZa2BXNDKUJd1E2WIzBCutdRy2wamWJmkuDR9WTmTRZOgVlbIuGDr4Eg1qdF6Mqs-caVN4GOJEaddGrjPaGAKcnPqNxsTuMBAAPgxXan67iCnoL6em99jtxVssafQZpPLAMkQXfnFW+jK1GJKf69Dg5+nsVURcqRBTCWgHVauRJRGymDkpGnXFXzdWhiMgyiRM0mOKNXWQbWcbKP5OherCZLgUNPIeUYSgChKAAehQLbNpi2aUFxNJ85sn5MTEXtdZeh7vInvdLHdp6wQLYuICqj4Oni1L0EgRxlcEPgIrebimzCnpEEqM8XPTKgjQCCqKQFzHmf35kZAZRzxjnMWcRVZ9zcnPOcG8yGFTm70bReC7F+TYXs4GT6kFkLiXctP3wr5nO9m3RSdYzJ2+3tYtuY+dppLKWYzknOA7CTwJQROLFNrH2Sr2zLN4Z67DOMhIaCMMNtgEGxKQgcJq9UcJuACJWYhzribqTckYPgfggrmXCtRJ8nlhshapE0yJypilSjkGUMoXgCgMiJPsUozmwhR1jnSJkD73YQNGG28IvbkqokAc7TEC7rmcVNasZMRSArgdqNFei5m+gEclVW7w1VNHmhfbYOJzbKGwUQupVzLD5Izw1qrlyLw9V8B7NVd5M8dZdSMkMAD3bnKDtStcTWxuZ4FsDfVEAoEX7REC5-oNwYzPEPzvG1Fmt8Hm2mNkW26dXMdzcl1D9sdQ7xeKqF9wMHOvCgEr-h+1iKGsVxe1ZhpTY3l5jPS-mfQG8ovws8YM6VJ3qP4-gShxbNuSf4tsQLM8o1GRRYD1bXLvT+leNVQU7yi2lmCL4WdKPXMU8rIT2jfMiffLjdGr7i3dS0dUsuWTwoyeMdp4y2XxgNec9G9iFF+vMePfOAT83xttjtdd1a7EPqhn30AIk0AuQigIAwHgEgVAMC0DEkdc5dppDHLcqD6dt0tNyD01qGbGcMrxKr-wQ6x2uC1+5dVZEQoBfl7723DD4vNUCZiO+lN1Pm+0Tm3BHQ8EK3ptm6Ow169Z0JX726CT34RhY5P40zyqC6B6XKf4KJ0ymwo6H4Z5aR-yOwYFZ6Y5WICx9SQG2hEHr6IE4SPTYHwHR6jSx7fyd74HgFbRzBXxQEP4nb8gbbwKij15gG35nYmx75oG27gjFgcr7bkqHbODwigDHyKTb676MxCFB7mSZx1T17SGyGhjyGoHmyH5MoSFSoOrm7ORt6N4MHLB9TAHfqgEkFY5YFdZt40Ed7l5SJXSEHMHbhsEb4cFL7XAv6iGZ48F0JUToy0EDK-wEHjYo4iEBZiHqHcDBG551TOFFowHGxbIzIpG8GD7jbaGCG6HCEZE9IpGn5dZFGzLCrfR4K4GrLmE5EO6TZWGiKJG2Ew72GbblE1rZH6YQEeGsFQFtFpETZ3DlFZE9pVFkCKa86RHLzRGjF9J0H0B-7jjzJ9rcC85DGij6EUoionaRC0p8Fb6pAoH5EH7CHbGSFLHtHwIXFSqv6XaKyMFf4uaBAyCGqgB4jXGsS3HpLjELLBbdE9FuiOKvHvGkgUFdY-FRRdF1H1GCQgmVDvE6BfHOTbEZJsqvKBHMqAmCxuhjIBGc4GG5IbxQklSgEHIbxjLzFx6e4u5DqkkZR-F9pd70kSbiE7HQl077LsGAFdZwo4yQ7xbq6wm4nGwnGKEFHKFiRW6NaYEQmbbu4LHhEuGaJuHjatHsGbE5oNLEbaykGuFPHIE746FnFSkxG8ZNKDglFHyHxyHHHGmnEopmmMaWmCnIqlGbYukkazKBDkYMZ7F-h9QIlvEyqfHynwJel6kYk1ZOmIFqmzE9agkyrgnjSOyRkaoCZJBOSBqAlBmJmIkyrIlakcI1ZaYeZYK5H2kKH75ggebmQXYenwIQ6WbIquLlnX4xAWHql9G2jlkonmCFYNZQ61mJajZdl37MEebrbGHmD1ZulWxtmjkVnLyYRLnhmsSihWaaAaalmPJLnxn8G47NbTmOxmZFaynHnLmHkZBZCrm2a8mbZ-LU44k4YOkSmmkV5iRE6NkvTU60704imimyyDBeFkHrnP53BE6yaylIHRHfkrbW6VLFnJKkD1LcJpKI4BkHGy7LxvhDS4goVoWRKYUb4yG2laGpCRKkAEVFRUApKKDEX0EnbgWwF9b4XCK0WhKoWpJCZMWkURDYVwlHECHvmxmMJGrazUUcWORcVEUYVSH9nGxUU0UyX0XoW8UqmVL7E344X8Hik1nvHgjKXSWRRqWMVXEsX2ScVhJmEBmHHPEgRJm25hmpmQkxYmVCCDCAV5kvEFm24pnQybbGAlIeVIzeVRH5khm25FlIZdZjLOrUCqKd4TpKleLuqpoPbR4pFjm6XAnf4JVJVLEAxskpHpViCZWZ7ZUPnwKEU8XpKsoFW7H8Xk4BaFSqWkCMiEW2Ub7eQLoLZSW1UMXyWaVororxXZKJW5JjKgEoWDrG7TAo6DmhVeU8lw7DF1SNVqLTXiKzV97G6LXuVpRhXe7d7djBUNLLV2HFmbV8VxmBmVkiUGXoETWFV0A-moklWpW0kinuEjCgVSKKUpoeJfXODHbNVCUuC2H-WaI+HSCYxj7AKT5gIz6QLz46C+FimkD8CqD6JwxIF-KsIcBCD6B410rrqgBwxrXnok3mQ8K8L9CSZ9ImBaDvbnjnIBq1BGGOxjLBpMmTHrFcmV4Q3dYzgxEMJ5oax-63x83BYC17L56BVcHani0iD5pqIyD41VkmlggyDmS5qq2S2A3dqVH-H9qwWRXGLcAuWK3fFsldEa0zHwkW262gABUzl3olUq5ToqoO2GnBmW26DVWsSO4CkUL0A7rm2i1O7EDLFvAR2WUKLR2DToya2PUo6jTmTR3vWzmh1bpx24qjRIG2GF1B2wyOBfA-wnSTrtq4oEqO23RQEpY22onuW1x12Gn7xN1hStUqzJFqa4jV1q4FS44nDu3rUfTzLv5rYhH5g5XC14w16KYuJG3zI1H9rzLPA6XC37xYwJ2Qy5br0Nwdmdm5UuDbi72xUE4IxvbK7Ziq7WbTZL29zrHrDJEh5+2cxiAqxT0jbhAiQi6f3f0rhLDk14w82T2L0hFhAv3GC33Y7AiAOqA-26jhAAA8CDzUQDvcNGNSpAJkEIoS+AE2dAvgQNFVCm1IWIyi1AtQzQ4IoAAA1GTQ2h8O1M1EKPooveEEw8sfQ0w52qw7NBw8nRMFTXgwauCIQ5jMQDZGQ62ZQxNbQ2JIw8w13II+wzIJw4-dw2JOZCowIyHEI5oyI7DWfqwpJDUZfjXkLTEMhrIkzKwtiO3SGEAdtsg0-Sg35qfQokeVw52jUvY+iE4+XfgJXR4l7TXerqbp2s0DXkrMBe4zRgGAk8A0k9MLE245hNo9aLaKk43HGKlqnLIvE73aptubfffVpRVmeuI5ONY2JA4DwuUKAL-vk8-OVgZGeJDIyEtW3bYqVkUJYW4-vYvcYhvXtdBPvS4mMw3G0-hO1vZd8g40QB7P05ffAtXtNlY9NiETY-DQToE446s5gn5q48TZA2jHPf6Aur49o-40s0E6s+SqE7NBU97bXbYmkw0LE9NvE-vH40OqUGRPvMAyEV80pGzsTVk6ntA3eCY3M0xKo0UC+BgiU7zFuepm85EwbF4y3rU8gxJU0yIC0zrE+hga+oeIRMeJ061d00CL05PQPtc+NpC0mqvaM1jBM5uFM9RIfUDAiy-Isxgss8E5gpTKPomuPiAlPuArPlAhgBjQotGrGhzWrclaGgecJfpYtQ4OZMq-6oGtnbjL6ga3VDGsokKYiuq0Wpq5DT2VkLOpTHlCa8Jmq0aIyCjs6NEdtMsbENtGOHNUUNERyL6zEByAG9rtEQhKG-1B1d2IG4UHMaCDG8zBG169-rQjecsZm5kP6Am7ENEQFMouQL4MsUWx0qQwaPmw4t-ueqG+evG5G9-jcCrIoiwIYH-i26oG20AisNWyLWCOCAwzG7EDTaAL4H-ZBlakw5W-29ES5COzEGOxO7Nlau5LO026LS5P1aW9wDEFaoUACJBjEO5Ae3O9-sttMMu5OxTaAJCOOzEOe6LcAIuwYHDNwCu0e7e2ABu+m6LQAKSvvXurugD-sPugBPuDv-0jvAdftWr-3juQcQgACEIkMH77iHIHqHQIE7m7g7qDQHGHn7U7oA6DMQuHf7+HAIi7sHJHqDQIiHeHEI4GhHH7N7Vqx7jHlHzH1He7hQtHt74GDHFHC13+yHr7t7h7nHyHsQeNzouUrV+rrrJii9gIIYf2203ASnqrgCCn5cPALrOnbJ+ALAAAVszcLup5NsiLNlG4Z4a9wLYbOv20UNp-Grp6Pc6zGqaxicwB8h6+bNEYessYei5-NTW6LZAHQGqKQruzEFFzF+pmF+F9EV2wwLAJAKG2lxl8l-Nal1QN2wAKIxtpeFe5f7Xf4ABy5AlXr71XlX4LXcenVIbndUBJa9anKwf2ygs2+8yg1irXvnHKiGXnKr8a7XLinX0w3XvX9rFs64Bn3nrrBJiGY9zqUa9nQaEmhaZVzMSB63b0jA4opALqrzpn5AuYbO7UmgdJ0Eg35rHAyKuSA6XLRQ7ie3RwRQ6zrEwE7Cg9KqSBTaN9-3uKG8r2SMg3Knj9huxug37XXDr3sQ4PgwkPxnZnFnMPOucPsRmey9iPYb6L-dWLQ9ZuHAAgpTYgXwLAPwIPXMrOAkhAxPAPo9jscysDpyUlgapAPCxgr4dA+Uy4ZAPPsX60Z4rQjIbPdUHP+i1Q+UjcL4XPwv6moA2HYkP8HAXM0h1TbEHEFbEIbk7kXsHgAyoA0v7o-P-AJ7bkXkSLhQ5bJb+gDgkvDA0v+grQxwiLVLxEjEKm5oqYne7v0cSPwgjMWNHAwiqFfvmkneUfnJ9OgfAzCvQvLzyvqv4I6vVsWvBk9v+i4IBvbkTI-v5gAwFQog+f1vCInvC8EQL8HTKwOf+v5fpv+Y1F54NIq6QC5fFfAzOfCKgQX0t3-orD-QCgDAf2t8dL4GYOTvQ07PLf+ip16kfnNAiSrQ9c-L+PMQjmLv8-bvK2s0ZPGUw-A-uOOEjcHWirRv5ybgO-ZAMvFv1sivKfK7JEKmR5sv-AdmDQDfefBfBGwQ7IMgH6iEy1BrUC7c-nXyLCtVxeQIZ3q7w-4Gwe+uvB3r-wL7CB2oXPYEI43N75QwB3fEMA3xn7BYpeu-BPoUxbCKI3ARfaJIH1xYxAS+i6DIHVDCSx8Y+VA6PhlC6JkDuwP-AAILsCnUIfUAaEjYhUByAoAansYDQAUsGIkA-0D-y77N87+bfctJ3y768MZBBoXvsfwUCD9QwOgsfpNgn7zIIMGyIgXPzv4u5-wtKJfhyg6hGI1+wCWZpvygxIJb+1FPftSAP6SAj+Q8E-jeTP4DNBWjEMektSECGAbIZAPnnL1DzQCJes-EgZYIQF85aW8yYXK4K0DuD9EjgsJofwbx+DdBp-RuDcxvIzNvoIDdFD-iIYts1As0UQcwG0gHp+eCQrIXz0xIr8HBjnZgpDAmCl1zAQPVWkKFmShMf4S0VQjPQxiBwSIFOC6M1CrizC5oNcSeuMKcEUxyQL4GTi3A-DtwFhX-QZuNgcAcNDBXEJBq9Enj3RrEp1QoBnVWE0QkWxmFTKoWTprhN66EPAJCA+EhgZh48MQPMJ+GHcJ64iG4RfRWB9RNhrYd8G3B2i7CN4gYOgEcJqFINxhVwwoGcLOgXCXBY4LGBvCMjX0kYKw4ERvR8xe8TMBgCoC7FCDCJokNwlYVjE3rvDPhoI8bOCB7h7BOaxI6viGD6gDDBgBI6iOvzGgFNQocA+fvNGT688AA5LH30DhdYgAAHSwBh8YMuiG+qyhkDBBChN5D9mxzlDQQJRKhcUTHSdAii7+Yo7nqEx+hSiBBMo2UaAAVFKi3EKo1WmqI1H6A8YvAZcNYh6DujuAAALwW52iBQyPdEuqNIC6Dsw2o0AP6N1Fdx9RYkJ-sYEqhQQJo7lcIZEMnBSinRjMF0WGOXbcBoi5AXhiwF4bKBeGwgeENYAlFOg8AJoznoaP0CZiKRIY10UR3zH5UixJYssRWLjHggvIQAA')">function extend_if_possible(variable, value, frame) {
    const binding = binding_in_frame(variable, frame);
    if (! is_undefined(binding)) {
        return unify_match(binding_value(binding), 
                            value, frame); 
    } else if (is_variable(value)) {                 // ***
        const binding = binding_in_frame(value, frame);
        return ! is_undefined(binding)
               ? unify_match(variable,
                             binding_value(binding),
                             frame)
               : extend(variable, value, frame);
    } else if (depends_on(value, variable, frame)) { // ***
        return "failed";
    } else {
        return extend(variable, value, frame);
    }
}
</pre></div></div>
    </p></div>

    <div class='permalink'>
<a name='p26' class='permalink'></a><p>
      
	
	The function <kbd>depends_on</kbd>
	
      
      is a predicate that tests whether an expression proposed to be the value
      of a pattern variable depends on the variable. This must be done relative
      to the current frame because the expression may contain occurrences of a
      variable that already has a value that depends on our test variable.
      The structure of
      
	
	<kbd>depends_on</kbd>
      
      is a simple recursive tree walk in which we substitute for the values of
      variables whenever necessary.
      <div class='snippet' id='javascript_96_21_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=4&prgrm=PTAEGUEkGEAVQFLlAFgHTpQKCwMwK4B2AxgC4CWA9oaOQM4D6pAhgOasCmAJgwDb2kAFMUoBbAA7UOhUgBpQpABYcmbAJSgA3llC7QAJw6l8+mvQbjm5fcLGTC00hoBkz0MuZdbEqTI0BeQIVlVVYAbiwAXxwCEgpqWkZCZlEOb3tHDW09AyMTM0YWdm4+AXTfOVAAImTUqrUI6KwQUEpxDn1meMJVACNeDnlxfFJQZkIuUE5SZrBcfTFQYkVmcVIO0ABmUEE6DjIqGk20Y821GKIDhOY6OkpiQQBrDgBPeUMRfS46LJ09Q2MpkSDEI+F4vEEH0oXx+fxy8IA-KAiFwOLhyA4uHD4XoAFygDgAR3wzAhzze7g4nkEHi8UJhakZ2JxoCRtMh+2h33OLJy+Judwe5PkLHIEPp3IaUQucUOoFEzGefQGgl+OREhDoo1491Jyo4oH8oH4WsEVQAVCx+hxzfUIjlYlcaDrKI98OInq8GABGeTkhgAJjVLI1WtAdHwvStA0NY1u909Lx9IqsEJ1xD10Y4jPtLPIuB25hRaIx3F2kazjK0zJZAPyyImJcxuZxkQJvD21d56uoYYlsYFCf9AZTYvLUeY1pzNZxdaBRcb6MxHM+XB53e7SOLS+4M43unxovFnK+Ut50RyF70ju6tE1HSE-t9oGH8gAbqT8NmuyHe6MIxO1oDvGQpes+R6COmmaTgM068vmhaMNupZeABlbBhueykKoY5Qbw+qyHu+66JY1iQWUT5DFYNivqAH68F+jKEcRLEKKmkG6vh6FniybYcB2BrZPuoajP2RqDqBSYjmxY5oTB2Y8RuCGCAuqI7nSJ5rhhegAJC8lhOEQnJ1qEXprG8qRNiWYmgbvp+2bMeZrEQcZsHTmZuh8QJP6sQZEESnZDHZi23ZXq22JhaAN5ylw9CWKQyyCKI2k5HONCiIaQRVC6briFURE4kiOXugV8L4hlgRGlUGJ7PopD5eZSI1Q+pV8gS+gLDYojyFURCPIQlAAO40G0HRdHKAC0E1sdadoRdiaWgLFdDxcsjQ4CJrTtJ03T6rGCpKlmqoRJt0yxqNO2HPqZrFXlUqbcMoxGhd43UNd1X3nVc14Jct4HSovQYrFhCsIIH76OQ8mBYxPm5ICNDWeDkMmXR9lStE0UJIDEwYqwDBI-JgjY8DrDaYt7LE7j6M-bKWNA7j+P2UT9Mg2TeRAhBlOs+tmM0FzeMYgw8wpGkBMo8LqRs-DcaCmDzAQ1DUWdJLPO-XKHAAB7rBMcsKyj9FfvIEvfkJuiLdZ-0MPzuvIwM0MOUrIvU7MUVq72SuLFAcCIMg6Demg3oyk6BIG10aQiD4DgyPI0hvhhi3mPw6ydBCEcZH4BVFeQyd6gb4d2BU668vi5i1PnkeZJnxqUK67oMHQLyiL0lD4XnuyN83+GULgIIi+UUdODHhBxwVJeMKs4j8Bm3T95XG5IhPvAvIIHCh+sgi8wwmviIYtyHLPfhD3HjlOSa2Hd4zQV0II8t49vu90Ic19p4XR9MhuY8MC9pDQgwEfY69QgB8nBV1Xp+MOghv6-3-hiQBTBKAMEXuQae+8X4DzUG-UewINSxW6KSYBRcWRIjAfhHB2dDj4LQY4TBH9gS8BSL0LgzAt4ax3hwPe1ACFV0trzSCDCmEWHliLZO9cO4t2fgXdBJ8nIsnoU3ARzcuDLyoYfAkw9CE4k-nsYk0hiDl3TiA+eIc9TaK-CQNIpjdEqC1GHVIMgJEV1UbHDRZVgT9HuI8LhRiSFW3TJ4lRlRnFYPMGleuLB1h2KEAElxORiH0QYKEmxETHDAJod2T+m9UTEHoZdTh0SPKgFAWvNImT9hcQQSJcY2Esmp0kZkNJxdgQ1KETPaJRS9TNNyUAgJDSWSfwFOQVghBIleM3MY-CAyhkjJ6WoketCOidVSdUPqA1hrhheDIZgGtQBTXGSSdYc0mi8zGOISey9YjyFvj8HyylzA73IKIchb4VC8NiFWU2-x2Y0EXkme5jyKDPKFm7IBFyxj6FYD8FsXlOy3MYC-FEQLaYgqIO8msm1d5giensiBm9FHnJRdImR3ZNbax4LHaw1ARmtSJQ6YFgjlZGA6NfN5hKaUbiuaytlvJN7koWMMlJby4LwgTowUJbcMW8EMcRJEYr7J-2oNrIQEqpX7nxMhZscJoWCRrAs6EG8iA9RWUNGgxzSAvHaDs6aPy5p6GiEc4FxoBBfx7nna+286Bv1hnDesCoPS30NAAPmxevW+b8Y6sMhdKGmwcfFkLwbUxxgT1GwxFUwfQIxFDLxIfs-OON40WEMLFae+jX6zPft44ptg80UNIb2IkZiol1Kceo0q+Js0QLjTWxBkqOjJABSWqRZb1rRtvD4yx5jdikFEKQD1ZbYawq3hIM19d61WMndOn4KVPnS3VdwEKWraAFhUowehWowm2JSVqDdqLeSLXbevdE+gz1JI4CMq9M6MHOP3e2TsHyeyalGI+59U7sJ51jK1e9JTrDAYvTIddH7ZBfr3Au2VQUN7Qewu+y+jEt2zi+VFDDYTp3YY4CFS8P7tXETvfE8dejBDUs+TB5J9j4M-EQ+osjtr5r2qRY6s9F8iCTOXA3Ju4ipY+tWO3UTvBA3VHNIJveQzuC2nkCJzukaePBzoBmHolARgME6YAhxBjxPzkYLRgdc8jHMGIMQfAogwQQIY3oCe0guCco3KCcEHnuy+t2Dpr++nDPdA9c5nEFnz3MZnQQ8t6SmllJaagptKreRZ1NMFq6amW4xdbaALzvBh3HJ8e44g-jkueo+ZtPFsYSuPCtpQJRBCQqbTwnQWM2nxiBeqQlrp188WKSWH+BsQnuBtaNGfZ1DAFOPyU14VrA3qPgPXni8NpKt7DwpfyuDrWfNcvMtNwZmJZ1hb2yyZxzsivxMSeE19KSZnOJTfhy2qGvz0fMpBjk8MWFsI4d05LGCy0XYdT4oT0zytzsq0NsDRoPug8cCR77D8kuJoB0hnIQnRHSZIzfRTW3MNiITSZ+2b8QqLTzoV4H8SMt5PBw9j5GOsutyZtTnojOCHyBO2dytLOEf33YY-GnKPduneccLliaPt31l3VwYdLReZtfmJ7GA8AkCoADmgAMQdbyJ2zmNQnhdHvS3MEUTgPAz5LOyrrlOhyR1yiTnr7H0StA5AWvh9kEFolA945bMuUnO6medGUGoIsqiqYJ17rTBPJu+6dx88mVIvAe-+xH7X49cdg5R4b+sxu2Cm9KKaGZVQ4cyBt8c4v+PpMEKz0Cd37Fa9jk99ODGDry+89YUjwXJnq80HrxCJPKOm9a7lOYFnVe4-4Zz8UM3ZRC+VJkAZnrgD6igAAD4r9KpPvP5vC9iwGAv7JiXqDL7XxvwoueSjb-B1UUpB+uk29twkHnbPY9wkWoz6Pfde8xepscnnedEf87I5d6mzx7UgQT94maD4P7pSKgqBz7da36AKCBlz2wAG-YB58ZCBVDwH745JL7yAoGoxBRoEC6EAp7D4nr8LMJ86-Zj6v4T5n5T756NqJo9RyKMLUHt6AFH4-4OrsECKWAMoiKM7GYG4gFPaSbv4XyEFf6N6qy8b8HMJ4p0GS414J6CDgHsRyFRrHKWyKEkH7yCHCJMryD9bd6YE3RUEGFH5URCEmGgD9YU68bmA354GtL-ZaAFKu5G6MFb4z5X6uGH6ECl4OqBFdK9ypAqGqGB5nqGC4BLLei8G8ZhFwJGGpDJyiHoLmETZxFLJBjyHBwpG7TKEv6pT4Y5FohLJnAFG3iuHwLyoAZVK4FRFmwSFKg4Gj7OZFFXQx7-Zi56B6FWE0GkFvZErdFvRpGMpPrs6c6uxIq4FBH1aNbaGaap4JJfKRa3ZwalGtE+GhB+EF5X7Xawb1RJHByhLDFAFiH0HSyyHJ5OHBzmCdrUCUIeHj57Em4X7+GsHVDPHJD4SXE8Gr7r77ib5fGHE-HYHUC4JdovqRIhG8Z-F6hsJFodpvE3H1gVHxEzKJE1FyhIm1r3g6LbHonRGYHrHYng75HSjHIEndrJx9rkDPItGLRYlVHkEJDmAWbwbxwMH7HglCDvo9QWYIlaarrmKbGRLXzvpZB6AYlqFgHsQylnG1GEZwmXogbXLiG3HqHvoabQG5BMZbHRZ6m8nSwuSakqkUGLprBJjcmmk+Spr5asZWmcmUFGlvqWmOl8nOkWnXockFC+IeItHepmb8nT4QkGI9S1aim3i1ZLHKKklkl3ED54kJCWy1aTonEYHm5VAxmqY3aRIBnAhQL6DypNywLuGZ6aBeFlF7GCb6BJilnlkAJVld4n6gmMAAKNlfzbRdDQJiCtlXHoJpmBkNlNl9k-xlkwKMmd5iG1lklgkRksFRnLLJA9nNkzlL6umBndkTljRTktmVnDmZCeEu51nZ6+ECkW57m9kHkDkVmznBE7lbT3llnP5Jm7GYlOq5E4kvlAbnx9k6w7FflAhskzLUnN68Z7A4J3mdDAWfmhkxHYS-ng7VE6EOqWxIIoKcI8pcG-aXLgr2bw6Amag5lB7YX4FzFOjWGECEWsDEXz6kX6kGmbmDnHlvQ-yIKnJTxIEgWDYAavk7TQjnSTm-wfko6k58njlwX9nTnsVPmjJjJYU8XIJIE+59ylkYKzH7jm4AWyUIUD4xJtQqWTxqUzwaWRFaX9EyJ6WEYvSGVE46XmQwXQkGVeArFD5uncVmU4V-bVnymBmfHLkW6UXdCxlyh4U-YjEgWgGJ5aH3E0kt7gq0WZGnnan1hf4QGFxQFy7AoK4LAZRewq6+zq6bBeVBXppKDLwawYHmDNwtxUhAK1WFL7hIgay5a6o2AazRk1wDDjAEisL7DrDua5B6JMncD366GwGIpOiCCTEZGmENYUh07eHfmmhQk+AIq8yh5hYLX2ErZDpJXOFwoFzbXAobx1VXkhW4A9TwoTCzXhX-l0r7XTG4DkWxGVG3WgC4nHWFF0rKHvXZE-lfXyCQUGk8obZ8ojJA3vHrUoWg1bDFnPYbFtwaiKofVYEvYcCh4CUY2jnAjY1yxBRXXhnMHE2GzVDY0RUJDY0NGKoU0mxrUKnxVjh5xQFFYkA6iPwgzrZvibYjKrUXkczsRIZQWFGEbGwrzJpw0s3S1xzrSbRKAqCvq2l80C2OCxj5YRAGk8IMp+7iL2xanM0IzUQG0dhG3-kMqY7qYbwMqylynC097qHGxW0iwkbMr23O6O1kkQSu0PGjpaxubq3Q2XoE6zr0Szq9A3Aq0y0m3GjSCsBKDm3XKVQJ0gzJ2R3GV6BIgWwzVS0iGBRsYOEx183Z0Hjp1J2KAp0aAAA8ldmdpIsIbV7UiyVQP8lA8o4wLwYKDFUp4Y7oZl3A+IVQoAAA1K1USlqBDCDPmMvCIRoBPbjaPRPbMdPbjHPcTZup1R1Hqu3TXFFBwINL3YxTOgPapcPdUOPZPTIuvbPbgPPeHYvdUD1NfWvaQDPawJvVncWbdDbS3NjozhVtiJzW+HwDXB6ELSyMch1kAoXUQcbVRj6WCEZE-bMcQsPOA20NLdkpQDzXfFDZSikudrMfiIzplEaOyAveg5SNSFnaQ+GDphoUqU-aOBCD-Zxp5MhkerHBQ8ECrUukmLykQ34F6mdrvTYEA2uc3CiHliHgNuRvxL+q1JtMbLGPpVLRLhuG-kw8bP-R2HbU7DZRuHo66oY5LAo1xpePHbHFg5AxxhhbxgzlHm3FI-RMA7SrxrYy6PY3HGI7oDA0w-A1nf48Ksg+CDXTQ94xAzg9zQzMI3jvLbFk5GQwTnw1Q2gzSkiAZOyJHYFOXXFrA8w7JKwzJOw03UKq2DffCMpLw2ncrTacugk0WaEzkF1ebYaoQDIxMHI6kJajLIdvCZY55BRq03oKowyuo5LfrVo92Do+MOY9YuHYs9pado7KkB7Ss8M6AJFJFHepgz40k7LnMPlR7EVcrj7Grv7NgAaXchDP8hNY9fvG8t6R8efjdQatUH8k8jjS+d8-2gwA8pPMaUgS8xlXLX7Sis7A9Pcz808+7ONmUDOLmbSLjXoLSCxKsziLmUeGi7oEeJi5yrmZZHi6AJZIS8i0HmfKS2fBS7IkHqXCg7jYy+CBuFi-CLmctJPMwC8LjVy-Qj3d2OyzkLmV1Xi11cRMK3oLmQqEoIgr0HQKHrK4oPK21ryFK7oLmWPaS3oIID1aAC8AEEGtshPYKxqxYVUBNDq7oHq-IIa7JtstNGa0S0HhNOOXi9sjkP4EGroNNJ6+a7mSpiyLawa0a6ANsuaAa7oAG0HsANazsPq-a96+G6AGAM65SxtQAKTxshtJvGugCZtRugAxsbWVQ6u5thvbJp2GsusbUACEgQ5biblboADbRoNbGbWBtdObzbDroA9dugHb9LG1td-g1rFbfbo7g7JbWBAaPbdrLbProbtbs7Y78g8IE7yb2yAaRoy7nbZodb8bKbXrS7dbegtVM490Q2-zjzm8Ihhoe4fmtIQwsLAL8uV7glN7gKm8lAvQAAVsNWNo+5JrELJsS6+xNbjV-oKua-CF+y8vlVKFgDCw8nC-AWNhYbmdLrjdLrB2sxa5AIQEuNnLy+u4R8R2anh2szK10Cq7AJAHi8qwwPR1R6djR3KwAKKktMccesd7a5kAByzAAn8bQnAnBTXKH7YY8HDRNi8+97-gwHHoxAsm7IxAAOMn6HUnowmnf4TRrqD7vIfmKnybshTEZLEHgKWnOtZePFvylnCHSK+qdFvdZ8GBPygLPQxY+gS8DMf7zAH42mEMawoxrEMnQLAwkSoLBKYWt8bnYQ8IjjYpxg4gIdIjQgGBJKwdzTKSzmrmOsMnd74dHOe2unjR8nrDeXpybm81Dn8Lum-7gHJXXKZXcnoG9kbGzmDTqtTThDeOzsAwowDTrAOo0dAJfXkS7WeQqXOXcGSHxyghewDAOiPZzy+gzcewKkhAj074HQG3JH2km0hIsYi3KgK3y8GIj0A2yka3+3ZqrbWUj8AwJeuGS0cUArZoU000O89w-OoA53d4j0vrU0do1TOQ-LPLggRAp3y3X4jZgghIOYOzozmgkUC6AoD4+8iPr3ngPA6ae+v8GPdU+8RPxRy1CPlTNTR6t3eDJHD3VUT3jgy+f6LIEPy8lrX3VqtwmP1wXAqIkwnPIPDQyPSjgkuzKPe4bPn3gv-3cPPdyqbWgvQvnDb3K0ArYShgKQoX3Y09VIogDAfmYWaj3rOl0P8sS3532vbKNULAMgkM68hIRs9tfHbTxSsPHQy8jv4YuMg3b0uvWv+WjIlPdqFVFnv3tw7v8Pl3Iwu363tPlH86R6LLEI0fTgr3UvHP0096Ilycjyfa3AlqVrA2B6LPugR3J35vZ3cvW3V3KvGfnPS0EMa31cbQgPIwhfyvkv73kPZvT6VfHvFP2z6P3PxPnC2PYzuguPCSYIKghPI-M8pPV0yh2PKv4P3f7PAAgvP3KLjwXz-EtF0MwCXXsGgDarxBL8RPXzLwDwrx3198vWfxuGzxr3r1bzrx-Xrwb5Jkb5Myb0Sr3xb2r5YAdIBSG3lUnt5pAvertF3noEgyR9PeqmH3kYD94f8A+KDIPts12bSgXcxyfSuMDoCDQOgNfEYIdyGzHcjQMPS3qnwGwTMRYGHOAZby974NferOVAaIGQLoCFs4TCEMbGbpGIagndWVssFxgH8WADUWhAAP75R9yuFACBF73ZC8Cg+AdGKBwHaATBGAnCUinZD1h2x1mTNTxsHA-4qBBopITxPoLzBJ9GAu+NIApAn6Hodg9afBNYJjg3pzIi0D+l+FX62oL+5kKrDVhZgCwegmjJ3k7C8F4Z6yi4FCETAk4t1cATdDgM5QrpGCGAJg3gJ4n5jY5eglPc8MAJL6tRU01kb8DQ2SGpDPE7IWwWvgUCGBjBpg4phCAUgMM4hAkFXlgKdpVCOANQtISvHwqkFnYlAuXvjD254M0gAAclJ6CB8OugAADpYB8eaQfLjwC4q4BoQ7A-LHawXZVhzIIwnqDTz2BzR+hHvQYXH025jD5+EwyYTMLmE3xquD1JYSsPmpm18A74AHBSGshPDQAAAL3M6gAZh8IBYfUWWH6B2Bb4dYZ8KD40pth1QXYb8wiBmQ8AhGfAYQJsBjCbhiwhBICPYGJt5AuZZgMvV6DL1iAy9LgPUDUAjCpQLQA4atyGEnD-hdwoEbm2xEUU8RBIokSSMhFVA7QQAA')">function depends_on(expression, variable, frame) {
    function tree_walk(e) {
        if (is_variable(e)) {
            if (equal(variable, e)) {
                return true;
            } else {
                const b = binding_in_frame(e, frame);
                return is_undefined(b)
                       ? false
                       : tree_walk(binding_value(b));
            }
	} else {
            return is_pair(e) 
                   ? tree_walk(head(e)) || tree_walk(tail(e))
                   : false;
        }
    }
    return tree_walk(expression);
}
</pre></div></div>
      
      
    </p></div>

  

  
      <div class='permalink'>
        <a name='sec4.4.4.5' class='permalink'></a><h1>
    4.4.4.5&nbsp;&nbsp;&nbsp;Maintaining the Data Base</h1></div>
    
    
    
    <div class='permalink'>
<a name='p27' class='permalink'></a><p>
      
      One important problem in designing logic programming languages is that
      of arranging things so that as few irrelevant data-base entries as
      possible will be examined in checking a given pattern. For this purpose,
      we will represent an assertion as a list whose head is a string that
      represents the kind of information of the assertion.
      
	
	
	  We store the assertions 
	  in separate streams, in a table indexed by the
	  string that is the head of the assertion.
	  To fetch an assertion that may match a pattern, we
	  return (to be tested using
	  the matcher) all the stored assertions that have the same
	  head.
	  Cleverer
	  methods could also take advantage of information in the frame.
	  We avoid building our criteria
	  for indexing 
	  into the program; instead
	  we call on predicates and selectors that embody our criteria.
	
      
      
      <div class='snippet' id='javascript_96_22_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=4&prgrm=PTAEGUEkGEAVQFLlAFgHTpQKCyUB7ABwFMAnAQwBcBLfAOwH1LyAjAG2IBpRCBXS0OToATUAHNilXGABmpfAFtQAYwAW5QpTKgAzKAAUAZ2LKa9XWh2WAlDhm86p2nUGHD+ZfoDWxAJ7dSE3xSYUNrUABvLFAY0EDKXlIXakMGOl42Nn1A5WDQ21jCwoB+UAdhYhlqOmJhaKKigC5QYgBHXnIsn39QVWJyYX0+geygkLDrAoaS3v7BnLyw+umY5vI3D28-bmZqLIXxyYBuLABfOwcncwVyHyZWDn1wqMLcukMBNg9O+-ZiUAAvKA2ClKPoAEQAKmYf0h4OsJ0K9kcZhcX3wXl4hC2vgYAEZuN0GAAmZ7LIpvD6gQy8FgwjiA1zuTxEgmgXZZL7KH704jHcmFagyAwpBjlSrVWpGWm8yaRAXTeKJFziqo1YSI6anFpsYzylavehUg6iIHrZk4kk7ch7aV0h58hEKhpKpKgUWqyXzMbCKYGlalT3q53+1bsm37H1OlbnQqx2LIq7Jd5kMGswl+K2gABunV4fP100pAhp9r+jPNm3T4dtXJ5Dv5KyFItSQalpdlZND1Mk91r3zYvw4nBD3Z4NtI+hBH0tbMIE8txO4ubY+cmI7HY45U4HQ8d0a1Or1L1DxbiPorGxZmaXNayHYbB-9zf0HpEEvVo1yITlJ8KAEgVmMSg+3vGUHRHQDNxWedqEnWDJyJW8VzXDdoM3bcHz+SYnSgmJtWIXV-j-MdgNAr88mXPM+U1f14waejQEYxNUVAYQUnnSg1H0BQu0VSRlVAJQARE0BwXRTFCHBUcGlKCSsRkpohMBUTwWqYxSEoaToNKdTU0UwpmjIeRJwUbhwQcLw6HwAB3FwiDIKhnFAABaFzwz+eFaKY8lXRcdjDE4tQTnOLAzwcihUT3RkbjuXknhOM8JAEIEIqc+g9wheSpKdM8+BSggSEi5xMrUlNNK8i4UWc5KGA+QJyAUHE2W6UlCxiM9DEZZLmozXxSW8vz3Vbd81XbcJSnSTJQGaQwQqqpNhvuMQJGEBhpzBXIFEIehiDoSgdj6Za+JiIbRQQ-Qtp2mp9vCAAyO7ZhGK7dtulSgUoI7mDEeasBY5zRToRriEuxRrr2ygTvPBI3VFb7VvW0FQe216DrEoGFGISrQv+8xqgqAAPBgiXwGR9E4qG-KGOZyaoflQrwXH3lAORFAgGB4CQVA0DxHmFtY4gUKoEGXputG9uzE6ztSEEtAoLJRYhv1pjk6g5Z+FCRbB1HlYaZpAeB5HwdumS5PwDEsTq3wFBYfBB01oxrdtwdSbSQ3Fdu7gJd1pTRQ0QgQW5VEjZ103BEIAPfH0QW82F-QmYYYgCcIQI3GcEOxesL26EltD0I2hhXc1wx9HIUgxET5PU8MZwS49yHs8ln3DKWtLKGCBgtpYap0roDOlbDmPVzjtuO67nuovbhh-cD3v+89loc+b2J9dSN52NRTp58hweV07+gN+cLf68b5ew1FNhGpYYRyErlPiDT+ht7P0BSli4gGCZqcr5vhh5woTGcsrY2ztnXbWmc87oWmJfG2v9bbCCjvXLOi9JYyVXnVNo+ZHBaxRpnXePxjDtD2soEGhCsEkLqswLQmN9pgNwUrU+aClrsA8F4Z++DBwsOUGwk+KCX7oL8pQ4WNDNrgIHv6UoQ8GCCI+MIiG29GH+nQQnCoyhL7FSfkgvCoAOEdC0PHS4UVVGDinsWIQIFjHP0UQadBxiy5zyQRwhgdiNF914d7Jhfs05iDoCI9hEiWh73NNQHxfj3FLyYcZYICixKWWsnZakvh9rkAJq5dyQ89FYydDjQxzkZ5R2RNwMuYgwjtRfOdUg1AFBq2oNmD+X9kS-gVENfJf9KnVJoHUz+uSn6FMEOXMItECJEXdMKV8a9tblG6dVXpDgmkNDPKnDIBUMlxwTvAgpczIFQINEnLQIhE45zgvQPxBkdlIh6Ywf+wM5Yl0ads85-pimGAeY8lYCcJbHN8fIxpjYijS2kQJJIDAHZLLYDvMcpRBGa33vteRYKIXdmaG2DUyxhnHgVFEycfSLJ0CsrZFwTN2S+BIGk8OkdKqxHODkmZaJQSFxkCC6iJck6EBeXw9qp0gUuBuNiYpgIAB8gTY76OKafL2ydBlnH5s5KR68an0GPmI-ap9OUAsoKQfgqgo6rP0fKzeg577sSDjg42Dc+Ev1fsK4eeqD4KqBoOSkmD5FIOsTY61mTQYiHtT8TocsgadNNTrU+v0iVSLIcQ0hlAFCUHZd7Tl5TUjEG2pQXEEbsFGGjbG+Z-EYYqlGl6by6L-iJvWusECsjqHyI+DGiYnLChDV1SDKopAPhCKrftTNtas7eyLUeYiIYzwtrbTWkCmtGQGSbfHOCI6qHJurVmsInBe0hlLdC6i07W0VqzUy1cjp625sEsO7dMbd35m8nGftB6XTcutRgohGazmxFTtuuRtCu3ZuXUvC9VLyTUpleYAursHDBJ8e2J2oDKa3t5Y7EBbBBViUhCB7x6o4TcEMBB3U2SAMuEMNyRg+B+DOJMOo3udCzVQbzUtdNJD-EBPIMoZQvAFAZDjk+2I-s9rCFef6KabAeMGhg3hoQhciMuLIwJ7sNGP6Vvne+pBkxFK2JI-Y4OjjQyqxnOJqKGG4PP0tc0PjobLl3q4Tw5V4sl6crPBsxkZmGAbOft5M8dZdSMmEwRsTKnXElw2U+FQRoBDIZrmB0IjIgOMuCyEz8rmpUNtvVOjZEr9lrU+fIb5nbYuSbeZuKLoX2XsZyysb22G-omakTIudYSLOqpIkNd+gK81npBuxqdgjWXV3Tq6i1xnaV3tAxl0R9CVUcpImecdQIp0DZEc1u+nXNEWeQSuwoA3gHO2a6XFDM3dPOysTmaiIbfK3s1r1xaUjtNdZq6N8kq2dt2w2xdjKd2FaLe4IV4rQt9GPcYDCjrD8a4LeGw3d76FvbZbHMt59t6UW-UZpcrqrMlBQDgIgZA6BebEhw0tWWjkXtA8o4JOG5AVq1ERjOXh4k1a4+xmVvrOP5YbaQZEQoR2qPDEGNuBTp3WINYxqQzDBO3QbQhHz8E6GBfc+cs9hlbtMbPzVbe9n+hOeLdK0SrxIXBvy7q7eonJO1rC4p9NiGNOiXG-2mtu22vWeCSV9uO3EZ9P01p4tc3Y7qJzf+5d-HCu2c023Cr-HzuXesVFN9638WqN64Robq74IzEW++-CUAAAfFPilo+k9j0D8yuZKkOmI2o1Tzhk9p4z6keGWekYU5Ud53uNOQ-OW+5bvHFH2pDWl67Pn1MRiB4o87olzfftVy94Dtvf4hoO9tH3nWweiUNYTxYuvwc+dUT3Z7x+dBBd0pnPHwL5jC+kdRGL0Aq-9vr7+5vtXJmL4-1vpfgHbjFvt91xX4nMfq9x5gdfe-I-N+m5M2-1-muUATIBb3Ix1hfyoyE0wxlzPyn1b1n2wyJSANvkcyZwn0V390dxn0zjnxMwa1QI30f1pgAUkDIHZT8190EmF3Ejv2IJL24BAPINbW4D80lzxlSFryL1cW120Rt1hjf31zJyGzNXMm4KPxL2QJMwkOLwym7wwIEJ3xAkCDJl4TxGkL61kNcT-nsVANbQjyhyowLlUJiQGmlSJW0N7gc3wAQUMK5WMPpVMN4R0E0MWgkKYHwFhVkUTxI3sOhkEgX3318J4LnnYysKigUNe3Y0IPoIf3ThBxZkuUPzkKuT0JYIgIgUSIiJKnQNV2vz61FEqzfVEMgMwKjyEI-3Jzj2KI7S0jcNYnaz-xIMUKMNt2wNtC52lUb04NhUPkVUQMzmoMEOWiqNKLFnMn1SPkHHiPoFL3T1DEzwN0-xzzEimIGPbTk3qPmiJXWIdTaVqGoBNXsKGhMMqBiQ0J2JMz2J+CdQfXGKVigJoKcPON4XMPOF2LtQNWnnBTIADVqSDSGPKOeLbWcKu1cI4OSFSGkw-Sllf1GKrxnFHXMmkwAL62k02JERLlHWeFiGWEnw6PvCzQHxkJnVfTqI-VKWBLdCV1HSlQ+JMxfUxIhmxMXThKo0wjZKuMKKTRTTTWdQzTpPZMJ1SD40pIaIBhlnLWZM7SFKeJGLFM5O7QKMWlFDM38PVXf0RIeJG3BDMzRMWnszyJ9x1z9170dy6IZL6wa3VNkxEW32BCRj1K5C8BPztKVkhNbiKioDHkUG7n+LHzKP4MjxFLFCBlIFxFHlIH3htgnm9zbzL0WNSH9LLkjO9PbmjPHgDKf3x25NVJGlTMLnTN9NjOzL4JZxDJGMr2WOqNWNxULKjJjJTOPwlN6JTIjKLMcgzKbLjMDKBODLaKrK1JrJ1LRj1J7g7MbKzPr1bPsmLOjOew1NvTOLUKu0uIsNJK3U7IoBECXMcNBNeKu3eJ6NwyCAOTSl3NaMHOUMBVXNWIhO6Pn1uA-hniOLng+WaOcCKXLmYwhgYKNAdNoNfKDkYKSNpX-LoG-LEF-It1mPeBVNYinL9N7MYCnmAocWfzG0C0Ki7OCEZEbMXKQUGnhJA0nPnJ7LLPUwCQa3QuDl50NijKzkSNDGF2PW3KEEGAUwMyEmfOngjlnjot4u70YvBx2VYrJPYsvOiKKykzPLWgvM4vyM9L9n4rfLU0wvxPhOrJEJiXBFoqkLzNYg-Pvk3xOKwPNM6NV0MryXLggsyMeOpJcAQOVwtKUu6Lh1pQR3kCRw5lR25l5h0Cxzhk1U+ijgJgdLVPNg4CEH0HCp0Q01AAJiUxaFIBMlivMltjtn6BcFZRMC0G43PBIQBOEAbyfLuC-mYNuTYNsJ6HjVNJBLBD3xRimSZjF0K0qooOqoQUOytPzJjJ2hasuXjgisqO1PjkmMmQOVatnLAqTF0LINuWGuGJvNMJkG4HXN6qMuSMcxkEApeLJjWtAGPMsOSLSxOR+T2oPIOu4AfJpUWga3XT3S9X2UhmWsdN30evzBPzeBepmqKO5Q201hGoRJHP0E1nMk+qyWsvMEhthRerBuogdOcqBoQtlUcC+BrjoArjOq1zqqULvGjm-Q3K0IkrkENjxsrKcpphXXODPE+g-mTU0FxBxpEUZCMyxwazJrl2e3ZWLgdIuh5rX3zHpJPJZjIPAPjjINxLxMpqekGC5pomJvcPFuLkluBmlpiHxu3AVtRvMD2S40OWzC+T8UFvP0oPWAZqs3qqFz2jEE+lg2dlKREiBA4CxvtpXCWASouk5rIIdtATXyXVABYAtsNu4tdrttUD9qw1AAAB5gRbb3bOhPaAksUIR258AeK6BfB+loKsTqQsQA5qBahmhwRQAABqeKnZeqaoMQIUKOHm8ICuk-UuiuxI6urGuuhGrDbi1O8EdOlmYgGyHOmC2NfO1S4usScuyuqBdu2umQeuzDUpJu8yKetujVGuzuj2-Aunc2SSFvDbZ7WrckMNHOdac2bECm6YIlDzKO3mpOqGFYAFMUhuxIyRU+9EC+9G-ATG7Go5dLPxErRI2aTDd6OW2+y1AMMBreoB6kfDFy20Bu60W0Le-zOMVdMZCWUB+mxOPkw242hyydVK6JQ+2JOgW2coU-YGSlQ8QiDFbsIdMgxkNihWwmyWH9G9KjG+hWiWnW0S0Mbh1WnW1B39NB2WiWM+ogVh3WlwW7WAh2EhlcI+i5PrcRj+qR69Wa1iG+02rejR2WwGDIe8ReiBlWFBCRz+tRb+muvB-++RQB85YBuDUB2k4x1+nsECJXD2tfExvWWBmKzCYxpBrIFB9hpiaeooF8TB529kI6Rm1NGx86t6EiYrIhycEh3FchkQShzGMlN3ahhiK9ZJosbChWph0m32yHf0DvOB7hnmtWzGJimSgR5lepx0UJxiRiRtd+8+qR2HWQeHMWtmZHTmNHHmDAIK1IFOKpGpLpBpOZeUqEkGnSnFKZjpAEg01iVZmZj+KpAOLY98+ZxysB7WuZUrPKdpbZ6ZJMLqF2pGZ0Wg9nE-WIdnMcRphoWgjkJ5mIDkV515WghCL58cOCX5+5p0jaQFjaEF6BJ0gxzIE-WF+DA0N5ooWggKAOcgXwE-NFy+bOpFv5p0rFL5rFbsZFwoWgm4T6aeFgQwMXCl1QKlrqFYUl2IWgsuwF2IdK0AXwcIAEIVVJCu3F5lmIWglydlmITl7lhDVJdyQV-F3fFyUizF7gGIVJQoXl2IdyVVoV96xqtDaYCVnlvl0ASELlmIbV2g4AMVgwAmbgSV9V1JMAWV0F3fAAUitYNaldABddNdAHNadOdvZY9ftdAe5blcaoAEIRJA2bWuXDXErQBI2gRQ3nXGqY73WY27WjW46Yhk3oXd8Y6AQxWg2s2gRY2w2IQBV03bW43UkhUc2-Xd8BVC3lXChi342m363y3wRw2rX421W62E3YhwrnRcpsKtnA0rmdNF7AQQwYN2cmCLmJ2mYpVznpml3kj8AWAAArPKm52djQAxFwdV-5xd9Z7gZy35bVoocdgEyd2uJ0MKMd09rpRfG5nVqcJ0lFE-FFK9mS998ESAOgNUNWJVmIQD4D1NX9mS8lqgel2ASAL5ulhgeDqDorGDylgAUUBaQ4w9Q5y1oIADlyACOrWiOCOfGdlR33gBAb2X3giK1p2AR93sRlAEMldlBkFaOP5X2qOqQuPvDmALdi4Z2VgYNWP1XnKOPOPn3uP6OpVRbWl+O5nIKc6NoHTWlqgwyKhSA2BfBrGt3yBcw8NKlNB9B2qZOGBdmOAREDmt8+GYhik1OjgihHyTNgJLYWb5EHT9aDlPPO12NONdylPkjTbmKYh+PF9wC8OOMI4uNyYLOE5N2d3TACscsIv6Pmsl12NsG4nma-7EnIZfoOABBsGxAvhg6Zj8vBt3MBJCAEmtcH2iV-5jAGAiEOy6lSBbZjBXw6B8plwyAuuQOoYzxWhGRmuP42uo5qh8p-MXwOvBvU0E3VIa5Xb6iNHsWMWIQ3J3IU4PB-tQBJv3Rev+AYhtuvJwnCgNuo4HBxvWv8wIz9BWhjgwnaHiJGJS1zRUx04nuH6ONhA1pNUOBC5ozPvNJ05QeopHMfvQm5uBurHFvE2xIVuTdfuGgrutvtv3IIe8l-vag0lMfzvi1IgOnCmQx0fwRMe3IDv7vs6EUupKe3J8migrvKEGomoDJ6p+gFAGAYNCtSneXmKbuy4WvJuzOZL1JBOaA45WhuAhH7OPVhY7uyAo4ZfqQa7iunsNUuf9A+McJ-N-1RbduSE3AleHvpv+B+vOv4fJWSJS0xTzfIZUe2IOIcWMf0lPs8K5ZqkA08ezv9fSeVgRuxvheJuaeeuZvQnyfMe2JKkOvgRz6jv8p8fGfhGYh0ehfW1Q-lfHu-kGgPu3Avun4fu9G-uAeMgP4O5sen4q-GAofc+DRyeABBAvsH8wAYCoUQduNiKgcgIOi2tAJny9V7kvtPl3zbinyn6n5X88GkcFenhn5uwf6YFnznxqMX0iLXxqHng9vnxhgXnZDPkXsPrAf8bRCX8xagaX2XqW6L2IJtU3lX9DdXyQTXtnnXwxvX9pv9aVFnSwiSoQQwDZDIDh9+Aw3bCqNyBC3dReDvfzAw2Bhvt7+ovVXj-Q16MBV+TUXXv5ifqGNWmydA0KUHBDWQeKXEVQDXW77MBtISiMoL1xD4P8euPhKXvolV5K4FaEwaRgPRIHTwW+qIEuJxH9TX91ab1WqPjCTik4a+vAqgP6hmrCD3wBMMQdwNri0xKAUgoQb2HQE9dCYxMTMKTCUFSDzINfFyOgIbxQCaeIKOHt1wADkEPfQH+xiAAAdLAIDxBiBc1oU8GQMEAwGGNbW1bOUNBAsG55zBUNLACYOV5mCrelg6wbYNAAOCnBpcWLgcjcEeDaYcEfQLwGXDIIegF0NIaAAABe64ewQKBcGeFP4SQ7MN4NyE4Rzk-gsSPN2-pBCoIf0f-u8CAGTgrB8Q1wV4XcGkAmoGbbgEBWbosBm6ygZuiVUmAWCnQeAEIe10CH6A2hJABIZ0KSG9D-25AAYUMJGHwhrA1Q8EF5CAA')">function fetch_assertions(pattern, frame) {
    return get_indexed_assertions(pattern);
}
function get_indexed_assertions(pattern) {
    return get_stream(index_key_of(pattern), "assertion-stream");
}
</pre></div></div>
      
	
	The function <kbd>get_stream</kbd>
	
      
      looks up a stream in the table and returns an empty stream if nothing is
      stored there.
      <div class='snippet' id='javascript_96_23_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=4&prgrm=PTAEGUEkGEAVQFLlAFgHTpQKCyUB7ABwFMAnAQwBcBLfAOwH1LyAjAG2IBpRCBXS0OToATUAHNilXGABmpfAFtQAYwAW5QpTKgAzKAAUAZ2LKa9XWh2WAlDhm86p2nUGHD+ZfoDWxAJ7dSE3xSYUNrUABvLFAY0EDKXlIXakMGOl42Nn1A5WDQ21jCwoB+UAdhYhlqOmJhaKKigC5QYgBHXnIsn39QVWJyYX0+geygkLDrAoaS3v7BnLyw+umY5vI3D28-bmZqLIXxyYBuLABfOwcncwVyHyZWDn1wqMLcukMBNg9O+-ZiUAAvKA2ClKPoAEQAKmYf0h4OsJ0K9kcZhcX3wXl4hC2vgYAEZuN0GAAmZ7LIpvD6gQy8FgwjiA1zuTxEgmgXZZL7KH704jHcmFagyAwpBjlSrVWpGWm8yaRAXTeKJFziqo1YSI6anFpsYzylavehUg6iIHrZk4kk7ch7aV0h58hEKhpKpKgUWqyXzMbCKYGlalT3q53+1bsm37H1OlbnQqx2LIq7Jd5kMGswl+K2gABunV4fP100pAhp9r+jPNm3T4dtXJ5Dv5KyFItSQalpdlZND1Mk91r3zYvw4nBD3Z4NtI+hBH0tbMIE8txO4ubY+cmI7HY45U4HQ8d0a1Or1L1DxbiPorGxZmaXNayHYbB-9zf0HpEEvVo1yITlJ8KAEgVmMSg+3vGUHRHQDNxWedqEnWDJyJW8VzXDdoM3bcHz+SYnSgmJtWIXV-j-MdgNAr88mXPM+U1f14waejQEYxNUVAYQUnnSg1H0BQu0VSRlVAJQARE0BwXRTFCHBUcGlKCSsRkpohMBUTwWqYxSEoaToNKdTU0UwpmjIeRJwUbhwQcLw6HwAB3FwiDIKhnFAABaFzwz+eFaKY8lXRcdjDE4tQTnOLAzwcihUT3RkbjuXknhOM8JAEIEIqc+g9wheSpKdM8+BSggSEi5xMrUlNNK8nA8BY5xDFAORFAgGB4CQVA0DxdqLhRZziBQqhiH0XIFEIehiDoShuDG7M+PPBI3VFEEtAoLIhpGmpxr9aY5OoJafhQgbVtGjaZOaUU6HIBQDsUNaxsoTbZOBfAMSxBhDF8BQWHwQd9qMd7PsHfAZDSC6ruGo67smuhppO91Ug0QgQW5VFBuu8H7qKUp4bYXx9F6vN+v0GqMuIAAPQhAjcZwUbB9aIZaKHrDQ9DpxAwGGH2wx9HIUgxAYUnyeISmjWpm6Nsh6b0cM2GGDSyhggYIaWGqdK6BFtGZNKPHVwJ2X5cV5WorlhgseoJGqcO2nGfp6H-VO1I3nY1FOjVy2NZaFcFfoR3nGdi3bvFyXYjthg2AulhhHIPmyYpwxzdR13-VKWLiAYInVdDj6I4YecKEupbXr+r7Ob9sWDM3DPw8jz7hBxku6amwOw1FYx2jG5RQdFu63a1162nzRwBpb-v29e5gtEu8bi-j26rYbmHRXYDwvBdmfu49xflGXuuA-n1I-NH-qJ7BOvG9ATWPf3j5D9ulfxp323pbThgKmUUPivoW+7rw0A1-xrRCcuFFF+g4jbFiECBYBn9Z4M13s-Ewb8VZQN-oOYB3NEHb2tqfYO5pqBiDoEfJBid3Y-BwXgghGC54P2MsET+5lLLWTstSXw41yAk1cu5LWHQtCVVCmnQQhAEY42RNwbmYgwiFndMKV8qRybUAUDtag2YU5pwAXQX8Co-L8MEdnUgciFFKNToAqmwjBA8zCLRAiRFJEtk9mDcohjuof2ROohoZ4KYZAKpwgmT9q5CIcIzMu6EWgky0CIPmUM4L0AIYEoJCYjEZRziDJanNnFM1iWOURhg0npNDE-KakT8E32cY2IomjRT7x+u4tgXcxylAqdRT240b5VJqd2ZobYNTLEsceBU1DJwmIsnQKytkXB8MoL4Eg7CtHY0qrEc4vD4lolBDLIGHNcZkyyZgiRMRNE3GxKIwEAA+Yh2t-6iIDpNDZToFmOJcD3B2Cj6C+2nnfLZJEympEoKQfgqgcZeP-g8p2g4BbsSRh3NGAdT5nxOVwq6IhHnnUHJSPuN8T73yoX1AFXsEUkOqWQc6NAlFQIDiFLqSYTm91bgPIwlAFCUE2Q3bZL5RTEGGuMylw9B60vpS4-ic0VTvjVLUby3T-jMtSKHD4B9x43w+HSiY2zCiaP+QNKopApVXxleNGl8rGYNxFUeYiIYzxqo1dy9m1FGQGRVYTOCZrr7arlTyzg+qQzioYPU1cqq7UgSdRar1vL-SaNNb681+1vJxkNYqvlgke5DzbgNGJ557VavpTq51rqYzknmWS1iLMVlinOpTPB7ZC66hmrNQSezfofS+kcsSkIHCkPVHCbgb1a3ltJVgPhhhuSMHwPwOBr80GoinjTGe2yPkcoTYQoh5BlDKF4AoDIBMk1aLGsIbJ3Z0iZC3aGatvahAy0Hag9+7w92bnjQPaVrLbpjs7jhRSwdT3oJea0g020Zwvqiu2-6UCoXNB3WwLtfCe4by3m+gO2yzy+MZOBhgvioHeTPHWXUjJD39pPfAkdtV9C+KfCoI0Agm3FvVHVIE+a2YkdjiWwYqHzG+QEm6G1vjLmhOEOE7MBSCH0YvTkoJ1HcFke4Gu-j0wG7XNzT1C+THGCatvdqihDNJ2yaErcFOnr8z6BiTa-e-MY5x3HWLTBknu2LIpc28hkG3nkjPPtRkNrLO3X9fmKOAshaqzRZg7yzaC4dpcwNJz40-N-q8-tEljH+U5moiB8zPdv2Gc7lBkivnf1fQC-oBLGU0srTfVbUTDQbVZcYPtNzBmP5ooK5uBufHoKZtiJojpXbqqLLqg1JQUA4CIGQOgDqxIpPmAWjtRyuWjN3RU1F0UzAxASA4yzWhYlFojZ4WZ25wJhvLQyyfSIhRIuCWGIMbcJ9TN8Km+QGbtQQ6ggW5QPo9wxAVqnQhKBoAABkr3ZgjG2yJIEt2U7Tdi2ts6IMXvvNU2di7c3rsYPBOdS6K3VvkuTsDS6Nb-qPdU-N2HINwRtrLSd8zOWC1w-BZbCb+25j6CO3lgnQO4akas2NjHk3Pnndm1dmcMOgtaUk3w7nIWvqg7226A7VOIxDEp9TpnOFSV84Z850r+nBaxwq3l8nIvJfi6lw+-kNzyWimK0LpV4PWeQ458faz4IwHBeK-CUAAAfe3ikIfs-mzD3MuiHRDoQaiO3jvnem9d9Dy3T9be0-JcVgXo2H0SM0UTtmJOJcjG12jXXiPWKR8V9HZXiW0ax9U6L7cKfLZp-T85ZH1uIHYbPfoEnVEvVlZz-QZngkseV+9zh+guPQB1+iw3pXHnw+sQWmHLOA+VeebV3+Kd02g+c8txXMf2ePMrb4YvyOiS85kCj-evP0-VMHrLcTkG3BC-i+O7z8z6+EP4BrkbnZBfNe2mLzPUvfDkfX-H1TTfkgyCbPw+rksjOOJKPpHF-l3twD-sktwPhoDvrqkKHtXq+kzpEN-MLskIHpdm7iHosh3meqvuZogcOmeijqThOmDlFvmoEDIAtniJfmtkQT7iVFAX-vfg-pQcstQQtqSLLoQbgZHohtthQa3pwZUAtjoPQeSowUwPgI0lfDbvAmwZWm6BXkRuAngYgjEowZ3owInpVtBB-qAY3h5tpuktoSQSweqsSgVuYSrDfnfhfnAcPnvLJjeozjHvvizvdnPhbmNuZJfGPApjzrwWtnpsvhPmwZomfraMdk4c5KKICj7NHnvugdLLPlgcHn4WJIkU8oOOAXQH7k7qGC7hkfPlkVbtikCm4bdAQWtjkYijorUKbATEIcsJolQWIRgnQSEeSvUT8MilSr4R4W0ZjqITQRgjwWcGXuYH0YOJ0EtASoomQRtPnhwVKlwRghIXEYNqkFeu3OmjNDPmzqUWCE6uZHscQLUeShcdUZPAcTtjECMVFtEfeNymnnwiGrcacdyuIp4RTiME6gxucHwhTKGg6mmoCYcapphD8ZIc4XzGyriBcemr8U8YJGdBkK8bqj0fCZKmCamiiVCV4UBmLraJCUPvEakOBkoUcWbtgeUeBlcaxPBoIVPqkS8f+jieXupghlyMvPJkfC3m6FjoyW2oEYKdsRgTLEVFQHrIoErIsarigREGgcbl4U2qQLiLrKQLYgqcgTHv7sUVScrJqdKY5HLDqfrIqZPkzlyTsYWtzFqTKRabqQbLnmTiqbtmqeiZgVDmUUlmJBqU6eaXKR9G6V3nCZSQhiacGZFKGXqcjEIaqQ1ibt4ScQtuCHqaadqa6daUyc5DmTljSaMesZ0dZt0VMR8T6maRQCIMWWsSBBsdZpMcCYTkEGEmlHWa0d6cKWMeIRSdcDySbGbE4rgfkSIjzEus5vkaiT2UAWCOCMOSrN3nkuEc4BOWIFOcFjOQOfZM6fGeGYwEbEuYmWyYaO8AINqYyIWWWkhqkW+I6TWbKZafKYebOh+mpncCeVTMjontqQEmJisPNp8Z2YMBfk+p+SnN+R-L+SDv+bVjksBdWaBdYYBd2MYA7E+V2TTrudLNBTacMSmV4ekX6UMeDOZPhfmeYKue5hEd2ewf8YdufjTnaS4KIsYRPrvh6WiRrsnlrsxdLqZi1rcm1vIB1s1N1m1B1DoANlKV8j8jjCTEKVKZ9F9P0KrEpT-KGKUCTBBX0voCTOZKpRwEIMEiQKYLUAECYMQEscIAju-jySopYf-rfj0IysIb2cAYdPYmnLjkms5TAa5RFq2XTrYiND5YsoTMpWkccaRYTOZN5WEr5ZGdRbgc5VFYAetqWTQTINwBWSFVIbgYhjINFR0TldwC2dMaMmOREvIIUtqiVZlWVfFboLhcjppnCqEuNh5fORCB1d3m8F1SlVKR1foPtNFSUXFeFmJP1cNcoSVg0oNTfONZlRyeNbhW3F8LHHQLzPknVQQu5akduK6gVaxJ8XICDodXOZ9oMCdWFERuyHdqypoLiHtVErdIyEBicFVZBanLnIPGWpshzNFc9jlkDdRECT9RdZdDvoTP9c8F6URYxXDSDHNdDSnGsujQjbEEdeLljZKcEuxpxtxrKoDfXv-usCnFdUjcKWNGILdmjkXOED9sCHTQzSuEsNpeOHBDxI5f9YzbqOTVbCwJTZxgBqzTtQzWDeEAADwS302qBjWdCc1EL6Xghyz4BqZ0C+CmKblHx1Q0gCIgi1DNDgigAADUWlsSHwuiO1QoOM0tFtYk5kTtBWNt1QYg9tSt5a4tatGt9UxANkutW59K1IWICM1AJtYkrt6S7tdtMgDtgN4Qlt3eZtltbtXyHtXtHNb+V+T0kkUeGWOWyW5IoGUMIcT02I1NDQPafaAt4N5a0aLoqZJJ0tBWms5d6IVdjgW1HtxN+1N8EmBWzQOWKkQIoubd6SpQouOdw91IddmESd1otoOdBGcYbqUiU0Y9j1VNiJ-d71KxJEKw+lxdgZdAn05QPeOOa9cyUaR9RYD16NjI51-N9WQaqmGGKNMNYNX9fICFY46NAWKS8NN9+E2aqRU0FdRAuMDMBNqWR+P0p9K4JdSIcWndldMD00Td9UhOddYNQt2D11GJmQ9dUKAY1sUD3dr8+A21u1tVB9YIQ96SI9Za29E9Sd7dPYIEM9yt9eZD0wI9C94u0ty9WQq9Eat9G9BgW9LNf2CJL1+99V3V1qpAJkAtdC59A6IgV9l0Uy3Osyh4hEPS3YJq-1z91Z6NmDoDpSH9ddgDP9WN-93YgDmNIDEjYD6911kDXdVjzWsgrW9UYlTUXWrUvWGAsl0ssi8ihKyikVziqxPpaZcVAyUT+ilxc1qTMTDAciCMQRiC8TfxvFTFtoxSXaeUui0TSxDiSY5GWVYIzoWOB23esQB2Y4AFDQWOHIzTMQHIbTe6WOCE3T3NpAfTDT124koIQzLMoz0wWOxDbA3e8z-o7TRQWOAUCM5Avg3e6zocOtBoKzhQWOfS3TfS3YBzsQWONwt2xsLAhguOVzqgNzdUKw5zMQWO5tQzsQBl3AvgzNxybCltezrzdTEILknzMQ3zoAvz9abC7kQL-T4zLkQZ3TbChQAIxyMQ7kqLwLWOra0wkL0L6LoAbCkIULMQOL4zwA4LBghlULfzxLoAYA8LYzwBAApNSwS-S2wqy2S6ABS8AT9p85yzC9vb8wi8AQAIQiRCu0uEv-OgBStAhisssLky0cuytcugBy0xDKuzPjMy0AjgvCtEtsIGs6v8sLmHLqs-OasYt0viuWuGvcBFDGvyuHJAj2sqsQgSvUsMtot2sSuxBKXOi5QPWZNVNPxg2AghjVoHaQEVNpPVOjqhsXk8AJtZNPz4AsAABWJgodAIMbGgqi9aAz6bSx3eHJxSwLRQ4bBiacDG91qbtbKcletT82WOHS3eHS1baFIL4IkAdAaoO0WzzrA7Q74yPbaFlzVAjzsAkA3TDzDAc7k7gF071zAAokM4u+uyu2JljgAHLkD7vUuHv7v8PpIptUjNtyHMDBZRsFsrDVrKD1qi7KBWzXutuXsCAftqHBYczRuPtFvPtEsclvvvtlsGKfvfV85G24jXsqImKiIszRVYy4jVCFoVCkDYx93ZvkC5i9q6KaCmHQTXs5McBHz5P+JOOxBIeggIhFBTE-XAQvRvVKNPCZWkxE2sfRLQTwwbr6Dwe4H4NW05I-sXnqEiMxJ8d1mCe3Iyw5t5ubJVYxBifyEgTA3Uc73yPsrcczxdocACByNiBfAi15H0NKPoYCSECKMEJOg-U5zGAMCtymlKKkCfTGCvh0D5TLhkDufDsVpnitCMgOcpzOc4zVD5QEYviud+fjIKuqSxwcDjR2730xA7ObOgtuRpseDK6gBhfuhef8CYtuReQidFDpc4wOAhdOf5ian6CtDHBMR32MTurmiphUwNcVqFADAcbfIcAyw6lteaRUxDdRSIadfuPWJjW+c0PDvxdAjgiJc1FdfTAVeZduTuSjfOQ9e1DsIbdgv0eiqRCMRHepdsQcS7Prcbd5e1c60tJ1T7cbcGMNAVejyBAXTEf+g239AKAMDVpJpP3otVZVfcyOdheff8bqS3s0AEytDcBY27uFAqo1dkA4xw-Uge0GfZZfI-e16Yk4QEY5r2fyDtxuAo91cRf8A+duezcTtMpSLzOeeRcrdpcXcZfgjXf-LBDshkDyIEq7dPeE933GoPVBdAjVfg+U93STdrcc-XfCC6KuePREAFf5R7clfWNrcg-qqhe3f1clINCtduDtcfydeEM0fCC9cZApzyxbcfx2+MDjcG8Giy8ACCxvw35gO3ogcsbEVA5AoAItxgaAz3RQp3Bksvj37k+X936vT35kofKwr333H3gSKfv3-36EgPhyom2vYPevWA-438UP4C1AsP8PIDmnMK-U5PaPbamPkg2P73CgePmQBPk3J3Uxu2VZ6qIEQghgNkZATP-AAXovwXoPuvqPw-0vtmj9-1tTyP4P6PtDWPcmOPH3QGzvU6JJ6NKtH5sOmtVzagHtfvzA2kD8efk-FP4n40Zf-86Pouu-MujHfCyUb3uP3QbI3QpI0GD1tTyUOIL-n4EmJENWwgqL0EYHCClAgMoAEel2gl63d2YM3DzgAHJRu+gXtjEAAA6WAProFgEQboZCqcYIC3yAw-MbWcoaCCgPMgxcaG6TE4AgNR5ICaeqA9AZgNAA4C8BXMAgWEiNgyASBAnBcLwGXBWwegz2YQaAAABe64bAQKGk4cY+BAg7MOQKkE4R0k1AsSLQOMCVQoI3aasv30H6Tg0BPAhQbIX4GkAW+srbgFjnICp0WAqdZQKnTsqTAUBToPAIwJc7ICBoxgkgLwLMECCrBfbWwUZQcFOD4Q1gDQeCC8hAA')">function get_stream(key1, key2) {
    const s = get(key1, key2);
    return is_undefined(s) ? null : s;
}
</pre></div></div>
    </p></div>
    <div class='permalink'>
<a name='p28' class='permalink'></a><p>
      
	
	
	  Rules are stored similarly, using the head
	  of the rule conclusion.  
	  A pattern 
	  can match rules whose conclusions have the same head.
	  Thus, when fetching rules that might match a pattern
	  we fetch all rules whose conclusions have the same head
	  as the pattern.
	
      
      
      <div class='snippet' id='javascript_96_24_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=4&prgrm=PTAEGUEkGEAVQFLlAFgHTpQKCyUB7ABwFMAnAQwBcBLfAOwH1LyAjAG2IBpRCBXS0OToATUAHNilXGABmpfAFtQAYwAW5QpTKgAzKAAUAZ2LKa9XWh2WAlDhm86p2nUGHD+ZfoDWxAJ7dSE3xSYUNrUABvLFAY0EDKXlIXakMGOl42Nn1A5WDQ21jCwoB+UAdhYhlqOmJhaKKigC5QYgBHXnIsn39QVWJyYX0+geygkLDrAoaS3v7BnLyw+umY5vI3D28-bmZqLIXxyYBuLABfOwcncwVyHyZWDn1wqMLcukMBNg9O+-ZiUAAvKA2ClKPoAEQAKmYf0h4OsJ0K9kcZhcX3wXl4hC2vgYAEZuN0GAAmZ7LIpvD6gQy8FgwjiA1zuTxEgmgXZZL7KH704jHcmFagyAwpBjlSrVWpGWm8yaRAXTeKJFziqo1YSI6anFpsYzylavehUg6iIHrZk4kk7ch7aV0h58hEKhpKpKgUWqyXzMbCKYGlalT3q53+1bsm37H1OlbnQqx2LIq7Jd5kMGswl+K2gABunV4fP100pAhp9r+jPNm3T4dtXJ5Dv5KyFItSQalpdlZND1Mk91r3zYvw4nBD3Z4NtI+hBH0tbMIE8txO4ubY+cmI7HY45U4HQ8d0a1Or1L1DxbiPorGxZmaXNayHYbB-9zf0HpEEvVo1yITlJ8KAEgVmMSg+3vGUHRHQDNxWedqEnWDJyJW8VzXDdoM3bcHz+SYnSgmJtWIXV-j-MdgNAr88mXPM+U1f14waejQEYxNUVAYQUnnSg1H0BQu0VSRlVAJQARE0BwXRTFCHBUcGlKCSsRkpohMBUTwWqYxSEoaToNKdTU0UwpmjIeRJwUbhwQcLw6HwAB3FwiDIKhnFAABaFzwz+eFaKY8lXRcdjDE4tQTnOLAzwcihUT3RkbjuXknhOM8JAEIEIqc+g9wheSpKdM8+BSggSEi5xMrUlNNK8i4UWc5KGA+QJyAUHE2W6UlCxiM9DEZZLmozXxSW8vz3Vbd81XbcJSnSTJQGaQwQqqpNhvuMQJGEBhpzBXIFEIehiDoSgdj6Za+JiIbRQQ-Qtp2mp9vCAAyO7ZhGK7dtulSgUoI7mDEeasBY5zRToRriEuxRrr2ygTvPBI3VFb7VvW0FQe216DrEoGFGISrQv+8xqgqAAPBgiXwGR9E4qG-KGOZyaoflQrwXH3lAORFAgGB4CQVA0DxHmFtY4gUKoEGXputG9uzE6ztSEEtAoLJRYhv1pjk6g5Z+FCRbB1HlYaZpAeB5HwdumS5PwDEsTq3wFBYfBB01oxrdtwdSbSQ3Fdu7gJd1pTRQ0QgQW5VEjZ103BEIAPfH0QW82F-QmYYYgCcIQI3GcEOxesL26EltD0I2hhXc1wx9HIUgxET5PU8MZwS49yHs8ln3DKWtLKGCBgtpYap0roDOlbDmPVzjtuO67nuovbhh-cD3v+89loc+b2J9dSN52NRTp58hweV07+gN+cLf68b5ew1FNhGpYYRyErlPiDT+ht7P0BSli4gGCZqcr5vhh5woTGcsrY2ztnXbWmc87oWmJfG2v9bbCCjvXLOi9JYyVXnVNo+ZHBaxRpnXePxjDtD2soEGhCsEkLqswLQmN9pgNwUrU+aClrsA8F4Z++DBwsOUGwk+KCX7oL8pQ4WNDNrgIHv6UoQ8GCCI+MIiG29GH+nQQnCoyhL7FSfkgvCoAOEdC0PHS4UVVGDinsWIQIFjHP0UQadBxiy5zyQRwhgdiNF914d7Jhfs05iDoCI9hEiWh73NNQHxfj3FLyYcZYICixKWWsnZakvh9rkAJq5dyQ89FYydDjQxzkZ5R2RNwMuYgwjtRfOdUg1AFBq2oNmD+X9kS-gVENfJf9KnVJoHUz+uSn6FMEOXMItECJEXdMKV8a9tblG6dVXpDgmkNDPKnDIBUMlxwTvAgpczIFQINEnLQIhE45zgvQPxBkdlIh6Ywf+wM5Yl0ads85-pimGAeY8lYCcJbHN8fIxpjYijS2kQJJIDAHZLLYDvMcpRBGa33vteRYKIXdmaG2DUyxhnHgVFEycfSLJ0CsrZFwTN2S+BIGk8OkdKqxHODkmZaJQSFxkCC6iJck6EBeXw9qp0gUuBuNiYpgIAB8gTY76OKafL2ydBlnH5s5KR68an0GPmI-ap9OUAsoKQfgqgo6rP0fKzeg577sSDjg42Dc+Ev1fsK4eeqD4KqBoOSkmD5FIOsTY61mTQYiHtT8TocsgadNNTrU+v0iVSLIcQ0hlAFCUHZd7Tl5TUjEG2pQXEEbsFGGjbG+Z-EYYqlGl6by6L-iJvWusECsjqHyI+DGiYnLChDV1SDKopAPhCKrftTNtas7eyLUeYiIYzwtrbTWkCmtGQGSbfHOCI6qHJurVmsInBe0hlLdC6i07W0VqzUy1cjp625sEsO7dMbd35m8nGftB6XTcutRgohGazmxFTtuuRtCu3ZuXUvC9VLyTUpleYAursHDBJ8e2J2oDKa3t5Y7EBbBBViUhCB7x6o4TcEMBB3U2SAMuEMNyRg+B+DOJMOo3udCzVQbzUtdNJD-EBPIMoZQvAFAZDjk+2I-s9rCFef6KabAeMGhg3hoQhciMuLIwJ7sNGP6Vvne+pBkxFK2JI-Y4OjjQyqxnOJqKGG4PP0tc0PjobLl3q4Tw5V4sl6crPBsxkZmGAbOft5M8dZdSMmEwRsTKnXElw2U+FQRoBDIZrmB0IjIgOMuCyEz8rmpUNtvVOjZEr9lrU+fIb5nbYuSbeZuKLoX2XsZyysb22G-omakTIudYSLOqpIkNd+gK81npBuxqdgjWXV3Tq6i1xnaV3tAxl0R9CVUcpImecdQIp0DZEc1u+nXNEWeQSuwoA3gHO2a6XFDM3dPOysTmaiIbfK3s1r1xaUjtNdZq6N8kq2dt2w2xdjKd2FaLe4IV4rQt9GPcYDCjrD8a4LeGw3d76FvbZbHMt59t6UW-UZpcrqrMlBQDgIgZA6BebEhw0tWWjkXtA8o4JOG5AVq1ERjOXh4k1a4+xmVvrOP5YbaQZEQoR2qPDEGNuBTp3WINYxqQzDBO3QbQhHz8E6GBfc+cs9hlbtMbPzVbe9n+hOeLdK0SrxIXBvy7q7eonJO1rC4p9NiGNOiXG-2mtu22vWeCSV9uO3EZ9P01p4tc3Y7qJzf+5d-HCu2c023Cr-HzuXesVFN9638WqN64Robq74IzEW++-CUAAAfFPilo+k9j0D8yuZKkOmI2o1Tzhk9p4z6keGWekYU5Ud53uNOQ-OW+5bvHFH2pDWl67Pn1MRiB4o87olzfftVy94Dtvf4hoO9tH3nWweiUNYTxYuvwc+dUT3Z7x+dBBd0pnPHwL5jC+kdRGL0Aq-9vr7+5vtXJmL4-1vpfgHbjFvt91xX4nMfq9x5gdfe-I-N+m5M2-1-muUATIBb3Ix1hfyoyE0wxlzPyn1b1n2wyJSANvkcyZwn0V390dxn0zjnxMwa1QI30f1pgAUkDIHZT8190EmF3Ejv2IJL24BAPINbW4D80lzxlSFryL1cW120Rt1hjf31zJyGzNXMm4KPxL2QJMwkOLwym7wwIEJ3xAkCDJl4TxGkL61kNcT-nsVANbQjyhyowLlUJiQGmlSJW0N7gc3wAQUMK5WMPpVMN4R0E0MWgkKYHwFhVkUTxI3sOhkEgX3318J4LnnYysKigUNe3Y0IPoIf3ThBxZkuUPzkKuT0JYIgIgUSIiJKnQNV2vz61FEqzfVEMgMwKjyEI-3Jzj2KI7S0jcNYnaz-xIMUKMNt2wNtC52lUb04NhUPkVUQMzmoMEOWiqNKLFnMn1SPkHHiPoFL3T1DEzwN0-xzzEimIGPbTk3qPmiJXWIdTaVqGoBNXsKGhMMqBiQ0J2JMz2J+CdQfXGKVigJoKcPON4XMPOF2LtQNWnnBTIADVqSDSGPKOeLbWcKu1cI4OSFSGkw-Sllf1GKrxnFHXMmkwAL62k02JERLlHWeFiGWEnw6PvCzQHxkJnVfTqI-VKWBLdCV1HSlQ+JMxfUxIhmxMXThKo0wjZKuMKKTRTTTWdQzTpPZMJ1SD40pIaIBhlnLWZM7SFKeJGLFM5O7QKMWlFDM38PVXf0RIeJG3BDMzRMWnszyJ9x1z9170dy6IZL6wa3VNkxEW32BCRj1K5C8BPztKVkhNbiKioDHkUG7n+LHzKP4MjxFLFCBlIFxFHlIH3htgnm9zbzL0WNSH9LLkjO9PbmjPHgDKf3x25NVJGlTMLnTN9NjOzL4JZxDJGMr2WOqNWNxULKjJjJTOPwlN6JTIjKLMcgzKbLjMDKBODLaKrK1JrJ1LRj1J7g7MbKzPr1bPsmLOjOew1NvTOLUKu0uIsNJK3U7IoBECXMcNBNeKu3eJ6NwyCAOTSl3NaMHOUMBVXNWIhO6Pn1uA-hniOLng+WaOcCKXLmYwhgYKNAdNoNfKDkYKSNpX-LoG-LEF-It1mPeBVNYinL9N7MYCnmAocWfzG0C0Ki7OCEZEbMXKQUGnhJA0nPnJ7LLPUwCQa3QuDl50NijKzkSNDGF2PW3KEEGAUwMyEmfOngjlnjot4u70YvBx2VYrJPYsvOiKKykzPLWgvM4vyM9L9n4rfLU0wvxPhOrJEJiXBFoqkLzNYg-Pvk3xOKwPNM6NV0MryXLggsyMeOpJcAQOVwtKUu6Lh1pQR3kCRw5lR25l5h0Cxzhk1U+ijgJgdLVPNg4CEH0HCp0Q01AAJiUxaFIBMlivMltjtn6BcFZRMC0G43PBIQBOEAbyfLuC-mYNuTYNsJ6HjVNJBLBD3xRimSZjF0K0qooOqoQUOytPzJjJ2hasuXjgisqO1PjkmMmQOVatnLAqTF0LINuWGuGJvNMJkG4HXN6qMuSMcxkEApeLJjWtAGPMsOSLSxOR+T2oPIOu4AfJpUWga3XT3S9X2UhmWsdN30evzBPzeBepmqKO5Q201hGoRJHP0E1nMk+qyWsvMEhthRerBuogdOcqBoQtlUcC+BrjoArjOq1zqqULvGjm-Q3K0IkrkENjxsrKcpphXXODPE+g-mTU0FxBxpEUZCMyxwazJrl2e3ZWLgdIuh5rX3zHpJPJZjIPAPjjINxLxMpqekGC5pomJvcPFuLkluBmlpiHxu3AVtRvMD2S40OWzC+T8UFvP0oPWAZqs3qqFz2jEE+lg2dlKREiBA4CxvtpXCWASouk5rIIdtATXyXVABYAtsNu4tdrttUD9qw1AAAB5gRbb3bOhPaAksUIR258AeK6BfB+loKsTqQsQA5qBahmhwRQAABqeKnZeqaoMQIUKOHm8ICuk-UuiuxI6urGuuhGrDbi1O8EdOlmYgGyHOmC2NfO1S4usScuyuqBdu2umQeuzDUpJu8yKetujVGuzuj2-Aunc2SSFvDbZ7WrckMNHOdac2bECm6YIlDzKO3mpOqGFYAFMUhuxIyRU+9EC+9G-ATG7Go5dLPxErRI2aTDd6OW2+y1AMMBreoB6kfDFy20Bu60W0Le-zOMVdMZCWUB+mxOPkw242hyydVK6JQ+2JOgW2coU-YGSlQ8QiDFbsIdMgxkNihWwmyWH9G9KjG+hWiWnW0S0Mbh1WnW1B39NB2WiWM+ogVh3WlwW7WAh2EhlcI+i5PrcRj+qR69Wa1iG+02rejR2WwGDIe8ReiBlWFBCRz+tRb+muvB-++RQB85YBuDUB2k4x1+nsECJXD2tfExvWWBmKzCYxpBrIFB9hpiaeooF8TB529kI6Rm1NGx86t6EiYrIhycEh3FchkQShzGMlN3ahhiK9ZJosbChWph0m32yHf0DvOB7hnmtWzGJimSgR5lepx0UJxiRiRtd+8+qR2HWQeHMWtmZHTmNHHmDAIK1IFOKpGpLpBpOZeUqEkGnSnFKZjpAEg01iVZmZj+KpAOLY98+ZxysB7WuZUrPKdpbZ6ZJMLqF2pGZ0Wg9nE-WIdnMcRphoWgjkJ5mIDkV515WghCL58cOCX5+5p0jaQFjaEF6BJ0gxzIE-WF+DA0N5ooWggKAOcgXwE-NFy+bOpFv5p0rFL5rFbsZFwoWgm4T6aeFgQwMXCl1QKlrqFYUl2IWgsuwF2IdK0AXwcIAEIVVJCu3F5lmIWglydlmITl7lhDVJdyQV-F3fFyUizF7gGIVJQoXl2IdyVVoV96xqtDaYCVnlvl0ASELlmIbV2g4AMVgwAmbgSV9V1JMAWV0F3fAAUitYNaldABddNdAHNadOdvZY9ftdAe5blcaoAEIRJA2bWuXDXErQBI2gRQ3nXGqY73WY27WjW46Yhk3oXd8Y6AQxWg2s2gRY2w2IQBV03bW43UkhUc2-Xd8BVC3lXChi342m363y3wRw2rX421W62E3YhwrnRcpsKtnA0rmdNF7AQQwYN2cmCLmJ2mYpVznpml3kj8AWAAArPKm52djQAxFwdV-5xd9Z7gZy35bVoocdgEyd2uJ0MKMd09rpRfG5nVqcJ0lFE-FFK9mS998ESAOgNUNWJVmIQD4D1NX9mS8lqgel2ASAL5ulhgeDqDorGDylgAUUBaQ4w9Q5y1oIADlyACOrWiOCOfGdlR33gBAb2X3giK1p2AR93sRlAEMldlBkFaOP5X2qOqQuPvDmALdi4Z2VgYNWP1XnKOPOPn3uP6OpVRbWl+O5nIKc6NoHTWlqgwyKhSA2BfBrGt3yBcw8NKlNB9B2qZOGBdmOAREDmt8+GYhik1OjgihHyTNgJLYWb5EHT9aDlPPO12NONdylPkjTbmKYh+PF9wC8OOMI4uNyYLOE5N2d3TACscsIv6Pmsl12NsG4nma-7EnIZfoOABBsGxAvhg6Zj8vBt3MBJCAEmtcH2iV-5jAGAiEOy6lSBbZjBXw6B8plwyAuuQOoYzxWhGRmuP42uo5qh8p-MXwOvBvU0E3VIa5Xb6iNHsWMWIQ3J3IU4PB-tQBJv3Rev+AYhtuvJwnCgNuo4HBxvWv8wIz9BWhjgwnaHiJGJS1zRUx04nuH6ONhA1pNUOBC5ozPvNJ05QeopHMfvQm5uBurHFvE2xIVuTdfuGgrutvtv3IIe8l-vag0lMfzvi1IgOnCmQx0fwRMe3IDv7vs6EUupKe3J8migrvKEGomoDJ6p+gFAGAYNCtSneXmKbuy4WvJuzOZL1JBOaA45WhuAhH7OPVhY7uyAo4ZfqQa7iunsNUuf9A+McJ-N-1RbduSE3AleHvpv+B+vOv4fJWSJS0xTzfIZUe2IOIcWMf0lPs8K5ZqkA08ezv9fSeVgRuxvheJuaeeuZvQnyfMe2JKkOvgRz6jv8p8fGfhGYh0ehfW1Q-lfHu-kGgPu3Avun4fu9G-uAeMgP4O5sen4q-GAofc+DRyeABBAvsH8wAYCoUQduNiKgcgIOi2tAJny9V7kvtPl3zbinyn6n5X88GkcFenhn5uwf6YFnznxqMX0iLXxqHng9vnxhgXnZDPkXsPrAf8bRCX8xagaX2XqW6L2IJtU3lX9DdXyQTXtnnXwxvX9pv9aVFnSwiSoQQwDZDIDh9+Aw3bCqNyBC3dReDvfzAw2Bhvt7+ovVXj-Q16MBV+TUXXv5ifqGNWmydA0KUHBDWQeKXEVQDXW77MBtISiMoL1xD4P8euPhKXvolV5K4FaEwaRgPRIHSJy+JcTiP6mv7q03qtUfGEnFJyA8H4tMSgP6hmpCD3wBMUQdwIkFSDBBvYdAT10JjExMwpMRQX8WQTggxBLkdAQ3igE08QUcPbrgAHIIe+gP9jEAAA6WAMQaXFi4HIp4MgYIBgMMa2tq2coaCOYNzxmCoaWAYwcr1MFW8LBVgmwaAHsGODAua0Vwe4NphwR9AvAZcMgh6AXQUhoAAAF7rg7BAoWIZ4U-gJDswXg7IThHOR+CxI83b+oEKgh-R-+7wIAZOEsHOC4hXhNwaQCagZtuAQFZuiwGbrKBm6JVSYOYKdB4Bgh7XAIfoBaEkAXB7QhId0P-bkA+hAwoYfCGsCVDwQXkIAA')">function fetch_rules(pattern, frame) {
    return get_indexed_rules(pattern);
}
function get_indexed_rules(pattern) {
    return get_stream(index_key_of(pattern), "rule-stream");
}
</pre></div></div>
    </p></div>
    <div class='permalink'>
<a name='p29' class='permalink'></a><p>
      
	
	The function
	<kbd>add_rule_or_assertion</kbd>
      
      is used by
      
	
	<kbd>query_driver_loop</kbd>
	
      
      to add assertions and rules to the data base.  Each item is stored in the
      index.
        
      <div class='snippet' id='javascript_96_25_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=4&prgrm=PTAEGUEkGEAVQFLlAFgHTpQKCyUAzAVwDsBjAFwEsB7YgZwICdqBbCGeJVNARjQCYcRMlVqhKdAPoAbSuQCmjAIbSAFKVYAHWvOLkAlKADeWUGdCN55Qo2Lip5JQHMn8gCYyJ5dVp16ANKAARLIKytJB+gDcWAC+WMIUNHahiiqSAG4qhPI+LNrEugbG5qCm5pbWtqAAFvJKbqqOlGoa+X4G0XFCJEliEpKOLu6edN5tBUWB5HWDzoYmpZU2dgOaSpSMeZN6hgBke7X1jRMdhgC8l6Az8nNOMfEJvaKrUsRKLLmnhbvG5WbLaoDIauDyyMbbDqBILvT6RB49ETJUAsJQAa1usNydAAniwAEbUaQLf4WKwrUDg7wwj7yIKBXEEoldR6JF6gRmE6SSaj4SRYyE-YqLCrk6p1BpNDatXxC-QsxF9V6SJR0OiUJzET56QVFElLMXKkEjKm6gLBVXqzXa8jw7ps5GWjVaoqSTlEs3C0mAuwSxrNNR+qUtT3y+UIh1iJ3W11ZaQ5STyAAemksauSob+BqqvuOwbUAdD4e6TyR-SkbnkpGkSmUL0zIoBhvsd1Bo3GsqmwQ09EcekklertaUL0ioAAPuPSaVzMDnG3Td8u0EsoxKEp8dJboOa3XkmPJ9OZy3jWCvJ7oZHiAOq7uR-uFaWlaAd8OXm68VyG-8fRzP0SeT5AUg0LJddmLeIrxfW832STJsluZNU3kdNaG-UUcyOSVC1AztwMfKDUQxSQezGJR+1fPc0KxQI4wTJC03VWh9QwilTSCUi+3IG8hyo4h6VAGjQDoxCU0Y5ICOeZEBhrAk3CURMxJQpjiHQptMLnYYzwhMDyGhWT8XkxTkNQ-iFSggyjPWZRPjCD8mWkOg1LJTDUU0VR3W5Xl+VpQIQOlItzKksRLIUwk3BxZzf38kNcPaOUIMVdkiNuULjPEtDrNpMI6ECcKcRY9S2PPEIPkMhSGOU-dAiy2zFFy0B8skstlSvHi73rXSFgASFKb1m00hdz10y9guvSj71oO1ILGggxva2DaB8z5nJc4qxkkSx8AvUAeCClq5paha+MkWqrHq1bfypTb5G2kbQH4fbnzaib33yy7m2uradoAZie9kXtvQZqBI2gyIo28Ptc9Fbk48juNejMj2PcxAd4ybrwFLr-GRlGURhmQyqMyrTNUXG8dR+bEaWs6ctDHGKcZtGOrg96usSp92QGH03UcBQbSigaHHnE1hrwvTgh5sj+aKabOeRHmSZUwXMJimV4r1ZrnwGHs3DkZIVChilBtFnTxehXX9dodIlYfCcp0Zk8Re0jsNfNDjaD1l50ml+QbTlqDLe97lkL10gRy+cXCqurwbru83dv+5Eg4N7lSPkABHHIdS6rMiuqL7bp2x6I1mlPre5FQwneKgMkjt2vVYgvY+++6-oReXyzdTPs9IbFyBYRv86NZ32w8geJaCOge90PuA9m6es9n25fZtJyxkHhZzB-Zs1fHzek7EfBNg21ein38g6Gj3e8w3y-D7sNNuLPvR14nq+87W6pCzvq-S4OgYftNDkBxN3JeZB+6Dw-o2X8AxiCEGkGoX+D8Ww1lPnzP259kGf1gW8BBBYArIK1lzKQm5qCkDREbIEwstJj3ukEMhFD54HUYWiSQbMo6fy-rmbCAV2b-2fCldh0hyGUJfkPYelISqsIEuI4h0kpDUE0Gkcg1BGCgwJJQGuGZc5GF6tvbMxspAkFrKApRKi1EaPxFojGmZDyOwGNY94jAzHKLrJYtoTjbFdQESQyQJiXE8jcSODxrAvGdU4XovqhjqGtlNq7HYk8AmuIseozxNjRwoMcTYwJ5j3FpLCRknRkT9FmH6hpGhQ0zYN2hF43JwTVEFM0doqaKC8khPUZ5KhKQW5F3untXxyJj6MA2u04gJxInlPWtxVuCcS72gXlWT2QS0jjO6VIjasyamgHbiWQiBMlCaE0LIcO9Y2q21oIEWsThCA2nSlVMGhVuEbOpIc45lBTnVUOkqe5pkrmMBuXci59B5FiHaY0qxRSlqqJVEck53jJmlE4qAcFajQDnBRQ0yxXSfFTNicklZ+TIUtNUl1cmZgAD8+NiJvPhfWIRApUWMH0AzR2bLjymmGaM4Jaz2b6HJaAAAXNS24tKPm2IZbSVQTKWUCvZRy88XLuJjImQ3WV8qNXHmnrrQl5FVWJLDB3KCAwxWfLQroneFS4kux2kEU1GNmHPXmsClWFI978IWQda5vyVJOQtU3Hh-oApxQNRzY1UhGAINyJaRQLwnm4OtWPGNjAXjQkjVuR17IezVkIMrdN8h40314SGfNiUoL5vYdQCKqhS1cITfAxB+Ym2lvlAKql7EVAAHclA4gcJGuk-LHbCr3oWFtj48Dgrgo4Tc8gaqEHIKAPVoBXDkFwGAfAzA2CkBqIcsIOzQAeSrOyH6aAT1-SSo6NU5DVAYhxIESwGhGBuGgXi5UDa1APrUc+wdjMqUkErMfQobgBXCp7obW9fk8xBk-U+q+rbHZUug0s2DP6KbCstNeiD1wAowe-aCuwQjp1blUE85FIjw7ciI-IdFLzVBBAAFRUfo3aUoFlqDUDRIQdyt7JA8ECDxx6XCkVgwXXQQg+IqM0Yw6QG98hQF8ewyGcj6QqPFjxpQfAB6Bj-tulo9wHlxOqaeXjX8OnAPuBiHjWIoB5COWo42CmyLcNSavTJgT0xCGGY3FuNTjsE1mb040XDqHNV-vGbpoDcqUbCtHchtwXQrOkniKx2aWjp4ptk-J-jcnJD8FoghYz5hkViYk956jGLpOZd4x5pT5CVNld88eDTWnjHhfM40ErRmhMo2ntxQsynKNldZZq8w6xNiqFNDxhTY2tjueEgV9VI28b9bq4NmdhrcbWds9Pbrx4nNxZc3QTDOW8uKaQV59bCWHGadUNptrgWa1xflN10pM5etzBDJ1obWBXtLdADN1QAO5siUW39imP8Ls+eLK9rbdndsU3e7Fx9bh8vxgLZZx2yWUZY7MDj757I9Z0HWOQbdqgWCFckWwS4GKQjsc45oIIUXKWUjp1xpnQqUToquEENLsbGcaqpbzlN7PQOMGYFsFg0ISBomINQTtdhJ1iAALRK+wzOlj5g8e-kJ8T7dHdkWK+vJJjFhGyskZiMildNHDdzBnXRkRHGuN2mRZoed1uGlTrNzz+gfOuid1WOFpMkgeO8kByOQtOZVBBmJ2G2aK7eaWA+JlhTt7BMOeKzRldyfss4nmTE5UAWgMeUMFS99HO6BGoXo00VapY1wS0ZILRlYkyqGTXGrhyLb00ab8mYPOXQ9t4khjswyLSA2EsP2QfS0xiJ6p+z5dVgE-1BYJl6EU-iBK5n8vjXZhXfeCw3a2vKbkib-ILP+kuMAfr8CCR9FAA+UAY+xeunX0vj4seDpjDUbcCtDee8t9rXTxE3+xHGrho2zXjDzSjSuxH2AK7wxX-z7zMW2mJ2rhgMf2AKfwnxmSjTfzn01Xjy3yTwP3zVP3P3QL31X0lijTIO32GxnAB3zRvwuAfywNdArSIPJ3wwICsG3RVCPxeCclQMUGIECA3VpAjwpHj3-xGHXyENAJEJQWkMD1kIEOSHkPIDQLrWbEILP2X1u0DyQMAjD00MULXzUNoFoI+Dln9x4JJxqE2ijQ0OrjEJsgLW0MwmUObxGHzWcMUMGTEC8OTB8KcJMK0Ic1-F0NnwMObyMND2ENsBZWoK3CsJYBsLwCvAYA3VYHYDgEQGQHQD4B4AvTEHkDogjh2l0AyGvitVSHCFDHJXbTkDSG5BEgaMZmFTgSlTJV-RZ0d00Hsi5HgjRw8n-C8iAm6KjkCCqJC2PE6KkHtQiTVUaMXThUijKOyAqPOSUlJmxhs2IGqPoPlWum8hEicm9WBT9SmP2OqNmJnHmN1QhXSRJXaIpipQ2PjAqKZWJQxmBlhXeTNVJWuJmPJQePLneHVgNRWI+NBnGStghMqIOLuNKAeLShdR6LeJFUkCvAmyJgUlpkUEGKJCuLVSOLB0pDxMrWrT2JBI6JbEXl7nrihN6JhIZOXkPXAT7l5gjjXnphuORPMAeNYVeLxneLjGEVEUROqNBJbClgwQFgxNFJs3FLlJ5PPnulpLQxbGZkWiBLVVe2hPKIUFUGZj+LhghmrD5M1LxgeOpj1OZMxJhLtKlIFLMAeOjBdBzijkNPSA9IVITmtOixszFzUVtWl1l3lz-D0CUCTFABV2VM2IUBsKglpUimEH+ScBfVnBuzWDXBYH1jrmxLGhNJIGewc0kVTNOjzILNuBxPTMXQBT-n+Fhx22a1uykFOH-SLJahLOIDLKPH2zE2kAXQxQ+MIC2PmnemEFB3JOPGTAUHGUTAOM2FoAFnnyWzagJJGV7JnNnLxmuVynXJG3OWXOYE9O8GnMawDVlMNGGJyEeyHIMCiypR5hElhIXO8DTAQSfPZWFULws2bJszh3LODPF17Kl2IBlzlzsCghAWUTjNV1TJ33iFZFmhOL5DONUCQgahmKE1-DclbwBXvwTM+ONOuWmKROmJTCbNQoOhhPBMNg1KRI8KMUGEjRmHWKNMjjhODirPcHFWNJpKRNdOZzHIqIYrTjBhni9NJP5JAxIvHMEs9nhN9OHJEPvDritKRMrzovFLZIgQvhwuYoczbMAXyBATAUZMMv7JM2bH-LcGH1ABbOo1MqkDQWfnlKwXfhspRl-DEuNKVW5Jlh1GQX8BmMcucvh2RUCrvjvPKzKDZX8tyBis8pCu8rCu0txlcpuhzDipNJPg8sHjip8sZl-BSqKpEkctKEipAuPD8r0ukr7jJk1SfiCswVfmsoyuqKqs1ySz2TQtjm8hMXTE1H008izOvIIs8mIoY2GqtCA2YwZDGJopKLsDoHDmvGoHnWOgxhJINRYtiX0qasVKVKUFIDHxYAQQqPXLeV0BR3XPfTJMdimo2p5G2rtMPPJKOpXlSsvkCnkoGGdJOpRiaIhDtKJMhLOBEo53fR0ufBhOFKYuqI72APyho1YSpMilxWE17BZwowYAxXWvIjeoRhgj4iciakcuRTmudHcAJpeUAn8XeBGqLwGybPzwUoqPyiooXI8CqJXPPIm1W0+r3PJJptGufUCCPNFvMBmO4JhNVOCoSShH5IOoIwJlfIQmavlSSse1yvROBOErhvZBhL9PVIDOMtJGRREho11rNv7DfINtkvCtJA9IhryvtufjGL5JEgou6tfXmzR2NuRCdLJoRW2Vwoczds8jyvBpxWuOlpnF1vBsdp2OVmxkTvZRmKepGxdo5vso7gyLGiyM3VyM4AKN4FPVWpPHYpqEiiTEkNiUJCJHqFUgboSt6KTHksUDAqTFqXYy3HIhsxTCPXcHvSrHkEoDrjcGTNmiERxK3Iam5tVoiM+hKk7MXKvAv01UXryirTvX5ICOVA3o8DrMbpHloU5Qtl8C7K3pQU3OHDqm3PwHPoZu+nwECAGU9SdSOinNfsLm2g-oenvudVPNXPPhfrVrfqLiAd2VosEQ1tvLaJ7A-P-pKk1rRwEhQb1CPpvNyraJBygZNhtV9sliQYQkzQVnIbR3fPPkIdXtVjzELBB3lrIBEXVGICcCXIyAFoFkjoDsLBdpmgOkCvEJWn4Y5qDCEawGRRuETHMtAX5rPJtBo1hurvnrcNGIcgajONfoB3GtRxyBWqgjEZXmWpNLcK3gMWvKDFMfvrcLiqcjsZKGsckULDseDtKKTF5u4d4awWWtRyXtVEQkto5q3E4ZmC0a5A-mp0pF0CcEibjCvjbRAPGw0alQMcDqvjymCe4ehuFXCYSZqCieJMMAAB44mInimknob3iQytgghVFqB8ZiAcQGzAUigGAxM4VKB3BhUghQAABqDukbGfLRJwDTSKcawwYZgSAZ4Z6WsZzhyZ1QGp-J0C0Mxp9jHgztdp25TpjkLjd5Pp4IIZkZzVJZiZ-AKZ5amZ4IaEM5xZs-cZlZtZzxlIVnAYmOtozyP2p5KCKomQdjdyCRlGKCIm1STJmp+HDmuBfBEpxyaGpUwFh3EFth6gDhrhpR8BnUOW6W4Vaa2JoMaZ6WxDPMGp-FjkDaptaZmrNQN5zbLKm7KornDFORoBCy7F88inJO+phFiCwkf9QSWkHfGcGquVaKtwmjURzRvOvzZsCFix2kCGpxyxnOzVUxxxpVz4K86qvqjmlF4FrCzK+B9kaOsYvK35wOv5rhAFg4oFpRY15G2q-HZERVqFlQCa0qoWfkeFklv7d4+11F416sDF8Z3x5R8+PFv7AlsY1lrCDrW50ljkRfIMJJ1HJFoMxVn+W5ul1Zz13VzXc50oNsll2J9lhRiNnFiRCmHu0Mq1oIEgQV8ZYVz4BCxdFm-2dA6qoCnbF1nGsYJgWkaVgq7E2VzKtlX8RVzV8a7VgtdVjVTVzCux7t3qvVg1oNo16RtdV1sGJgHIqAPIrgQojAau3MygfM2uWs4s6cnBH108MeesoIVMC9msyhsQF9y9qe24C945dqvmDMW9mBItINEMS8-XYAz9ms7spUem00ZGdiP0AScwP0dlXcswdiAMZDswAMNDp69iGbbD1JxgPDhDkqKkIjqkUjlGdiOFxBASOj6QRmdD2jIIHXGsHEASdjntZj-DkqOtxgbDgTtlFj9iVEGYFUfEOgekcThwjcBgPGUTkqQZoj8wVQPu0AAqYi2M4Ztp0AJTiEIIJXVTswdTwILT84B-WM1XPTgz6kJXZJbD2M0oSz8wVXZzuzujRalGMzzTlg0AWM+jTTswTzoIYAEzg9DTizqz0AMAWzvjwzgAUgi98+i4C9AES+C-04S+pGp1U9S-89jNiYKhy7owAEJLh8uovCvQAKuMUSuyPDOymUvqvtPQAKmzAGuaOSoynzgTOCu2vevOvQu78WvzOauH9hvSugg78+vAgZwBvXPYzZupvGvqQyuIv0uXPJvavzAG7kYugXdqyr2YP3xxr0VcYCK-Qapjvv3Tv1DDvIPbvCy2pqB8QAArI9Amy7w5Xs4igj57ukSDYtNQS8ljhgwH+7x5GIGRp719k780y+GjU0dieygSey8HmW9iSAYgQDOQTj+bnHvHkBTH0WsTkcBw2ASAbD2TyQKn0nvc8niTgAUSI9p+Z4Z9nPYgADklBueIvefufM2-tHvcaoOEeRN4YVWLu8YCLSBiKgxSAkjxe7vEemyjv4fVfJeHaEJvvZffv5fXP3V5QbvNfCy1e-cUy1iqyzfr2ez6zrkqRX7KyG8dNGBpAcRw33ulAsh1q1xgFtb5UVfCzf2twbRbFpyF3jxHevBogZx+rP9yQBiuWBZX75y7qq3Bb2dbq1lg+7eflMnM7-tIfEeVXOfzAc-Gg8+ofNqPuvupbZzq-S-dGo-SgK3gFFGwHuWO4twF05GnARF8QbYu+VHCak-M-U+YeoJrJp5JAl5Ak65GBCRp4DC99aJFBl-8fSNgCM4aMZ-bh5-IotE990C2zF-N+QFavud1RwnbQeXuPIojP4zUxyFlJQBD-xBiA98zAVdjO4-cYH+qgEgPvzn45AXEqgDOOGCcq9t7MeObKuvggElUZwDQDwBWksQIDX870SAauzMBn8N+YbS-nV2CA39ZYPLUoIAKf6-8O26WM1m4ErBuAEKv-P-lEGgHbZYBSWGAfDgoFMD4yH-L8sOQYA8CVcorcgRIGOQ9o8CgfBHHoQ+CSACK8+UxvfkTrADaws-Q-lILBxpYuI64Y0hnFcISFy+stLiqAMUCRQ9BHIcZr32nwyCV876MMOgRQrV0X+fcNUCYPAHH9506-JfgQK04mUcyeCRtB4M6BcCxBHHOjFQP8poowg+ZGuO4EYGitxWeMZFLvwxQgD1BQQnAS+FCE9pwhVAtwGuEX59FNAn-b-jwJEHmBABKgkZAfzAFmDC2uA-wfwRoEZhsBMLCvnQMcJbgeQ6iDARYWvBYD6hM4CgQAEE+hi6OgXENUQvgRwSgRqMEzQDlDccnA-thUOyGP8hB7-WoWSEfKCChBczRYUMLWGSCmcnBOQb9wUFStLOR5KoWoNqFkxuor2LQfDB0G5BzBK7VvqUCSpuCzBDISwVYGsHRE7BG2RLHqzxy2FAq5EOgJ2kUCr9502-XGikJALVDvhsIgwFTWAKmN6aXw9QeYMxZWDrwnBVQECMcr1p4WmI2psEFlz4x7C4zaYY4H5x0kbhNQ0wQYXBhUAKi5g2xm4TgzcEUBnQ24OgL6Gt4+hr9bmFGmFHNDmIxbY8FSj5H5oJRdeZiPJT5G9DJRfZXBiqKFHr4nkX+SwE0MVHXg-8geBUcfmYgkjmwQQDjEEA1EdD5RgBUkLqJ-y4EjRzeGtNAXNGYRLRaIa0SWDSG1DMg+AlfgAHI28qgGWmYAAA6WAeUZXz+L4A1Etg-BOZ3G7PYNUQY6EOfwxYDoYgfo0wQGO8HBjQx4Y0AFGJjFHIM+MKeMYwBXwA5CAtEJIgfVrGBAAAXib0jHThYxlYhMas2TGgBWxqYkbOmOCCZjp4dofRAkFHaQjoRWwEMeWMXJdjqxqXQIB2jmb4g5mpAOZjPXlBBiugeAXMQv0DG5BZxyiecSDCrEr4ouy4kqEoFXHrjNxkQfQEOKCDwggAA')">function add_rule_or_assertion(assertion) {
    return is_rule(assertion) 
           ? add_rule(assertion)
           : add_assertion(assertion);
}
function add_assertion(assertion) {
    store_assertion_in_index(assertion);
    return "ok";
}
function add_rule(rule) {
    store_rule_in_index(rule);
    return "ok";
}
</pre></div></div>
    </p></div>

    <div class='permalink'>
<a name='p30' class='permalink'></a><p>  
      To actually store an assertion or a rule, we store it in the appropriate stream.
      <div class='snippet' id='javascript_96_26_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=4&prgrm=PTAEGUEkGEAVQFLlAFgHTpQKCyUB7ABwFMAnAQwBcBLfAOwH1LyAjAG2IBpRCBXS0OToATUAHNilXGABmpfAFtQAYwAW5QpTKgAzKAAUAZ2LKa9XWh2WAlDhm86p2nUGHD+ZfoDWxAJ7dSE3xSYUNrUABvLFAY0EDKXlIXakMGOl42Nn1A5WDQ21jCwoB+UAdhYhlqOmJhaKKigC5QYgBHXnIsn39QVWJyYX0+geygkLDrAoaS3v7BnLyw+umY5vI3D28-bmZqLIXxyYBuLABfOwcncwVyHyZWDn1wqMLcukMBNg9O+-ZiUAAvKA2ClKPoAEQAKmYf0h4OsJ0K9kcZhcX3wXl4hC2vgYAEZuN0GAAmZ7LIpvD6gQy8FgwjiA1zuTxEgmgXZZL7KH704jHcmFagyAwpBjlSrVWpGWm8yaRAXTeKJFziqo1YSI6anFpsYzylavehUg6iIHrZk4kk7ch7aV0h58hEKhpKpKgUWqyXzMbCKYGlalT3q53+1bsm37H1OlbnQqx2LIq7Jd5kMGswl+K2gABunV4fP100pAhp9r+jPNm3T4dtXJ5Dv5KyFItSQalpdlZND1Mk91r3zYvw4nBD3Z4NtI+hBH0tbMIE8txO4ubY+cmI7HY45U4HQ8d0a1Or1L1DxbiPorGxZmaXNayHYbB-9zf0HpEEvVo1yITlJ8KAEgVmMSg+3vGUHRHQDNxWedqEnWDJyJW8VzXDdoM3bcHz+SYnSgmJtWIXV-j-MdgNAr88mXPM+U1f14waejQEYxNUVAYQUnnSg1H0BQu0VSRlVAJQARE0BwXRTFCHBUcGlKCSsRkpohMBUTwWqYxSEoaToNKdTU0UwpmjIeRJwUbhwQcLw6HwAB3FwiDIKhnFAABaFzwz+eFaKY8lXRcdjDE4tQTnOLAzwcihUT3RkbjuXknhOM8JAEIEIqc+g9wheSpKdM8+BSggSEi5xMrUlNNK8i4UWc0VmDECRhAYacwVyBRCHoYg6EoHY+nuMQ+JiPz3VSBD9Fa9qai68IADJptmEZxo6qaVKBSherqkKqqTYa0nIBRiDGxQJs6ygBvPBI3Vq8h6tqJrQUOtqlu6sS6D24hKtCliavfAAPBgiXwGR9E4s6-KGOZgaoflPsuVjkoYD5Aj2nE2W6UlCxiM9DEZZKUYzXxSW8oa3wqNV23CUp0kyUBmkMTbpFAL6jUZ+QlCgOBEGQdA8TQYkttY0UQS0CgskWybTox87BKum7Guah7jq68yhcctgPqwJm0WoYWfhQg6xZO55Cl8gS3WGQZtwNqanRh6rrluYhdv2oxfAUFh8DYUHTa1mdwVe-bwW4QxXfdz36c16kQ49hhAad-Wjqer2Lpcc39EthPxeh-matSc1qDEOh9q6hXE8l4nUjqhq7pnK3nvBPOC6LrSbY12HnIbwuToRqPRYzw2y+9+aLYjcGRnTx7M5wzaI47puGD1hhiB+whAjcZwS8zgfk6HtOR-HxXTqz1u7eSVIKmUNhyGK+gN-7kjy76qv5dr8ziyEEDz8v6+6HhUAAB8-6KRlk-e6L8xK5lINQB0DBP5X3Sj-cIACgEV2uiAmufclZiU1jAkwX94Hq2PttWB39u5uw9rfZaf4hrBzIYOWO-sDqp33onLOEdiHwPntRRey9V6GHXrXAaQ0mF7xHgIo+EdYqOzfl1HBF84Gon0Awqiq5HZLxXsQNe9Ak6CXluCaRH9cHyOcIHUASicxcLUbw5wLdCEC1SJfN2whyDcPUZougFCJZUMHsA26z8MF1wcSwJxLirH0HVhHQJwT5wUH2sLUhodDAeMEYPG42IaGhxjjIOO3BhG2jES3CJe0gnOPdsIXwSSMZCIhtuZhk8bESIdk1IpwTLEaL4TfaJb1haGG4KU3w2i3S6Mic41pbiTGdNiWQHpoA+n1LbuYUU2D2EKIEZEPCoATbbx8XLUB-jzJLMMd-cJ8yXAHLkSQhhFT76D2agwQIQMwF4gKScxmJzZF4KihMyQUyrmbJ0aCO5lQPHcEJmcWxzkzkfJKn035hQhq3PucC3QzyT6vJPu8pg+AGD6PebC2IQ1JHYqNMwGRyz14GQTG8slGVLkCLQmOQlwyQltPJehSl6LqWMC+d0pJ9L0KQqMRlGF+Tw4vNFH5BGzAtBNzxVLS6KDZbVxanssSEqPhUGIE3Y5qKJWjPae41ZXjt65N7hPQ2czUWijeOxVEnRZVytPo-XxuyzWYL0fQG1zgfh6uMYgwBoZtlKqRe6kQ2svWDnVdKk62rtrWrDfQH46j2Lci0LK+FALEWPJRbGj18bXqDkpG0fMxdDXLHTR8QFDyVWgvOBHONtrBydGFq9Gg2Z46us8WWm5GagVgJ0Ba7aopjDtE6soA6HwFCdvxd4hVaCwQTrrsO4tY6Y2sSXaOx2kbNUnUSQuo2MQu3GuqSPPd2bWJVFIBWrdMqF1hEqYPVOt6z3OVXiBa9O6jCUEnXeo1glMJfsoGEaeYrUias0Liddjhx0AZ-Ye6WqQqb3hg8+hZ9j1hvqldu4uT771bIQxkLI-7v3iJAwwdgHgvD2ofpXZ16CO3mXI8oLwq7nKMa8GR-AZSqMPuPXk-xrCXmErY5+jVTcBk+zBOCNjJj31TVFZa1IaVKDBCJW7ao8CrnrL+fKsUr1SC4iUyp1qLB1MrP4--f1z5Ugmb0wZoqVAjOKBsxpgRwGFO6avnZxyynSCqec2ZjtzwtNwpnU6nZdGD7mQcJ5mO9mfN+dM76tzg7rPqf07F7zjm1Mtv4eZiIwXp14bC0GsBUm0tecill-zSWwUR0M759J5DS0he3gi3tKqnnJfPXBCtaURDcdaz2qt9HQA1vBeYYw1qMsUH681wr-yK2ZpVf2+T21CUaEICCFN69sE+voNwK+YheBzz2+8cTwJ7r10IJt6g22wncF2zwll+3BCkCOydp7bigNgvG-ZOLVXEsZWUwwDbW2XN5fJOFf7pBGT1fiU1-jRNQvRfS3D4zgODX8cUqUdb12wcKMJZc+r1g+VsoNPLC9vX7Ozf45MRSzRcc3bu+4wnb19DE9J2T6YFOesgT64MOlFKuexEmx66bQgBe04HXYkHePbvg8C7h+DxW-Ejau0z-BKHTlvNO2mnjY9RG066+3N7zKvt66PQb20tTzXS5zncjIB1zSpmsVvZXNHwtgmd5pZw5lSCO5Y+YN4F9eD6uyI787Jrw8cAEzqx3HGuP+5j27nTiHd7W5Hkn-c2OLu+06DZcgvgK7+-en6FYzQo-biz1PH7eBNbYzkIoCAMB4BIFQGgHmeJs7mGIChDVSLOrZmSUVlWIskkyTktrVWnCVHj-9M0UUtKsf+jkvgDEWJ4eDj1i7WhmS468paHQIfMkF+5zl8zufBpSig-Kb3vM-fHuuLD3Sw-Q-OfdlubHPWiTDtm-1Ykl-QfOnefHaNHJzDHS-AMFoPvVNMA7LDhYHUHeXALA+EnV-MvBoU-IlUNBtSA6YUoO-AtXNXAsBIAk-HaJlXXARCfISRpTWKcZpZxblMgTfAA-jd-LnJlYVdg9A8godItDdPA2SaAn4SDMdIwAQqDSVUTD9QAo-DApSUUYTaglfEQwcZQlVMgkA8Vb2aQqNEtZfK-NQwFZOPQrDZVEbLQg0LAgVb+JJArKAwgjoVNSFTFbA9VUlXBA-Kw8vHaTlIQooAglcd5QVTHSw+Qvg3ONeRuE6AImYQgkHaIzuAw8I4-EA4yYIYNSyayOySOLqcgH6VydyJwjVAhGePHcpZEA7N7WDWIF8UUFeagBQMNNtBgeg5EX8BUIaG-BgRo5o1tR2dohwaosQb7WIAiIid0YUV8VIRacoNok5fQDos6TGYlc8GkNgAqEolwt5GFDojg4XGIJeLQEQReI-OCegGVIXYXbBZgy9JYhwEna4rnQ7HpZ4snXbc4+QZIsEZYp8ebHTCVbfVeDIU6ClUoIErhN4E4sEEEzYhQ6YZoNsDUZYCY48BUDIycKosSbI2ybXVFSgXwEgIowQCoyqcYn7CJAFL-aiRJNRaZIAyWB1Wg7EQ7QEAAPjUOcKdze24CAL5OXm+1tm2gSPrXDQH3kJT0dUoH9zWlvxgPjhwPDV6MCGTX7zkKHwRPiIVMOiVITSIJTBHRSNQL5IiNDCMh1LFP1JB02LIByzbW8PkNW1YgSLEOg2-VNKH0lnqNAzakJIRkkPEKfRWIBJVHfDJhRLjCPH+B9KaSvUwxvWQxDMGkHm2IOkpwwxkOw2Q04CAO8jROIhDDPAzMlUnRn3zEZAMjTKWN5zMMTOI1zKdJDFjMhNnxLIXXLMdCZP4m3nbIA07O8ijMInRO7CGldMDIOmeNfTrI-SfUbKH0HIpLjEpJeU-yyWiySPbB7lqNDJZJ31Dg5LEkhA3L4QLlqDhCDm3Ltwm25EYHwH4BCO-jYMV2uSKzdLiJmHIGUGUGOwyH73eI206mEAOJWEQxAumFSSMFvJjgfM5TeMOLdJnK6mfNQOAO0LPkOQV1QJz3lk5U3ySS1NiGaEQ2dOcgSI0NSLOjPD6UZDYwT3KVc0hzWLrF1EZEMGgvvIMXOXgUSVmW8jPBPPznVGxiBDXI803MGBYrGN3OrL6QFJOMakHwuJ+J3G5F1HAsOLHEErPNCG4HeM0oaCAOvJcASLVQTNiNIMlNfMEkJVbPzH0GuOrN1U+2fx4KMtIp72CNngss0KsqYveAED1kZGrO8pkQXioLcqbMKA7k307P0FCrfR7gPz1k9P+KGj1g8pMuCP8Msq9JIhisay32on0DwsKoP30sMp1LwvCpcty0Cw0sOP5IqqKDzO0zDNJi9HpjrxOQb1Zmbw5jb25ksG72lNlNUHKR+nOyULXw4CEH0Emo2VDFKB+npxaFIBMnmoYxmv6BMuXhMC0GAvPDHWoDbWEDKMEzoMWLuOmTkvQKlNz0kzmNOM1kDmeOut6U4x6FatrVIyesanaKmtnVo1+NfgTnmJeq1zRSTF6LgUmXuJkHOzayBhkG4E61qxeWwT2MRqGyWJBUhs+OzGUplQRvuqRtxuRUytoLuDssVJhOxt9hppMWhMNmN1QxMOVDir1kBpV3uhStVV0L1kDxcBpuwJhP0C5vuqjy5uMsPwvnwD4ToDEDOMJu+JlUZOsrdG3G+t+0ZlrLkDZ3Vrap3m1rPDWlUT9NxCUtVpOkZBIpGqpsGJiXHW3OUXzB3JTO3lGkKumW-3xqdtYKWKdv3QPRa0ElTn1v2j9rek7MSQjoLAiGNlDs1pHjjpluOKAuVqJtiO9uURuvWFUT8qTrRE6jEDWn3I9jvRElEpLrLpXCWCWvHDgh4joKdvLvUvMV1DQJYHzuVsIrDA4EVrLu9vCAAB5gQa7VBxbOh67VDMSIRlN8BaC6BfBXt3sd1qQsQbtahmhwRQAABqRasnRGaoMQIUcpYe-esScyS+iq4+xWs+qezuvummNaja8EBexmYgGyVe47demkOXbesSG+rnO+0+mQc+q8y+kxXeg+2+mUk+h+uukjVFbKWK7fQq1KyWCOQfJqNfbEQ2lYCOdiuanOju92g0B+NPYeiqggo-XBogfQUdL4BWpWq2y42Ioyiq2mHuFaHeahrnUoVOJBrh6kW89Pe8K860W0JB-45cpsaYwfXhs2xeC2zO62yhKs9azIjBnEugd2coUxN6ckw8Ycws7sYsp2xkEsuOxhqK0MahMRuOgO1Ohq0MJx7-QOt6RsLUckRiMcuh9EfBps4U1iAqnuOKnRlcTBkibBgJvB2xvKkMIhsR0hpB7sl0ULKhq8mh1-ehoJuWlhtR9h4uThrnbh2hXhx9bJgRnsECIR6e5RZ+3w4h9xTCSRu8R+iYRc-CQ+hoF8RRqu9kXqMDf0thn45MlqrRycHRiyPR+8kQQx-aEkhK4xhiaM9JikNYuOqxvW1u1q0cweFpzx-aZxoO1x-0dx2k45x0bpnyORmSuJhh7WhmevFmJvdmVvLmDvDAe2hoyBfok6wYxYjopXHTD3INbE8EPolo0vVmlwaFgYhgJozbcwjTEF39M2XjLIZY+mPKf5mFhYk+ESh6hy7nS7c2ExWIc2McJ4sl32DkSlmIDkGl9-XRBCRlxumHbsWlhoIZUEDl5qFl50XRRfAjExUV6mA0HlooXRAKTbQvExOVy+FeqV1ly7TExlzE7ltV32G4NaEHFgQwQOPV1QA17GFYaVwoXRPejl2ITa0AfpQ8wog+lVy12IXRFyW1mIe1x1gETkwo9yV1nVyTFyFHXwRlwowoP12IdySNt1mIXRC86YH18IaNwoyEB1mIeNkl8EYAL1gwH6bgX1-10AMAIN4Vy7AAUnzZTaddAErczdAGzd0SrttdrbTd4f6WDYhAAEIRI23C2HXU2S2+2gQu2K3fYR6a3B3i3QBCix6Yhx26XJMR6AQvX22S3V3F3m3Lt2Tp2i3h253QBOTt3u3wR2S13uAigN2j2L3T2J3JMe382j2o2T3QAe3YhJrnRco1iEXAXCXobvbAQQxILzZuA-3Wj68f2AqeB8XEXsF8AWAAArfakSkDjQB4lwaNtluDwFkxKPP4jSiDoFolp0MKX93D1o-RYl+WXRZEkxZE7Ngy91y7SAOgNUbWcNq9tjjjwkpj5jnNk1hgWASARloTkT-j5j3RITgAUQ5dk8k4Mt0QADlyBlP83VPlOmnhdoOqRiP3CSVEraE0OVhILlBDzU5lA0D9PqPdOBAbPiV34Y7gPTOMPzPo2o8rPrPKOpFHPkKyPyjNtcR9Ohi6ARjmpzsejqhdMKhSA2BfAT6GAkPyBcx2LIFNBSXoJ9PkWOAm40XHjznV6IujgigVzUVgIN8xmZVzt07TiqvYjrjAL+sQu3lSHmqYgHOAqnPh7zmmvBgWv0VEOUPTBpl2vYOmiCWcVfbznlGRnLavjinTp6YOABBlGxAvhu7Bx6uuo2KBJCAimVKAuXloljAGAR10s21SB3ZjBXw6B8plwyBrvOOqK1jWhGQTvHZzvylqh8p-iXxLunvCT33VI+EB7m4NmlXC8IQ3J3IV4PA2lQAvv3Q7v+AYgYevJemihIfykHAPuzv8x9N9BWhjgmJ1mIhGJYzvcFFieJmBhGos8Y5fMqf15mehVPqifvG+npiAf5bOPgegRwRQfo0JnChsfoeYf3JWeXA6fagiiJeMeCzIhGJFeSJReOJlXxeJfEeCeV64TAM5f5fZHYhsfJUkYFBMv-REZ+gFAGBILnjtm-Xmrcer5TuvuLfDj1JDOoFU1WgHsg7FOWqFT8eyBylffqQT6VuMorfkZEMcJ-jzgQnnI4ex03Bg-Cefv+AHurvee+PvTpiJWsgM-D4If1eofwQYeuSHMYdhZmiW1Zf0f4+yeizXv3uXfPudfbvfvbmxfy+K-hBIFLvgQ8Hkf8oDfPWjeYgxfnfL12+Q+OeJ+piWxEiNJqfOjuw6eHcOBGfl+Xcb4pf6L5-bm1fAoNfwQABBNwXf6X4QCoUQZTNiKgcgGZfOtAVZooFXgyHviXtybXkP9Y0E7GN-zcjQM3+KwE3tH3N5C4IBtvDDvb0saO8yc0-V3h3ywD-h1knvd+N7wOhh9U6AfQoGmTT6h8g4EfSQFHxlLW9FEBGOPrc2V5gpjYEcEskIEMA2QyAnffgC9xg5vcgQePN3kX3+IWM3oxLAgW7zD4sNI+jACAZQMyCc9mSBfa5jPSMJ+xF6erNQCfQf7MBtIIBJAbP3T5dcuoWAonjkghhx0JgMtD4MEEdj79ou1QCoD9HiqX8fcWiSWGeG6CMgbBS8f6JmEBj2CV+1ifimsR-LrUu4+-CAS52gjwxJB3QcyFLxcgQC3++UHENEIcGohYh5AvaK9RggLgpe3AJ4IeUCGBAZEIQtIbxDME+ZHYDPawb9Gjzx1-KenKgM2kZDB5VwYeavP4Jg6uCgQ7gv6ADCBicRm0-AgIYkAKEgQGeoQgEM8QiHFDEhqqR3KkLN7xD+A0w8EFnjmHW8Mh0wUaFnhyGHt8hXcUYcUKPg8Cde88R7vLQOgAByKnvoAE4xAAAOlgCzzxVrsGdYHDIGCDm8wKDrA9nKGgjnDzIPPYwJVCOEh8Th2fG7pcOSHXCbh9wx4X1zcJvDSA5vUaLwGXBoEegyI7gAAC91wdwgUHCNeHvDxaRbLEThC5x-DwEpwwEbhAPSMD3gLAycJcOeGnECRiIn1twF0TkBoGLAaBsoGgZnVJg5wp0HgGBEXdKRFw-EVigRHm8Z27Iy7JyIYw8i+R8IawOSPBBeQgAA')">function store_assertion_in_index(assertion) {
    const key = index_key_of(assertion);
    const current_assertion_stream =
                get_stream(key, "assertion-stream");
    put(key, "assertion-stream",
        pair(assertion, () => current_assertion_stream));
}

function store_rule_in_index(rule) {
    const pattern = conclusion(rule);
    const key = index_key_of(pattern);
    const current_rule_stream =
                get_stream(key, "rule-stream");
    put(key, "rule-stream",
        pair(rule, () => current_rule_stream));
}
</pre></div></div>
    </p></div>
    <div class='permalink'>
<a name='p31' class='permalink'></a><p>
      
	
	
	  The key under which a pattern
	  (an assertion or rule conclusion)
	  is stored in the table is the
	string it starts with.
	
      
      <div class='snippet' id='javascript_96_27_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=4&prgrm=PTAEGUEkGEAVQFLlAFgHTpQKCwMwK4B2AxgC4CWA9oaOQM4D6pAhgOasCmAJgwDb2kAFMUoBbAA7UOhUgBpQpABYcmbAJSgA3llC7QAJw6l8+mvQbjm5fcLGTC00hoBkz0MuZdbEqTI0BeQIVlVVYAbiwAXxwCEgpqWkZCZlEOb3tHDW09AyMTM0YWdm4+AXTfOVAAImTUqrUI6KwQUFiyKkI6Vv0xCBh4JFQ0AEYRmKJ2hI4AN2ZefGZSNJEfBxl5aWmsnV1DY1NE0qX9OfK1px2cnIB+UH5juYZZ+eW7CrVLq90ALkPa19WmU+X1uvEolAA1vhxAw6ABPUQAI0ovCec3waXhSJRDEouAY-zOmQ2hC2wKuv3MzHE4n4xEWHSJfnJN1A1NpcMEM3RizSbXihAYHAAHuJDHQ6IyVhk-CStrIWV8rvw6KRcfjnhi6IJmPpWELReLJdRtdL3nK1B8lXpKYxKOIOCdSJR9AwVojyMkBUyLtbdLdufNeYJ7Y7Fi63WIPV6OkxKAx2XSGdQfWoLYqfocRIQuOQBaczecrX6A89Izm8x0C29zum-aBbXwUoiuMwDWKOBKpTWgfXbqJmBCVPzGbxm62LLqUkZHbCEcjeKae7KM-WlWOkRPkVxOYXiaBNsXrY26BwAI4YkgAmW+ksHsuni-SYiY8+Xl+wlhLVIyJeA2UHqSR5Ko2iJgsQEKpqupaPGBlAQT6dZ+o2ez5J+vI-kIe7Mn296PKhpjod+jiIYBZL1o2I7UAwXAcMQY5Ot2-5OAAkDk0F4UGSyCFRgq0fRcblqqzAyDRdG8KmSHHoc-EMcmhBQbhgZifRU7ethlSHqujbMF2rCEJhil3spumSvphkaVJIEHvoPQ2JZ1REBChCUAA7jQ8IyMwwqgAAtL5nELEs9SNOMcQdGyNK8JysTyLqrB0NsejkLgoCCOYYrkKIlbTMOEzerElpaOSBE0ImcIWPoWU5Xl4UprFbJ6olER6JEB6LhwtCpeljBmkQPC8TxRBFdkVzZqquR0PgvCkKA-iBcGvEMNuMXDQqa4bUqIpLDmQqktY1CGaum1rktlgnKkxzaoV60nXdOTxXQt33fdS2bAdBkkYVlotVcpWHKVaIvII4rTbea63IDmoqNmO1CKDM3AchoD9RwuCetwv2gG1HAdcVXyOnZQ2EPIVROS57mtPlEWkHCDp+QF5UhZc0RNLxdwCOqQNalyopPWRSU5P9A7iDqepzQAfAt3HxRaGx8w0URhZMNDKdmub5hJDmHvjej-eYpD6PgSicoGQWvBWmuVdw5D0txGlpgLSMgtLFsa1WqLjW+JEO1Z1lm8G6uVtQjxzMcMa5ZJAuhXg1NTA+3tXoIqqiKQ-M66NugpWl5gcBItOwonL7J6QqeJYLXz-aj6MOFwWPY+1p5dTnjBjqqRF5yRKdpyNir-QH3Ho-o7fCcRMgl2XaaHvXON45nY0mrNQ8j6XarQ3NoDHa7PHWCvGFd6viWyNPirZz1DBQ+ifK72q3fcxwvcbf9y+36v9-1zks9N-P1r9wnT5Jy3kLTsr996-gnj3Y+QEP6tU+KzZWAoObtzxAwIgplyD6W4MnecKJEq612HkA4ItsHYl4JLaoAAqNBela4UKqPILEC5mpK1jnVDy9JBSUGNipOSAo-w3grrkfYBRC4AOLg7Y6txmDEGIPgUQ01gxAIejSaQXBnonUINNXg6jNrELoBw3E3DZJqQ6E9JRSpHzvhUKPTu4CHaWmOo2YxjEUwSIhkgoQzj5JzlIamZ2FJQCaN4LwGO7NlJwQQtrIC+DQDjVmitDeESITLUoDuVM9c4l3HgnMLo819EiUMWqLxfDBArUVjkTJ1CzK11yR4rmVSMG10EOBHJ5S9aENVpqYMK15Y7R4O9Hon1x4tMXDol64yrgNMwVwfm5iJlrkPIrNmcdOn4Q6R3Cyy5NLRPnsLQcKhL7A3MQPNIgMRQdi7K4rZjtFmhJWZxBMNDNnMQtDEzJ695onJ1E8xw992xGiYgIi09d0H6R8Que+3zqmYXBSiKO0NgWfH+tDO5bCHnFMBRUV589QWCkYTiaGggMXUXxVra58g5nWi+cSwU0N-mdmNApX2lL7qHjGeMk+wDhEoxzGjDGdcWEtF4l0XAPRRB9DgIgZA6BRgACYEERXMPcMMZLmKCP1oUNgnAeAqiwls0myqTi8GZtEdmhrHiEodlodiXL8juA4J4QQLByCqoEUshVCQBxDgJNOEhC51UdI8YIGo056GgFJe61hKtw04NRCgwkVrdmBo8F4Z1rr3iRvZlSH549E1IsDQbLVJRdWkSqLizCJqo2IPLb80lqYYn-RTU6qwEkm1pr8T9JW7Ma2iTpecgFVy1UNuTQ61NLbm0uo7ai6N5gaX1qTdywtxQdVlAclUOJIkiniRMdQeooAAA++7jpLu1aUVUpbZhVWYGBFQNK92HuPZq5dZ69UvOqEtO9mb7k0themos+D-qkq5oSNt477HuvZj+vthoGWYv-ZnRto6J0SXbeB6diCvUw0XpunhO6FL-HkNBi5jKA3cpLeu7Dok73yAI6AIjA7CBfrRUq8cbZ+2wcHQIgDBan2npLWujcLY2MwcuYQStZrWOTgujOV0pL+HvG49yvRsbgPTnkKBydaGu33ME1uVJu5rmKbtRplDYHrmduWWizDTZNzCeI4yc604rryDKcOsjZQqi6bswxsNjnLqOn5mU9DirGAfu3S4plhnNBsT0PmxdvHi2rv1e+lZuGIvifuWF1SEWfWpHnXFu1uqL5o1IsMCDmXUs-r8zJ+T8GCsHCK4YXApFZXlbRVl3hsYVr5dtQ1zmTXSIAGY2vRo64JDdVHxI9faUp-ZQkWCTey-JQQ5iOt4dy9ec05jrNefpaJlbEy1s5eq1dSSLKqZsLS947rWnLMzsYIDGxzyuMIZ46EPjSW31VEe1+WxpAMtorOSJxl02hHGaQ6h8zwWEjmCDprUHYODgnsS+etdcOPZ7cZfeo9a5kcrtR8lijlsMdPccAD6N6OQ6og7LmO2m26szcK-1krDkyuhXZpT5InsTSJ1fS9y4-1Gss+S619n9zOehxmo6CO9PMhGb6+3AbDlhvQ5EZY58mJV4Vw1e9lHQhu6k3V1ecniCjcflJ+A7uWRYuM4OCZiBFmq0RRfhsg+k95c0Cbd3Zhpr7nilAWPNOEC8Gve5e273I3EG53zhVM3mv3eh7teYIJEkI9i+Y63XSAe-vB+129lPyHc9Mfu8tcCkE829ZEUUD7BOvtJJNxFJJKS0kV9t57iHZm1WR4itZpJJcwFODc0z89VR68MN+5hYvUe7QOidBGd0npluJpi7oerIi0H6AqqGOfroF8xk4wph9uPGDRl1Fv2f4Zd9RkX+pa56eS8b-P2GZ0V+kQ37g3L6LNq2+HGr3r0tj+uIF+L+kYb+++Ym3eMOJ+i+m+QBz+8+1+4B86K+m8lev+Ra+OfOWK1Qp+sB2+l+oBp+AoDeCQ+BIBdareBC7miuwub6bO2m7WN8cBJwOYCOguzOzWDkouDB0ap46szBIkXglBiONAQunByWKuLC7M1miYtsy2b0wOHQcUeocivy7GomIea+QaZaUUchxB8gCh9m1AyhrAqhok6hjKPuHqNAZBCBYB3izoCYuhdsH+fgbyi8oAth+gG8Xhv66SWh5ggBvhe+S+1ykioAMhzhy21mhIXhaY52a4JaLu+BrB4GjiERc2shLhKYMRvqcR7K8yegSRTBKRQh5KCRd0fB1APApRU6Uh9yVIURt+Q6ieSOCWmBpaWR8kJBNAhhDGoOiGjqkOXe9+1aeomOpiAxI6Qx46wxbqkaQqKyIqYqEqAw0qIwaAg21hv+RsJsggwopGSeJ+4IvADqCkBxqBuEwo6RhMLo+xpMyIKIZxB4oodESwaiuQL45AuUXAlaTunqc2g0J2AWLm+m2KWh5GfUu0vE9CcywJw8oJO4iKvuGeoBkg-UDAg0uAhxbRuuHRuApMUJA0KyPRF2KsUmTmAWPEOJohHBPE8g9BKJo2qW3W2JQ+CuaoA2BJoA3BTJiCb0+0gyhkbJC6w+nJJW3Jkhd2GGc2hyGItgMgn+EJHmcpHAYasMmQoxIWxWwikK0MNJ6Bz6JaCK1QqppJqp5YcMgg+p7J7eMxk6+pU+EUz4YIkohA+oAyh0JEGcWh7aJ8fJzuTBoqvqPpaBTa-pWAmSSgKgec4gBcnpQys080KeEQ-xNA1mwZeWcmhGV8mhaBlg1gfquCOZLwVh7MmZ1isa100m1uNuP+TaFZkBvR0m981Z04tZq+aB7ajZquLxfSe00wH0hk2ZdGOSLmukMZOyEJ0grASgRZi4AQQQpx7pc5zwiU4RBZNgGZ0m85-Ma5jsiIE5A5-iOQvwy5s5igu5GgAAPHcDOaua0uEbcTYFUM6JQBkYQHCI1KYZhF0FNLodwL8FUKAAANSXEvSqhVTukpSchyYaBgVhrAVgXnaQWeisAwXWmtInk2g2REyvngitAcCuTflmFpzhrQi0jkCAXVCgXgX3SoXQW4CwVVnwXVCky0UoWGxoUYX7lOkJBgiQjQi-qQqkrgk5BhKkh8DgiiyhlKjsz5IKQjn7kxK-z55aJXnnYBiSUCUyUkCuloUDlDnelATYUUQxqkJzRBBe4sWaX2qOr7nna-AKWF5wXyDtq8UwK6DRDWhnybCWXzTRlCgx6GVClKkbTPnzmkxEDIj9SBKhptJfBfydQ-xKiZIVkbwu4VlcjQJbyAYcI8QtlyYFXtkFGvQtnQxtmpCdrWjeWwJoGbBSX2jZVbC9m4rCWEqiWjnaICwxISXTCNW6VbAqV6DyX5VKWtLDWVxqXBIaUTJaX9U6XZX0SUBukemClenjyLKOXmULj+V2VeBwW2WnhqhNprklmmXIzOXh4sVuXjoeWKhtSnzdR+WBABUhCxnxnrWJmCJUq2R3GdVkyEAxU5hxWpAMxsg5r-YJVXBJWTULydBLzSYZVBk7mcprh5UiTFWpC-qVUPylV3QVmtlY0PzQ2fxwJaENWLURnNBgDCrdC9BQCSqDAyoYDbEZRVTZQUC5SYkrLEx57xZ4kvrEykyZSc3fFqlNmgCi01QMBZS0h-byHDQe77WF7fQxyZLS1c21Qqy1IlosjkYpphp6ApqbTxHrgeZppG26Bpqm3srkablW1S1WDeEbRm1fDka6qO26q2360ebJ5aJhr+3BL1hu3Kgea5h0C0jMBwhhoR1R1fl+ih05DkbPlW3Pmu120eYDhKAJiIh0D0LZ2KC51dDWhJ1FEeYgWO16D3GgBwgBBSw+RgUJ1l26Dka+RV26A1113kI+QBTN2Z0j6+SP5W0+Q5D+BSy6ABSj0t3aF0LyBfBd312gA+QUK126Az3kbAAd1pTCjyDd3j3L2gBgD92+0j4ACk29i9PdoAZ9a9oAG9Hmr1VdV9B9Pkr1tdD9I+AAhIEM-bvR-dfT-fNHXQPUIFUNeZff-fvQ3aALeboCA6fWA9ef4B3S-TA8g-A5-WAxLJA3vUvT5BPR-aA8GhLCg-PTkGg4faQ5g8Q1UF-dvYfWPYQ1-XoAcSyIrBrRzTLUtHJnNIqMQimvIJreLTzWwswpw9VFraI+SZQIiAAFZvG5L8PUjEzkL21cNa1hr27fQz1XDCPc3CqKyRkeH6NYYI2bq61lDkbVz8pho2O1y6OFHJ0eaQCEA1x5gx3z2uPuO0yONOOt1Z2LBF2wCQBW2F0MAhN+P+PkbhMACijtcTUTTj5GAAcswCk9vWkykxdYURwyYxoyIxNrfFWXw9aMQsQOQk2sQI7KY-NhY3kwjVLQU9zUU62aU0qOU5Ux3pppaEI802Y8JL+EY92lFBVLU1iUQCYbqgaeVLLYKKjPoNFAZXI8wLMPolVHGQdndLU3LacZhIrYxvjV8PFNM2EFcPUWisdUJQmYZAadtKoiFRtUIOYuyKooIOM6liORUU05I4U5RsU6QkfC8yoqwR85drIwo2QLMk47U60xVUk3oIFR9RVDc5qSwqcbNIFawGCIeaiKizIBvFczCPi0IMM-cudKeAwE+LAblPoMiKeOlIQOIMbIRo6PSx44IpkmeBvBSyoNS5yJ6My04PXGfLS+y7TKAEA9UJKMuVDXDXHWOJyFUP5AFGKPBAyqAPy7QEy8bJPf5CFHRTkAq9HYIEQLy1SxiJvoIGeD9A3LjN-LVVnN1NmqePoN6Daz9XoJ4DwEbKcbiK6KZI6N6IG2611vpta9VUqKK2yytR45K0EFUDK2Tp618Ma0qyq-5BDa69WlwLRFwAzBmwa7DZoI63a3PIqGm8Ghm5m1qwjGRdW-q6TXoGm5+IYCkFs-WJBQ6qIAwMQnMulePQkWa7qJS-yx24UZ6IMxQMGGeAYTWQi3oCcha46JyLO+GmhRiySobN24ICnpaJG15Rc9Gmqy+BKMu1a4Kyy3RjG5KL4zEmfEHRJJe04Cm6AJW8q5mwPC6AoI6NlF6NwAW8zJ-I3MlYqFyzyyO3y5awKzq8KxW-QPHVWyq2+1VLS1kvaNq0KwW4255W+wh4q6a0y5B+e6uwe1cA+4wCG+64-GuN6xfNNCoBGFR4yMx9RN1h67h0a-hya1UAAIIShBsRTesAfOhvuLDMCgCHmnhoBAdKjFtbzvsNuavQeTRgxdANvt2kyyf1gttdvttKJ6c9t9tlXTiSwsrDvDxQcrsrYsQoGTsLbTvcRruNkLu6BLtjtrurWbt4rbvtt7v7u4elvwLsTllMEiR0CuSOiMtCucseHcvzTmtjvPvQ1pXSa1LufQfWsMIbtGBbttuiC7taJkc64F4VnrnuI1DvnZ3ECKBoVicsBVDpEWejuZf2ebrkAzvqZIZlcBdHtR68rCgMBDhb7NaWCD6immCCBNpjeO5YCJfQdPA3tpAADkVHgg-jOQAAOlgL62kK87tI4bgC6AVynnvXg0VHdMt6TGKytRLREPNyu4t3S7d4IKtwJ26+txt7oNt7tzqCCzwId8d+887aa4Ro7HCEIyD-gPIAAF69PffAj7cA-xhHf6AFfTBnegBw8XcvRXfVA3enjMwxZ4BhedCRc2Crf-eCSo8FdQPyDkbMCIWIiIXECIW-GWjLeKwtAPc0tLevdI-U9A90-aGM8PEs9s-1BqB49VAhRAA')">function index_key_of(pat) {
    return(head(pat));
}
</pre></div></div>
      
	
      
      </p></div>

      
	
      

  

  
      <div class='permalink'>
        <a name='sec4.4.4.6' class='permalink'></a><h1>
    4.4.4.6&nbsp;&nbsp;&nbsp;Stream Operations</h1></div>
    
    
    
    <div class='permalink'>
<a name='p32' class='permalink'></a><p>
      The query system uses a few stream operations that were not presented
      in chapter&nbsp;3.
    </p></div>

    <div class='permalink'>
<a name='p33' class='permalink'></a><p>
      
	
	The functions
	<kbd>stream_append_delayed</kbd>
      
      and
      
	
	<kbd>interleave_delayed</kbd>
	
      
      are just like
      
	
	<kbd>stream_append</kbd>
	
      
      and
      <kbd>interleave</kbd>
      (section&nbsp;<REF NAME="sec:exploiting-streams"><a class="superscript" id="4.4.4-sec-link-3.5.3" href="./3.5.3.html">3.5.3</a></REF>),
      except that they take a delayed argument (like the
      <kbd>integral</kbd>
      
	
	function
      
      in section&nbsp;<REF NAME="sec:streams-and-delayed-evaluation"><a class="superscript" id="4.4.4-sec-link-3.5.4" href="./3.5.4.html">3.5.4</a></REF>).
      This postpones looping in some cases (see
      exercise&nbsp;<REF NAME="ex:q-why-not-append"><a class="superscript" id="4.4.4-ex-link-4.69" href="./4.4.4.html#ex_4.69">4.69</a></REF>).
        
        
      <div class='snippet' id='javascript_96_28_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=4&prgrm=PTAEGUEkGEAVQFLlAFgHTpQKCyUAzAVwDsBjAFwEsB7YgZwICdqBbCGeJVNARl5yJkqtUAFMAbgEMANoUnlRAClKsADrVHFyAGjHFxASlABvLKHONR5Qo2KhKdAPrTKCxjOVqNWg2fP+AgH5QFzcZRylZJRUWdWJNcl8A5NAALnsnYkkWaK94nz8U82DpamoAa0JVRzoATxYAI2ppCJlCJTrG5sdqfEcsnM9Y70TdTUNCovSHR0lVVRdSeRpiIbiEpKLi0DmF2sUJNvklQQoVx1EAD1VLOjoVtZGDMf1nya2UlzpyHr7I9roikkjAA5hdrrd7rRATF1j4XoZNltpk5qKpRO5yNRGI4Yg1KFlhKtYU93slgodZMdFGiMfJsbjWPjCecsbN5otlrRHvlRnoJh80hlGcQACauFYeEm8pFFCmREXiolSvIJBGylIo5zZBqiyTgm6iO4PaUbMlBUAsSTlUSOU5ExTSHV6xyqYHZKwYmr1JrSGGq+HmwUfJ2NF1NUX7U3w-ka5JauiiACO7TIuWGMqD20pNWTqdIHTzmgLNXIxxyWn9GY26qzQpmDVKpHKPLNgvl4Ub1Gbra0tcFWss1lspfLCV7iTrHZaQ5sxFHCgr5An-Y+Wvt51FolITsxJoDiQAkAEp2J-tSN7RHFud442Sp6GWtNft9IJ89Y3WtTfd1ziQe4wtHMf3dB1ox0T8B2FSRjRBYgl3fU8cxg+44IQ8DV2RMRGGYRgV1AAAiEhymIagAHc7DqLRJEuUAAFo6LPI4FAIgwAG4sAAXwEEgzhEXZpH2QRdGBEE6CMUx-EofBQEUGYbkoFgJXEW1L1WQQDAkslZ1sHYOVqV1GEU5TVN4h1hJ2UFxI4-xOLEP1RHsGS5KcEkSFFO0zIeDStJSB9vlAW5CGkchQAAXiYqkFEUNTHAjISSDeYNkqKK4FDFC59EoZh4PHOsUuDWK3XcHI3EBDTtHygqPlEuhKuqhr-Fi8ZstoBCfPY7SrDnYUdPnf4lCCkLAJSYI+taKIRXS5chsnFL0nc0R8AJURRRs8w7NEByTDJDFcJikhdCI4gSPIuw1NAchanRejGIE2pWPW0BuO4rALq+H5egmgEDmuOrYx25I+stOYgVBcKAD5IrkaLRPVMY-s616LpzB8lUlN8MIByT-GBmZyEYQhyAAC32SkYdyMUJVocJDXFJZovAj9xk0-LpwpzwqeVFp-KLLR30wrDyepNHqayFoZDcFkVIF2MOORryRBzRMU2LDpyBYch-pZwGpOcmZRFiK7c1VtNFG+TXxN8opgcW5b4jWyZNu26TZJmJ1vgXQ3xwtrXNN1lJgeF6LlsYT3vjHfnffE7QWae577MTAPkn80LQ-DjWfgG8LQCq4OTmyjPI+XaPnjjoNXZcxxxoGmLC5+X3vtEf2ccFYH04bzOm-jgJnaT1uPiDhUVfzJQqoCW5O+LwFS9j14e9sp2uJ4oQVhCBxPr6EgUMoODVvNn1mnE5PgatVQD66aRIcIgAqbfYIdm+CN0TpfWs5e3sVyilnnagiZfHcoEVhVjhIkE+3VdIzBHmrRCwZgiSFIKQQgLBgrUnHgEXYmhRT1QasQYK0gcHVTPubH+PR-4gT3NCQhjVQDQLTF7JcICnis2DN+V8QDuRMzZuvb4igKF-m9Jfd8I1-DpDwdIaQ8sV58TsDmLsPYsY6wHqnUA8Uc7yPKHFagkZ3zxxUU2GQDAIp0FIX-H4-CiSAnip1AIKj76oQdkYnhm9HD2N3g7R03ZDE2NxhA2R55orxQRulDyLUcoIQMX6ahNCYkBDcXvUU-10GxODCzJG0iiSRWrn4hh45FGvHAcOOwVobTZKKU3RQyT86KHGlcQ0xpOEAXVOkz+q8lYKh3mhPJB51TJxUdnCK1TOm5WfANA0kJ9zVhjOXDBD9BG+gqcMpc8zmiywGuqeOwMBpSNaTIrJFjJmgN6QPYZKyWi1wOVeV+qyma6GSR8aplz+ptFtHUiZjSpmjHuY1Fm0SYkzN8UU0AdsVqO1engNSDB8DMDYFAOAiBkDoD4AAJgyWvd2rg6SYwAoUnq+NJAghBKtZwG98IEVCFix6y93qYvcOcl574TAngnn40AxNRCSFFIoMslBsWfM0jsi6+LCXEo+vhEmtoywgmthYVl8lJDZUZQAMiVWyjlXKmbhTChFCVd4CWCq-sKAY6ZQEysCnKpwUqiUeTFVjAixqqUKzacU60tpjUX19Ga4GYr7UemfrQw+0gWkXWuS0L67rNUD2Buyzl3KFV8tNcGw1MwlndP5biyBlqCXWpJbwu1qatCOt2ZkgtDdA2MqjaymNXKeVvmrXG3lwiBXUsNaWpu4yjRQn-OmytQL621obQm5hSbnXCieRWyYeMs0iptaSu1qdJDPieaxUAAAfVd+VhU5ttT0wiUgjKSEbLaZdRh12bunduudu6CKxRPQa0dTyzkTsBT1UNvx+gekUP2+NTapEXUfWMt5nbDlPADtG9Vg7INM2bU6vZJTbQLqXewyhqxjW6EAxCYDtAvWsp9Yh8xyG-z+rQ6ADD9Su0jr2e7Z0+ogMNO7aasDFq9UztzcuO1oZdS0cw-Rot70aOundKVL0oamEyiY0C4hb7w0el0N+xt0H0n8bDPqeKz7ZV9ogwOgdin71wdddqFTHb6OKGKh6MquhrEZrsD6zjLo6Ndv9WZ4TYdLPaNqJRzJMxb2EbAji4wx5-CTuY1a0VV7PlHR84AlDfHDVRd-ESD9gxI3BaBR9bJ+B8I8CU3Fr+ACEvnGc56MO6mNM9XS5YTLWNkU5dHfFjh841MpZZWljeGX8IAGZat7Pi3eagIoI5IZ3KV81kmDP4fyw1yp1V6soaSyap4fyPjwcM1x4zXbps0NmwIorZUBbfPMNtxLTWAIwbRSIGY40I6LjTYx1uU6WOXrzdeq7ZYbuFu65k2pPGNvNbK7peTQ6ZSefRa5Wg6MaZA42NZ4UoXZ3PYi4RUW3N1srBXWe4MW6wsI6OUj8HYtwjXe9h9v9hrkcY0MqtSgDMFvifu7htrlWsufbXuTyHA2+bsf84Ub1jOlr4Rq6T0dbPxazBChiaWtPof09a57JnWMut6a804OhBZzaZxlQ9uHbH1eayOqr0QsXR0G9yZWXXYDjBBZfQDrTP7fZnYuh3U3JdM7Hxlz1etpchd7Mns7mervNesoHV7lto6DZGwMgb83buefMfEW+EP3EhVOA9lPd7LvLaB6BTMePkHS4g4u04DRI2tfZux1zxHBENFG72RorROi-v-bsID4R3vMkreL0TpcOHZfLir02co-qu8bCV6Dno6JMQMjxASP8FbAvmFS3ipw29GAGVpJPnE0+WQfMYxjwUDYZ+r-H3SLEm+mQz78-ytvY+V9r4n-SM-jQL8gbp-P3OLWl+PfL2S2-x+N+Mif232IBr2VzikPzvxPyn3PyALn2ZWtzsCx3hwr1xyr3AL-wfwAOZCIxZxEHXwwNDRLwZzl35yxmy2vxECdzwLFEIN73a2qxwMom3HB3QOoMb1G3Kz5yq13UVw-guhWwEmp1n2ah+xWBElBGQQSFR2hB7w4N4QIgEIZjR10GEPI1EMshBAkOfAc2AQLzsDwNP0wOfyvDZAUNnzYJUX0OxBzksJxAIKZk2WY1-xsMMJgK4TgRBlKVMIdBW3dRsKShSS2DFUoPv1YNOxEXMHSH4I5EEO8IM18Pv1P38ICM+FJWCLpFCP5SW2SOSETDRhYI1TCNH0L3ZAWBiJf2l1j2zwvW-3zWiMUNoBALXhUPeQY1A3dxt1jR01O3ILsFEikPoFK3A06J-S6P5TO1wDAEhSYFYHYHhS4CRTQA63OwQMtUJhJn2EuBkMzS0WaA5VWE2Pf3bFAEuHynSD2mxEUEuCOiaF2MXTEGuG3AUGwXNQLEoBUlFCLWLTXhWzUlMyE2K3+iCWxkX10jwy8Hck8mdWfnuV2wxEBPcw2VDyozB2GAhN+PwC2JWK-yQJiiOjcgyjUkaIoLy1hJKwxJhwq353wF0DIKRMyVijU3JN7VkJ+CZ2pNAEFzpKaLyzCTanHCZJBJs04NxNAB4Ng3bwMxrgZQfGmkxOcUUAIilKiH9RlJHy5OKKVPaEUAGjlMQJ13WUIk1MNwYPYJHDGVVP5h1Jhxbx1N0L0B3GoHuGIDBF5JGWXCUUFMuh-XLiTzi3rjtBKiUA9I-w6K5R9KwBUV1UNlUGNldKXBznjw4i+JEB+MDI9SPnQxeRjxDLsDdEVVE0zKiHfl9Lq0DLOXKkDIkjgKbzVVjWhQ9BNPrJyCbgrIbKZSt3gK9MbSbObiKNkUuBCUynEFajdPTKiVI0MUsxgleQKWZNBM0BBBJjHOPm1QimkAXKXMiHEm4TzLwlTM-QLInL9A-AaGnKHPCKFHXOdKXNEyMAAB4QgNziZtTvFuFzi8ICIsRqAQZiBah1DNCtZaEqhSjVp0gCJQAABqQ4xqb4IyZ06SfYW8yCwiI6ZCg7WhAmAkEEBCl848i8s4nCC4z8soAgUQMif8xhIC6I0CwiNCmJWCrCnCpCqC-1cCqC9Chi+C-AfYLc8Y96MoSoaoN9WuUNY5SYFGfQZwMoc+YMooENH+Zcws7M4MB7XPW89CikSS0oNEA4MgUoJ0l0rKcJccNJdC9IUNLVCKT3QNbcmJYIetXisy2hBS4PGyj8AdXinxFIbiLYSucYSyy6dlC4CPIckc7vZOLYd8sco6EgJodyUAB1Ly5IPuRyAeLYFRHsnOJ3Hs3SwwBeQOVlExRdGKMs0TEqhsrIhqHsls8qnIZtLYHyxeHM-kKSnS8M5M3ouZYShlUSo8sSgICS8QVqmS2coMeS4qw83iiKm2OPfBZci8rYTSoa7Skah0gy0K4y-mUymJcywNAK6yy+WymhYIRMH4Byyco8haqYZy4q1yw69yn9Ty-KhOCuZyfy1cwK15EKuMio5KKK3q46OKsUBKj0W6HYB+JcKlBqxOVKqqDKwMrK-0nKgFNuQqhS6qsqnspIlJaqgaVsuqpK3uJeZq8YYa3KlpCFL+KFGFWYzgRFXgDAZY4UBSJSKgFSSEmRA6YgLPT-bXIIw6QiFmkyIk3MoyVmt420RSBYYnN7byRKCTD3W3bsxKFpFRIWtm0yZ1JxMVc0H1atf1fwatFKbG-wH1WtA28wWtY2pbH1Xci20AXc623W0lclDee2j6J2ooH1HPfBf1H2iRQUE28wH1cUOgBYSQB6XQUO8Ov8j4IO+Ugid8i2985KeOn1K0EmWYBoOgZ+DO4mLOhgLYNOl2iC+2-wS43QDza+WiKC2O4uuQuiMu8wCu0AKusKKGWiRiOum2l2uiW-C22iAIdu-wRiQe+uvvJ+XQFIFutuju0AG+Vu8wcehU4AJu2SK41uowYe2iMAbu52uQgAUjXpnq3rnoPsXtAGXoIlXLLpPuroCo8x7rkIAEJtVb6N7Z7jjQBX6IpH796+87zj6P7T6v6HzzA-6vaXa7ywom677t7QBoHwGr6IYgHK6QHaIoYkGn6+8IYYGp6Ag4G57cGsH-6FTn616v6h7MHv7-BNjzROo1axaTIObEtRNwogxiFq1dB1aJaWGdCOJGHjINa+GrxqAGgAArR4oxDh0GQQa+W2phjW-1FvDqSq-wHh9myFTqCM6EUKDRhDXRxdQCtc0lH1EFB2f1cx1aeO7I4Ol2yAYge2VwSO8wBxpxq6Gx2x9O+QfO2ASAC2vOxwPxzx7I7xzOgAUXtsCfCZCeSJ9QADlJB4m17En4mrqYkGHdGHbFHeGJs2GwoZHz5SBr561SAPx9GBsnw-YBGsmKmJs8b2GthiFinh6W8ynymcn2b8N34Oq9I9hDIhHeH0SBbRIPo5T7pHACRXExQMRBIsLHBxHJApATEjIYzNsCoKmpb1ylwhDEo1GUhRmN52JkheDDVTqqgNq+T+Y5S0osFLnRzklMFqCKnYpDz0L1HOmDHHwjHyzYmMF5gsFTNPmRHf4JGpG7kAi6nDHRksy-n-AozvqjKrnEgdl1zQpdUQRShTyWgfqtAc5znqhcXlxtGLpipExHBVYj8VJGAmhEw5JiBVAiZ0MMRaXnGzUVEkwc4yXbRKX9gCRGWUXJhK5qXWWrpv7tVCJ7grzyAV00r-Bo6nR9gCIGJGIbhuxO1QBeX7AGWiZzAVXHpoLkgFWI7FASBuWKX2hV9FAkwBUE4tp+5GrzBK4U07gMQHQbWzUMFRQPJCZ1yegcQUI3WHhA3GBjt3NrX6qihhWWXHTnHxWIoCIpWEhZWqpjWlWVWGJwbExQ215OUtxRRboM2DWUqTBHW7Xto5XzA02FSM3M2tXZoGBa2GIoaig03SxLBsh1mPhYKOUWBHBiF7lMr273mzXgRyXeWu3YkCRBsqBqQkxlDKy4X-B84LWMR9h53aEsK0WrkCZe3FB49NJI2NpTnR01WCw7hV2rX+WmXSMY37gPHk5nXMg5rr3EhPX5WHAY6a3M3g4rC3AlJCRVpC2W2NoYbprzAOWuWx2eXLW+WdXBWthq3lWVXQBRQjJqWQhpLtWBXC3m3CaP2w7FXTWGXoPL312j3kgn3ZhXWc3uQPXwPkg83q5gpbQGQQ2HR2Pzg1MPXnqAgkOABBGjktb1oDrEVD+QSQVRactAED5KsDyto1z9oj5DjNzV2D81OgYKQCptxuo6WTxDpTiO9tvd9BHt7Ift0GQdhG4dmhUdsOGDtdypQ8N-adqpygOdhdhspd8wFdidjdgy7d+cMzlgfd-BQ9-D49omst3pp3RdOgMiDEelgV9lrJzliKc1id19pK+Gj0JxXz2D61l+LdqwHdjtkLg9pK1Suanso6j4YIe1b8jO0gYmLC8TssAiU44FEj+zsj+lmd9z6KDd+tGrw9vsjCsrkou5rcRV-eOgHgKOraCO4lOgGrGHf2hPbLbhabpbjyFbxQfCh2hVPCT3bLfZoofb6+YLybjKbb2oWb3d8z4PU7952x1Dxbu73bmrdJZzn7lIXpgkNwdcpZ49d72b+bt7mbz73U59iRc2Tb9w275b5Ffbzr3cr9CDOb7z8ukBgH2ZjldmxHrlF71t0Hz7-bs7hqC74eq7p70bj+DL2DiIO9pQAAcnY8UFe9AAAB0sBfWlAnmPI2R8BsRyv8FK60H-ZqoWejoRXHTjSOIGe12meaW5fFA2ehOOfXuee+egQAWMoheRe-jFVCB0MPxahuGjvTXdAAAvTSKennxjvXwX-rYXxgEL8QcX0AW3yXxqaXvdZnqlQLN6f0uLhLvCNnp3vrO0Q3j+3QH1SQVihoVi0gVij4zSFnzqPARXql5ntXgXqP13kL2PhOhP645P1P1iAwP3giR6IAA')">function stream_append_delayed(s1, delayed_s2) {
    return is_null(s1)
           ? delayed_s2()
           : pair(head(s1),
                  () => stream_append_delayed(stream_tail(s1),
                                              delayed_s2));
}
					      
function interleave_delayed(s1, delayed_s2) {
    return is_null(s1)
           ? delayed_s2()
           : pair(head(s1),
                  () => interleave_delayed(
                            delayed_s2(),
                            () => stream_tail(s1)));
}
</pre></div></div>
    </p></div>

    <div class='permalink'>
<a name='p34' class='permalink'></a><p>
      
	
	The function
	<kbd>stream_flatmap</kbd>,
      
      which is used throughout the query evaluator to map a
      
	
	function
      
      over a stream of frames and combine the resulting streams of frames,
      is the stream analog of the <kbd>flatmap</kbd>
      
	
	function
      
      introduced for ordinary lists in
      section&nbsp;<REF NAME="sec:nested-mappings"><a class="superscript" id="4.4.4-sec-link-2.2.3" href="./2.2.3.html">2.2.3</a></REF>. Unlike ordinary
      <kbd>flatmap</kbd>, however, we accumulate the streams
      with an interleaving process, rather than simply appending them (see
      exercises&nbsp;<REF NAME="ex:q-why-interleave"><a class="superscript" id="4.4.4-ex-link-4.70" href="./4.4.4.html#ex_4.70">4.70</a></REF>
      and&nbsp;<REF NAME="ex:q-why-delay"><a class="superscript" id="4.4.4-ex-link-4.71" href="./4.4.4.html#ex_4.71">4.71</a></REF>).
        
        
      <div class='snippet' id='javascript_96_29_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=4&prgrm=PTAEGUEkGEAVQFLlAFgHTpQKCwMwK4B2AxgC4CWA9oaAM6kBOApgIYC2A+iwA7dOEATDgKYAbFgE8mAgBS0AjABpQI8VKG0ATAEpQAbyygjoZqXwMa5Wh0L5RoufO2Hjr4wH4VYydI5aZzm5BAFyg3CzkDDIAFqyyCtqKLkEpxgGgALwAfHSMrJw8fILC3upyeewcpBEOCUmpDY1Nqao+GjraANxYAL5YAJCDg0F4RGRUloSkTAyirABuTCVq0o7Krep+OvrJJkxmFqBWNna1Trspnhu+-oGNoeGRMXGOiRfNoOnZR1MzcyyLZZtGTvD4Na7tAL1MEfL45ejMSrVchnbRo7p9LAgUAEEgUai0HEMShsCAweBIVBoeTUnC48bUUBMeYsUT4FjTGTEEncaj8UjKfjzXQGYymcyWayicjTBisrk8vlTO6pTzS2WsjgstlMBVsXmEfkqlKhY6Edi67n6pWkY1BNWUSgAa3w3D8EjYACNKKItaz8LraB7vb7KLgbBa9QajYLCMLQcZTdZCtLiByJlGbXa3J4UxIZMz-RzdfT8YQOEwAB7cZi0WgZq3R5Wx4XQmGgaX0Dhhv062gyFgMADmFertfrBMzhubTLjaITRiT3b4ctIlAYHCtnvI5rLU6NC9AnkLbOLMkoK45683JO3u4mVUoXF4qfT1H3M6F2dcS+5ghlEzyo2WaHse2o3v+ZZAYq04CrO8b3EcUrsJ6AgsKONZMHWDYwQejSeGwLBOkspYZuIXpoRw4Rymw+wzO6Xo+v2wGwW87aNORqHod6Aj5ixMbwd+iZIX4TAAI4BiQlq4cqoFMuBtDiZJxCBkp-AqX41TTLRUzMTJtotkJi4iZ6oiUMQTofracknhwpnmZZ-FTIZh5LuKFiacWOmkFZRlHvJmrueW9BefyVkuYhxykdQJTEOIq44darH9K4NnauynLReWIhxY+EEhVMsUOE5BmCa5Ik5fFb6EL5aWapVg7VeFZWRcm2FDoQ3m1fhAW+iw7WdWFJURQ0oQzMSUTDaAABERBOoQlAAO40EGUwsJWoAALSbb1GVMNNXS9HSYxlqAeYyLiyiDkOtAisk5C4J8xw1uQbAAYCWUXUQaI7EEQVnS+EhUQwr3vSRJ0ZpdZ3Drd3TGD0TKiIpRyPTIxzAUQQifbiP2im4f70HstB2KQmS7WeWV2ZQvFfYQbHsc0VbTMUQqRNQXWHgzQSU9RFqyv2ONtlzzTXbQQvC40lOs8Sg1TLTaKHX9+wSiJQW9gGMi1iTfkeHsBzlulSx-szPla6I1kfKEmNMLgO7SHDRgI2IyN46443rrTyizYQ81LTQWWgKQEh8FtO15gdDugH0mIB52pDduGhv9lW3Bi4Jv2uP9hHcAOw6ZDkJ57bnQ6GYK1aw0dox4hMvUQQIAHUNBSX8oZGdGP9xyMPgpDRPmhdnn+9dQb6mH12mnIlYkgk62BRYT9QQ+Ab6BNqXLk8jaN5Pz5BS9cObMz3osvmGRix3V4ytmKRJ6mBqQbCkGnX5tyjT3WEw+pB6J19SeU9+3XdqR-rW1toaAQkco6I2Rg9V+HBxBdhCtpMK9A-64wTP9fumVIjwK0u-JBd8H6JC-OAp2SMmDP1cATUmtsGDYPvurMhGRQCcy3iWLB8cEG4LlsgghigiEJmgWjawatDYXTYZpOhhtUHNH+tQ2h8dDbgNcCQl2zD0EKVXipEE7ZazsJwd5fs3Dbq8LnIo+Guxo5nwZDQOOCcOBEH6vWDqqwgyMSRgAsUytDjZzkMGH0+cZoACp7EDWkAE6aygXEhgrjHCGjJaBpnLJQbuRVGplj0s3ZUz8O7WCvspaSGSLY9RYMQYg+A2B2DPMwtwhR+ACHFs0Ww9h6lNG8fElgiTkkNQSgSZpYJck308og3Svl5xNCXF0pqk9OZqisD5CZZYGIhhGZzUIjTRCnyrlY2u9kLLNSfq7UAlDQA8QkGTHZToqY00nuAo5Zk0xIzJm0jp8d5kTH7CcxWxgjnBMcaAwkjCbE9h+eQJxsg7msgrpnTxNAMG6hOWXZmQhpbszCuCpGvSJbtmBaCtOVTMWNC-IdGJ58YXgTVhwrqU19m7CzkRJYwj-S6jxSwzW0KMLjkSk2UqhKNkB1sg4kFssfJUrnM-I5hsyawoHANby9D2VYQnDVdeglwECo6osn09DpW-NlZEn0x9QCGxPjS6FhrGW8tiaS+qTA4qpM5TaVuBy1XBV8b6ERryYp6uKvpKezKGhSo9QbRl8rsLvnXn69iX4MUwj4VC-WoBgF2zAZXbEWVCS4GJKSKAcBEDIHQDSTQljTrHHVDMJuXL3Ht1NZ3FgQ4hy+Djs1aapa5SiAjkdWOMoy1usZb5fQqU40q1iCwWQyJvUFPRJXAONa60Ntmc1HuSxqhDkrXrFWz0IiTR9aAAAZDu0Aw7ZCT0yBkRhi6qi1otSSkS5paJ9oOdki9s6hCNqmtNW9+0iVFproRYiEY71etXf9Rt76LThLoK6r9mzTpetsR++9Jr42HpkGOkZV6tnHGdZS7dD7q3WGXfWl98631Yf5O2voAdSOFS9QhwdhxkOoYYzUEZk6KOWrOjK-kcqU4crDThxDQ6XiodQ5PVj37GTHEDbRjx8aZ2EdgcR-SXtKHtJeTaqqZYDqgAAD7ac5nJud9Am0shBiwUySxA1ad0-p-Dtb5OvqUzNSmlmoMB0DRq8dFa27-Vgz2eDTGUQsdPm59TdqYqGxDYq6Ta76NCeYyJn1YnoM-rpflaohUpMfuUBFnjCqJhAdNSBlTGXQvdMIOBrLZqdSRfy+h4tyEKLoVy6GpV-GZPrts8+hTRm32cUos1xV5HkuMj6+hXmtFZQefSV512tKc6+fDJVgLnmsxidjihSiJzov-WWyh5jonXPsd-UsUbNX3zjbojQ5QHysmFfnc2jbTWxx5eoOBi7-NrvUwkId69UVLUpLK-elKxgBOHAM0RnrjnprOdK9VIbAcYe2rK-+-JM3QfWNmRwZguBmpOGC+xxHGmHzvZmNNrMt3402Ox81HQ+Pr2E7C+WLbx7cOU8x9TqaABmL9CP-uVTysVtTcVosxZoMdtLqmAdNWZQz5H8Hw0wnF6dgbGYI1GFl9VKijUJuk+PmrnEfPYcLOZ4ln7GGhFsopUNNrVbZOdfs4pgpXtyV6LIzz9jasVd8Ynd501u3RN1ZrujBeDdzQrdYhTjrT6HeQ6dzNQeofNRe-K7oazTRwfdeFVDhPw9BmcNIPD9jOfd6j3IOPVH5PZt3a7BzxzeOO1F5D7nle38s8+6r2zmvNsafu+vcXxufV94WHTEfFnyRgPs+71zs39Wv55N-raX3dvo+GZ8twr2-SpKF+vZvjSVvhncJFCD9rsWR17cC4f3vWzZG6NClw-Bt0l+CbP4Yq-p0dF5-0Qvx-HeVaodf3TubhWB-EDLvrfCgk-mDtYGst-m-kHshNgnfmvg-pWo+jAf-igTPvAXZHco5DbrblHgRqvk2uctvlsucpcnxPgaLgenFoFgHg3teuLucuUEgQVp3j5NNKQREq7sqIHhJtYBeGWmuBuFuDuJMjhsDkYOjiJPYgwEDEIauNeGIfeN7l5mno0McHeIOAoZeCITeF6OIXuNcowUAXIbocIcobeEYfahHnoFIUwnRpKCvhDm3lyl7OYcuJYaIdYaoSnoAbPtofIV4UoT4YYX4UDgOifs4UQa4SQeIcEYoVeGEdoZpnAYyEkfoTRmPk4R2JPjjlNPXmxvTmIkkYICLhPl3gUY5rTqYTBjagvCEe0ketQZUfHLXnHtzvwWLqlimGXk1FLM9i1ldMOGUlxsnj-jISBn0ePBMOBoMZhMMdDEOGMYVBMVgRkXoVYeEZrmuM+NwK+MYdQUcpkeuGTKcRuNkT6uAo+p4RcQYakbYXhD1OLjMU1OLvBhcfTPim4I2jfk0eUQdisqAK8S+P0XuB8ZGF8dGsLH8aUZeICT6jCT8YpIPACS0ROkltOsmGCbMWoZXuPnhi4Znk2m8WkQETXAsbxq1u3oSUhnQeHkaOkTQNdGdoQGTnYXSc-qOvFvtqbhsqmpaumpmmSDmpSPmmgJzuJjEQwN3L3DIJWOwVHt6D6KwDVIqY4T1JWMCe7FEJWF7Cqf8DCtWDatMHUnsCpOQIsAIENsNj0X+p9CTldscl9o6lMfdhjMUFlOEn6k6WnPCiqnUdgZ6VjJahdEqVAcSX8cpoqJjBwN6cyQbiSlrjRJdgLBGRjlURdMoEUXaUmVYpQeGZHocFTt3rgMoLUcUdfv9sikKkWazirKWTjuWaAF0VOkdqlgyjqAqL8Jkg2SWfdl2QGOBsbEaBSQIVjmyiIpIsWTEXZsQUajNEOZ+uOTQMuRBCbDIDOf2TQLtpIhsTCiQGZPWIQCOLWV1NSrkahnwlWadP8RmpGJedEbQWfjeVgEcueu-NwJ-OefyGTGst0HmeLg+QBq6mnEnBmWEJuj4q4uBYytEnmSBUsF6gLKmUfsfs+chkhYmUhfQqhRaOhdIVecxthd0UyJWIihWHGGzHWShdlhCtdv1EsE+QQSWfwEOD3DBVEroKegCuxZxdqLdNMlBU8MBamVxUxPRW4oxYpFRQhIhHMKeZxShboAADwdj8XRBbkQozxMgMATQyDTRriUAgntKnLXSrEPx0CugHHkDSChDTSgAADUmp7ECIO4Q4D0+YKlzlM0Xsvl+u7lp5Xl2lbiOsY0+lHsRljoOITAi0yxllhIxMYJ9lM0AVXMQVnluA3lYFugLl4GjlLlgVjAHlIVglWJ7GZkzoroHmWqXqbprgfKcYsCjoOcLFbgAcTyEl6KVWkx0iRJMBKl+ux4zVVVbVR5lAJ5Z51FMsF5c4OsqQoQXqJ6jCyGQ1XMngyG5V+uS1CS5+tQuVygqG5VnyQQfQqQAiQoK1gcsQwB35QMv5fZzCup3VHhhA3omMoAH67aqQyiZCByqQRySFZM954lsaTQPme1uFKFF0aFyJzQuFScsNBFp1bg51ZiuRQoLVF4BYJi7Z16zqtVIi9VVWDVxgTV8w2N41wo5C5N7GXVdFvVq6gCA1pw3VQlG18EVNuNcUk1HlclNFc1woC1JoEGri11a1uVw1dA+wHAW1DFVWItIQdAe1-+h1gczGJ1pijsrlbgl1cY11n5IBAts1RotNQQL1JN3sH1ggX1FoocHGOqbu2tECzs-1zCQNqZINYiSFuNwoLtuRXV0NYFyNtE3xEsiN8FodTAk6v15iMhWNY1ftUGgpJKwpJIopFIea1IGA0pIkL0b0FAH0YZOMkBc5XWfxRAXsBdYMZBp0NdRdSwr0Bx+eAx30ZdL5PJgWOMUGRyDdVp4MadZMjaoIIGh64Gxgh6Hw4dxgIGY6E9RgY609zSIGjwDAC9IlDAy9o992ccG9cc29KQIGZopw4GJ99gjQM9RgIG9ctABxkg4Gt999pyDQV9eRRm00upC9upzQb9IGhEPcXAnotA4SAD0QQDhIqQf992TlG9aQ+poA32-iG0LlL90DH9m0cDRgCpygSD3wG0O0aDK992m05hC9G0rg3wRgO0FD6DnBYSygQQODiDPFOQG0ASiDRgdDhlwAWDnwCDeDbDoAYARDO9H9AApHw8w4I6ABtOI5w6ANw9NLxXA9I6w7I9dd9sQx-QAISnqqMCPqMbR6OMJaNiOcGqVSOGPIOgDqVGBmNH33aqUZBYNqM2POP2NKNZBWO4NGOgA5CePaOcFZAuOMOuBuP4P+OMIsNBOGU6N8MaOUMBOgA6PGCKmgiHR90gyF0D3xn-YoWZAJjeKHrKD93F1p2ZMEikxlOD0FmUCegABWpp-yRTPAtM-iq92Ttdygu2Pdb9bgNTeTFTgFWToMjdEuukw986IGiaoC4Gsz0g-TPx79nBkAhAICMoEgE9azGzQcSzPx-9HI4DsAkAC9YDHAJz+z+KhzgDAAohvec7c1c5iiBgAHIsCvN8PvOvNK0MyVPsnVNdPjOC5TaFOpDeLED+LIbEBTyDOC4VyjM5OAggtJxgspAQtQsMlchoilNAu5PwuHR5l5jAxjO5PYxV3LFxyQXEs7h2KCB-ASD80NMAj9TEAgzflaIwiDPN1zDeRt10zw3GDXRUudBuD41bKKRmBuiPU+SQVMy1Im0opyzMo1LlGDOUyM367GBwtVOS4qWCsAxFCyDqv-b1NNNkC4qYo6sAuS4QUGtG33WKtCpQZzCkznpDhmSehJ4zVKukyMKSs1UysBCAUBzUSyXXzBGLAMDeiKRoyEDcDdzZYzAxubOrpHJiRkxhtLARv5g7gJu2jgICJRsptBwpOnozT1iKUF7M3GBP1qCGXbQ7Q1jmQKqgA5s-D5vUPbQRy62uB1uSAyBEBZscA5syBiToiu2kL6Do1GACKYZ1gzB7jjs1tGAjpCCylzDdgbgOKLsZg7sMDG5fZjux0pBFvJt82lsmMVsohu7m1uD9v5jTSNvbSO27uMhrvSChzPs9t-XTvmKQLu0tBWDP0NvPs7TttmxWVgfduo19vAdqCaSIhsCcuNAIj5AcDeJ+rA3ZBatDuDjhsBjyEocSw7gFQUBnhiTKDYXPNuzpTFgjuEf5iUd0AeWuueoVDIdrIKyo0WJ5nNsqR1gMczC5vxuJuGrnv1h7PPxzvQFs15vdxSIpAPugc7QYJnGyhvS7ifuNs-XwwAd3vpuZv4fZuMdxv5uwe1vwcDtPuNsqAgxRsditUdvdxfswcu3Kd4c0ImfCfHsWezuozzuKQHsZjLt3uuBrtY52BLDXj7t7ixcPhbbLsB2Wd331vTQACCC7wX77AgIgAggcJlaE1QxyTFaAunZ1+nANSnVnj70HbbjHRMJMhI0HmDXs5X4INXiH+QxHqHHHGHbTWHXtOHDMnnBHPnAwDhpH6W5HnIzH1HBrLCQnRHzHU1bHwUHHMgXHCsLtM7UcR0qUCOYi7StAi0MwZnCnYqVTbbRnXnS3In5nNyV3SF-yi3o7K3rH+w7HSHm3pwJ7rFzhMBz3ul76JlADxA0QHlKgHILA00wJo33nRHU3qm5AFHPTLwQPFVO+fXuA4gd8bTUMfVz5OPHIzMXX7A5QSH-XOcBPa2BOuPpPaH5PjPbAkF59tQHHulaywJO4so-wgIEIPXzQa1HPC3nw6jxPpADPG3zPF6F+HPSWw7ObWoEnuoAA5LFzIMs0YAADpYAbu6iqtCB7G4DricenC4O+M-Qwiq9ezFuTUrlYCK+MfK-Rv28yDq9Zc+Ra+gC6-68Di8AKvG+m8yBr2DvZZTwSClPQX4DKAABeOLOvFwhveUJvDAyH8wFvoA8fVv7ENvM0dvik7awOeAR37Jp3UQ6vAfxQQfaf0jyg0xBVnoBVxABVNpaIqvh02ITvwnLvMbavyfNfyHAj9f92MPBpzfrfB02gef00EcQAA')">function stream_flatmap(fun, s) {
    return flatten_stream(stream_map(fun, s));
}
function flatten_stream(stream) {
    return is_null(stream)
           ? null
           : interleave_delayed(
                 head(stream),
                 () => flatten_stream(stream_tail(stream)));
}
</pre></div></div>
    </p></div>

    <div class='permalink'>
<a name='p35' class='permalink'></a><p>
      The evaluator also uses the following simple
      
	
	function
      
      to generate a stream consisting of a single element:
        
      <div class='snippet' id='javascript_96_30_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=4&prgrm=PTAEGUEkGEAVQFLlAFgHTpQKCyUAzAVwDsBjAFwEsB7YgZwICdqBbCGeJVNARl5yJkqtUAFMAbgEMANoUnlRAClKsADrVHFyAGjHFxASlABvLKHONR5Qo2KhKdAPrTKCxjOVqNWg2fP+AgH5QFzcZRylZJRUWdWJNcl8A5NAALnsnYkkWaK94nz8U82DpamoAa0JVRzoATxYAI2ppCJlCJTrG5sdqfEcsnM9Y70TdTUNCovSHR0lVVRdSeRpiIbiEpKLi0DmF2sUJNvklQQoVx1EAD1VLOjoVtZGDMf1nya2UlzpyHr7I9roikkjAA5hdrrd7rRATF1j4XoZNltpk5qKpRO5yNRGI4Yg1KFlhKtYU93slgodZMdFGiMfJsbjWPjCecsbN5otlrRHvlRnoJh80hlGcQACauFYeEm8pFFCmREXiolSvIJBGylIo5zZBqiyTgm6iO4PaUbMlBUAsSTlUSOU5ExTSHV6xyqYHZKwYmr1JrSGGq+HmwUfJ2NF1NUX7U3w-ka5JauiiACO7TIuWGMqD20pNWTqdIHTzmgLNXIxxyWn9GY26qzQpmDVKpHKPLNgvl4Ub1Gbra0tcFWss1lspfLCV7iTrHZaQ5sxFHCgr5An-Y+Wvt51FolITsxJoDiQAkAEp2J-tSN7RHFud442Sp6GWtNft9IJ89Y3WtTfd1ziQe4wtHMf3dB1ox0T8B2FSRjRBYgl3fU8cxg+44IQ8DV2RMRGGYRgV1AAAiEhymIagAHc7DqLRJEuUAAFo6LPI4FAIgwAG4sAAXwEEgzhEXZpH2QRdGBEE6CMUx-EofBQEUGYbkoFgJXEW1L1WQQDAkslZ1sHYOVqV1GEU5TVN4h1hJ2UFxI4-xOLEP1RHsGS5KcEkSFFO0zIeDStJSB9vlAW5CGkchQAAXiYqkFEUNTHAjISSDeYNkqKK4FDFC59EoZh4PHOsUuDWK3XcHI3EBDTtHygqPlEuhKuqhr-Fi8ZstoBCfPY7SrDnYUdPnf4lCCkLAJSYI+taKIRXS5chsnFL0nc0R8AJURRRs8w7NEByTDJDFcJikhdCI4gSPIuw1NAchanRejGIE2pWPW0BuO4rALq+H5egmgEDmuOrYx25I+stOYgVBcKAD5IrkaLRPVMY-s616LpzB8lUlN8MIByT-GBmZyEYQhyAAC32SkYdyMUJVocJDXFJZovAj9xk0-LpwpzwqeVFp-KLLR30wrDyepNHqayFoZDcFkVIF2MOORryRBzRMU2LDpyBYch-pZwGpOcmZRFiK7c1VtNFG+TXxN8opgcW5b4jWyZNu26TZJmJ1vgXQ3xwtrXNN1lJgeF6LlsYT3vjHfnffE7QWae577MTAPkn80LQ-DjWfgG8LQCq4OTmyjPI+XaPnjjoNXZcxxxoGmLC5+X3vtEf2ccFYH04bzOm-jgJnaT1uPiDhUVfzJQqoCW5O+LwFS9j14e9sp2uJ4oQVhCBxPr6EgUMoODVvNn1mnE5PgatVQD66aRIcIgAqbfYIdm+CN0TpfWs5e3sVyilnnagiZfHcoEVhVjhIkE+3VdIzBHmrRCwZgiSFIKQQgLBgrUnHgEXYmhRT1QasQYK0gcHVTPubH+PR-4gT3NCQhjVQDQLTF7JcICnis2DN+V8QDuRMzZuvb4igKF-m9Jfd8I1-DpDwdIaQ8sV58TsDmLsPYsY6wHqnUA8Uc7yPKHFagkZ3zxxUU2GQDAIp0FIX-H4-CiSAnip1AIKj76oQdkYnhm9HD2N3g7R03ZDE2NxhA2R55orxQRulDyLUcoIQMX6ahNCYkBDcXvUU-10GxODCzJG0iiSRWrn4hh45FGvHAcOOwVobTZKKU3RQyT86KHGlcQ0xpOEAXVOkz+q8lYKh3mhPJB51TJxUdnCK1TOm5WfANA0kJ9zVhjOXDBD9BG+gqcMpc8zmiywGuqeOwMBpSNaTIrJFjJmgN6QPYZKyWi1wOVeV+qyma6GSR8aplz+ptFtHUiZjSpmjHuY1Fm0SYkzN8UU0AdsVqO1engNSDB8DMDYFAOAiBkDoD4AAJgyWvd2rg6SYwAoUnq+NJAghBKtZwG98IEVCFix6y93qYvcOcl574TAngnn40AxNRCSFFIoMslBsWfM0jsi6+LCXEo+vhEmtoywgmthYVl8lJDZUZQAMiVWyjlXKmbhTChFCVd4CWCq-sKAY6ZQEysCnKpwUqiUeTFVjAixqqUKzacU60tpjUX19Ga4GYr7UemfrQw+0gWkXWuS0L67rNUD2Buyzl3KFV8tNcGw1MwlndP5biyBlqCXWpJbwu1qatCOt2ZkgtDdA2MqjaymNXKeVvmrXG3lwiBXUsNaWpu4yjRQn-OmytQL621obQm5hSbnXCieRWyYeMs0iptaSu1qdJDPieaxUAAAfVd+VhU5ttT0wiUgjKSEbLaZdRh12bunduudu6CKxRPQa0dTyzkTsBT1UNvx+gekUP2+NTapEXUfWMt5nbDlPADtG9Vg7INM2bU6vZJTbQLqXewyhqxjW6EAxCYDtAvWsp9Yh8xyG-z+rQ6ADD9Su0jr2e7Z0+ogMNO7aasDFq9UztzcuO1oZdS0cw-Rot70aOundKVL0oamEyiY0C4hb7w0el0N+xt0H0n8bDPqeKz7ZV9ogwOgdin71wdddqFTHb6OKGKh6MquhrEZrsD6zjLo6Ndv9WZ4TYdLPaNqJRzJMxb2EbAji4wx5-CTuY1a0VV7PlHR84AlDfHDVRd-ESD9gxI3BaBR9bJ+B8I8CU3Fr+ACEvnGc56MO6mNM9XS5YTLWNkU5dHfFjh841MpZZWljeGX8IAGZat7Pi3eagIoI5IZ3KV81kmDP4fyw1yp1V6soaSyap4fyPjwcM1x4zXbps0NmwIorZUBbfPMNtxLTWAIwbRSIGY40I6LjTYx1uU6WOXrzdeq7ZYbuFu65k2pPGNvNbK7peTQ6ZSefRa5Wg6MaZA42NZ4UoXZ3PYi4RUW3N1srBXWe4MW6wsI6OUj8HYtwjXe9h9v9hrkcY0MqtSgDMFvifu7htrlWsufbXuTyHA2+bsf84Ub1jOlr4Rq6T0dbPxazBChiaWtPof09a57JnWMut6a804OhBZzaZxlQ9uHbH1eayOqr0QsXR0G9yZWXXYDjBBZfQDrTP7fZnYuh3U3JdM7Hxlz1etpchd7Mns7mervNesoHV7lto6DZGwMgb83buefMfEW+EP3EhVOA9lPd7LvLaB6BTMePkHS4g4u04DRI2tfZux1zxHBENFG72RorROi-v-bsID4R3vMkreL0TpcOHZfLir02co-qu8bCV6Dno6JMQMjxASP8FbAvmFS3ipw29GAGVpJPnE0+WQfMYxjwUDYZ+r-H3SLEm+mQz78-ytvY+V9r4n-SM-jQL8gbp-P3OLWl+PfL2S2-x+N+Mif232IBr2VzikPzvxPyn3PyALn2ZWtzsCx3hwr1xyr3AL-wfwAOZCIxZxEHXwwNDRLwZzl35yxmy2vxECdzwLFEIN73a2qxwMom3HB3QOoMb1G3Kz5yq13UVw-guhWwEmp1n2ah+xWBElBGQQSFR2hB7w4N4QIgEIZjR10GEPI1EMshBAkOfAc2AQLzsDwNP0wOfyvDZAUNnzYJUX0OxBzksJxAIKZk2WY1-xsMMJgK4TgRBlKVMIdBW3dRsKShSS2DFUoPv1YNOxEXMHSH4I5EEO8IM18Pv1P38ICM+FJWCLpFCP5SW2SOSETDRhYI1TCNH0L3ZAWBiJf2l1j2zwvW-3zWiMUNoBALXhUPeQY1A3dxt1jR01O3ILsFEikPoFK3A06J-S6P5TO1wDAEhSYFYHYHhS4CRTQA63OwQMtUJhJn2EuBkMzS0WaA5VWE2Pf3bFAEuHynSD2mxEUEuCOiaF2MXTEGuG3AUGwXNQLEoBUlFCLWLTXhWzUlMyE2K3+iCWxkX10jwy8Hck8mdWfnuV2wxEBPcw2VDyozB2GAhN+PwC2JWK-yQJiiOjcgyjUkaIoLy1hJKwxJhwq353wF0DIKRMyVijU3JN7VkJ+CZ2pNAEFzpKaLyzCTanHCZJBJs04NxNAB4Ng3bwMxrgZQfGmkxOcUUAIilKiH9RlJHy5OKKVPaEUAGjlMQJ13WUIk1MNwYPYJHDGVVP5h1Jhxbx1N0L0B3GoHuGIDBF5JGWXCUUFMuh-XLiTzi3rjtBKiUA9I-w6K5R9KwBUV1UNlUGNldKXBznjw4i+JEB+MDI9SPnQxeRjxDLsDdEVVE0zKiHfl9Lq0DLOXKkDIkjgKbzVVjWhQ9BNPrJyCbgrIbKZSt3gK9MbSbObiKNkUuBCUynEFajdPTKiVI0MUsxgleQKWZNBM0BBBJjHOPm1QimkAXKXMiHEm4TzLwlTM-QLInL9A-AaGnKHPCKFHXOdKXNEyMAAB4QgNziZtTvFuFzi8ICIsRqAQZiBah1DNCtZaEqhSjVp0gCJQAABqQ4xqb4IyZ06SfYW8yCwiI6ZCg7WhAmAkEEBCl848i8s4nCC4z8soAgUQMif8xhIC6I0CwiNCmJWCrCnCpCqC-1cCqC9Chi+C-AfYLc8Y96MoSoaoN9WuUNY5SYFGfQZwMoc+YMooENH+Zcws7M4MB7XPW89CikSS0oNEA4MgUoJ0l0rKcJccNJdC9IUNLVCKT3QNbcmJYIetXisy2hBS4PGyj8AdXinxFIbiLYSucYSyy6dlC4CPIckc7vZOLYd8sco6EgJodyUAB1Ly5IPuRyAeLYFRHsnOJ3Hs3SwwBeQOVlExRdGKMs0TEqhsrIhqHsls8qnIZtLYHyxeHM-kKSnS8M5M3ouZYShlUSo8sSgICS8QVqmS2coMeS4qw83iiKm2OPfBZci8rYTSoa7Skah0gy0K4y-mUymJcywNAK6yy+WymhYIRMH4Byyco8haqYZy4q1yw69yn9Ty-KhOCuZyfy1cwK15EKuMio5KKK3q46OKsUBKj0W6HYB+JcKlBqxOVKqqDKwMrK-0nKgFNuQqhS6qsqnspIlJaqgaVsuqpK3uJeZq8YYa3KlpCFL+KFGFWYzgRFXgDAZY4UBSJSKgFSSEmRA6YgLPT-bXIIw6QiFmkyIk3MoyVmt420RSBYYnN7byRKCTD3W3bsxKFpFRIWtm0yZ1JxMVc0H1atf1fwatFKbG-wH1WtA28wWtY2pbH1Xci20AXc623W0lclDee2j6J2ooH1HPfBf1H2iRQUE28wH1cUOgBYSQB6XQUO8Ov8j4IO+Ugid8i2985KeOn1K0EmWYBoOgZ+DO4mLOhgLYNOl2iC+2-wS43QDza+WiKC2O4uuQuiMu8wCu0AKusKKGWiRiOum2l2uiW-C22iAIdu-wRiQe+uvvJ+XQFIFutuju0AG+Vu8wcehU4AJu2SK41uowYe2iMAbu52uQgAUjXpnq3rnoPsXtAGXoIlXLLpPuroCo8x7rkIAEJtVb6N7Z7jjQBX6IpH796+87zj6P7T6v6HzzA-6vaXa7ywom677t7QBoHwGr6IYgHK6QHaIoYkGn6+8IYYGp6Ag4G57cGsH-6FTn616v6h7MHv7-BNjzROo1axaTIObEtRNwogxiFq1dB1aJaWGdCOJGHjINa+GrxqAGgAArR4oxDh0GQQa+W2phjW-1FvDqSq-wHh9myFTqCM6EUKDRhDXRxdQCtc0lH1EFB2f1cx1aeO7I4Ol2yAYge2VwSO8wBxpxq6Gx2x9O+QfO2ASAC2vOxwPxzx7I7xzOgAUXtsCfCZCeSJ9QADlJB4m17En4mrqYkGHdGHbFHeGJs2GwoZHz5SBr561SAPx9GBsnw-YBGsmKmJs8b2GthiFinh6W8ynymcn2b8N34Oq9I9hDIhHeH0SBbRIPo5T7pHACRXExQMRBIsLHBxHJApATEjIYzNsCoKmpb1ylwhDEo1GUhRmN52JkheDDVTqqgNq+T+Y5S0osFLnRzklMFqCKnYpDz0L1HOmDHHwjHyzYmMF5gsFTNPmRHf4JGpG7kAi6nDHRksy-n-AozvqjKrnEgdl1zQpdUQRShTyWgfqtAc5znqhcXlxtGLpipExHBVYj8VJGAmhEw5JiBVAiZ0MMRaXnGzUVEkwc4yXbRKX9gCRGWUXJhK5qXWWrpv7tVCJ7grzyAV00r-Bo6nR9gCIGJGIbhuxO1QBeX7AGWiZzAVXHpoLkgFWI7FASBuWKX2hV9FAkwBUE4tp+5GrzBK4U07gMQHQbWzUMFRQPJCZ1yegcQUI3WHhA3GBjt3NrX6qihhWWXHTnHxWIoCIpWEhZWqpjWlWVWGJwbExQ215OUtxRRboM2DWUqTBHW7Xto5XzA02FSM3M2tXZoGBa2GIoaig03SxLBsh1mPhYKOUWBHBiF7lMr273mzXgRyXeWu3YkCRBsqBqQkxlDKy4X-B84LWMR9h53aEsK0WrkCZe3FB49NJI2NpTnR01WCw7hV2rX+WmXSMY37gPHk5nXMg5rr3EhPX5WHAY6a3M3g4rC3AlJCRVpC2W2NoYbprzAOWuWx2eXLW+WdXBWthq3lWVXQBRQjJqWQhpLtWBXC3m3CaP2w7FXTWGXoPL312j3kgn3ZhXWc3uQPXwPkg83q5gpbQGQQ2HR2Pzg1MPXnqAgkOABBGjktb1oDrEVD+QSQVRactAED5KsDyto1z9oj5DjNzV2D81OgYKQCptxuo6WTxDpTiO9tvd9BHt7Ift0GQdhG4dmhUdsOGDtdypQ8N-adqpygOdhdhspd8wFdidjdgy7d+cMzlgfd-BQ9-D49omst3pp3RdOgMiDEelgV9lrJzliKc1id19pK+Gj0JxXz2D61l+LdqwHdjtkLg9pK1Suanso6j4YIe1b8jO0gYmLC8TssAiU44FEj+zsj+lmd9z6KDd+tGrw9vszd50wL4zztg4uc3MhVPCDexQEBg9nZDL2DiIO9pQAAcnY8UFsfMAAB0sBfWlAnmPI2R8BsRyv8FK60H-ZqotujoRXHTjSOI1u12NuaWXvFAduhO9v9ujuTugQAWMoLuru-jFVCB0MPxahuH5vTXdAAAvTSKeo7xjkH87-rS7xgEL8QW70AZH+7xqR7vdTbqlQLN6f0uLhLvCHbjHvrO0cHj+3QH1SQVihoVi0gVij4zSLbzqPAd7qlzbn7s7hn7HkL5nhOtn64zn7n1iAwEngiR6IAA')">function singleton_stream(x) {
    return pair(x, () => null);
}
</pre></div></div>
      
    </p></div>
  

  
      <div class='permalink'>
        <a name='sec4.4.4.7' class='permalink'></a><h1>
    4.4.4.7&nbsp;&nbsp;&nbsp;
      Query 
      
	
	Syntax Functions
      
    </h1></div>
    

    
      
	<div class='permalink'>
<a name='p36' class='permalink'></a><p>
	  The driver loop uses 
	  <kbd>parse_query</kbd>
	  to transform an input string into an abstract expression
	  representing an assertion, a rule, or a query,
	  and 
	  <kbd>unparse_query</kbd>
	  to transform an instantiated query back to a string.
	  The input is designed to look like a
	  JavaScript expression, so that we can use the
	  <kbd>parse</kbd> function 
	  from section&nbsp;<REF NAME="sec:representing-expressions"><a class="superscript" id="4.4.4-sec-link-4.1.2" href="./4.1.2.html">4.1.2</a></REF> to
	  transform the input string into a tagged-list representation and
	  also to support JavaScript notation in the
	  <kbd>javascript_value</kbd> syntactic form.
	  For example, 
	  <div class='snippet' id='javascript_96_31_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
parse('rule(append_to_form(null, $y, $y));')</pre></div></div>
	  yields
	  <div class='snippet' id='javascript_96_32_div'><div class='pre-prettyprint'></div></div>
	  The tag
	  <kbd>"application"</kbd> indicates that
	  syntactically,
	  the rule would be treated as a function application in JavaScipt.
	  We will use a more appropriate, query-language-specific, representation
	  to identify and manipulate assertions, rules, and queries.
	  Figure&nbsp;<REF NAME="fig:syntax-abstraction-lp"><a class="superscript" id="4.4.4-fig-link-4.8" href="./4.4.4.html#fig_4.8">4.8</a></REF> depicts the three
	  abstraction barriers used in this section and how the functions
	  <kbd>parse_query</kbd> and
	  <kbd>unparse_query</kbd> bridge them.
	  Using the same example,
	  <div class='snippet' id='javascript_96_33_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
parse_query('rule(append_to_form(null, $y, $y));')</pre></div></div>
	  yields
	  <div class='snippet' id='javascript_96_34_div'><div class='pre-prettyprint'></div></div>
	  and 
	  <kbd>unparse_query</kbd> transforms it back into a string:
	  <div class='snippet' id='javascript_96_35_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
unparse_query(parse_query('rule(append_to_form(null, $y, $y));'))</pre><pre class='prettyprintoutput'>
'rule(append_to_form(null, $y, $y))'</pre></div></div>
          
    <FIGURE>
      <img class="scale_factor_" id="fig_4.8" src="../img_javascript/ch4-syntax-abstraction-logic-programming.svg">
      <div class="chapter-text-CAPTION">
      <b><a class="caption" href="./4.4.4.html#fig_4.8">Figure 4.8 </a></b>Syntax abstraction in the query system.</div>
    </FIGURE>
  
	</p></div>

      
      <div class='permalink'>
        <a name='h11' class='permalink'></a><h2>
    
      The function parse_query
      </h2></div>
      <div class='permalink'>
<a name='p37' class='permalink'></a><p>
	  
	  
	  The function <kbd>parse_query</kbd>
	  transforms an input string into the query-language-specific
	  representation. 
	  The string (which looks like a JavaScript expression)
	  is transformed into a statement string by attaching a semicolon at the
	  end, and <kbd>parse</kbd> translates
	  the statement into a JavaScript syntax representation according to the
	  specification of
	  section&nbsp;<REF NAME="sec:representing-expressions"><a class="superscript" id="4.4.4-sec-link-4.1.2" href="./4.1.2.html">4.1.2</a></REF>.
	  The function <kbd>query_syntax_process</kbd>
	  recursively transforms that JavaScript syntax representation into
	  the query-language-specific representation by simplifying 
	  assertions, rules, and queries such that the symbol of a name in a
	  function expression of an application becomes a tag, except that if 
	  the symbol is <kbd>"pair"</kbd>
	  or <kbd>"list"</kbd>, an untagged JavaScript pair
	  or list is constructed. The case when the function symbol is
	  <kbd>"javascript_value"</kbd> is handled
	  separately.
	  <div class='snippet' id='javascript_96_36_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=4&prgrm=PTAEGUEkGEAVQFLlAFgHTpQKCyUAzAVwDsBjAFwEsB7YgZwICdqBbCGeJVNARjQCYcRMlVqhKdAPoAbSuQCmjAIbSAFKVYAHWvOLkAlKADeWUGdCN55Qo2Lip5JQHMn8gCYyJ5dVp16ANKAARLIKytJB+gDcWAC+WMIUNHahiiqSAG4qhPI+LNrEugbG5qCm5pbWtqAAFvJKbqqOlGoa+X4G0XFCJEliEpKOLu6edN5tBUWB5HWDzoYmpZU2dgOaSpSMeZN6hgBke7X1jRMdhgC8l6Az8nNOMfEJvaKrUsRKLLmnhbvG5WbLaoDIauDyyMbbDqBILvT6RB49ETJUAsJQAa1usNydAAniwAEbUaQLf4WKwrUDg7wwj7yIKBXEEoldR6JF6gRmE6SSaj4SRYyE-YqLCrk6p1BpNDatXxC-QsxF9V6SJR0OiUJzET56QVFElLMXKkEjKm6gLBVXqzXa8jw7ps5GWjVaoqSTlEs3C0mAuwSxrNNR+qUtT3y+UIh1iJ3W11ZaQ5STyAAemksauSob+BqqvuOwbUAdD4e6TyR-SkbnkpGkSmUL0zIoBhvsd1Bo3GsqmwQ09EcekklertaUL0ioAAPuPSaVzMDnG3Td8u0EsoxKEp8dJboOa3XkmPJ9OZy3jWCvJ7oZHiAOq7uR-uFaWlaAd8OXm68VyG-8fRzP0SeT5AUg0LJddmLeIrxfW832STJsluZNU3kdNaG-UUcyOSVC1AztwMfKDUQxSQezGJR+1fPc0KxQI4wTJC03VWh9QwilTSCUi+3IG8hyo4h6VAGjQDoxCU0Y5ICOeZEBhrAk3CURMxJQpjiHQptMLnYYzwhMDyGhWT8XkxTkNQ-iFSggyjPWZRPjCD8mWkOg1LJTDUU0VR3W5Xl+VpQIQOlItzKksRLIUwk3BxZzf38kNcPaOUIMVdkiNuULjPEtDrNpMI6ECcKcRY9S2PPEIPkMhSGOU-dAiy2zFFy0B8skstlSvHi73rXSFgASFKb1m00hdz10y9guvSj71oO1ILGggxva2DaB8z5nJc4qxkkSx8AvUAeCClq5paha+MkWqrHq1bfypTb5G2kbQH4fbnzaib33yy7m2uradoAZie9kXtvQZqBI2gyIo28Ptc9Fbk48juNejMj2PcxAd4ybrwFLr-GRlGURhmQyqMyrTNUXG8dR+bEaWs6ctDHGKcZtGOrg96usSp92QGH03UcBQbSigaHHnE1hrwvTgh5sj+aKabOeRHmSZUwXMJimV4r1ZrnwGHs3DkZIVChilBtFnTxehXX9dodIlYfCcp0Zk8Re0jsNfNDjaD1l50ml+QbTlqDLe97lkL10gRy+cXCqurwbru83dv+5Eg4N7lSPkABHHIdS6rMiuqL7bp2x6I1mlPre5FQwneKgMkjt2vVYgvY+++6-oReXyzdTPs9IbFyBYRv86NZ32w8geJaCOge90PuA9m6es9n25fZtJyxkHhZzB-Zs1fHzek7EfBNg21ein38g6Gj3e8w3y-D7sNNuLPvR14nq+87W6pCzvq-S4OgYftNDkBxN3JeZB+6Dw-o2X8AxiCEGkGoX+D8Ww1lPnzP259kGf1gW8BBBYArIK1lzKQm5qCkDREbIEwstJj3ukEMhFD54HUYWiSQbMo6fy-rmbCAV2b-2fCldh0hyGUJfkPYelISqsIEuI4h0kpDUE0Gkcg1BGCgwJJQGuGZc5GF6tvbMxspAkFrKApRKi1EaPxFojGmZDyOwGNY94jAzHKLrJYtoTjbFdQESQyQJiXE8jcSODxrAvGdU4XovqhjqGtlNq7HYk8AmuIseozxNjRwoMcTYwJ5j3FpLCRknRkT9FmH6hpGhQ0zYN2hF43JwTVEFM0doqaKC8khPUZ5KhKQW5F3untXxyJj6MA2u04gJxInlPWtxVuCcS72gXlWT2QS0jjO6VIjasyamgHbiWQiBMlCaE0LIcO9Y2q21oIEWsThCA2nSlVMGhVuEbOpIc45lBTnVUOkqe5pkrmMBuXci59B5FiHaY0qxRSlqqJVEck53jJmlE4qAcFajQDnBRQ0yxXSfFTNicklZ+TIUtNUl1cmZgAD8+NiJvPhfWIRApUWMH0AzR2bLjymmGaM4Jaz2b6HJaAAAXNS24tKPm2IZbSVQTKWUCvZRy88XLuJjImQ3WV8qNXHmnrrQl5FVWJLDB3KCAwxWfLQroneFS4kux2kEU1GNmHPXmsClWFI978IWQda5vyVJOQtU3Hh-oApxQNRzPAV4GD4GYGwKAcBEDIHQHwHgSVkTyDohHHaugMjXytakcIoZyVUrzekESBbGbCrgVKsljMi3UGoGiQgmh7JcngvGbE-4vJASrVHQIWb+XlpbPaiJarC2gFpZFNN2QM3nKUqTbGoA+2ss1ddbyIknLeuBX6ntC7iDZv7RTCtiisVNPCcUkdNaF3poUNK49xKMbA1he8s1pLt19vJYe0G4yrbvHVga0dk606e2-Ybe6b6B0ySJhVWdytq0UypUIq8qg0q00UM2okW61VLs1SjNKHDMM7uze+lsi9e71z-RegDYDSMeRnhA3mEc170wI-uvGH7WFlrg5e9I7HQO7pYyjD9UsMEC1g3jKllGhMMfPrxwj4GpDM0Wi+tVpSygUavbkZmD64YQ2rExsDB6WzUyU+RzjlGjOZr40Rk16YYw5yjv+uMKobMujs9s-TrGF2MGYFsehJA0TEGoAAdzsLiPQSgkygAALSRa4-GCOctO52HHaoYQ-ynDQP+JQfAoBVBrDXCwfWddJCIeEPKLhkjx2nXy4V24JWSBpb-v8WIC7HLyHENl3LUhTgkA8HV4gZXGzmGRWmBB5B0WxcINO+a71StYewxTZMChxmJl3ZsWgAs5XzdKG1FDIyUskHVVt+V1zcqbaO9898Wa1sue8KV4sx5cE3RzK2nIqgRvSAMJtqlPMRKfqW94d7n32XCp67dLR7gYjmGa-IVr5XPPef28QaEfmAvBYu8iEByiosxfHXaKHezZorr5Gu1QSEGp9vK7+NyqhrnooAHwTYzdc3tfHe0pka6yWalHy4-os9mrhj3yCMEIDMCd6mfBfuDlV9w4rr3zr7fxlG4nxc8-SOncBCSzgs9kwOgDk25dAal1XRQ2i656b40arnjmSPLwvuTvjXCss5cAfkEBVHbdELh5I0Hx9ChuEh1Dlr092vO6kGg5+wmsHvwG7jX8evp0nwj1JnUyD-B9oD2YaHsPBtIrBmNpVvNB4vbaxiuV8fr0F-EXbll6fcZO8609lYxeUuJ8L9xESMe2W-krxPYvGeZxZ+DznlGcfre0b7mTTVT96My1ftXtPFvcbxFKPETnB0if+PeM59wHkO0ZZiXYannl6fBAAFQmO324U-si9+gpC+Ha81ARfHQxhhg1Auhbu4gRxzjShSCkFuQQQzTO3MDeV0DcDmzZXgUQUgMdiPwfx5GfyM1O3Oxtzo3ETfzOHlAFQ-XM1EzExeVUCMzQ1-SwJwMEnwUtwOkox4wTgp0G2RXynG1YXYWoAilDH72RREXDkcnGzoAQKfwRhgj4iciak4Lz1AAvytD9wYAxQ3ykOdB324JUEawP0Z2vXyjZyWw8Cu2YBuyQ3IRUNgPO2wwUM1HcAahAJMLxgVyoOfAk0NBn0wVc0SW1yeSpwJh+wQkn3lXL1yEVmgzPQNTcLv1iyc2kJEzoIdwYIkJEnGz8Jp2czuV+xdXl0X1KGjGvE8mb0yLuRxW3REjcP71-BEjsPZDM2EIRTc2iNJEyJIOb2IPyPwysJsPF2IJSMCPNR7RaM1UXR6OPFrzUJ93B39xLHDTGkjWjXYDjS4ETTQB+hTS7iFxFxqEiiTHcM-0JCJHqFUnWNUwvSTHIMUARyTFqTrS3HIgXRTCrAUAgLJD7koDrjcAS32WIkQ12wak0OYw-0wnYm62WyvHpCsI+LyjYJxCKM9W1i618B62KzGhSw2KtVPDHnwAthhIBLGkdQBnmg+IRJ+OmTjhS0CAGUhOxKOhm0RIJO+lRIehQXOVWz0IFnwEpObk2SLhpN2TX0EU8McNLR7H+xZJ6QhCCC8LbQEn5L1EGS7lFNew73xNiWRNNEKMll5IQixIVlVLbT+3PjlMG2ijzELA71CNnhEXVGICcBWwyGuwFnoLxTsELFrxmgOgLyjSlVtLUKDEdKwGRRuETFd1AV0PWyKHG2gOkBiESxFWKxsnbQcgajXUFNAHWE2F31jNogQg5wjNdM+BIKcizPkC3gMQDSwkaDzLpOjOL1zOjILLKTUMLFLLKNTSTG0MtOtKwT3zTMcjylVEQhqLUK3HNJmBTK5A-kuDkN0CcEHLjCvgFSpSTK2AQ2jKHPQw7Kvi7OnktMV2PGFX7InJqCXMckMAAB5KRxzJyVDNyZxxMvM1FVAghVFqB8ZiAcQx0AVbkigGA6BG13l3BhUghQAABqfY7DMYNcc0rLSKTyD+QCgSP8wC-okCrRJwcC1QKc7Ax2YVY4m8u8utAgeQQLF8wFd8jkL82QH84IACoCzVBCsC-ACC2-CimCii+CoXRC5C1C0IkRetRteo0tTyNwrhKCLNGQOtdyd0lGKCfg8ifcuM88r3GcR7UM6Si8tlcTXdYSpRUnMgU0xClsxk8+BXfo4VY-Uc4spS-oqlIMVCwyjkB-fMJS6YAKdi-vFfOvDrLNdFK4X0oBN3QMm7J5Gw68rYPi4IEgQkHrQSWkPHFGQfNrYfY8ZFPM8bF0xcwYx2X8SS1SPMnMlLKs4wzVLKknUsroPGZffHNQoSzi0SxfLk9kOo7I3ijtDs-iwbQStSyqzS-nOK9HMQDK6Slc-ykfT-RSyC5Sx2VSjIdSqq6sagM0i03ym0vjUagdYyq4IMEa8yjkKwSQSyow4SFQJagzXqn+W-BykMJypfSi0oevdykyry-03SoM34Lq0oTCoKxqkK4gMK8ZCKz4bHMdJI2WYq6KoPWKuVBK6MpK1vPMjqoGxmdK2yrKyCnK2kQ7Ewgq9M5Gz4e7aK0kUqyRCqkSmGjucYlqSY1gaYzgBNXgDARY5UVMSgArWuWreE0rHBT-RUxVerYIemxmx4ukFBHmmrSQBm45ZwvmDMVmmBG+XhEMO7DuZFQWpmuE0m8bU0ZGdiP0AScwP0dlVG0odiAMLWswAMXW2A9iOco2xMjYRgU29WkqKkS2qkW2nDEqOBfBASN2xBRmPW8wdiPWOgY5JQHEASf2wO58imH2swdiV6o216tlSOwgoIVEGYFUfEOgekZOmoVOhgPGBO9if8y28wVQU40AAqE-CLQC8OvOkqSLQuswYuwIMu84BnCLGLKus2mu5JI2iLUoZu8wGLHu6u4U6-QIY8Bu0ui4Fu0AU-UuswIe6kYAOunLEupuqesAduu24UgAUiXvHtXtAAiy3tntAHntvNHMLr3snoPo8oxQKg7uFIAEJLgL6V6r6Isn7b7T6ghDzd7X7y7QBjyzA77N7qRDzzg67L7-6wGgGv66df7G637QAGcYH77qQ6dwHR7ShIG+6It0GUGQHbyH6l7r7e7kHQAH7zB1jkYugFbqsla2pIL0VcZqc-Qao6G+blalRGtaGGaha2pqB8QAArG42Q5hw5RHE-c29huuASPeO7BOmcRWjhiNLob0iQpRorbTS+VW88diYYv3ASfR9wBR6wqOkqSAYgX3OQYO0eixqxkBEx0x9iTOyQWASAI2lxtxxx6w5xkcLOgAUUtpcf8e8ZMPYgADklBwml7InwmDrzsaH1HpHYY894YcymG8ZqdSAT8gxSAWVEzknP1wZ74YgeHebNHUn+w10MmUYsmcmDS+F5Q2HeGlatHGsIzKsNHmaWpEc0sqQEzKstFN9KxGBpAcQdLBGlAsh+C1xgEfD5Uunhb8gtwbRbFZsrDrl+mogZwCcDpp5rAm15rz4EzFtwCHr9CQCwC1lFmGH2zLrsNFmtGczQnQCjlwDVAbn5oBHhGKBLCTDHnKn290yXnjbZhvKAyGTHqDAO4twxtfSnARF8QbZIWbs+DyRDmUWBZVGoJrJ1yl5Ak65GBCRp5ctiBNARdaJFBiXrGnlkUM5xtcXbh8XIotFyXoXSR69CXqWQFyGrgp4WhAa5LQ6axIoghosYtUxyFlJQBmXxAyWRczBxX4R7mzBhWg7VASBGXJBmXVAM5wxQAYrjA8aQ8G9LRFB6w9WBqzAGgPBhctweR1EzXGB6wnW3owTdXsbjxOWqWZrrHeWMV+X+zbQrWZw1XRXxXot-rp5nXHQ3BKw3BscI3lXDWjBjWU3cYw3byI3I3ZXAcGBs3osorjww3eZLAPh5mKYQL6gWBJBqcrDErm7+jJCyXaw8WcgXEK2jstFin1xr0M5Agiq8qUY-DtX23Ip+2ORELYWloq3y3QywxYaDXdnnxJW+41RR3FAWX5WJYuXfWHHHcOtPa1BWWRdO8UZM2xXI3y80UwgCsa53BE2i2DWQa5K6WGXW2mWx3SW2XF3SgL2I2Xw1xCXKQRK5W2XE3C3f3zBM3NWP2N2O3LXnLZxD2pBXWMxLW5KMi43NoEFbhLE0O0ICPrx3pEO5UL2ABBNUc12N+N64B8+SRwRqbstAJ9lfF9566DiQMOrN7NmVsdskT8j7fNgtmC1j89rjkV0t6tztytoXat2t8R+tiGxt+bWDkZT9zdsmbqFTbtriXt3ICdwdqwkdnVid2a6drIuTud-BBdpDzPXG7oPqKCAvciOgQLRQb909rhN9jFLVnVk99l3PXsJgWkWQ9QjThDhkKdqwGdqzlgVQedxdhS-BTGlCA6qlGEB85O0gGoRCl8EcJQIIcgtTttzT3T+GfT3VvyPMPMq+DmHFuD-z7d2liQpCd99TzzsbaCqIJ938Zlj8MLJMKrKVtUUnFMUI-r0LRwIb1d5SMbzQJ5evE1OFWXDMJCM9oLsYbqrIjtPgjtQCZaDTZ1To1SdbqD+vW5hyG+4ISZ6Z0gWZoFsUkNyROcxHH5YKjdE7pyM7pD9NxmWhkb6eDwE7cbanSbnEQb4btdhqT7kyX1ebz1wazCS7rka7oIC2lo2c621QIMWbqj4HgFVc0ywsPHoHlUQnsMFo4VFHokNHh2zHgpwHkYE7Knq25Mmn6QNhpngn9LKDtNl9pbqQVcdcTcXIM7uHOPFMfvFN0APANriQKRMIFQI8GOJX7kUtdb6XksPzsdzIH1klgAclddUFMfMAAB0sA7XcgrmPAYV8A1F4vQzG6EGysNUDfoRd3p47QdfN29eiWZrcgjeqPnWTfTfQALereac3nls7eHePnsfCBaJ8nwS2ethE-QAAAvJpswC3mcG3h9e3xgeLjIZ3zPsMLbd34IT3-mmIfRBIVvVz9zrYI36P23kGQv+LlewIdiQr2pGC0gGC54+UA3roPAH3gl-XwP-P2Povve7vkqXv4IfEfvwfyIfQSvoIeEIAA')">function parse_query(input) {
    const exp = parse(input + ";");
    return query_syntax_process(exp);
}

function query_syntax_process(exp) {
    if (is_application(exp)) {
      const function_symbol = symbol_of_name(function_expression(exp));
      if (function_symbol === "javascript_value") {
          return pair(function_symbol, arg_expressions(exp));
      } else {
          const processed_args = map(query_syntax_process, arg_expressions(exp));
          return function_symbol === "pair"
                 ? pair(head(processed_args), head(tail(processed_args)))
                 : function_symbol === "list"
                 ? processed_args
                 : pair(function_symbol, processed_args);
      }
    } else if (is_variable(exp)) {
      return exp;
    } else { // exp is literal
      return literal_value(exp);
    }
}
</pre></div></div>
	  Names are preserved in this transformation whereas literals are simplified
	  to the value they contain. For example, the query
	  <div class='snippet' id='javascript_96_37_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
job($x, list("computer", $type))</pre></div></div>
	  is transformed into this query-language-specific representation:
	  <div class='snippet' id='javascript_96_38_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
list("job", 
     list("name", "$x"), 
     list("computer", list("name", "$type")))</pre></div></div>
      </p></div>
      <div class='permalink'>
<a name='p38' class='permalink'></a><p>
	  An exception to this processing is the
	  <kbd>javascript_value</kbd>
	  syntactic form. Since the instantiated
	  representation
	  of the predicate expression is passed to 
	  <kbd>evaluate</kbd>
	  of section&nbsp;<REF NAME="sec:core-of-evaluator"><a class="superscript" id="4.4.4-sec-link-4.1.1" href="./4.1.1.html">4.1.1</a></REF>,
	  the original JavaScript syntax representation coming from
	  <kbd>parse</kbd>	  
	  needs to remain intact in the query-language-specific representation.
	  In this example
	  of section&nbsp;<REF NAME="sec:deductive-info-retrieval"><a class="superscript" id="4.4.4-sec-link-4.4.1" href="./4.4.1.html">4.4.1</a></REF>
	  <div class='snippet' id='javascript_96_39_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
and(salary($person, $amount), javascript_value($amount > 50000))</pre></div></div>
	  <kbd>parse_query</kbd> produces a data structure
	  that combines the query-language specific representation with the JavaScript
	  syntax respresentation:
	  <div class='snippet' id='javascript_96_40_div'><div class='pre-prettyprint'></div></div>
	  Once <kbd>instantiate</kbd> replaces
	  the expression for the variable
	  <kbd>$amount</kbd> by an expression
	  for a number, say <kbd>list("literal", 70000)</kbd>,
	  the JavaScript evaluator can evaluate the predicate, which now represents
	  <kbd>70000 > 50000</kbd>. 
      </p></div>

      
      <div class='permalink'>
        <a name='h12' class='permalink'></a><h2>
    
	Representation of pairs and literals in instantiated queries
      </h2></div>

      <div class='permalink'>
<a name='p39' class='permalink'></a><p>
	  The function 
	  <kbd>instantiate</kbd> uses
	  <kbd>make_literal_expression</kbd> and
	  <kbd>make_pair_expression</kbd> to convert
	  the values of bindings in frames to expressions that represent those
	  values, using the syntax
	  constructors of section&nbsp;<REF NAME="sec:representing-expressions"><a class="superscript" id="4.4.4-sec-link-4.1.2" href="./4.1.2.html">4.1.2</a></REF>.
	  <div class='snippet' id='javascript_96_41_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=4&prgrm=PTAEGUEkGEAVQFLlAFgHTpQKCwMwK4B2AxgC4CWA9oaALYCGA1gKYD6ANuacwE73utmADwAOPZgGcJVQgAoAbv3zMAlKADeWUNtDjS+HjQYsOXXvwVLVAbiwBfPETIy6TNiPrkeg0eKkzZAAtmegATHzEAGlBSTwFhMTVNHV1mfUNXE3oREU5iegpqWWM2QnpaZlkAIg8vKpVIrRTmltbmzglSIJDwhJ5o2PJ43xUVWzsgA')">function make_literal_expression(value) {
    return make_literal(value);
}
function make_pair_expression(head_expr, tail_expr) {
    return make_application(make_name("pair"),
                            list(head_expr, tail_expr));
}
</pre></div></div>
      </p></div>
      <div class='permalink'>
<a name='p40' class='permalink'></a><p>
	  For the purpose of unparsing queries, other representations might
	  be equally suitable for literals and pairs, but the JavaScript syntax
	  representation has the advantage that instantiated
	  <kbd>javascript_value</kbd> queries can
	  be readily evaluated by
	  <kbd>evaluate</kbd>.
      </p></div>
      
      
      <div class='permalink'>
        <a name='h13' class='permalink'></a><h2>
    
	The function unparse_query
      </h2></div>

      <div class='permalink'>
<a name='p41' class='permalink'></a><p>
	The function <kbd>unparse_query</kbd>
	distinguishes between compound queries, whose components are unparsed
	recursively, and simple queries and
	<kbd>javascript_value</kbd> queries,
	whose components are unparsed using
	<kbd>unparse_term</kbd>.
	  <div class='snippet' id='javascript_96_42_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=4&prgrm=PTAEGUEkGEAVQFLlAFgHTpQKCyUAzAVwDsBjAFwEsB7YgZwICdqBbCGeJVNARjQCYcRMlVqhKdAPoAbSuQCmjAIbSAFKVYAHWvOLkAlKADeWUGdCN55Qo2Lip5JQHMn8gCYyJ5dVp16ANKAARLIKytJB+gDcWAC+WMIUNHahiiqSAG4qhPI+LNrEugbG5qCm5pbWtqAAFvJKbqqOlGoa+X4G0XFCJEliEpKOLu6edN5tBUWB5HWDzoYmpZU2dgOaSpSMeZN6hgBke7X1jRMdhgC8l6Az8nNOMfEJvaKrUsRKLLmnhbvG5WbLaoDIauDyyMbbDqBILvT6RB49ETJUAsJQAa1usNydAAniwAEbUaQLf4WKwrUDg7wwj7yIKBXEEoldR6JF6gRmE6SSaj4SRYyE-YqLCrk6p1BpNDatXxC-QsxF9V6SJR0OiUJzET56QVFElLMXKkEjKm6gLBVXqzXa8jw7ps5GWjVaoqSTlEs3C0mAuwSxrNNR+qUtT3y+UIh1iJ3W11ZaQ5STyAAemksauSob+BqqvuOwbUAdD4e6TyR-SkbnkpGkSmUL0zIoBhvsd1Bo3GsqmwQ09EcekklertaUL0ioAAPuPSaVzMDnG3Td8u0EsoxKEp8dJboOa3XkmPJ9OZy3jWCvJ7oZHiAOq7uR-uFaWlaAd8OXm68VyG-8fRzP0SeT5AUg0LJddmLeIrxfW832STJsluZNU3kdNaG-UUcyOSVC1AztwMfKDUQxSQezGJR+1fPc0KxQI4wTJC03VWh9QwilTSCUi+3IG8hyo4h6VAGjQDoxCU0Y5ICOeZEBhrAk3CURMxJQpjiHQptMLnYYzwhMDyGhWT8XkxTkNQ-iFSggyjPWZRPjCD8mWkOg1LJTDUU0VR3W5Xl+VpQIQOlItzKksRLIUwk3BxZzf38kNcPaOUIMVdkiNuULjPEtDrNpMI6ECcKcRY9S2PPEIPkMhSGOU-dAiy2zFFy0B8skstlSvHi73rXSFgASFKb1m00hdz10y9guvSj71oO1ILGggxva2DaB8z5nJc4qxkkSx8AvUAeCClq5paha+MkWqrHq1bfypTb5G2kbQH4fbnzaib33yy7m2uradoAZie9kXtvQZqBI2gyIo28Ptc9Fbk48juNejMj2PcxAd4ybrwFLr-GRlGURhmQyqMyrTNUXG8dR+bEaWs6ctDHGKcZtGOrg96usSp92QGH03UcBQbSigaHHnE1hrwvTgh5sj+aKabOeRHmSZUwXMJimV4r1ZrnwGHs3DkZIVChilBtFnTxehXX9dodIlYfCcp0Zk8Re0jsNfNDjaD1l50ml+QbTlqDLe97lkL10gRy+cXCqurwbru83dv+5Eg4N7lSPkABHHIdS6rMiuqL7bp2x6I1mlPre5FQwneKgMkjt2vVYgvY+++6-oReXyzdTPs9IbFyBYRv86NZ32w8geJaCOge90PuA9m6es9n25fZtJyxkHhZzB-Zs1fHzek7EfBNg21ein38g6Gj3e8w3y-D7sNNuLPvR14nq+87W6pCzvq-S4OgYftNDkBxN3JeZB+6Dw-o2X8AxiCEGkGoX+D8Ww1lPnzP259kGf1gW8BBBYArIK1lzKQm5qCkDREbIEwstJj3ukEMhFD54HUYWiSQbMo6fy-rmbCAV2b-2fCldh0hyGUJfkPYelISqsIEuI4h0kpDUE0Gkcg1BGCgwJJQGuGZc5GF6tvbMxspAkFrKApRKi1EaPxFojGmZDyOwGNY94jAzHKLrJYtoTjbFdQESQyQJiXE8jcSODxrAvGdU4XovqhjqGtlNq7HYk8AmuIseozxNjRwoMcTYwJ5j3FpLCRknRkT9FmH6hpGhQ0zYN2hF43JwTVEFM0doqaKC8khPUZ5KhKQW5F3untXxyJj6MA2u04gJxInlPWtxVuCcS72gXlWT2QS0jjO6VIjasyamgHbiWQiBMlCaE0LIcO9Y2q21oIEWsThCA2nSlVMGhVuEbOpIc45lBTnVUOkqe5pkrmMBuXci59B5FiHaY0qxRSlqqJVEck53jJmlE4qAcFajQDnBRQ0yxXSfFTNicklZ+TIUtNUl1cmZgAD8+NiJvPhfWIRApUWMH0AzR2bLjymmGaM4Jaz2b6HJaAAAXNS24tKPm2IZbSVQTKWUCvZRy88XLuJjImQ3WV8qNXHmnrrQl5FVWJLDB3KCAwxWfLQroneFS4kux2kEU1GNmHPXmsClWFI978IWQda5vyVJOQtU3Hh-oApxQNRzKCJBrLT0GIoFgqhrlPNwfBNcG4txxoBfyx2VLPKASTeuTcuR40CuFTJOQaQ1CFszRycga5iBOEoPgSKqRwjwXjAW9NGbGbFqkPa+s8bQAHBbAKc5SlSbxo7RTKlEbazTw8v+LyQEpXDpMsreNgQ5UU29cCpyq6yiapnFOkZtwwgsHHXjLt7CckpKJekklaanCnpRlSoIqggigAANSgAPVG49qglW6rWWO9967X2vo-Uy+yX4+1vuA8Ed9n7iCRqPTGjySzxn-saIB6D7LIhBCwKUgAJAAHRrLWrc8HI1aKcPh0A+HqA3EYNR-DaItFuDoIx3kjGEBKCyOAUga5gGMa3aAQjyhSPyHw0W0AihmBbGudCEgaJiDUAAO52CXi4v8eglBJlAAAWl0+R6dSHGAsDlrgMAV4GD4GYGwKAcBEDIHQHwHgSVkTyDohHHaugMjXytU2w2ZLGZUv89yESoZyXnqxlHclwXqDUDRIQTQEGAJhezd5KLarAjeYfTOc9Pbilqpi6AWlkV3PZE80ujKpKo5ZeID51lmrrreREtugFPrkh+pq1Jur8oIstnAzehFhWgtSY8woaVWKmnhLgjC-L5quvZb6zrT2Vt3jqwNUVsracVvBy8z1pbUg0ousCxOkVkgryqDSrTRQyXHL03XeytKHDMvdZ8wdsBvd64bZG1tj7y8UPgL7rzCOa96avZy6Uc9rDws-bjMI0Re23udpbFLDBAsTt4ypb91HIPz73UW8jgYzNFrVbVaU3dp2tuEAq1TIGMK4YQ2rGDgnFNz3U1J99yncP2eI4h+YPL6YYw52i7D9I0YXTC+2Szs9UnGAydtQppTqnNOOB0-p0b5WFBmagiV39JB-lOGgf8etoBVBrDXCwfWddztjT18QeUXDJEldOhbq3twLvCAN3-f4sQpOOXkOIfApvlvtBIB4D3JAHeNnMMitMCDyDoo1-GGnR13rCHVXutlyYFBoe85sWgAsHuZ7MG1a7Iy7cZ+L+y65uUi-F-OXV-PEvvDp+LMeRNPMwtx+kAYddVLO8IVBnoc+3fe-suFWH26Wj3AxHML7+Q-vHey-l574IiuVN2CgiA5RemDMlbtHPvZs0mt8ha6oJCDVsuO9-G5O96KAB8Sfqfjbk+DrLKZveslmr98ua3edcMTWrUIBmFKzG0jnGVW3SFDnFXG2xnBz53MCxzAJ8AgODiH0XmzgSTOFqyR2Ryp081-zFx70UG0TrmZx6yNW-zhwwP+1-hwKeRNzNykCARAT+wgQvivieRiTsEn2PkKDcFnznz92nkD2D0O1VGfjRywXfij1xl-HwPGz-XEQ4JZWy0ELMHn0X2jyRTBgTyUInhbRyETzlQUNyH0Nxx1GQX8DUNxkYO5kNEMLMJPkkMHkcNkLZV-H0NcJEnUJnE0JEO0JRnkOoJnnYLryfmBxllfhUOsIoNxniFKHiC-wOhP38XeEF34NnQciN24Pxnck8gf2CAACoTEMj3AijZE51P9XMxA6Bw5rxqBgDjoMZOs1UAChY2C+4YcRslBSBSBbkEFPM69isjldA3AGt5V4FEEJj2Vb86jyIeQmj2da8q8ORQigdxFWjQ0ECzA2cYI+JujTtTR2dbsixJMpjpBKCDpftod8cesuFkV8pE9WF2FqAIpQxfDkURFw5HJE95iGilj9iWjVAmpPjdD4Nxd3AGAMVUjSirRMjviVBvdcjTCQS3icR38c8PA89mBm9LtyEkSZjVji84TnQoS11iTKTstQU7BscHDlC7ifN2joZiIB9W0yYNVUTFYR1lY4DqSrjnxftxd0cE4r9o9kURJE9UThTYxB9jsFs4jShxdbtHC40Mi7kcUusRJ6DfDfwfCj9rjucgSIkpd7jo9lTs0wsTjNSXthiUZUSTiRJ2t5tMs7TOSesiTM8bDcjeDp8BCSw8BLMmBWB2B7MuAnM0AfoaijRGBgCahIokwE0OjCQiR6hVJEyKdTskxJNpM1FVAkxak4stxyIpMUwqwFBxiyQ+5KA643BtdZohELsy8Gp8p6DmTpkX1Tgw8bcWp6Q69my8p0SdTPVtYpAuy0MPckyrVTwx58ALZfBuyrxHUAZ5pmzf0pzpk45f1AgBkRyVzU90T1z2zm5Nki45yHoUEG8Mgm8BZ8ANyTyZkzzAhdlkjBECY2ScgUCc8JFnl2IPy6RAgexvyskpB-zVARJ7yR5aFTRtTJYHCRJlyFZ4LB8gLz4ILjzA18xwKEIw1v8yARF1Ra1ExG9cSBYxS8U7BCwbCZoDo-1rMpVyLcigxqKsBkUbhEx8hWCcSC8ihE8LiYhO47BGybJsQqjaIEIciA1QB1hNgsiuQGoWtLyRLbsnJ6LPgt4DEpKgw1L5AlLaRHDVKRKNKylcjCwdKaTSysTiLrzSKsExLhJCTGpVREIzSKLKRdAnAZg5KiQP5LgYSPKvK4wr4BUqUZKthhKpVPIFKkSWUnKo1pcZctxa0vKorDAAAedy5KmobCxyHY0ALHOXPMoIVRagfGYgHEYrAFW5IoBgOgRLd5dwYVUDTMzVMYGtOtBtby3KuDASZqt0tqyjetSKIK3rR2YVXMrYYquLAgeQZTSqwFGqjkeq2QRq2DD9fq6tQazq1Knq6EODDa9qoanKzggU9kEReLRLFU1LOdNs6PKCbzGQOLdyRilGKCf4rq6K7qwI9vDoi4j6vKzHV7R6pRc-fC6gQipwaym88+akt04VAovyrCRoVKt0qlIMEauGjkeorC1K6YAKEaroPGBIlGRg7zdFK4dilg0Bbi5vLg+0wqrYTyeTYgQkMPQSWkA-FGfwgPb6mcZFHSxPOikS0GnzXwvGX8d6nSlS39Iyz0vdKWs-cywmrm0kYmyRB68656uI189kC0udVUpmhy6QW60ke6urYGrWpk3mt67GqK8Sr6uVRNP6lG4vLHc2zW0G6scGyjKG2ynUWG4veGudcmjFIMF2zPLNKwSQdGxyuMAGlGeG7Gn+Ko2KwsAmsWoQ2woPEWkO64WYKm32ni34Xm0oCarq5m1m8Zdmz4XfYrdU2WZW48bmpfY8fmkSwW5w87YW70x2CW7GqWqKmW2kSvVYhWiSoe9Sxuvw1WtyjWp6kWx8QMsaKzGzUMzgRzXgDAaMlsVMSgS3Wud3W3dPHBDomczlfXYIXe-emsukFBK+t3SQPe45TBLTM5SPE+1WPMMyyPR8ZFe+g+nspUaEl5DkhVCEIIP0AScwP0dlEe8wdiAMKBswAMWBz09iMKpB6SjYRgVB5GdiKkTBqkXBlGdiOBfBASMhxBRmOBswdiPWOgY5JQHEASehxhiqimGhkBoICapBiatlTh9iVEGYFUfEOgekIRmoERhgPGARkqN9TB8wfMwIAqQonTD9dh2R8B3TBRswJR0AFR84R-NXfRswTR6kXTZJJBnTUoQx8wAzaxsxl9CowIY8PRgxox0AIokx0ARxoIYAHR03As-Ri4DxsADRtBkqAAUgCbcZCdAB00ie8d8b8oUdidUdzoKgifAYAEJLhUmgn3H4nQBcmMVMm8GSo0qYmCm4mdMMqzAymSGKnzgdG0nbHamMVgmsnqR78qnlGanQBH96nfH79mmXHShWmPGRmhmumX1smAmimbHBninzBEzkYug-7XcAG2oor0VcZb8-QapNmb7AGXhvcNm96H62pqB8QAArcs6EvZw5O3Qo9Bo5uuASPeVvThmcf+45yzLoVi8E3563BnS+RPU0diX0-ggSKF9wb5yk2hkqSAYgPguQZhlx5F1FkBeFhFwRkcSR2ASAJBiRyQQlnFykvF4RgAUUwZJapfJeJPYgADklAmWAmWWmX47i91mgW3nYZdD4YVLdm8Zb9SBCigxSBYrgX+Xex4YzneWLmAHQWDLhWUZRXxWv6+F5RDnFXjnQXvdBKRjjlQFpWTmMxV9rkqRIKjXpBQEtE0jKxGBbWfabnuNVQ+NKBgFQH5VTWn6twbRbF085a8ZLWvBogZwDTnxp5rAksaaBZrXs8xjC68Si83kxjVBTXtn7K3TzBTXlXcbU3Ri1lM35prm7mKAGoc2zA82BX+xFLg3jxKbOLqaSKi6DAO4twE92KnARF8QbZW3m8-jyRY2B342BKoJENJB1NQE65GBCQZ0tFNBgDaJFB520WnlkUM5E9J3p2zcENgCp7GDZ212QFimrgp4WgG6W6XwJA2GX19MDNUxyFlJQBp3xB92E9d9tHw3cZWGaxIov1bhd2M5wxQBm6jA1bRCmCVQ1RFB6wQO6azAGgPBYytweR1FLQ4OMxMPGA3pDyEOM6zAj3V3vbT2Sngh1QkrbREOZw-2mH72H299YPcPHQ3BKw3Av2H34QwPhCebIPwPf3b3-2GPGPX2cgNNR8GBGOuOp7Sg6PQE2r6hY05VFOPhJBb868BbDGc3AOp3xPIoq3ZxZW9B1xxsM5AglaG3jxTC9PFBIpzOORKNO2lpVPY0Liwwp6kjt6n2+41RbOXE92l2JZj3SOVHo87C8FEFAuD2aP5OROn8OlrgY0Ml3Av3OaNDePr3N3t2jN-PIpF2D3COb2GHhOghRO3A1xZ3KQnr32gvOPv2iu4vdPgO28Sbs6TVmP4P3DHZkPNoEFbhLEcPe1OvWZ8PWvGY4uggABBEbqMNj1L1RF8EcJQOK+QNAdLvwzLku8wSb6TgzN9yT+r-TXqjbvGeT3mSwD4b1x2Vz9Tp5zT9u7TzPZr-TsmbqcnLRcGKgTzBzyzuvGz4DhkJzqwFz6tJT1Qdzw1eImeyDw1v9ciOgZTRQaLn87LjFHd17gr9t0kNu2kYBgH17hziG5z68VziH-Bcb55ShtQHS4KytGEUqoR0gGoSjJbxwXDMawzQ9PLvdr70z3IBz7SkSzgiyl7uz1Qad616n1QT4AkZHoMSXwIdiPVXqtRXqpTaj0akbQD1QBX-T1OgKRXrn79GNPKifBDIzXXvMI3wsI3sXlxFBHX4FaO44L3A3NIxDHqWenkuCGBj9Z9ZqtoVEbuLKCsmXp571QDr3B3f3-QIIQZMQIPhSaeUP9wcedqySp3PogYmscbDyK5PouJhgD9ONPo3OoIV9J9V9Jqvaj9XoyVqzx2CvhkTa2taorADHuzzIEjmdAAciG9UARfMEIywFQ4LSLY8BhXwDUTc-wWUb6Ydw1V7+hBC+njtE78CVX9yH7868H6H+E1H-67jQn+BnOxn4zewdUEIFolioxKwdkuv9AAAC9tWzAR+Zw020Mp-z+Mh5-n+wxi8y-YIFvztD6IEgndBHkjy2D98T+3-EzG4yV4lQlAvVfEL1VIC9U6y8oXvl0DwAb8Z2Pfbfp-0n4gxp+8AgpogPAbIDakaAjAZEH0BACK+0QIAA')">function unparse_query(query) {
    return is_null(member(head(query), list("and", "or", "not")))
           ? unparse(head(query), tail(query), unparse_term)
           : unparse(head(query), tail(query), unparse_query);
}
function unparse(expression_head, args, arg_unparse) {	
    return expression_head + "(" + comma_separated(map(arg_unparse, args)) + ")";
}
function comma_separated(strings) {
    return accumulate((s, acc) => s + (acc === "" ? "" : ", " + acc),
                      "", strings);
}
</pre></div></div>
	  The function <kbd>unparse_term</kbd>
	  formats any unbound pattern variables (taking
	  their symbols) and JavaScript literals 
	  (<kbd>stringify</kbd>ing their values).
	  The argument of 
	  <kbd>unparse_term</kbd> might be an
	  application of
	  <kbd>pair</kbd>
	  as a result of 
	  <kbd>instantiate</kbd>
	  applying 
	  <kbd>make_pair_expression</kbd>
	  to a value, or when a
	  <kbd>javascript_value</kbd> syntactic
	  form contains a call of a primitive JavaScript function. Such
	  applications are formatted using
	  <kbd>unparse</kbd>.
	  Operator combinators are formatted using infix notation.
	  To support other
	  kinds of JavaScript expressions in 
	  <kbd>javascript_value</kbd> syntactic
	  forms, more clauses can be added
	  according to the JavaScript
	  syntax described in section&nbsp;<REF NAME="sec:representing-expressions"><a class="superscript" id="4.4.4-sec-link-4.1.2" href="./4.1.2.html">4.1.2</a></REF>.
	  (See also exercise&nbsp;<REF NAME="ex:parse"><a class="superscript" id="4.4.4-ex-link-4.2" href="./4.1.2.html#ex_4.2">4.2</a></REF>.)
	  <kbd class='snippet'>function unparse_term(arg) {
    return is_variable(arg)
           ? symbol_of_variable(arg)
           : is_literal(arg)
           ? stringify(literal_value(arg))
           : is_application(arg) && is_name(function_expression(arg))
           ? unparse(symbol_of_name(function_expression(arg), 
                     arg_expressions(arg), 
                     unparse_term)
           : is_binary_operator_combination(arg)
           ? "(" + unparse_term(first_operand(arg)) +
             " " + operator_symbol(arg) +
             " " + unparse_term(second_operand(arg)) +
             ")"
	   $\langle unparsing$ $other$ $kinds$ $of$ $JavaScript$ $expressions \rangle$
           : error(arg, "unknown query syntax -- unparse_term");
}</kbd>
	  The output of this 
	  <kbd>unparse_term</kbd> function
	  is correct but note that the string will become unnecessarily
	  verbose in cases where pattern variables are instantiated
	  by lists. For example, processing of the query
	  <kbd>job($x, pair("computer", $type))</kbd>
	  might lead to a binding of
	  <kbd>$x</kbd>
	  to
	  <kbd>list("Hacker", "Alyssa", "P")</kbd>
	  and of 
	  <kbd>$type</kbd>
	  to
	  <kbd>list("computer", "programmer")</kbd>
	  in which case the expected query result string is:
	  <div class='snippet' id='javascript_96_43_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=4&prgrm=PTAEGUEkGEAVQFLlAFgHTpQKCwcgFYD2ARgBQA2AlgM4AupARAEKW0Amlbb5ApgwDShmPAHYMAlIKp1GAY0IBbAA4BXWjwBOAoQHdKALwCGGthPG4gA')">'job(list("Bitdiddle", "Ben"), list("computer", "wizard"))'
</pre></div></div>
	  However, instead of the expected string
	  <kbd> 'list("Bitdiddle", "Ben")' 	  </kbd>
	  for <kbd>$x</kbd>
	  the function <kbd>unparse_term</kbd>
	  given above produces:
	  <div class='snippet' id='javascript_96_44_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=4&prgrm=PTAEGUEkGEAVQFLlAFgHTpQKCwcgA4CGAlgE4AUARAELEAuAJsQwwDYCmlANKEWVdXYA7bqCEBXVqwCU0oA')">'pair("Bitdiddle", pair("Ben", null))
</pre></div></div>
	  and the overall query result string is:
	  <div class='snippet' id='javascript_96_45_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=4&prgrm=PTAEGUEkGEAVQFLlAFgHTpQKCwcgFYD2ARgBQAOAhgJYBOpARAELUAuAJte+wDYCmDADSgqdRkz4A7IaEkBXHjwCUS4aPoMAxoQC25Oaz60Z6xgHdqAL0q12M+YpVLcQA')">'job(pair("Bitdiddle", pair("Ben", null)), pair("computer", pair("wizard", null)))'
</pre></div></div>
          In order to render nested applications of
	  <kbd>pair</kbd> as
	  lists whenever possible, we add a clause to
	  <kbd>unparse_term</kbd>:
	  <div class='snippet' id='javascript_96_46_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
function unparse_term(arg) {
    return is_variable(arg)
	   ? symbol_of_variable(arg)
           ...
           ? is_list_expression(arg)
	   : unparse("list", element_expressions(arg), unparse_term
           ? is_application(arg) // arg is pair expression
           : unparse("pair", arg_expressions(arg), unparse_term)
	   $\langle unparsing$ $JavaScript$ $syntactic$ $forms \rangle$
           : error(arg, "unknown query syntax -- unparse_term");
}</pre></div></div>
	  using the following straightforward helper functions.
	  <div class='snippet' id='javascript_96_47_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
function is_list_expression(arg) {
    return (is_literal(arg) && literal_value(arg) === null) ||
           is_application(arg) && // arg is pair expression
           is_list_expression(head(tail(arg_expressions(arg))));
}
function element_expressions(arg) {
    return is_literal(arg) 
           ? null // arg is literal null
           : // arg is pair expression
             pair(head(arg_expressions(arg)),
                  element_expressions(head(tail(arg_expressions(arg))));      
}</pre></div></div>
      </p></div>

      
      <div class='permalink'>
        <a name='h14' class='permalink'></a><h2>
    
	Predicates, Selectors, and Constructors
      </h2></div>

      <div class='permalink'>
<a name='p42' class='permalink'></a><p>
	The pattern variables are JavaScript names, which are tagged lists with
	the tag
	<kbd>"name"</kbd>. The functions
	<kbd>is_variable</kbd> and
	<kbd>symbol_of_variable</kbd> 
	are therefore implemented
	by the functions
	<kbd>is_name</kbd> and
	<kbd>symbol_of_name</kbd> 
	from
	section&nbsp;<REF NAME="sec:representing-expressions"><a class="superscript" id="4.4.4-sec-link-4.1.2" href="./4.1.2.html">4.1.2</a></REF>:
	<div class='snippet' id='javascript_96_48_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=4&prgrm=PTAEGUEkGEAVQFLlAFgHTpQKCwYwPYB2AzgC6gCWxA+gG4CGAThfQEYA2ApqALyU2F6AW04BuPETKhiATyGt87avgBmdJiw7c+s+YuVrBI0UA')">const is_variable = is_name;
const symbol_of_variable = symbol_of_name;
</pre></div></div>
	</p></div>
	<div class='permalink'>
<a name='p43' class='permalink'></a><p>
	  Unique pattern variables are constructed during rule application
	  (in section&nbsp;<REF NAME="sec:query-unify"><a class="superscript" id="4.4.4-sec-link-4.4.4.4" href="./4.4.4.html#sec4.4.4.4">4.4.4.4</a></REF>) by 
	  <kbd>make_new_variable</kbd>, which uses
	  <kbd>make_name</kbd> from
	  section&nbsp;<REF NAME="sec:representing-expressions"><a class="superscript" id="4.4.4-sec-link-4.1.2" href="./4.1.2.html">4.1.2</a></REF>.
	  <div class='snippet' id='javascript_96_49_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=4&prgrm=PTAEGUEkGEAVQFLlAFgHTpQKCwMwK4B2AxgC4CWA9oaALYCGA1gKYD6hzA7qwG70BO5egCMANswAUfQSPEAaUP3zjW9AA5rR5YvQrVW5ACYBKUAG8soK4ual8-Ggxbt6tSQGcAnrWGVRrSlwXNykBITFmUwBqUAAiVljQKMtrVLT0q3dSQUIAc3JcTwklFXVNbV0qQgMTYwBuLABfIA')">function make_new_variable(variable, rule_application_id) {
    return make_name(symbol_of_name(variable) + "_" +
                     stringify(rule_application_id));
}
</pre></div></div>
	  The unique identifier for a rule application is a number, which is
	  incremented each time a rule is applied.
	  <div class='snippet' id='javascript_96_50_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=4&prgrm=PTAEGUEkGEAVQFLlAFgHTpQKCwMwK4B2AxgC4CWA9oaALYCGA1gKYD6hzA7qwG70BO5egCMANswAUfQSPEAaUP3zjW9AA5rR5YvQrVW5ACYBKUAG8soK4ual8-Ggxbt6tSQGcAnrWGVRrSlwXNykBITFmUwBqUAAiVljQKMtrVLT0q3dSQUIAc3JcTwklFXVNbV0qQgMTYwBuLABfHBBQAhI9Qnc2-kpaCBh4JFQ0AEYxnHayKtBmPlF8XUliPrVqZkJSBQ2eUwtrflt7GnJ3Vi1SZn56UQkV2jWOTeMUjNAAflALq5veG-xlqt1s9XhkAFygU7BQEPYGkF5vKyfUSUSiMfBqVheHx+P4LDzeXz+QLQu5Ap7w7aEXag9IQqFlLQ6Tpk2EUhGIz6Mopzf5LCRTTqsZgADzUh3c7iqrMeG0ps2pxjktMRqS0WQCQXmAPcEgEuWFYolUuouvusueVN2HLe9LOlDUP1IlH4rHuwnIhEq1BlcJtGU+vIW-IdTpdbr6Hq9Qudqg0TO9hF97Kt-rpkLOK0IhnInRuyblabSgfmEezuaq+fNcNTKtSdvOrmEhnohvFzEl0ur7Lr1k+TjYguloibLdYagErlsVyxhL8ZvJheVqpXaRHPjHvkMRW7S4VNNVDfczAAjgCSDCLfDe0jZqXj2eNsQPKfz8+saQlm5Ngu2XudkW9YZqwYiUMQjAFiCqolr8oHgZBWz7oB1gNocdgOB+X5yghyG3kGrBoccmGXN+pAIbWh7AUO+iGMwxAjtcLK7s8ACQqQ3h8d58pcApENMNF0f4sZZlk9CbKwtH0ThFGIg2kkMYmOEcTB-jyZOTGLpsMm2sB9CdrkhCkUp0Fcf4elSgZRnMYhAEcRCVy9Pw5FxEQjCEJQnA0F4mz0CKoAALT+aZiyXLE9RNJMfGdKA3K8YQCj6u4eyvAUoASFC4rkLQFY8IOUXSu0xjJekhEODF8aeOOgjZRQuWsNRSbtAl-C5ElDTWI0syiMekK4GlULVkQhj1flPqFcVaQiaQNjuMo00ALzBfyDUgZQ25xUqHGrm8oqXNmwrUuQvSGdhW3baqK0TtcbiXPwuqFcu51PakiWPc9z0rTsR3UEZ43hSVRxlVCpXVNqkgSnNuGpJ8IN4gCZZ7WREOiNe20QkNzC4J6zCGO1Vidcw3XMOYKoOS6cUKLErnuZ5bSjTQpCeI6AVBdyYV46AzTNHg9NfKcpCanDHYSKKajuKmJNpCDdDqHqLWgPNAB8S08fqqbbGKbURTzHQzPhWY5nmtzWRL+wHIDJxnNk+CkAAFjy2r8gbFbUL87Y5syl5+qmUOcUGIWAuWRtlg+55kdZSpIVt9mOzxzvBzct3RuQuXSUhDTcw1plYq+T4eKQtCkOLSGS9YqXpWczAPIzOePheEhZIXSUTQD6E0BjWMcLjoIE0TvX9WcI4aqJJHYY3RdFaXrfHCrkhY3dAsj1XY8FxPcgARznNdT1ZvpFNbRHcPq9CwroBnf7y2H4vn6j5sDer0l6+KpvqTl8DFtCwKV8foXQuT7viJpbzyPr-MGL8Orb2JgAt40t8KhzzhIM6qQJTXywj+e+TclQb17M0VIXNIq62oHzDUJIiDmXIAZHGDc5zdRbjYNuMs1DUJxKIBWytYgACoyH6S7hw2IChsREi1pnXm7gdDVEoDbCSgl1JVF-FeOh0soTwPrhHLaXJiDEHwLQZQ-IkEvQ0BsQwb1zqEGUKIEx20GBMLEWJAIUi1KMTkZY56Kj3xL1IvIv0RVo7AUcYpNRK5kT8wkP4oUgi-A4V9hCMxohRAZwIfxGg+E4IQRNiXAB+8tyeFPqk1a60I6b33iiHQ3VT62IkQ4mRTjTQSGyf9aw+9uEWS7t0Ra6oBakK9DwqhJSbha2QRbWedS1qeA1ntYaX1jpGT6d1Fx70FmpGaRQ1pCh9GLNXABcKIjCHJNLLDDx2F0kASnvQmeA4CIfzBogp6F8eKw1FsaLsml5RbISTrJJ2dyGWSOS802oJ95g1PncyQ3yTriTBm2J5PoI6pk3mC2cLDP5gtIoiokacwZwtBNLMB2ss74TCc8v8WkMmggRRE-w1zCX6ApWndZiIQWhOqYmIWUKOwmiTLC+l70ALzJ5c-bFQyO7Y27tzVoDVui4F6P0KAcBEDIHQOMAATIk6KUJvjXGNi8xRQyoSflyLkHG5wQnpNiBqm47MIpZ3NZS-4Xt2TmHYoMhhttmD0EMBIT85AtXEvhNs1VMw9X0ANUajpzk7ZsH1TqhhGV6BHRwqAAAZIm0Arr3UJvmpm0AEbWD6veVnKEXoQgR1OUoq2wbDXDTDaaotzBLU7M+Rc2tzCiTRpnmG2Itb+GgApf6j50UKWC2bSWgB0s00eq9T6hRfaC1nBRb831bagblpDVWk1fy4jzs2PW-tMwt2LxoQm0dQzx2erjbcU9k6olFQSVnfdrLHnsqJQo0tJ63UTvPWe7117828yhNSzl2rX0xpXZW41WRnKxCmmJAWAGwqgAAD4Ia2kG1d4Hw4btiNIcIKg4OmCQyh0Dob12+spitPDv7dmgAA2iyJI7XjS0HSSZtl7P0RxvVa3mNHIWPs7DCoDu8x3vq-bcK97GZ28wudB8SAGJC1oUDxo0T7qBLpoB26TsHmWdG7fJ0Ain2x8cIBJqj6rRytl4xyo9DHdVEbXRB0165mzmaU4Znd1qzPjknDdGcFKvEOsE0M6xLbcTManAoVj37xO3t5o5zcoyrPmxdcJq9YntUcYbdFC5sXnMGcs1dKct1i71OA+2kJZqPMWaqN2-L3m7oKHqZRz5UJyNaefX6cwbFrCCpA7mitxH7OYZa-RWR1A3O8yGwpIUw6BPddKxqQ4uBnKjH9VnCbI3qg1enHdBLiW5sCwW85JVK3xv02kcNmp1Rsk7asNLDplzFvpIAMzHaoxN3NlAQ6fhk4Ja7ZyypSdNF9zT53FLrLWxd0kXKnpZYqy5yz3KrDg5ZZtwr0kEd012WdybVR8k7jS8ZprZwDk32Xnfeju3l29bQ9WzDxO0GkDG1Rh5cO2v+es0l9NqXF0E7VZmaghtKxTva8enr+qwM09I3EeOgu2Wufw8hlcqHxckavJTaXrt-CHO3S9z56uvT+HdhUOOM2Kdqf5vdpbOvop69+CJXOZOTc3aGXdg76SjvRaozbsyKMrjJ1TuTp3DCXeY2cs9xrvPa5vnzoXFuZaqfK4g+PSmbi61W5mCn4ipOi4YPhI6qw7OZ4RduOPdLu6iHANQbfMi48kpTyE+mmvaeiEoMz54nPteAsMKvY3j3hPhTV0qin9vsebPsHMcP3vEeh6V6z8Puvo-Ymic-Y3nngazipN+3HsX-WMOS9iKkxnny8lXYD4HwvyW2NpcnzMC5G+te55F3tiQ++SmMG7ff1fRCoShkYuGd0noAkBNOt89nUZ4oQyF+BKof9dA-9IwACNJF1EMFdVQoQowBAoDHRf9XR-9k5+NF1r8v8zgICMCwxsC4DcDANECzBgCz5QDKdt87Nd9VcXIvRICAhMCYCyCfB4Cqsm9LYQIAC2DoDnQuC0CECX1qCnVTdgIGD0NIM0ChCOCRCIxuCKDD9ophDwxaVT8-szd5sQ90llsCCaAK92CfhsxN9ndzdXcN13dOMqNjwDYzDrgLCdDbtrCDCN0w88VJMmA2BGQjcCpTtKtqBmpchtE5RZcOUO9ZsyoO0AjmQqsFBPoWdQiYoWoIjxIQiuhP8aBNDRCeD9BYwEjACqCAVAdQB8jT58jaMhd2RN449iDnDOCVCxDWdCx1EZZnASiWQm0pwJB8jNoNlVQw1TDoDXD8dfELkejpQ+iQhBi+VhjiEyIxiOCJjF1FiljUhHD+dmj1jp1cjdJ4xAi8CJCC96C+tGDIMZjRs+CMckkoj2jnh58OcP1Isr97DPl9RHjalT9683il93juc+1xV6ZJVpUBg5VhhFU0BHsA1CDc0lA7YigRRVNgJfA-A3UkxUTaCTIRRfEyYnIRRKYMTxAxJZgxQ6JLhjEbBnwU4cYd0y9HA-CRpdkJAUcrgitRl-k6C9CyIoMgQhpWSkl+F6UOS6tQBsksVmhZ0VC1ghSGoBQ0Slcd8BQ1dBT9oGp1CZhLovMtt7o0Tg9FtcAFAjDPjooVortcBDSPDjSFA7CZSTtMcpkfpsJrSSs4jbS1TQBvCMsb8WTYZrksxEYbSINYhAy7Vu1gzCxjDgIIz8RQh8RlTbM5DMU4h4yARtTm8rk7UEZsIwY0Si9EyARS8mSFR6JKApQ8gDoeBvpwUyITlH8yor1sFHTXtv4pV+jGzYiaBT1WysB94c0q41Aa4XT6zT5F8GgyyLlOyQhfMFM7UYjeTQAJx415y9NFy7jZy2BfMBRrpIg88QDpDT1tytz9yhZ7p9y9gpCz9mzP1Tzw89YRQJkay6yjJ1z5gis9I2BuzlzxA8g7ZgtaEFYs1-zchALPzfZPhVynIZz9ygLi5IL6tvyazokvgNhwLbYELTAAAedCgCrCyCzowk5-Z0SgGWQgHJfUTIouHtDEcoHGCERIGIdHLIHIfIQobCpIOISmbi1i7IT0DiooSCtCki2IMitoLgdI8IzxOi44xiuIPixZNiwSgoIoXzaIHixSli5SgSvINSxM5uR8ohFENEDEWoz+ClHk6wfFakc4VEJhX8jILOCpBChc4C6BDIOPRfbC9HQMOy0yxykgFEKsg0McoyLZdHCEClECxaU9DSvy1NYTIixZaK8RETbChQK9ES8BfGXscuHYWK7NV1fvEcyqcKwsU5HafgRyICymIgXwIaUALtBpdIXuHeM6febc0+Uw7ckWAVVcRjdK7c2oy8qcIYrYkasGMatwDjN4XBDqHs-ceyh0fq3YYymgclGhSymhdy6yxHXmHYFaoK3YKqmy0RdKj8-pOhGBBfcfBKxZfyngY6-qis0K186ZbCSK1KntGhIq+KmhJKRK48AWU9T89y32HSVy7vQGyObK661qtITqfKvqNaoqocgfD61054zy9IEiqylgxq7MZqqcFmGKHhUiS1eayBM6veCo7qxaXq+C7BQaoZVyka3c08zY86Kaxcvc8axGvBHuJao6wKtakEsACVHoPoSEoYBVMYDAeE-gzKGqek4UlkQqF4sAlM0YogSmFWnKVPWMg22qNgLKTQLPRSTWzvc-Tne8ogUs-eE2tWqW9pEJOsDtcdbtawcdbaCatcMrSdb2qwSdP2+ZDtGC4OlcuNfgMOj2srDpKOjpOOjIDtQtcxbtdOuJVUf2tUMrHMdwTQegTwbtAuounJREXO6wDtQk4Owk1cKuqwDtBgO2VQYQdwfhFu22Nu7oN4Ru5Y5-KIKO6wCQYk0ATwUwJWUAPyGICu-ujtfyYeqwUehQCethaegKceqweesrfyYg4OvyVIKeqwIKQ+nesMvhBQdIFe8eye5WPyDhLe0Ac+-k4AJetKMeteqevyMAOe8OsrAAUnfpvq-vvtAAAafpfuf0zXmmHpAbvo3pgdvv-rDIAEJM04HP6EG-J0HFoJ6UH+ScLgGsH16-I8KrB8H46wycLYGr7Uh4HSHQAaGKGoHYhFZiHV7sHQBlYWGCHn9FZaHr6SHv7uHFpkGqH+TUH36N6j6eHQBUHrBUS6xwonbqpDb1acdfMFZewgtx0FBna6oJUVGKiDG8pMdKBhAAArKktpHR2WdodeiOtR027tIsv6bmlc5xl2sE8KAckxrxuqDTNpAejtYVLubtMJnGfurY6usrSAQgTuXMEuq++JxJxmaJmJge2ILu1gWASAYOnJvJjJmJ5u3QbugAUSjpyfKeKa2I7QADl6B6n37Gn6nIaNljGuhppTHPsYNRrtG3ggtiB17T1iBI4emgnOmshPGsp1GNMLyBmMghmRmL9Isip9GAm2BJmpy70KoqpZnTaNGxo9bpKOk0TuQDBqgMZ+BRBPBBLWBLH6A+AxFBARybknoenzbxBSIraHaPGXoWozm6g0gfCHCjhMQKq740TdojEsb6z3ntoygjF2TNmjnqh1z0drAJnAc+mNL-mrAkWLCemVoLHrGyBi5MWrBsWum+npranUgMayq4XSI+1xBpoc1cgURhBfhIWFoe1wXmXsJfGs4rpjxWBHw2Dcp+BfBjx0pCA1AbYFMrgZWkm6F94TxT5RW2AJWihPQFX4RN5y4pWVXGZ5Gs1YgpR-yGcbrrAy6RwihYhAogpxQwJ2VQAdXIR5WbYT7Ap2ZcT0g7Xi6JAiAtXxWARICJATwb0t5CYd4FqrA3451JQrgWQo2bWCXDBhoSg2BwxzIU3pQ83+AhQrs03cr+4pBlXKykmzXFoLXvU5R4Nca0hA2HWnXApybjwi291M2cYWY22-X2qoF42Y2+4m2W3n82322PXkZaLJ3fXBbbXThy6PxDhXAEXEQ2K3VaBWAgt6UGbFZMWQ2BAxWdX12NlPRRJNghAeITxkirz6XUgQUw2rgihb2e1BK2WaVsgt25NzEio5rFq-SiEXXnxJRn2I29XFW9NK2pR0nTlE2x84k5X9X-5exx3HX227kXRs0rhspoxe2nWqaIFY2oFex1XNXj3tXw3dWvWDW0Ol37WJ2nXqNBApWvgHLPX9W+352y3x2j27oqOX3I2AP0gEPC3U3UPVx3Us3lAc3XRxOC3k2u39AS2RPER0OABBJT6KaT3t50ajXQegSU78tAIjtqmmpt1IdDud916jmaOaboOdxeymMz9Thj4uldn9-RTd1wHd2WPd-cthBHfjk96jxBFiGgi9oHa9yQN908h96wJ909t90Kz99F79tdxff9hdvKoW4dss0wsSdwTgK4ZDm2NViojVxaUN09yDuj1ILq-c4JpLsLlLj92wL91d2gX9uJNT7y8fbcoGoJOIdyGWUgYgW2QSgzz8WIXxELwTiDmlq9-kN9k8pr-995NlxQWTiMIgW6U+AABh2d5g4G4GzbjHKESP0CMAkEUR25WD26uFPnO4e82Ce5iFGAaKGRe8kTe-4HeRq+o94Bg8kAAHJxOJBMmrAAAdLAbNvUQxfaWMXAF0brxfVezhyeJ6UHymY1yso2rAQHl94H6V-HiQcH7TyHqH2H+Hwl4aZH1H9kmO4NhTSOMZaO+NfABQAAL3WZh9pDp-e3qkZ54Ax9AF56x-ehx7iDx+PEtU6zwG-iK5K6cnB8R-p4+xR-4G68-oUHiO7X3wN+IAN8MDCmMFB-ClaCJ8lZB-J8F4Z+15Ab17K3oAN+ECN5N7N+l9iHZiAA')">let rule_counter = 0;

function new_rule_application_id() {
    rule_counter = rule_counter + 1;
    return rule_counter;
}
</pre></div></div>
	</p></div>
      
    

    
    <div class='permalink'>
<a name='p44' class='permalink'></a><p>
      
	
	The functions <kbd>type</kbd>
	
      
      and <kbd>contents</kbd>, used by
      
	
	<kbd>evaluate_query</kbd>
	
      
      (section&nbsp;<REF NAME="sec:query-eval"><a class="superscript" id="4.4.4-sec-link-4.4.4.2" href="./4.4.4.html#sec4.4.4.2">4.4.4.2</a></REF>), specify that a
      
	
	syntactic form
      
      is identified by
      
	
	the string in its head.
	
      
      They are the same as the
      
	
	<kbd>type_tag</kbd>
	
      
      and <kbd>contents</kbd>
      
	
	functions
      
      in section&nbsp;<REF NAME="sec:manifest-types"><a class="superscript" id="4.4.4-sec-link-2.4.2" href="./2.4.2.html">2.4.2</a></REF>, except for the
      error message.
      <div class='snippet' id='javascript_96_51_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=4&prgrm=PTAEGUEkGEAVQFLlAFgHTpQKCyUAzAVwDsBjAFwEsB7YgZwICdqBbCGeJVNARjQCYcRMlVqhKdAPoAbSuQCmjAIbSAFKVYAHWvOLkAlKADeWUGdCN55Qo2Lip5JQHMn8gCYyJ5dVp16ANKAARLIKytJB+gDcWAC+WMIUNHahiiqSAG4qhPI+LNrEugbG5qCm5pbWtqAAFvJKbqqOlGoa+X4G0XFCJEliEpKOLu6edN5tBUWB5HWDzoYmpZU2dgOaSpSMeZN6hgBke7X1jRMdhgC8l6Az8nNOMfEJvaKrUsRKLLmnhbvG5WbLaoDIauDyyMbbDqBILvT6RB49ETJUAsJQAa1usNydAAniwAEbUaQLf4WKwrUDg7wwj7yIKBXEEoldR6JF6gRmE6SSaj4SRYyE-YqLCrk6p1BpNDatXxC-QsxF9V6SJR0OiUJzET56QVFElLMXKkEjKm6gLBVXqzXa8jw7ps5GWjVaoqSTlEs3C0mAuwSxrNNR+qUtT3y+UIh1iJ3W11ZaQ5STyAAemksauSob+BqqvuOwbUAdD4e6TyR-SkbnkpGkSmUL0zIoBhvsd1Bo3GsqmwQ09EcekklertaUL0ioAAPuPSaVzMDnG3Td8u0EsoxKEp8dJboOa3XkmPJ9OZy3jWCvJ7oZHiAOq7uR-uFaWlaAd8OXm68VyG-8fRzP0SeT5AUg0LJddmLeIrxfW832STJsluZNU3kdNaG-UUcyOSVC1AztwMfKDUQxSQezGJR+1fPc0KxQI4wTJC03VWh9QwilTSCUi+3IG8hyo4h6VAGjQDoxCU0Y5ICOeZEBhrAk3CURMxJQpjiHQptMLnYYzwhMDyGhWT8XkxTkNQ-iFSggyjPWZRPjCD8mWkOg1LJTDUU0VR3W5Xl+VpQIQOlItzKksRLIUwk3BxZzf38kNcPaOUIMVdkiNuULjPEtDrNpMI6ECcKcRY9S2PPEIPkMhSGOU-dAiy2zFFy0B8skstlSvHi73rXSFgASFKb1m00hdz10y9guvSj71oO1ILGggxva2DaB8z5nJc4qxkkSx8AvUAeCClq5paha+MkWqrHq1bfypTb5G2kbQH4fbnzaib33yy7m2uradoAZie9kXtvQZqBI2gyIo28Ptc9Fbk48juNejMj2PcxAd4ybrwFLr-GRlGURhmQyqMyrTNUXG8dR+bEaWs6ctDHGKcZtGOrg96usSp92QGH03UcBQbSigaHHnE1hrwvTgh5sj+aKabOeRHmSZUwXMJimV4r1ZrnwGHs3DkZIVChilBtFnTxehXX9dodIlYfCcp0Zk8Re0jsNfNDjaD1l50ml+QbTlqDLe97lkL10gRy+cXCqurwbru83dv+5Eg4N7lSPkABHHIdS6rMiuqL7bp2x6I1mlPre5FQwneKgMkjt2vVYgvY+++6-oReXyzdTPs9IbFyBYRv86NZ32w8geJaCOge90PuA9m6es9n25fZtJyxkHhZzB-Zs1fHzek7EfBNg21ein38g6Gj3e8w3y-D7sNNuLPvR14nq+87W6pCzvq-S4OgYftNDkBxN3JeZB+6Dw-o2X8AxiCEGkGoX+D8Ww1lPnzP259kGf1gW8BBBYArIK1lzKQm5qCkDREbIEwstJj3ukEMhFD54HUYWiSQbMo6fy-rmbCAV2b-2fCldh0hyGUJfkPYelISqsIEuI4h0kpDUE0Gkcg1BGCgwJJQGuGZc5GF6tvbMxspAkFrKApRKi1EaPxFojGmZDyOwGNY94jAzHKLrJYtoTjbFdQESQyQJiXE8jcSODxrAvGdU4XovqhjqGtlNq7HYk8AmuIseozxNjRwoMcTYwJ5j3FpLCRknRkT9FmH6hpGhQ0zYN2hF43JwTVEFM0doqaKC8khPUZ5KhKQW5F3untXxyJj6MA2u04gJxInlPWtxVuCcS72gXlWT2QS0jjO6VIjasyamgHbiWQiBMlCaE0LIcO9Y2q21oIEWsThCA2nSlVMGhVuEbOpIc45lBTnVUOkqe5pkrmMBuXci59B5FiHaY0qxRSlqqJVEck53jJmlE4qAcFajQDnBRQ0yxXSfFTNicklZ+TIUtNUl1cmZgAD8+NiJvPhfWIRApUWMH0AzR2bLjymmGaM4Jaz2b6HJaAAAXNS24tKPm2IZbSVQTKWUCvZRy88XLuJjImQ3WV8qNXHmnrrQl5FVWJLDB3KCAwxWfLQroneFS4kux2kEU1GNmHPXmsClWFI978IWQda5vyVJOQtU3Hh-oApxQNRzPAV4GD4GYGwKAcBEDIHQHwHgSVkTyDohHHaugMjXytakcIoZyVUrzekESBbGbCrgVKsljMi3UGoGiQgmh7JcngvGbE-4vJASrVHQIWb+XlpbPaiJarC2gFpZFNN2QM3nKUqTbGoA+2ss1ddbyIknLeuBX6ntC7iDZv7RTCtiisVNPCcUkdNaF3poUNK49xKMbA1he8s1pLt19vJYe0G4yrbvHVga0dk606e2-Ybe6b6B0ySJhVWdytq0UypUIq8qg0q00UM2okW61VLs1SjNKHDMM7uze+lsi9e71z-RegDYDSMeRnhA3mEc170wI-uvGH7WFlrg5e9I7HQO7pYyjD9UsMEC1g3jKllGhMMfPrxwj4GpDM0Wi+tVpSygUavbkZmD64YQ2rExsDB6WzUyU+RzjlGjOZr40Rk16YYw5yjv+uMKobMujs9s-TrGF2MGYFsehJA0TEGoAAdzsLiPQSgkygAALSRa4-GCOctO52HHaoYQ-ynDQP+JQfAoBVBrDXCwfWddJCIeEPKLhkjx2nXy4V24JWSBpb-v8WIC7HLyHENl3LUhTgkA8HV4gZXGzmGRWmBB5B0WxcINO+a71StYewxTZMChxmJl3ZsWgAs5XzdKG1FDIyUskHVVt+V1zcqbaO9898Wa1sue8KV4sx5cE3RzK2nIqgRvSAMJtqlPMRKfqW94d7n32XCp67dLR7gYjmGa-IVr5XPPef28QaEfmAvBYu8iEByiosxfHXaKHezZorr5Gu1QSEGp9vK7+NyqhrnooAHwTYzdc3tfHe0pka6yWalHy4-os9mrhj3yCMEIDMCd6mfBfuDlV9w4rr3zr7fxlG4nxc8-SOncBCSzgs9kwOgDk25dAal1XRQ2i656b40arnjmSPLwvuTvjXCss5cAfkEBVHbdELh5I0Hx9ChuEh1Dlr092vO6kGg5+wmsHvwG7jX8evp0nwj1JnUyD-B9oD2YaHsPBtIrBmNpVvNB4vbaxiuV8fr0F-EXbll6fcZO8609lYxeUuJ8L9xESMe2W-krxPYvGeZxZ+DznlGcfre0b7mTTVT96My1ftXtPFvcbxFKPETnB0if+PeM59wHkO0ZZiXYannl6fBAAFQmO324U-si9+gpC+Ha81ARfHQxhhg1Auhbu4gRxzjShSCkFuQQQzTO3MDeV0DcDmzZXgUQUgMdiPwfx5GfyM1O3Oxtzo3ETfzOHlAFQ-XM1EzExeVUCMzQ1-SwJwMEnwUtwOkox4wTgp0G2RXynG1YXYWoAilDH72RREXDkcnGzoAQKfwRhgj4iciak4Lz1AAvytD9wYAxQ3ykOdB324JUEawP0Z2vXyjZyWw8Cu2YBuyQ3IRUNgPO2wwUM1HcAahAJMLxgVyoOfAk0NBn0wVc0SW1yeSpwJh+wQkn3lXL1yEVmgzPQNTcLv1iyc2kJEzoIdwYIkJEnGz8Jp2czuV+xdXl0X1KGjGvE8mb0yLuRxW3REjcP71-BEjsPZDM2EIRTc2iNJEyJIOb2IPyPwysJsPF2IJSMCPNR7RaM1UXR6OPFrzUJ93B39xLHDTGkjWjXYDjS4ETTQB+hTS7iFxFxqEiiTHcM-0JCJHqFUnWNUwvSTHIMUARyTFqTrS3HIgXRTCrAUAgLJD7koDrjcAS32WIkQ12wak0OYw-0wnYm62WyvHpCsI+LyjYJxCKM9W1i618B62KzGhSw2KtVPDHnwAthhIBLGkdQBnmg+IRJ+OmTjhS0CAGUhOxKOhm0RIJO+lRIehQXOVWz0IFnwEpObk2SLhpN2TX0EU8McNLR7H+xZJ6QhCCC8LbQEn5L1EGS7lFNew73xNiWRNNEKMll5IQixIVlVLbT+3PjlMG2ijzELA71CNnhEXVGICcBWwyGuwFnoLxTsELFrxmgOgLyjSlVtLUKDEdKwGRRuETFd1AV0PWyKHG2gOkBiESxFWKxsnbQcgajXUFNAHWE2F31jNogQg5wjNdM+BIKcizPkC3gMQDSwkaDzLpOjOL1zOjILLKTUMLFLLKNTSTG0MtOtKwT3zTMcjylVEQhqLUK3HNJmBTK5A-kuDkN0CcEHLjCvgFSpSTK2AQ2jKHPQw7Kvi7OnktMV2PGFX7InJqCXMckMAAB5KRxzJyVDNyZxxMvM1FVAghVFqB8ZiAcQx0AVbkigGA6BG13l3BhUghQAABqfY7DMYNcc0rLSKTyD+QCgSP8wC-okCrRJwcC1QKc7Ax2YVY4m8u8utAgeQQLF8wFd8jkL82QH84IACoCzVBCsC-ACC2-CimCii+CoXRC5C1C0IkRetRteo0tTyNwrhKCLNGQOtdyd0lGKCfg8ifcuM88r3GcR7UM6Si8tlcTXdYSpRUnMgU0xClsxk8+BXfo4VY-Uc4spS-oqlIMVCwyjkB-fMJS6YAKdi-vFfOvDrLNdFK4X0oBN3QMm7J5Gw68rYPi4IEgQkHrQSWkPHFGQfNrYfY8ZFPM8bF0xcwYx2X8SS1SPMnMlLKs4wzVLKknUsroPGZffHNQoSzi0SxfLk9kOo7I3ijtDs-iwbQStSyqzS-nOK9HMQDK6Slc-ykfT-RSyC5Sx2VSjIdSqq6sagM0i03ym0vjUagdYyq4IMEa8yjkKwSQSyow4SFQJagzXqn+W-BykMJypfSi0oevdykyry-03SoM34Lq0oTCoKxqkK4gMK8ZCKz4bHMdJI2WYq6KoPWKuVBK6MpK1vPMjqoGxmdK2yrKyCnK2kQ7Ewgq9M5Gz4e7aK0kUqyRCqkSmGjucYlqSY1gaYzgBNXgDARY5UVMSgArWuWreE0rHBT-RUxVerYIemxmx4ukFBHmmrSQBm45ZwvmDMVmmBG+XhEMO7DuZFQWpmuE0m8bU0ZGdiP0AScwP0dlVG0odiAMLWswAMXW2A9iOco2xMjYRgU29WkqKkS2qkW2nDEqOBfBASN2xBRmPW8wdiPWOgY5JQHEASf2wO58imH2swdiV6o216tlSOwgoIVEGYFUfEOgekZOmoVOhgPGBO9if8y28wVQU40AAqE-CLQC8OvOkqSLQuswYuwIMu84BnCLGLKus2mu5JI2iLUoZu8wGLHu6u4U6-QIY8Bu0ui4Fu0AU-UuswIe6kYAOunLEupuqesAduu24UgAUiXvHtXtAAiy3tntAHntvNHMLr3snoPo8oxQKg7uFIAEJLgL6V6r6Isn7b7T6ghDzd7X7y7QBjyzA77N7qRDzzg67L7-6wGgGv66df7G637QAGcYH77qQ6dwHR7ShIG+6It0GUGQHbyH6l7r7e7kHQAH7zB1jkYugFbqsla2pIL0VcZqc-Qao6G+blalRGtaGGaha2pqB8QAArG42Q5hw5RHE-c29huuASPeO7BOmcRWjhiNLob0iQpRorbTS+VW88diYYv3ASfR9wBR6wqOkqSAYgX3OQYO0eixqxkBEx0x9iTOyQWASAI2lxtxxx6w5xkcLOgAUUtpcf8e8ZMPYgADklBwml7InwmDrzsaH1HpHYY894YcymG8ZqdSAT8gxSAWVEzknP1wZ74YgeHebNHUn+w10MmUYsmcmDS+F5Q2HeGlatHGsIzKsNHmaWpEc0sqQEzKstFN9KxGBpAcQdLBGlAsh+C1xgEfD5Uunhb8gtwbRbFZsrDrl+mogZwCcDpp5rAm15rz4EzFtwCHr9CQCwC1lFmGH2zLrsNFmtGczQnQCjlwDVAbn5oBHhGKBLCTDHnKn290yXnjbZhvKAyGTHqDAO4twxtfSnARF8QbZIWbs+DyRDmUWBZVGoJrJ1yl5Ak65GBCRp5ctiBNARdaJFBiXrGnlkUM5xtcXbh8XIotFyXoXSR69CXqWQFyGrgp4WhAa5LQ6axIoghosYtUxyFlJQBmXxAyWRczBxX4R7mzBhWg7VASBGXJBmXVAM5wxQAYrjA8aQ8G9LRFB6w9WBqzAGgPBhctweR1EzXGB6wnW3owTdXsbjxOWqWZrrHeWMV+X+zbQrWZw1XRXxXot-rp5nXHQ3BKw3BscI3lXDWjBjWU3cYw3byI3I3ZXAcGBs3osorjww3eZLAPh5mKYQL6gWBJBqcrDErm7+jJCyXaw8WcgXEK2jstFin1xr0M5Agiq8qUY-DtX23Ip+2ORELYWloq3y3QywxYaDXdnnxJW+41RR3FAWX5WJYuXfWHHHcOtPa1BWWRdO8UZM2xXI3y80UwgCsa53BE2i2DWQa5K6WGXW2mWx3SW2XF3SgL2I2Xw1xCXKQRK5W2XE3C3f3zBM3NWP2N2O3LXnLZxD2pBXWMxLW5KMi43NoEFbhLE0O0ICPrx3pEO5UL2ABBNUc12N+N64B8+SRwRqbstAJ9lfF9566DiQMOrN7NmVsdskT8j7fNgtmC1j89rjkV0t6tztytoXat2t8R+tiGxt+bWDkZT9zdsmbqFTbtriXt3ICdwdqwkdnVid2a6drIuTud-BBdpDzPXG7oPqKCAvciOgQLRQb909rhN9jFLVnVk99l3PXsJgWkWQ9QjThDhkKdqwGdqzlgVQedxdhS-BTGlCA6qlGEB85O0gGoRCl8EcJQIIcgtTttzT3T+GfT3VvyPMPMq+DmKCTHXIJCBMtYa20nFMdL0y5ro4wK9rzQZHYgfzILOwYFa4HEZRdUsQCUufZr+Uumtr7rsa64AKRb3XXrpCAbobtHUb6by+BLPzsdzIH1klgAclddUFMfMAAB0sA7XcgrmPAYV8A1F4vQzG6EGysNUTvoRd3p47QDvN2juiWZrcgzuqPnWLvLvQAbu7uac3nlsnuXuPm2vCBaJ8nwSrbkzUfQAAAvJpswG7mcB7h9Z7xgeLjId73HsMLbb74IX7-mmIfRBIVvVz9zrYM7+Hx7kGUn+LlewIdiQr2pGC0gGC54+UE7roPAAHgl470H4nxHsnve-nkqQX4IfEYX0XyIfQWnoIeEIAA')">function type(exp) {
    return is_pair(exp)
           ? head(exp)
           : error(exp, "unknown expression type");
}
function contents(exp) {
    return is_pair(exp)
           ? tail(exp)
           : error(exp, "unknown expression contents");
}
</pre></div></div>
    </p></div>
    <div class='permalink'>
<a name='p45' class='permalink'></a><p>
      The following
      
	
	functions,
      
      used by
      
	
	<kbd>query_driver_loop</kbd>
	
      
      (in section&nbsp;<REF NAME="sec:query-driver"><a class="superscript" id="4.4.4-sec-link-4.4.4.1" href="./4.4.4.html#sec4.4.4.1">4.4.4.1</a></REF>), specify
      that rules and assertions are added to the data base by expressions of
      the form
      
	
	
	  <kbd>assert(</kbd>$\textit{rule-or-assertion}$<kbd>)</kbd>:
	
      
      <div class='snippet' id='javascript_96_52_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=4&prgrm=PTAEGUEkGEAVQFLlAFgHTpQKCyUAzAVwDsBjAFwEsB7YgZwICdqBbCGeJVNARjQCYcRMlVqhKdAPoAbSuQCmjAIbSAFKVYAHWvOLkAlKADeWUGdCN55Qo2Lip5JQHMn8gCYyJ5dVp16ANKAARLIKytJB+gDcWAC+WMIUNHahiiqSAG4qhPI+LNrEugbG5qCm5pbWtqAAFvJKbqqOlGoa+X4G0XFCJEliEpKOLu6edN5tBUWB5HWDzoYmpZU2dgOaSpSMeZN6hgBke7X1jRMdhgC8l6Az8nNOMfEJvaKrUsRKLLmnhbvG5WbLaoDIauDyyMbbDqBILvT6RB49ETJUAsJQAa1usNydAAniwAEbUaQLf4WKwrUDg7wwj7yIKBXEEoldR6JF6gRmE6SSaj4SRYyE-YqLCrk6p1BpNDatXxC-QsxF9V6SJR0OiUJzET56QVFElLMXKkEjKm6gLBVXqzXa8jw7ps5GWjVaoqSTlEs3C0mAuwSxrNNR+qUtT3y+UIh1iJ3W11ZaQ5STyAAemksauSob+BqqvuOwbUAdD4e6TyR-SkbnkpGkSmUL0zIoBhvsd1Bo3GsqmwQ09EcekklertaUL0ioAAPuPSaVzMDnG3Td8u0EsoxKEp8dJboOa3XkmPJ9OZy3jWCvJ7oZHiAOq7uR-uFaWlaAd8OXm68VyG-8fRzP0SeT5AUg0LJddmLeIrxfW832STJsluZNU3kdNaG-UUcyOSVC1AztwMfKDUQxSQezGJR+1fPc0KxQI4wTJC03VWh9QwilTSCUi+3IG8hyo4h6VAGjQDoxCU0Y5ICOeZEBhrAk3CURMxJQpjiHQptMLnYYzwhMDyGhWT8XkxTkNQ-iFSggyjPWZRPjCD8mWkOg1LJTDUU0VR3W5Xl+VpQIQOlItzKksRLIUwk3BxZzf38kNcPaOUIMVdkiNuULjPEtDrNpMI6ECcKcRY9S2PPEIPkMhSGOU-dAiy2zFFy0B8skstlSvHi73rXSFgASFKb1m00hdz10y9guvSj71oO1ILGggxva2DaB8z5nJc4qxkkSx8AvUAeCClq5paha+MkWqrHq1bfypTb5G2kbQH4fbnzaib33yy7m2uradoAZie9kXtvQZqBI2gyIo28Ptc9Fbk48juNejMj2PcxAd4ybrwFLr-GRlGURhmQyqMyrTNUXG8dR+bEaWs6ctDHGKcZtGOrg96usSp92QGH03UcBQbSigaHHnE1hrwvTgh5sj+aKabOeRHmSZUwXMJimV4r1ZrnwGHs3DkZIVChilBtFnTxehXX9dodIlYfCcp0Zk8Re0jsNfNDjaD1l50ml+QbTlqDLe97lkL10gRy+cXCqurwbru83dv+5Eg4N7lSPkABHHIdS6rMiuqL7bp2x6I1mlPre5FQwneKgMkjt2vVYgvY+++6-oReXyzdTPs9IbFyBYRv86NZ32w8geJaCOge90PuA9m6es9n25fZtJyxkHhZzB-Zs1fHzek7EfBNg21ein38g6Gj3e8w3y-D7sNNuLPvR14nq+87W6pCzvq-S4OgYftNDkBxN3JeZB+6Dw-o2X8AxiCEGkGoX+D8Ww1lPnzP259kGf1gW8BBBYArIK1lzKQm5qCkDREbIEwstJj3ukEMhFD54HUYWiSQbMo6fy-rmbCAV2b-2fCldh0hyGUJfkPYelISqsIEuI4h0kpDUE0Gkcg1BGCgwJJQGuGZc5GF6tvbMxspAkFrKApRKi1EaPxFojGmZDyOwGNY94jAzHKLrJYtoTjbFdQESQyQJiXE8jcSODxrAvGdU4XovqhjqGtlNq7HYk8AmuIseozxNjRwoMcTYwJ5j3FpLCRknRkT9FmH6hpGhQ0zYN2hF43JwTVEFM0doqaKC8khPUZ5KhKQW5F3untXxyJj6MA2u04gJxInlPWtxVuCcS72gXlWT2QS0jjO6VIjasyamgHbiWQiBMlCaE0LIcO9Y2q21oIEWsThCA2nSlVMGhVuEbOpIc45lBTnVUOkqe5pkrmMBuXci59B5FiHaY0qxRSlqqJVEck53jJmlE4qAcFajQDnBRQ0yxXSfFTNicklZ+TIUtNUl1cmZgAD8+NiJvPhfWIRApUWMH0AzR2bLjymmGaM4Jaz2b6HJaAAAXNS24tKPm2IZbSVQTKWUCvZRy88XLuJjImQ3WV8qNXHmnrrQl5FVWJLDB3KCAwxWfLQroneFS4kux2kEU1GNmHPXmsClWFI978IWQda5vyVJOQtU3Hh-oApxQNRzKCIDlGqCQk83Bp0NhbGjQKqlQZE2O2FYoZgCaUzQhIGiYg1AADudhgXXBxMox17IewKFflGlMMahZxs2LWzQ-LHZUsLKmxm6bGCZubTm4gebC3FqUqZUAVaih0DlrgMAV4GD4GYGwKAcBEDIHQHwHgSVkTyDohHHaugMjXytakcIoZyVUuPekESp6u0tixlHM9lJqDUDRIQTQ9kuTwXjNif8XkgJSuxqAfdraKbCpNXC8VES1UPtpZFbd2Rd3nJHcrADQHWWauut5ESTlvXAr9VHQIQHgN41A4orFTTwnFKg4zKlcH4y7qZcSjGwNYXvLNaS-DgHiAHvJSR0G4yrbvHVgah9tG+Ne1TnurjRGUa8bSi6sl1GRWSCvKoNKtNFDvqJHhtVaHNUozShwnTnHuM3oGIvXu9dhOKdE+Z5eHkZ4QN5hHNe9NjPSePLx1h16KY0bjMI0RkmTMgZbFLDBAsFM+cA350Lznz73SAzxlszNFrsbVaUso1md0KFUMzZjcMIbVlcwl0zFYYJ8W83jXz6RqapcSQRqTiWTXphjDne9mX0jRhdK17ZxXgsZrUba3N+ai1-j0EoJMoAAC0k2ovwYUFOqCMGcskH+U4aB-xKD4FAKoNYa4WD6zrspsay3iDyi4ZImDp09sHduCp4Qq2-7-FiIBxy8hxBbZ21IU4JAPB3ZIGdxs5hkVpgQeQdFs26PZbau9YQ6q9NsuTNWjw+7Ni0AFnK+HpQ2rqZGSduHmP2XXNyhjgn3z3wo+YF17wsPizHljTzK9IPpAGAx1ShnCE+PVu8Ezln7LhU-dulo9wMRzDPfkK987gGe0Dfu8EIbQ6yfIgjW96boAYN2lF3s2aGG+RYebQ1ID53fxuVUNc9FAA+CHhBd3XPqwegjKZHuslmqJ8ugnAv1qteQRghAZiway5HfjwcrvuAg5Zs4dv5RJqt7ut36R07gISRHtzAr00B58EH1OKpmeKG0XXIrUmjUu787ZiBF8DdSa4Zt7bgD8ggLARZ8vAPca-gF8fQobgRei5e9Pd7NepBoOfmFrB79m941-LR63UOT5D9izqZB-ggNd7MGLiXgOkVgzB0q3mg9P05HB3KyfCGZ9OZlvP0fi-C+42r59m6OY9+5G33fB-Y-Ha-ifxPB-y+Zyr97+vlGE+JeDmfcZMmqT8p+mCNaC+S+uM8QpQ8QzuB0Ou-i7wzWHeHkP662MSdgJunkFuwQAAVCYmge4AQbIpgaCnYHQOHNeNQL7sdBjNpgalwrGqXiARFpFkoKQKQLcggruiTuYG8roG4LpuyvAogqIWyrgTQTyPQTVsTqTmwSvMPjWnyqni2DVhVpVi8qoDVppkJmcO5h5oJPgkXgdKJl5vFpXoDsivlODqwuwtQBFKGN-siiIuHI5ODtQeRLIQjGVowaoE1K4ZvqAMQVaB3gwBisgWEc6O4KpuQioI9tgTHtlvlA7kjomFxqjlTvER4QoaTgUaEageEe4A1AIYUSjIRmYc+KJjFmfknkKJHiwc2EIuzl+qAfKkftlorEhpRgapHpQRDiqGgeFgnIbjYSESJODl0bkJ1nciJD6n0cnjAaUJ1voQ-qbiMa6DihxiJJHt-r+CJNUeyKJpoVYQelwmsZ5BsXoTsUZuUXjDMbof4e+AsfJvhg8Zqqhp8ceCsQGkUZWO3sLiWHgLOkwKwOwMulwGumgD9Jul3N7r7jUJFEmJ7kYo4USPUKpKiRlopkmOof1lsEmLUk+luORIBimFWAoCIWSH3JQHXG4AtrNEIipjjg1GkW5s0ZhOxN9uMkdi1PSOUWyXlE4TiPsZ6trF9r4D9vyUqDlmibEqeGPPgBbNKXyVeBWkMvNGyfKVydMnHDloEAMhKQDPNDDgqT0pskXCqQ9CguclkZTgLPgBaS8gaTabsogYIgTG0TkBnlzi6exD6XSIEOOrsIMl3EGaoCJC6SbDansZLIaA-pqWIEGZzufNGXqeKHmIWNGYMbPCIuqMQE4JkRkNkQLOMXinYB2lfjNAdNvvOlKhWckSmjWVgMijcImHXqAhTmjkUODuIdIDEJ3DgQTA2StJ5A1Fhi6esE2hObRAhE7sOUwLSPoU5GOfIFvAYv8UGOuXaTZLcHrruSUFuZIoWLuccVukmBkT2TkXOcJIkXlKqIhNYZWZSLoE4DMBgQ5B-JcFEe+Z+XGFfNHjOVsCyfuV+VyJOYkSyo1E+SWUYTOMKluEWZ+ROYYAADxvkoU1BRnQXR6EmqBBCqLUD4zEA4hq4Aq3ITocivrvLuDCpBCgAADUuJemYwa4RZm2kUaFzFwQ0IvFPx7FWiTgXFuFjkUeaaUuvaRFT6BA8gBaFFgK1FdAtFsg9FwQAlmOQlnF+A3FFBvFAkjFLFgl3uwlolgFYa2uT6L6b61xV6nkTRgOUE+6MgT67kTZKMUE3hqkd5FlkudODaA5EFWmCFbKNGXGrlSiUaZABZwlJZZZ58hGPxwqeBv5WEjQaFPxyaeYFlyVHINB+YwV4l0wAUFlXQeMcBKMN++66KVwHZQC9eN5NoTyjx0uWwDlcuxAhIP2gktIGuKMv+b2-+x4yK654O9Z4FfxjMv43lOW+5q5c1tI+OpO65D+a5+5tOA1pIlVkiLlIiUVMBnp7IVxP6GxHVcYjlpIzlEV+17lL5eMXlBVvl0F-lM4saQVmVmO4VGQkVd11Y1AhZxZTViVUmoVklqVVwQYn18OVK083EQYgF85xIeVs1P8FBJVIYZV3+8BrFM41VXGtVGK9VXZ8Vjpeor1pQBFHVQQJA3V4yvVnwU2M2cxss5VA1PeQ1cqo1+541J+650VB62NABzYs1q1E5i1nwy1BOq1h5G1bNx4O1oAitE+N1blAtj4oJY0c6C6kJnAq6vAGA8JyoqYlA+2tct2x2sOOCDaSpnKK2wQJtZt9JdIKCjtN2kgptxykBfMGYVtMCN8vCIYNOHcyKbt5tspLwkROhyM7EfoAk5gfo7KUtZg7EAY8dZgAYSdkhOhQQIF6doAIFWdMdJUVI+dVIRd+mJUcC+CAk1diCjMydOdesdAxySgOIAkzdrd5FFMjd7EhJ6dhJbKvdJUqIMwKo+Ik6-go9NQ49DAeMw9EIQQTF+d5gqgxJoABU+BE2LF3dC91Ik2K9Zga9gQm95wluE2M2u92d7Ek2yS6dE2pQZ95gM2D9e9hFZBgQx4x9G9Fw59oABBG9Zgb9QQwAh92269p9f9YAV9xdi9AApGA9-ZA6ABNnA4A6AMA7+SvUg7-Sg4TT-dfSVAAISXDYMQO4MTYkMYoFSEOL3oWIPkNb2gCYVmA0OwPUjoXnCH04NMOcOsPAPm4MMn0UOgCW78O0PUjm5cOf2lA8NP0TZSPiPsOEVENgN4OP1iOgBEPmConIxdCh3Xbh1tQTnoq4wm5+g1SGPO0R3JCPYGOm3u1tTUD4gABWVJkRZjhyJ2+B7EYdztAke8NOjdM4fjh2s6XQbZIRoTsMm+8MUdpo7EbeQujJgQSTHewTFROdkAxA7ecg7dn92TuTICGTFR7E09kgsAkA6d5TlTJThRZTI4M9AAovneU003UwUexAAHJKBdNgM9NdNg2FH6NRNWOHb5bPyYGmN4wm6kD4FBikAwXRN8bgz3wxD2NO3jOxP9hYbTMoyzPzPZl8LyiWMOPh0TOPZLmXbLN-bECrZUgumXZaIoGViMDSA4hxUuNKBZDUFrjAIdHyrLOe1bg2i2Kw7Z0UzXIPNRAzha4HRw2vqk29k6gumI7CFIs5ECFCFrI3PzR3k-HmDLMTOrkdOCFHLCGqC4tHTONuMUBlEFFEvbPcRTkQsozE3ALdkOnIsGAdxbhg4dlOAiL4g2xctU5eHkhvrA0otDlQTWTTySBLyBJ1yMCEjTw7bECaC+60SKCqt5NPLIoZzg5yu3CKuRRaKas8ukg37Ku6sgJaNXBTwtCs2vWd01iRRBDTYzapjkLKSgCmviAau+5mCevwi42lCutt2qAkDGsKs5AuKqAZzhhK0c3GCK035NbTyMD1iJstWCFuAeA+5bg8jqKWiKD1iltZusyikJubXHjWs6sA15P2sYqOvIW2i5vHgRvuueuq4VvHX5vuBM09uhuDWpvbUpvDUvgSBd2EU9uq7+s84MBzvTb9WdvTtuu8yWAfAAsUzsX1AsCSAm7lFjVn0EvRu1jyums7sE5aKrPrjZYZyBC7mkvmAzGxuKCRSPscjCV8tLR7vbsDlhjy1K1wvPjet9xqjvvxvmtavCQNvqjFNV4fZ11qAwedAuvruRseuq5dFophD7Y1yDshvAejuTsGtGsXsmtxtmuBuWt4xduzuesvhrjKuPpKIBsWtDsrvAfhuYeRTnsjJUcfs1s8ezjIdSB9sZg5sU15sFsIK3CWKSdoRKfXjvQ5tC1rst1uuEUACCaoZbjoA7bg1wJF8kjgsF08aAq7P+E7cqDH2HPbfr1HZIKlzOS7y7hl1n9HfHm7+717u73u+7h7Xjx7PNp78OAnl71HZM3U6Wt7XE97uQX7z7rLlRAeUHn7DIP7Vgf7gXAH+CQHGnIH8B3QfUUE2+5EdABaig6rFr+rIRhrGKMbV7aHwH3NtIUdb7V7X7gNv714-7LAqggHwH71+CEtKEQzoAVKMIJFo9pANQwlL4I4SgQQ6hkXQn0HvY8MiXCbfkeY65V8llACEn+nlbaE0amZVZZauQF3aVdqp3to4ZdgKnjhzhF3gO0UeYoZl8zaHMzX1HmQ8HuQAA5H26oJk2YAADpYCFuzHkt8kwr4BqKDcDkn3CNnYarA-Qg2sA0u0xD-cfuA8qu4+qCg8Pfg8Q-Q+w+m7w8eCI-I+UvxpRu0QwVikF1M+ECBAABeJzUP042LdPIMSPjAg3GQaPoAPPGPemWPwQOP08do+iCQJ+lX1XWwoPtPzGwvg3EDgQ7EK3tShlpAhljJ8owPXQeABPSrQPpPAvmvDPOvOd+vwQ+IhvxvkQ+gMvQQ8IQAA')">function is_assertion(exp) {
    return type(exp) === "assert";
}
function assertion_body(exp) {
    return head(contents(exp));
}
</pre></div></div>
    </p></div>
    <div class='permalink'>
<a name='p46' class='permalink'></a><p>
      
	
	
	  Here are the declarations of the predicates and selectors
	  for the <kbd>and</kbd>,
	
      
      <kbd>or</kbd>, <kbd>not</kbd>, and
      
	
	
	  <kbd>javascript_value</kbd>
	  syntactic forms
	
      
      (section&nbsp;<REF NAME="sec:query-eval"><a class="superscript" id="4.4.4-sec-link-4.4.4.2" href="./4.4.4.html#sec4.4.4.2">4.4.4.2</a></REF>):
      <div class='snippet' id='javascript_96_53_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=4&prgrm=PTAEGUEkGEAVQFLlAFgHTpQKCyUAzAVwDsBjAFwEsB7YgZwICdqBbCGeJVNARl5yJkqtUAFMAbgEMANoUnlRAClKsADrVHFyAGjHFxASlABvLKHONR5Qo2KhKdAPrTKCxjOVqNWg2fP+AgH5QFzcZRylZJRUWdWJNcl8A5NAALnsnYkkWaK94nz8U82DpamoAa0JVRzoATxYAI2ppCJlCJTrG5sdqfEcsnM9Y70TdTUNCovSHR0lVVRdSeRpiIbiEpKLi0DmF2sUJNvklQQoVx1EAD1VLOjoVtZGDMf1nya2UlzpyHr7I9roikkjAA5hdrrd7rRATF1j4XoZNltpk5qKpRO5yNRGI4Yg1KFlhKtYU93slgodZMdFGiMfJsbjWPjCecsbN5otlrRHvlRnoJh80hlGcQACauFYeEm8pFFCmREXiolSvIJBGylIo5zZBqiyTgm6iO4PaUbMlBUAsSTlUSOU5ExTSHV6xyqYHZKwYmr1JrSGGq+HmwUfJ2NF1NUX7U3w-ka5JauiiACO7TIuWGMqD20pNWTqdIHTzmgLNXIxxyWn9GY26qzQpmDVKpHKPLNgvl4Ub1Gbra0tcFWss1lspfLCV7iTrHZaQ5sxFHCgr5An-Y+Wvt51FolITsxJoDiQAkAEp2J-tSN7RHFud442Sp6GWtNft9IJ89Y3WtTfd1ziQe4wtHMf3dB1ox0T8B2FSRjRBYgl3fU8cxg+44IQ8DV2RMRGGYRgV1AAAiEhymIagAHc7DqLRJEuUAAFo6LPI4FAIgwAG4sAAXwEEgzhEXZpH2QRdGBEE6CMUx-EofBQEUGYbkoFgJXEW1L1WQQDAkslZ1sHYOVqV1GEU5TVN4h1hJ2UFxI4-xOLEP1RHsGS5KcEkSFFO0zIeDStJSB9vlAW5CGkchQAAXiYqkFEUNTHAjISSDeYNkqKK4FDFC59EoZh4PHOsUuDWK3XcHI3EBDTtHygqPlEuhKuqhr-Fi8ZstoBCfPY7SrDnYUdPnf4lCCkLAJSYI+taKIRXS5chsnFL0nc0R8AJURRRs8w7NEByTDJDFcJikhdCI4gSPIuw1NAchanRejGIE2pWPW0BuO4rALq+H5egmgEDmuOrYx25I+stOYgVBcKAD5IrkaLRPVMY-s616LpzB8lUlN8MIByT-GBmZyEYQhyAAC32SkYdyMUJVocJDXFJZovAj9xk0-LpwpzwqeVFp-KLLR30wrDyepNHqayFoZDcFkVIF2MOORryRBzRMU2LDpyBYch-pZwGpOcmZRFiK7c1VtNFG+TXxN8opgcW5b4jWyZNu26TZJmJ1vgXQ3xwtrXNN1lJgeF6LlsYT3vjHfnffE7QWae577MTAPkn80LQ-DjWfgG8LQCq4OTmyjPI+XaPnjjoNXZcxxxoGmLC5+X3vtEf2ccFYH04bzOm-jgJnaT1uPiDhUVfzJQqoCW5O+LwFS9j14e9sp2uJ4oQVhCBxPr6EgUMoODVvNn1mnE5PgatVQD66aRIcIgAqbfYIdm+CN0TpfWs5e3sVyilnnagiZfHcoEVhVjhIkE+3VdIzBHmrRCwZgiSFIKQQgLBgrUnHgEXYmhRT1QasQYK0gcHVTPubH+PR-4gT3NCQhjVQDQLTF7JcICnis2DN+V8QDuRMzZuvb4igKF-m9Jfd8I1-DpDwdIaQ8sV58TsDmLsPYsY6wHqnUA8Uc7yPKHFagkZ3zxxUU2GQDAIp0FIX-H4-CiSAnip1AIKj76oQdkYnhm9HD2N3g7R03ZDE2NxhA2R55orxQRulDyLUcoIQMX6ahNCYkBDcXvUU-10GxODCzJG0iiSRWrn4hh45FGvHAcOOwVobTZKKU3RQyT86KHGlcQ0xpOEAXVOkz+q8lYKh3mhPJB51TJxUdnCK1TOm5WfANA0kJ9zVhjOXDBD9BG+gqcMpc8zmiywGuqeOwMBpSNaTIrJFjJmgN6QPYZKyWi1wOVeV+qyma6GSR8aplz+ptFtHUiZjSpmjHuY1Fm0SYkzN8UU0AdsVqO1engNSDB8DMDYFAOAiBkDoD4AAJgyWvd2rg6SYwAoUnq+NJAghBKtZwG98IEVCFix6y93qYvcOcl574TAngnn40AxNRCSFFIoMslBsWfM0jsi6+LCXEo+vhEmtoywgmthYVl8lJDZUZQAMiVWyjlXKmbhTChFCVd4CWCq-sKAY6ZQEysCnKpwUqiUeTFVjAixqqUKzacU60tpjUX19Ga4GYr7UemfrQw+0gWkXWuS0L67rNUD2Buyzl3KFV8tNcGw1MwlndP5biyBlqCXWpJbwu1qatCOt2ZkgtDdA2MqjaymNXKeVvmrXG3lwiBXUsNaWpu4yjRQn-OmytQL621obQm5hSbnXCieRWyYeMs0iptaSu1qdJDPieaxUAAAfVd+VhU5ttT0wiUgjKSEbLaZdRh12bunduudu6CKxRPQa0dTyzkTsBT1UNvx+gekUP2+NTapEXUfWMt5nbDlPADtG9Vg7INM2bU6vZJTbQLqXewyhqxjW6EAxCYDtAvWsp9Yh8xyG-z+rQ6ADD9Su0jr2e7Z0+ogMNO7aasDFq9UztzcuO1oZdS0cw-Rot70aOundKVL0oamEyiY0C4hb7w0el0N+xt0H0n8bDPqeKz7ZV9ogwOgdin71wdddqFTHb6OKGKh6MquhrEZrsD6zjLo6Ndv9WZ4TYdLPaNqJRzJMxb2EbAji4wx5-CTuY1a0VV7PlHR84AlDfHDVRd-ESD9gxI3BaBR9bJ+B8I8CU3Fr+ACEvnGc56MO6mNM9XS5YTLWNkU5dHfFjh841MpZZWljeGX8IAGZat7Pi3eagIoI5IZ3KV81kmDP4fyw1yp1V6soaSyap4fyPjwcM1x4zXbps0NmwIorZUBbfPMNtxLTWAIwbRSIGY40I6LjTYx1uU6WOXrzdeq7ZYbuFu65k2pPGNvNbK7peTQ6ZSefRa5Wg6MaZA42NZ4UoXZ3PYi4RUW3N1srBXWe4MW6wsI6OUj8HYtwjXe9h9v9hrkcY0MqtSgDMFvifu7htrlWsufbXuTyHA2+bsf84Ub1jOlr4Rq6T0dbPxazBChiaWtPof09a57JnWMut6a804OhBZzaZxlQ9uHbH1eayOqr0QsXR0G9yZWXXYDjBBZfQDrTP7fZnYuh3U3JdM7Hxlz1etpchd7Mns7mervNesoHV7lto6DZGwMgb83buefMfEW+EP3EhVOA9lPd7LvLaB6BTMePkHS4g4u04DRI2tfZux1zxHBENFG72RorROi-v-bsID4R3vMkreL0TpcOHZfLir02co-qu8bCV6Dno6JMQMjxASP8FbAvmFS3ipw29GAGVpJPnE0+WQfMYxjwUDYZ+r-H3SLEm+mQz78-ytvY+V9r4n-SM-jQL8gbp-P3OLWl+PfL2S2-x+N+Mif232IBr2VzikPzvxPyn3PyALn2ZWtzsCx3hwr1xyr3AL-wfwAOZCIxZxEHXwwNDRLwZzl35yxmy2vxECdzwLFEIN73a2qxwMom3HB3QOoMb1G3Kz5yq13UVw-guhWwEmp1n2ah+xWBElBGQQSFR2hB7w4N4QIgEIZjR10GEPI1EMshBAkOfAc2AQLzsDwNP0wOfyvDZAUNnzYJUX0OxBzksJxAIKZk2WY1-xsMMJgK4TgRBlKVMIdBW3dRsKShSS2DFUoPv1YNOxEXMHSH4I5EEO8IM18Pv1P38ICM+FJWCLpFCP5SW2SOSETDRhYI1TCNH0L3ZAWBiJf2l1j2zwvW-3zWiMUNoBALXhUPeQY1A3dxt1jR01O3ILsFEikPoFK3A06J-S6P5TO1wDAEhSYFYHYHhS4CRTQA63OwQMtUJhJn2EuBkMzS0WaA5VWE2Pf3bFAEuHynSD2mxEUEuCOiaF2MXTEGuG3AUGwXNQLEoBUlFCLWLTXhWzUlMyE2K3+iCWxkX10jwy8Hck8mdWfnuV2wxEBPcw2VDyozB2GAhN+PwC2JWK-yQJiiOjcgyjUkaIoLy1hJKwxJhwq353wF0DIKRMyVijU3JN7VkJ+CZ2pNAEFzpKaLyzCTanHCZJBJs04NxNAB4Ng3bwMxrgZQfGmkxOcUUAIilKiH9RlJHy5OKKVPaEUAGjlMQJ13WUIk1MNwYPYJHDGVVP5h1Jhxbx1N0L0B3GoHuGIDBF5JGWXCUUFMuh-XLiTzi3rjtBKiUA9I-w6K5R9KwBUV1UNlUGNldKXBznjw4i+JEB+MDI9SPnQxeRjxDLsDdEVVE0zKiHfl9Lq0DLOXKkDIkjgKbzVVjWhQ9BNPrJyCbgrIbKZSt3gK9MbSbObiKNkUuBCUynEFajdPTKiVI0MUsxgleQKWZNBM0BBBJjHOPm1QimkAXKXMiHEm4TzLwlTM-QLInL9A-AaGnKHPCKFHXOdKXNEyMAAB4QgNziZtTvFuFzi8ICIsRqAQZiBah1DNCtZaEqhSjVp0gCJQAABqQ4xqb4IyZ06SfYW8yCwiI6ZCg7WhAmAkEEBCl848i8s4nCC4z8soAgUQMif8xhIC6I0CwiNCmJWCrCnCpCqC-1cCqC9Chi+C-AfYLc8Y96MoSoaoN9WuUNY5SYFGfQZwMoc+YMooENH+Zcws7M4MB7XPW89CikSS0oNEA4MgUoJ0l0rKcJccNJdC9IUNLVCKT3QNbcmJYIetXisy2hBS4PGyj8AdXinxFIbiLYSucYSyy6dlC4CPIckc7vZOLYd8sco6EgJodyUAB1Ly5IPuRyAeLYFRHsnOJ3Hs3SwwBeQOVlExRdGKMs0TEqhsrIhqHsls8qnIZtLYHyxeHM-kKSnS8M5M3ouZYShlUSo8sSgICS8QVqmS2coMeS4qw83iiKm2OPfBZci8rYTSoa7Skah0gy0K4y-mUymJcywNAK6yy+WymhYIRMH4Byyco8haqYZy4q1yw69yn9Ty-KhOCuZyfy1cwK15EKuMio5KKK3q46OKsUBKj0W6HYB+JcKlBqxOVKqqDKwMrK-0nKgFNuQqhS6qsqnspIlJaqgaVsuqpK3uJeZq8YYa3KlpCFL+KFGFWYzgRFXgDAZY4UBSJSKgFSSEmRA6YgLPT-bXIIw6QiFmkyIk3MoyVmt420RSBYYnN7byRKCTD3W3bsxKFpFRIWtm0yZ1JxMVc0H1atf1fwatFKbG-wH1WtA28wWtY2pbH1Xci20AXc623W0lclDee2j6J2ooH1HPfBf1H2iRQUE28wH1cUOgBYSQB6XQUO8Ov8j4IO+Ugid8i2985KeOn1K0EmWYBoOgZ+DO4mLOhgLYNOl2iC+2-wS43QDza+WiKC2O4uuQuiMu8wCu0AKusKKGWiRiOum2l2uiW-C22iAIdu-wRiQe+uvvJ+XQFIFutuju0AG+Vu8wcehU4AJu2SK41uowYe2iMAbu52uQgAUjXpnq3rnoPsXtAGXoIlXLLpPuroCo8x7rkIAEJtVb6N7Z7jjQBX6IpH796+87zj6P7T6v6HzzA-6vaXa7ywom677t7QBoHwGr6IYgHK6QHaIoYkGn6+8IYYGp6Ag4G57cGsH-6FTn616v6h7MHv7-BNjzROo1axaTIObEtRNwogxiFq1dB1aJaWGdCOJGHjINa+GrxqAGgAArR4oxDh0GQQa+W2phjW-1FvDqSq-wHh9myFTqCM6EUKDRhDXRxdQCtc0lH1EFB2f1cx1aeO7I4Ol2yAYge2VwSO8wBxpxq6Gx2x9O+QfO2ASAC2vOxwPxzx7I7xzOgAUXtsCfCZCeSJ9QADlJB4m17En4mrqYkGHdGHbFHeGJs2GwoZHz5SBr561SAPx9GBsnw-YBGsmKmJs8b2GthiFinh6W8ynymcn2b8N34Oq9I9hDIhHeH0SBbRIPo5T7pHACRXExQMRBIsLHBxHJApATEjIYzNsCoKmpb1ylwhDEo1GUhRmN52JkheDDVTqqgNq+T+Y5S0osFLnRzklMFqCKnYpDz0L1HOmDHHwjHyzYmMF5gsFTNPmRHf4JGpG7kAi6nDHRksy-n-AozvqjKrnEgdl1zQpdUQRShTyWgfqtAc5znqhcXlxtGLpipExHBVYj8VJGAmhEw5JiBVAiZ0MMRaXnGzUVEkwc4yXbRKX9gCRGWUXJhK5qXWWrpv7tVCJ7grzyAV00r-Bo6nR9gCIGJGIbhuxO1QBeX7AGWiZzAVXHpoLkgFWI7FASBuWKX2hV9FAkwBUE4tp+5GrzBK4U07gMQHQbWzUMFRQPJCZ1yegcQUI3WHhA3GBjt3NrX6qihhWWXHTnHxWIoCIpWEhZWqpjWlWVWGJwbExQ215OUtxRRboM2DWUqTBHW7Xto5XzA02FSM3M2tXZoGBa2GIoaig03SxLBsh1mPhYKOUWBHBiF7lMr273mzXgRyXeWu3YkCRBsqBqQkxlDKy4X-B84LWMR9h53aEsK0WrkCZe3FB49NJI2NpTnR01WCw7hV2rX+WmXSMY37gPHk5nXMg5rr3EhPX5WHAY6a3M3g4rC3AlJCRVpC2W2NoYbprzAOWuWx2eXLW+WdXBWthq3lWVXQBRQjJqWQhpLtWBXC3m3CaP2w7FXTWGXoPL312j3kgn3ZhXWc3uQPXwPkg83q5gpbQGQQ2HR2Pzg1MPXnqAgkOABBGjktb1oDrEVD+QSQVRactAED5KsDyto1z9oj5DjNzV2D81OgYKQCptxuo6WTxDpTiO9tvd9BHt7Ift0GQdhG4dmhUdsOGDtdypQ8N-adqpygOdhdhspd8wFdidjdgy7d+cMzlgfd-BQ9-D49omst3pp3RdOgMiDEelgV9lrJzliKc1id19pK+Gj0JxXz2D61l+LdqwHdjtkLg9pK1Suanso6j4YIe1b8jO0gYmLC8TssAiU44FEj+zsj+lmd9z6KDd+tGrw9vs4UaM42B8cRr+X6VQN3U0rE3POpayZ6GL-0qbsyWb+boYsMxGNiVbi6X3DboQQEZbqs4GAdM7-b8UsfCbgyUO6b51Lb872aiRZ767tbsOcxBwR7igZ7plHb97g7w1X3B7syU7xGAHoPb0vb1b3p+IEEY4DyCds7qHzTWNK7uHi6RZ5Z0gVZn4bQ7kVHy3QHzH16DL2DiIO9pQAAcnY8UFsfMAAB0sBfWlAnmPI2R8BsRyv8FK60H-ZqoaejoRXHTjSOIKe12qeaWxfFA6ehOGfGeWe2egQAWMoueee-jFVCB0MPxahuGFU8IdfQAAAvTSKelnxjtXzn-rbnxgEL8Qfn03w9mJYXvdanqlQLN6f0uLhLvCOn63vrO0TXj+3QH1SQVihoVi0gVij4zSGnzqPASXql6nuXjnoPu3kL0PhOiP646P2P1iAwN3giR6IAA')">function is_empty_conjunction(exps) { return is_null(exps); }
function first_conjunct(exps) { return head(exps); }
function rest_conjuncts(exps) { return tail(exps); }

function is_empty_disjunction(exps) { return is_null(exps); }
function first_disjunct(exps) { return head(exps); }
function rest_disjuncts(exps) { return tail(exps); }

function negated_query(exps) { return head(exps); }

function javascript_expression(exps) { return head(exps); }
</pre></div></div>
    </p></div>
    <div class='permalink'>
<a name='p47' class='permalink'></a><p>
      The following three
      
	
	functions
      
      
	
	
	  define the query-language-specific representation of rules:
	
      
      <div class='snippet' id='javascript_96_54_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=4&prgrm=PTAEGUEkGEAVQFLlAFgHTpQKCyUAzAVwDsBjAFwEsB7YgZwICdqBbCGeJVNARjQCYcRMlVqhKdAPoAbSuQCmjAIbSAFKVYAHWvOLkAlKADeWUGdCN55Qo2Lip5JQHMn8gCYyJ5dVp16ANKAARLIKytJB+gDcWAC+WMIUNHahiiqSAG4qhPI+LNrEugbG5qCm5pbWtqAAFvJKbqqOlGoa+X4G0XFCJEliEpKOLu6edN5tBUWB5HWDzoYmpZU2dgOaSpSMeZN6hgBke7X1jRMdhgC8l6Az8nNOMfEJvaKrUsRKLLmnhbvG5WbLaoDIauDyyMbbDqBILvT6RB49ETJUAsJQAa1usNydAAniwAEbUaQLf4WKwrUDg7wwj7yIKBXEEoldR6JF6gRmE6SSaj4SRYyE-YqLCrk6p1BpNDatXxC-QsxF9V6SJR0OiUJzET56QVFElLMXKkEjKm6gLBVXqzXa8jw7ps5GWjVaoqSTlEs3C0mAuwSxrNNR+qUtT3y+UIh1iJ3W11ZaQ5STyAAemksauSob+BqqvuOwbUAdD4e6TyR-SkbnkpGkSmUL0zIoBhvsd1Bo3GsqmwQ09EcekklertaUL0ioAAPuPSaVzMDnG3Td8u0EsoxKEp8dJboOa3XkmPJ9OZy3jWCvJ7oZHiAOq7uR-uFaWlaAd8OXm68VyG-8fRzP0SeT5AUg0LJddmLeIrxfW832STJsluZNU3kdNaG-UUcyOSVC1AztwMfKDUQxSQezGJR+1fPc0KxQI4wTJC03VWh9QwilTSCUi+3IG8hyo4h6VAGjQDoxCU0Y5ICOeZEBhrAk3CURMxJQpjiHQptMLnYYzwhMDyGhWT8XkxTkNQ-iFSggyjPWZRPjCD8mWkOg1LJTDUU0VR3W5Xl+VpQIQOlItzKksRLIUwk3BxZzf38kNcPaOUIMVdkiNuULjPEtDrNpMI6ECcKcRY9S2PPEIPkMhSGOU-dAiy2zFFy0B8skstlSvHi73rXSFgASFKb1m00hdz10y9guvSj71oO1ILGggxva2DaB8z5nJc4qxkkSx8AvUAeCClq5paha+MkWqrHq1bfypTb5G2kbQH4fbnzaib33yy7m2uradoAZie9kXtvQZqBI2gyIo28Ptc9Fbk48juNejMj2PcxAd4ybrwFLr-GRlGURhmQyqMyrTNUXG8dR+bEaWs6ctDHGKcZtGOrg96usSp92QGH03UcBQbSigaHHnE1hrwvTgh5sj+aKabOeRHmSZUwXMJimV4r1ZrnwGHs3DkZIVChilBtFnTxehXX9dodIlYfCcp0Zk8Re0jsNfNDjaD1l50ml+QbTlqDLe97lkL10gRy+cXCqurwbru83dv+5Eg4N7lSPkABHHIdS6rMiuqL7bp2x6I1mlPre5FQwneKgMkjt2vVYgvY+++6-oReXyzdTPs9IbFyBYRv86NZ32w8geJaCOge90PuA9m6es9n25fZtJyxkHhZzB-Zs1fHzek7EfBNg21ein38g6Gj3e8w3y-D7sNNuLPvR14nq+87W6pCzvq-S4OgYftNDkBxN3JeZB+6Dw-o2X8AxiCEGkGoX+D8Ww1lPnzP259kGf1gW8BBBYArIK1lzKQm5qCkDREbIEwstJj3ukEMhFD54HUYWiSQbMo6fy-rmbCAV2b-2fCldh0hyGUJfkPYelISqsIEuI4h0kpDUE0Gkcg1BGCgwJJQGuGZc5GF6tvbMxspAkFrKApRKi1EaPxFojGmZDyOwGNY94jAzHKLrJYtoTjbFdQESQyQJiXE8jcSODxrAvGdU4XovqhjqGtlNq7HYk8AmuIseozxNjRwoMcTYwJ5j3FpLCRknRkT9FmH6hpGhQ0zYN2hF43JwTVEFM0doqaKC8khPUZ5KhKQW5F3untXxyJj6MA2u04gJxInlPWtxVuCcS72gXlWT2QS0jjO6VIjasyamgHbiWQiBMlCaE0LIcO9Y2q21oIEWsThCA2nSlVMGhVuEbOpIc45lBTnVUOkqe5pkrmMBuXci59B5FiHaY0qxRSlqqJVEck53jJmlE4qAcFajQDnBRQ0yxXSfFTNicklZ+TIUtNUl1cmZgAD8+NiJvPhfWIRApUWMH0AzR2bLjymmGaM4Jaz2b6HJaAAAXNS24tKPm2IZbSVQTKWUCvZRy88XLuJjImQ3WV8qNXHmnrrQl5FVWJLDB3KCAwxWfLQroneFS4kux2kEU1GNmHPXmsClWFI978IWQda5vyVJOQtU3Hh-oApxQNRzPAV4GD4GYGwKAcBEDIHQHwHgSVkTyDohHHaugMjXytakcIoZyVUrzekESBbGbCrgVKsljMi3UGoGiQgmh7JcngvGbE-4vJASrVHQIWb+XlpbPaiJarC2gFpZFNN2QM3nKUqTbGoA+2ss1ddbyIknLeuBX6ntC7iDZv7RTCtiisVNPCcUkdNaF3poUNK49xKMbA1he8s1pLt19vJYe0G4yrbvHVga0dk606e2-Ybe6b6B0ySJhVWdytq0UypUIq8qg0q00UM2okW61VLs1SjNKHDMM7uze+lsi9e71z-RegDYDSMeRnhA3mEc170wI-uvGH7WFlrg5e9I7HQO7pYyjD9UsMEC1g3jKllGhMMfPrxwj4GpDM0Wi+tVpSygUavbkZmD64YQ2rExsDB6WzUyU+RzjlGjOZr40Rk16YYw5yjv+uMKobMujs9s-TrGF2MGYFsehJA0TEGoAAdzsLiPQSgkygAALSRa4-GCOctO52HHaoYQ-ynDQP+JQfAoBVBrDXCwfWddJCIeEPKLhkjx2nXy4V24JWSBpb-v8WIC7HLyHENl3LUhTgkA8HV4gZXGzmGRWmBB5B0WxcINO+a71StYewxTZMChxmJl3ZsWgAs5XzdKG1FDIyUskHVVt+V1zcqbaO9898Wa1sue8KV4sx5cE3RzK2nIqgRvSAMJtqlPMRKfqW94d7n32XCp67dLR7gYjmGa-IVr5XPPef28QaEfmAvBYu8iEByiosxfHXaKHezZorr5Gu1QSEGp9vK7+NyqhrnooAHwTYzdc3tfHe0pka6yWalHy4-os9mrhj3yCMEIDMCd6mfBfuDlV9w4rr3zr7fxlG4nxc8-SOncBCSzgs9kwOgDk25dAal1XRQ2i656b40arnjmSPLwvuTvjXCss5cAfkEBVHbdELh5I0Hx9ChuEh1Dlr092vO6kGg5+wmsHvwG7jX8evp0nwj1JnUyD-B9oD2YaHsPBtIrBmNpVvNB4vbaxiuV8fr0F-EXbll6fcZO8609lYxeUuJ8L9xESMe2W-krxPYvGeZxZ+DznlGcfre0b7mTTVT96My1ftXtPFvcbxFKPETnB0if+PeM59wHkO0ZZiXYannl6fBAAFQmO324U-si9+gpC+Ha81ARfHQxhhg1Auhbu4gRxzjShSCkFuQQQzTO3MDeV0DcDmzZXgUQUgMdiPwfx5GfyM1O3Oxtzo3ETfzOHlAFQ-XM1EzExeVUCMzQ1-SwJwMEnwUtwOkox4wTgp0G2RXynG1YXYWoAilDH72RREXDkcnGzoAQKfwRhgj4iciak4Lz1AAvytD9wYAxQ3ykOdB324JUEawP0Z2vXyjZyWw8Cu2YBuyQ3IRUNgPO2wwUM1HcAahAJMLxgVyoOfAk0NBn0wVc0SW1yeSpwJh+wQkn3lXL1yEVmgzPQNTcLv1iyc2kJEzoIdwYIkJEnGz8Jp2czuV+xdXl0X1KGjGvE8mb0yLuRxW3REjcP71-BEjsPZDM2EIRTc2iNJEyJIOb2IPyPwysJsPF2IJSMCPNR7RaM1UXR6OPFrzUJ93B39xLHDTGkjWjXYDjS4ETTQB+hTS7iFxFxqEiiTHcM-0JCJHqFUnWNUwvSTHIMUARyTFqTrS3HIgXRTCrAUAgLJD7koDrjcAS32WIkQ12wak0OYw-0wnYm62WyvHpCsI+LyjYJxCKM9W1i618B62KzGhSw2KtVPDHnwAthhIBLGkdQBnmg+IRJ+OmTjhS0CAGUhOxKOhm0RIJO+lRIehQXOVWz0IFnwEpObk2SLhpN2TX0EU8McNLR7H+xZJ6QhCCC8LbQEn5L1EGS7lFNew73xNiWRNNEKMll5IQixIVlVLbT+3PjlMG2ijzELA71CNnhEXVGICcBWwyGuwFnoLxTsELFrxmgOgLyjSlVtLUKDEdKwGRRuETFd1AV0PWyKHG2gOkBiESxFWKxsnbQcgajXUFNAHWE2F31jNogQg5wjNdM+BIKcizPkC3gMQDSwkaDzLpOjOL1zOjILLKTUMLFLLKNTSTG0MtOtKwT3zTMcjylVEQhqLUK3HNJmBTK5A-kuDkN0CcEHLjCvgFSpSTK2AQ2jKHPQw7Kvi7OnktMV2PGFX7InJqCXMckMAAB5KRxzJyVDNyZxxMvM1FVAghVFqB8ZiAcQx0AVbkigGA6BG13l3BhUghQAABqfY7DMYNcc0rLSKTyD+QCgSP8wC-okCrRJwcC1QKc7Ax2YVY4m8u8utAgeQQLF8wFd8jkL82QH84IACoCzVBCsC-ACC2-CimCii+CoXRC5C1C0IkRetRteo0tTyNwrhKCLNGQOtdyd0lGKCfg8ifcuM88r3GcR7UM6Si8tlcTXdYSpRUnMgU0xClsxk8+BXfo4VY-Uc4spS-oqlIMVCwyjkB-fMJS6YAKdi-vFfOvDrLNdFK4X0oBN3QMm7J5Gw68rYPi4IEgQkHrQSWkPHFGQfNrYfY8ZFPM8bF0xcwYx2X8SS1SPMnMlLKs4wzVLKknUsroPGZffHNQoSzi0SxfLk9kOo7I3ijtDs-iwbQStSyqzS-nOK9HMQDK6Slc-ykfT-RSyC5Sx2VSjIdSqq6sagM0i03ym0vjUagdYyq4IMEa8yjkKwSQSyow4SFQJagzXqn+W-BykMJypfSi0oevdykyry-03SoM34Lq0oTCoKxqkK4gMK8ZCKz4bHMdJI2WYq6KoPWKuVBK6MpK1vPMjqoGxmdK2yrKyCnK2kQ7Ewgq9M5Gz4e7aK0kUqyRCqkSmGjucYlqSY1gaYzgBNXgDARY5UVMSgArWuWreE0rHBT-RUxVerYIemxmx4ukFBHmmrSQBm45ZwvmDMVmmBG+XhEMO7DuZFQWpmuE0m8bU0ZGdiP0AScwP0dlVG0odiAMLWswAMXW2A9iOco2xMjYRgU29WkqKkS2qkW2nDEqOBfBASN2xBRmPW8wdiPWOgY5JQHEASf2wO58imH2swdiV6o216tlSOwgoIVEGYFUfEOgekZOmoVOhgPGBO9if8y28wVQU40AAqE-CLQC8OvOkqSLQuswYuwIMu84BnCLGLKus2mu5JI2iLUoZu8wGLHu6u4U6-QIY8Bu0ui4Fu0AU-UuswIe6kYAOunLEupuqesAduu24UgAUiXvHtXtAAiy3tntAHntvNHMLr3snoPo8oxQKg7uFIAEJLgL6V6r6Isn7b7T6ghDzd7X7y7QBjyzA77N7qRDzzg67L7-6wGgGv66df7G637QAGcYH77qQ6dwHR7ShIG+6It0GUGQHbyH6l7r7e7kHQAH7zB1jkYugFbqsla2pIL0VcZqc-Qao6G+blalRGtaGGaha2pqB8QAArG42Q5hw5RHE-c29huuASPeO7BOmcRWjhiNLob0iQpRorbTS+VW88diYYv3ASfR9wBR6wqOkqSAYgX3OQYO0eixqxkBEx0x9iTOyQWASAI2lxtxxx6w5xkcLOgAUUtpcf8e8ZMPYgADklBwml7InwmDrzsaH1HpHYY894YcymG8ZqdSAT8gxSAWVEzknP1wZ74YgeHebNHUn+w10MmUYsmcmDS+F5Q2HeGlatHGsIzKsNHmaWpEc0sqQEzKstFN9KxGBpAcQdLBGlAsh+C1xgEfD5Uunhb8gtwbRbFZsrDrl+mogZwCcDpp5rAm15rz4EzFtwCHr9CQCwC1lFmGH2zLrsNFmtGczQnQCjlwDVAbn5oBHhGKBLCTDHnKn290yXnjbZhvKAyGTHqDAO4twxtfSnARF8QbZIWbs+DyRDmUWBZVGoJrJ1yl5Ak65GBCRp5ctiBNARdaJFBiXrGnlkUM5xtcXbh8XIotFyXoXSR69CXqWQFyGrgp4WhAa5LQ6axIoghosYtUxyFlJQBmXxAyWRczBxX4R7mzBhWg7VASBGXJBmXVAM5wxQAYrjA8aQ8G9LRFB6w9WBqzAGgPBhctweR1EzXGB6wnW3owTdXsbjxOWqWZrrHeWMV+X+zbQrWZw1XRXxXot-rp5nXHQ3BKw3BscI3lXDWjBjWU3cYw3byI3I3ZXAcGBs3osorjww3eZLAPh5mKYQL6gWBJBqcrDErm7+jJCyXaw8WcgXEK2jstFin1xr0M5Agiq8qUY-DtX23Ip+2ORELYWloq3y3QywxYaDXdnnxJW+41RR3FAWX5WJYuXfWHHHcOtPa1BWWRdO8UZM2xXI3y80UwgCsa53BE2i2DWQa5K6WGXW2mWx3SW2XF3SgL2I2Xw1xCXKQRK5W2XE3C3f3zBM3NWP2N2O3LXnLZxD2pBXWMxLW5KMi43NoEFbhLE0O0ICPrx3pEO5UL2ABBNUc12N+N64B8+SRwRqbstAJ9lfF9566DiQMOrN7NmVsdskT8j7fNgtmC1j89rjkV0t6tztytoXat2t8R+tiGxt+bWDkZT9zdsmbqFTbtriXt3ICdwdqwkdnVid2a6drIuTud-BBdpDzPXG7oPqKCAvciOgQLRQb909rhN9jFLVnVk99l3PXsJgWkWQ9QjThDhkKdqwGdqzlgVQedxdhS-BTGlCA6qlGEB85O0gGoRCl8EcJQIIcgtTttzT3T+GfT3VvyPMPMq+DmY1KQO13IIjhMk2G1Ij6EJr9UsQHsasQgZWJrhMveQblBJr1g9gwb+U5URSnCAKEb9LxOlQQLIOhwYXfm8gveQsebjuPzsdzIH1klgAclddUFMfMAAB0sAmuac3nlsYV8A1F4vQzG6EGysNVDvoRd3p47RdvN39uiWZrchjuqPnXTuzvQBLvrurmPB7vHuPnraNXaJ8nwSrbkzCBAgAAvJpswS7mcaHh9B7xgeLjIF70ALHt77DD74IL7-mmIfRBIVvVz9zrYY727mHkGQn+LlewIdiQr2pGC0gGC54+UQ7roPAX7glg7oH-H2HonvennkqPn4IfEAXoXyIfQKnoIeEIAA')">function is_rule(assertion) {
    return is_tagged_list(assertion, "rule");
}
function conclusion(rule) {
    return head(tail(rule));
}
function rule_body(rule) {
    return is_null(tail(tail(rule)))
           ? list("always_true")
           : head(tail(tail(rule)));
}
</pre></div></div>
    </p></div>
    
      
      
  

  
      <div class='permalink'>
        <a name='sec4.4.4.8' class='permalink'></a><h1>
    4.4.4.8&nbsp;&nbsp;&nbsp;Frames and Bindings</h1></div>
    

    <div class='permalink'>
<a name='p48' class='permalink'></a><p>
      
      
      Frames are represented as lists of bindings, which are
      variable-value pairs:
      <div class='snippet' id='javascript_96_55_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=4&prgrm=PTAEGUEkGEAVQFLlAFgHTpQKCyUB7ABwFMAnAQwBcBLfAOwH1LyAjAG2IBpRCBXS0OToATUAHNilXGABmpfAFtQAYwAW5QpTKgAzKAAUAZ2LKa9XWh2WAlDhm86p2nUGHD+ZfoDWxAJ7dSE3xSYUNrUABvLFAY0EDKXlIXakMGOl42Nn1A5WDQ21jCwoB+UAdhYhlqOmJhaKKigC5QYgBHXnIsn39QVWJyYX0+geygkLDrAoaS3v7BnLyw+umY5vI3D28-bmZqLIXxyYBuLABfOwcncwVyHyZWDn1wqMLcukMBNg9O+-ZiUAAvKA2ClKPoAEQAKmYf0h4OsJ0K9kcZhcX3wXl4hC2vgYAEZuN0GAAmZ7LIpvD6gQy8FgwjiA1zuTxEgmgXZZL7KH704jHcmFagyAwpBjlSrVWpGWm8yaRAXTeKJFziqo1YSI6anFpsYzylavehUg6iIHrZk4kk7ch7aV0h58hEKhpKpKgUWqyXzMbCKYGlalT3q53+1bsm37H1OlbnQqx2LIq7Jd5kMGswl+K2gABunV4fP100pAhp9r+jPNm3T4dtXJ5Dv5KyFItSQalpdlZND1Mk91r3zYvw4nBD3Z4NtI+hBH0tbMIE8txO4ubY+cmI7HY45U4HQ8d0a1Or1L1DxbiPorGxZmaXNayHYbB-9zf0HpEEvVo1yITlJ8KAEgVmMSg+3vGUHRHQDNxWedqEnWDJyJW8VzXDdoM3bcHz+SYnSgmJtWIXV-j-MdgNAr88mXPM+U1f14waejQEYxNUVAYQUnnSg1H0BQu0VSRlVAJQARE0BwXRTFCHBUcGlKCSsRkpohMBUTwWqYxSEoaToNKdTU0UwpmjIeRJwUbhwQcLw6HwAB3FwiDIKhnFAABaFzwz+eFaKY8lXRcdjDE4tQTnOLAzwcihUT3RkbjuXknhOM8JAEIEIqc+g9wheSpKdM8+BSggSEi5xMrUlNNK8nA8BY5xDFAORFAgGB4CQVA0DxdqLhRZziBQqhiH0XIFEIehiDoShuDG7M+PPBI3VFEEtAoLIhpGmpxr9aY5OoJafhQgbVtGjaZOaUU6HIBQDsUNaxsoTbZOBfAMSxBhDF8BQWHwQd9qMd7PsHfAZDSC6ruGo67smuhppO91Ug0QgQW5VFBuu8H7qKUp4bYXx9F6vN+v0GqMuIAAPQhAjcZwUbB9aIZaKHrDQ9DpxAwGGH2wx9HIUgxAYUnyeISmjWpm6Nsh6b0cM2GGDSyhggYIaWGqdK6BFtGZNKPHVwJ2X5cV5WorlhgseoJGqcO2nGfp6H-VO1I3nY1FOjVy2NZaFcFfoR3nGdi3bvFyXYjthg2AulhhHIPmyYpwxzdR13-VKWLiAYInVdDj6I4YecKEupbXr+r7Ob9sWDM3DPw8jz7hBxku6amwOw1FYx2jG5RQdFu63a1162nzRwBpb-v29e5gtEu8bi-j26rYbmHRXYDwvBdmfu49xflGXuuA-n1I-NH-qJ7BOvG9ATWPf3j5D9ulfxp323pbThgKmUUPivoW+7rw0A1-xrRCcuFFF+g4jbFiECBYBn9Z4M13s-Ewb8VZQN-oOYB3NEHb2tqfYO5pqBiDoEfJBid3Y-BwXgghGC54P2MsET+5lLLWTstSXw41yAk1cu5LWHQtCVVCmnQQhAEY42RNwbmYgwiFndMKV8qRybUAUDtag2YU5pwAXQX8Co-L8MEdnUgciFFKNToAqmwjBA8zCLRAiRFJEtk9mDcohjuof2ROohoZ4KYZAKpwgmT9q5CIcIzMu6EWgky0CIPmUM4L0AIYEoJCYjEZRziDJanNnFM1iWOURhg0npNDE-KakT8E32cY2IomjRT7x+u4tgXcxylAqdRT240b5VJqd2ZobYNTLEsceBU1DJwmIsnQKytkXB8MoL4Eg7CtHY0qrEc4vD4lolBDLIGHNcZkyyZgiRMRNE3GxKIwEAA+Yh2t-6iIDpNDZToFmOJcD3B2Cj6C+2nnfLZJEympEoKQfgqgcZeP-g8p2g4BbsSRh3NGAdT5nxOVwq6IhHnnUHJSPuN8T73yoX1AFXsEUkOqWQc6NAlFQIDiFLqSYTm91bgPIwlAFCUE2Q3bZL5RTEGGuMylw9B60vpS4-ic0VTvjVLUby3T-jMtSKHD4B9x43w+HSiY2zCiaP+QNKopApVXxleNGl8rGYNxFUeYiIYzxqo1dy9m1FGQGRVYTOCZrr7arlTyzg+qQzioYPU1cqq7UgSdRar1vL-SaNNb681+1vJxkNYqvlgke5DzbgNGJ557VavpTq51rqYzknmWS1iLMVlinOpTPB7ZC66hmrNQSezfofS+kcsSkIHCkPVHCbgb1a3ltJVgPhhhuSMHwPwOBr80GoinjTGe2yPkcoTYQoh5BlDKF4AoDIBMk1aLGsIbJ3Z0iZC3aGatvahAy0Hag9+7w92bnjQPaVrLbpjs7jhRSwdT3oJea0g020Zwvqiu2-6UCoXNB3WwLtfCe4by3m+gO2yzy+MZOBhgvioHeTPHWXUjJD39pPfAkdtV9C+KfCoI0Agm3FvVHVIE+a2YkdjiWwYqHzG+QEm6G1vjLmhOEOE7MBSCH0YvTkoJ1HcFke4Gu-j0wG7XNzT1C+THGCatvdqihDNJ2yaErcFOnr8z6BiTa-e-MY5x3HWLTBknu2LIpc28hkG3nkjPPtRkNrLO3X9fmKOAshaqzRZg7yzaC4dpcwNJz40-N-q8-tEljH+U5moiB8zPdv2Gc7lBkivnf1fQC-oBLGU0srTfVbUTDQbVZcYPtNzBmP5ooK5uBufHoKZtiJojpXbqqLLqg1JQUA4CIGQOgDqxIpPmAWjtRyuWjN3RU1F0UzAxASA4yzWhYlFojZ4WZ25wJhvLQyyfSIhRIuCWGIMbcJ9TN8Km+QGbtQQ6ggW5QPo9wxAVqnQhKBoAABkr3ZgjG2yJIEt2U7Tdi2ts6IMXvvNU2di7c3rsYPBOdS6K3VvkuTsDS6Nb-qPdU-N2HINwRtrLSd8zOWC1w-BZbCb+25j6CO3lgnQO4akas2NjHk3Pnndm1dmcMOgtaUk3w7nIWvqg7226A7VOIxDEp9TpnOFSV84Z850r+nBaxwq3l8nIvJfi6lw+-kNzyWimK0LpV4PWeQ458faz4IwHBeK-CUAAAfe3ikIfs-mzD3MuiHRDoQaiO3jvnem9d9Dy3T9be0-JcVgXo2H0SM0UTtmJOJcjG12jXXiPWKR8V9HZXiW0ax9U6L7cKfLZp-T85ZH1uIHYbPfoEnVEvVlZz-QZngkseV+9zh+guPQB1+iw3pXHnw+sQWmHLOA+VeebV3+Kd02g+c8txXMf2ePMrb4YvyOiS85kCj-evP0-VMHrLcTkG3BC-i+O7z8z6+EP4BrkbnZBfNe2mLzPUvfDkfX-H1TTfkgyCbPw+rksjOOJKPpHF-l3twD-sktwPhoDvrqkKHtXq+kzpEN-MLskIHpdm7iHosh3meqvuZogcOmeijqThOmDlFvmoEDIAtniJfmtkQT7iVFAX-vfg-pQcstQQtqSLLoQbgZHohtthQa3pwZUAtjoPQeSowUwPgI0lfDbvAmwZWm6BXkRuAngYgjEowZ3owInpVtBB-qAY3h5tpuktoSQSweqsSgVuYSrDfnfhfnAcPnvLJjeozjHvvizvdnPhbmNuZJfGPApjzrwWtnpsvhPmwZomfraMdk4c5KKICj7NHnvugdLLPlgcHn4WJIkU8oOOAXQH7k7qGC7hkfPlkVbtikCm4bdAQWtjkYijorUKbATEIcsJolQWIRgnQSEeSvUT8MilSr4R4W0ZjqITQRgjwWcGXuYH0YOJ0EtASoomQRtPnhwVKlwRghIXEYNqkFeu3OmjNDPmzqUWCE6uZHscQLUeShcdUZPAcTtjECMVFtEfeNymnnwiGrcacdyuIp4RTiME6gxucHwhTKGg6mmoCYcapphD8ZIc4XzGyriBcemr8U8YJGdBkK8bqj0fCZKmCamiiVCV4UBmLraJCUPvEakOBkoUcWbtgeUeBlcaxPBoIVPqkS8f+jieXupghlyMvPJkfC3m6FjoyW2oEYKdsRgTLEVFQHrIoErIsarigREGgcbl4U2qQLiLrKQLYgqcgTHv7sUVScrJqdKY5HLDqfrIqZPkzlyTsYWtzFqTKRabqQbLnmTiqbtmqeiZgVDmUUlmJBqU6eaXKR9G6V3nCZSQhiacGZFKGXqcjEIaqQ1ibt4ScQtuCHqaadqa6daUyc5DmTljSaMesZ0dZt0VMR8T6maRQCIMWWsSBBsdZpMcCYTkEGEmlHWa0d6cKWMeIRSdcDySbGbE4rgfkSIjzEus5vkaiT2UAWCOCMOSrN3nkuEc4BOWIFOcFjOQOfZM6fGeGYwEbEuYmWyYaO8AINqYyIWWWkhqkW+I6TWbKZafKYebOh+mpncCeVTMjontqQEmJisPNp8Z2YMBfk+p+SnN+R-L+SDv+bVjksBdWaBdYYBd2MYA7E+V2TTrudLNBTacMSmV4ekX6UMeDOZPhfmeYKue5hEd2ewf8YdufjTnaS4KIsYRPrvh6WiRrsnlrsxdLqZi1rcm1vIB1s1N1m1B1DoANlKV8j8jjCTEKVKZ9F9P0KrEpT-KGKUCTBBX0voCTOZKpRwEIMEiQKYLUAECYMQEscIAju-jySopYf-rfj0IysIb2cAYdPYmnLjkms5TAa5RFq2XTrYiND5YsoTMpWkccaRYTOZN5WEr5ZGdRbgc5VFYAetqWTQTINwBWSFVIbgYhjINFR0TldwC2dMaMmOREvIIUtqiVZlWVfFboLhcjppnCqEuNh5fORCB1d3m8F1SlVKR1foPtNFSUXFeFmJP1cNcoSVg0oNTfONZlRyeNbhW3F8LHHQLzPknVQQu5akduK6gVaxJ8XICDodXOZ9oMCdWFERuyHdqypoLiHtVErdIyEBicFVZBanLnIPGWpshzNFc9jlkDdRECT9RdZdDvoTP9c8F6URYxXDSDHNdDSnGsujQjbEEdeLljZKcEuxpxtxrKoDfXv-usCnFdUjcKWNGILdmjkXOED9sCHTQzSuEsNpeOHBDxI5f9YzbqOTVbCwJTZxgBqzTtQzWDeEAADwS302qBjWdCc1EL6Xghyz4BqZ0C+CmKblHx1Q0gCIgi1DNDgigAADUWlsSHwuiO1QoOM0tFtYk5kTtBWNt1QYg9tSt5a4tatGt9UxANkutW59K1IWICM1AJtYkrt6S7tdtMgDtgN4Qlt3eZtltbtXyHtXtHNb+V+T0kkUeGWOWyW5IoGUMIcT02I1NDQPafaAt4N5a0aLoqZJJ0tBWms5d6IVdjgW1HtxN+1N8EmBWzQOWKkQIoubd6SpQouOdw91IddmESd1otoOdBGcYbqUiU0Y9j1VNiJ-d71KxJEKw+lxdgZdAn05QPeOOa9cyUaR9RYD16NjI51-N9WQaqmGGKNMNYNX9fICFY46NAWKS8NN9+E2aqRU0FdRAuMDMBNqWR+P0p9K4JdSIcWndldMD00Td9UhOddYNQt2D11GJmQ9dUKAY1sUD3dr8+A21u1tVB9YIQ96SI9Za29E9Sd7dPYIEM9yt9eZD0wI9C94u0ty9WQq9Eat9G9BgW9LNf2CJL1+99V3V1qpAJkAtdC59A6IgV9l0Uy3Osyh4hEPS3YJq-1z91Z6NmDoDpSH9ddgDP9WN-93YgDmNIDEjYD6911kDXdVjzWsgrW9UYlTUXWrUvWGAsl0ssi8ihKyikVziqxPpaZcVAyUT+ilxc1qTMTDAciCMQRiC8TfxvFTFtoxSXaeUui0TSxDiSY5GWVYIzoWOB23esQB2Y4AFDQWOHIzTMQHIbTe6WOCE3T3NpAfTDT124koIQzLMoz0wWOxDbA3e8z-o7TRQWOAUCM5Avg3e6zocOtBoKzhQWOfS3TfS3YBzsQWONwt2xsLAhguOVzqgNzdUKw5zMQWO5tQzsQBl3AvgzNxybCltezrzdTEILknzMQ3zoAvz9abC7kQL-T4zLkQZ3TbChQAIxyMQ7kqLwLWOra0wkL0L6LoAbCkIULMQOL4zwA4LBghlULfzxLoAYA8LYzwBAApNSwS-S2wqy2S6ABS8AT9p85yzC9vb8wi8AQAIQiRCu0uEv-OgBStAhisssLky0cuytcugBy0xDKuzPjMy0AjgvCtEtsIGs6v8sLmHLqs-OasYt0viuWuGvcBFDGvyuHJAj2sqsQgSvUsMtot2sSuxBKXOi5QPWZNVNPxg2AghjVoHaQEVNpPVOjqhsXk8AJtZNPz4AsAABWJgodAIMbGgqi9aAz6bSx3eHJxSwLRQ4bBiacDG91qbtbKcletT82WOHS3eHS1baFIL4IkAdAaoO0WzzrA7Q74yPbaFlzVAjzsAkA3TDzDAc7k7gF071zAAokM4u+uyu2JljgAHLkD7vUuHv7v8PpIptUjNtyHMDBZRsFsrDVrKD1qi7KBWzXutuXsCAftqHBYczRuPtFvPtEsclvvvtlsGKfvfV85G24jXsqImKiIszRVYy4jVCFoVCkDYx93ZvkC5i9q6KaCmHQTXs5McBHz5P+JOOxBIeggIhFBTE-XAQvRvVKNPCZWkxE2sfRLQTwwbr6Dwe4H4NW05I-sXnqEiMxJ8d1mCe3Iyw5t5ubJVYxBifyEgTA3Uc73yPsrcczxdocACByNiBfAi15H0NKPoYCSECKMEJOg-U5zGAMCtymlKKkCfTGCvh0D5TLhkDufDsVpnitCMgOcpzOc4zVD5QEYviud+fjIKuqSxwcDjR2730xA7ObOgtuRpseDK6gBhfuhef8CYtuReQidFDpc4wOAhdOf5ian6CtDHBMR32MTurmiphUwNcVqFADAcbfIcAyw6lteaRUxDdRSIadfuPWJjW+c0PDvxdAjgiJc1FdfTAVeZduTuSjfOQ9e1DsIbdgv0eiqRCMRHepdsQcS7Prcbd5e1c60tJ1T7cbcGMNAVejyBAXTEf+g239AKAMDVpJpP3otVZVfcyOdheff8bqS3s0AEytDcBY27uFAqo1dkA4xw-Uge0GfZZfI-e16Yk4QEY5r2fyDtxuAo91cRf8A+duezcTtMpSLzOeeRcrdpcXcZfgjXf-LBDshkDyIEq7dPeE933GoPVBdAjVfg+U93STdrcc-XfCC6KuePREAFf5R7clfWNrcg-qqhe3f1clINCtduDtcfydeEM0fCC9cZApzyxbcfx2+MDjcG8Giy8ACCxvw35gO3ogcsbEVA5AoAItxgaAz3RQp3Bksvj37k+X936vT35kofKwr333H3gSKfv3-36EgPhyom2vYPevWA-438UP4C1AsP8PIDmnMK-U5PaPbamPkg2P73CgePmQBPk3J3Uxu2VZ6qIEQghgNkZATP-AAXovwXoPuvqPw-0vtmj9-1tTyP4P6PtDWPcmOPH3QGzvU6JJ6NKtH5sOmtVzagHtfvzA2kD8efk-FP4n40Zf-86Pouu-MujHDldwCp7EO1Stnufw9ea4mVz2HuMvj-z7xrhWKgfaoB-15iACHQeGCAR7Wiqi53+8AsAUgJ2oZZUBD2TKtuAwFzUMB2TRgJY2gHACsamVSsJ4CIHDhAmqNMAZx344UCuAIAhgSQJ6rDNeab-OAZ-3oG-8-6VAy6KZgl63d2YM3DzgAHJRu+gXtjEAAA6WAProFgEQboZCqcYIC3yAw-MbWcoaCCIPMgxcaG6TE4AINR5CCaeog8QZINAAyC5BXMBQWEiNgyAVBAnBcLwGXBWwegz2ZwaAAABe64aQQKGk4cY7BDg7MOoK8E4R0k2gsSLoOMCVQoI3aasv30H6TgxBNggIbIXsGkAW+srbgFjnICp0WAqdZQKnTsqTARBToPAIYJc7CCBoyQkgLYLSEOCshfbXIUZQKFFD4Q1gCIeCC8hAA')">function make_binding(variable, value) {
    return pair(variable, value);
}
function binding_variable(binding) {
    return head(binding);
}
function binding_value(binding) {
    return tail(binding);
}
function binding_in_frame(variable, frame) {
    return assoc(variable, frame);
}
function extend(variable, value, frame) {
    return pair(make_binding(variable, value), frame);
}
</pre></div></div>
      
    </p></div>

    
    <div class="permalink">
    <a name="ex_4.69" class="permalink"></a><EXERCISE><b><a class="exercise-number permalink" id="ex_4.69">Exercise 4.69 </a></b> 
  
      Louis Reasoner wonders why the
      
	
	<kbd>simple_query</kbd>
	
      
      and <kbd>disjoin</kbd>
      
	
	functions
      
      (section&nbsp;<REF NAME="sec:query-eval"><a class="superscript" id="4.4.4-sec-link-4.4.4.2" href="./4.4.4.html#sec4.4.4.2">4.4.4.2</a></REF>) are implemented using
      
	
	delayed expressions
      
      rather than being defined as follows:
      
      <div class='snippet' id='javascript_96_56_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
function simple_query(query_pattern, frame_stream) {
    return stream_flatmap(
               frame =>
                   stream_append(
                       find_assertions(query_pattern, frame),
                       apply_rules(query_pattern, frame)),
               frame_stream);
}
function disjoin(disjuncts, frame_stream) {
    return is_empty_disjunction(disjuncts)
           ? null
           : interleave(
                 evaluate_query(first_disjunct(disjuncts), frame_stream),
                 disjoin(rest_disjuncts(disjuncts), frame_stream));
}</pre></div></div>
      Can you give examples of queries where these simpler definitions would
      lead to undesirable behavior?
      
    
      <div class="Solution">
      <div class="solution_btn"><button class="btn btn-secondary solution_btn" href="#no_solution_96_1_div" data-toggle="collapse">Add solution</button></div>
      <div class="solution_content collapse" id="no_solution_96_1_div">There is currently no solution available for this exercise. This textbook adaptation is a community effort. Do consider contributing by providing a solution for this exercise, using a Pull Request in <a address="https://github.com/source-academy/sicp" href="https://github.com/source-academy/sicp">Github</a>.</div>
      </div>
    
</EXERCISE></div>


    
    <div class="permalink">
    <a name="ex_4.70" class="permalink"></a><EXERCISE><b><a class="exercise-number permalink" id="ex_4.70">Exercise 4.70 </a></b> 
  
      Why do <kbd>disjoin</kbd> and
      
	
	<kbd>stream_flatmap</kbd>
	
      
      interleave the streams rather than simply append them?  Give examples that
      illustrate why interleaving works better.  (Hint: Why did we use
      <kbd>interleave</kbd> in
      section&nbsp;<REF NAME="sec:exploiting-streams"><a class="superscript" id="4.4.4-sec-link-3.5.3" href="./3.5.3.html">3.5.3</a></REF>?)
      
    
      <div class="Solution">
      <div class="solution_btn"><button class="btn btn-secondary solution_btn" href="#no_solution_96_2_div" data-toggle="collapse">Add solution</button></div>
      <div class="solution_content collapse" id="no_solution_96_2_div">There is currently no solution available for this exercise. This textbook adaptation is a community effort. Do consider contributing by providing a solution for this exercise, using a Pull Request in <a address="https://github.com/source-academy/sicp" href="https://github.com/source-academy/sicp">Github</a>.</div>
      </div>
    
</EXERCISE></div>


    
    <div class="permalink">
    <a name="ex_4.71" class="permalink"></a><EXERCISE><b><a class="exercise-number permalink" id="ex_4.71">Exercise 4.71 </a></b> 
  
    Why does
    
      
      <kbd>flatten_stream</kbd>
      
    
    use
    
      
      a delayed expression in its body?
    
    What would be wrong with defining it as follows:
    <div class='snippet' id='javascript_96_57_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
function flatten_stream(stream) {
    return is_null(stream)
           ? null
           : interleave(head(stream),
                        flatten_stream(stream_tail(stream)));
}</pre></div></div>
    
      <div class="Solution">
      <div class="solution_btn"><button class="btn btn-secondary solution_btn" href="#no_solution_96_3_div" data-toggle="collapse">Add solution</button></div>
      <div class="solution_content collapse" id="no_solution_96_3_div">There is currently no solution available for this exercise. This textbook adaptation is a community effort. Do consider contributing by providing a solution for this exercise, using a Pull Request in <a address="https://github.com/source-academy/sicp" href="https://github.com/source-academy/sicp">Github</a>.</div>
      </div>
    
</EXERCISE></div>


    
    <div class="permalink">
    <a name="ex_4.72" class="permalink"></a><EXERCISE><b><a class="exercise-number permalink" id="ex_4.72">Exercise 4.72 </a></b> 
  
      
      Alyssa P. Hacker proposes to use a simpler version of
      
	
	<kbd>stream_flatmap</kbd>
	
      
      in <kbd>negate</kbd>,
      
	
	<kbd>javascript_value</kbd>,
	
      
      and
      
	
	<kbd>find_assertions</kbd>.
	
      
      She observes that the
      
	
	function
      
      that is mapped over the frame stream in these cases always produces either
      the empty stream or a singleton stream, so no interleaving is needed when
      combining these streams.
      <OL type="a">
	<LI>
          Fill in the missing expressions in Alyssa's program.
          <kbd class='snippet'>function simple_stream_flatmap(fun, s) {
    return simple_flatten(stream_map(fun, s));
}
function simple_flatten(stream) {
    return stream_map($\langle ?? \rangle$,
                      stream_filter($\langle ?? \rangle$, stream));
}</kbd>
	</LI>
	<LI>
          Does the query system's behavior change if we change it in this
	  way?
	</LI>
      </OL>
    
      <div class="Solution">
      <div class="solution_btn"><button class="btn btn-secondary solution_btn" href="#no_solution_96_4_div" data-toggle="collapse">Add solution</button></div>
      <div class="solution_content collapse" id="no_solution_96_4_div">There is currently no solution available for this exercise. This textbook adaptation is a community effort. Do consider contributing by providing a solution for this exercise, using a Pull Request in <a address="https://github.com/source-academy/sicp" href="https://github.com/source-academy/sicp">Github</a>.</div>
      </div>
    
</EXERCISE></div>


    
    <div class="permalink">
    <a name="ex_4.73" class="permalink"></a><EXERCISE><b><a class="exercise-number permalink" id="ex_4.73">Exercise 4.73 </a></b> 
  
      
      
      
      Implement for the query language a
      
	
	syntactic form called
	<kbd>unique</kbd>.
      
      
	
	
	  Applictions of <kbd>unique</kbd>
	
      
      should succeed if there is precisely one item in the data base satisfying
      a specified query.  For example,
      <div class='snippet' id='javascript_96_58_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
unique(job($x, list("computer", "wizard")))</pre></div></div>
      should print the one-item stream
      <div class='snippet' id='javascript_96_59_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
unique(job(list("Bitdiddle", "Ben"), list("computer", "wizard")))</pre></div></div>
      since Ben is the only computer wizard, and
      <div class='snippet' id='javascript_96_60_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
unique(job($x, list("computer", "programmer")))</pre></div></div>
      should print the empty stream, since there is more than one computer
      programmer.  Moreover,
      <div class='snippet' id='javascript_96_61_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
and(job($x, $j), unique(job($anyone, $j)))</pre></div></div>
      should list all the jobs that are filled by only one person, and the
      people who fill them.
      <p></p>
      There are two parts to implementing <kbd>unique</kbd>.
      The first is to write a
      
	
	function
      
      that handles this
      
	
	syntactic
      
      form, and the second is to make
      
	
	<kbd>evaluate_query</kbd>
	
      
      dispatch to that
      
	
	function.
      
      The second part is trivial, since
      
	
	<kbd>evaluate_query</kbd>
	
      
      does its dispatching in a data-directed way.  If your
      
	
	function
      
      is called
      
	
	<kbd>uniquely_asserted</kbd>,
	
      
      all you need to do is
      <div class='snippet' id='javascript_96_62_div'><div class='pre-prettyprint'><pre class='prettyprint no-eval'>
put("unique", "evaluate_query", uniquely_asserted);</pre></div></div>
      and
      
	
	<kbd>evaluate_query</kbd>
	
      
      will dispatch to this
      
	
	function
      
      for every query whose
      <kbd>type</kbd>
      
	
	(head)
      
      is the
      
	
	string
      
      
	
	<kbd>"unique"</kbd>.
      
      <p></p>
      The real problem is to write the
      
	
	function
      
      
	
	<kbd>uniquely_asserted</kbd>.
	
      
      This should take as input the <kbd>contents</kbd>
      
	
	(tail)
      
      of the <kbd>unique</kbd> query, together with a stream
      of frames.  For each frame in the stream, it should use
      
	
	<kbd>evaluate_query</kbd>
	
      
      to find the stream of all extensions to the frame that satisfy the given
      query.  Any stream that does not have exactly one item in it should be
      eliminated.  The remaining streams should be passed back to be accumulated
      into one big stream that is the result of the
      <kbd>unique</kbd> query.  This is similar to the
      implementation of the <kbd>not</kbd>
      
	
	syntactic
      
      form.
      <p></p>
      Test your implementation by forming a query that lists all people who
      supervise precisely one person.
      
    
      <div class="Solution">
      <div class="solution_btn"><button class="btn btn-secondary solution_btn" href="#no_solution_96_5_div" data-toggle="collapse">Add solution</button></div>
      <div class="solution_content collapse" id="no_solution_96_5_div">There is currently no solution available for this exercise. This textbook adaptation is a community effort. Do consider contributing by providing a solution for this exercise, using a Pull Request in <a address="https://github.com/source-academy/sicp" href="https://github.com/source-academy/sicp">Github</a>.</div>
      </div>
    
</EXERCISE></div>


    
    <div class="permalink">
    <a name="ex_4.74" class="permalink"></a><EXERCISE><b><a class="exercise-number permalink" id="ex_4.74">Exercise 4.74 </a></b> 
  
      
      
      
      Our implementation of <kbd>and</kbd> as a series
      combination of queries
      
	
	
	  (figure&nbsp;<REF NAME="fig:query-and"><a class="superscript" id="4.4.4-fig-link-4.6" href="./4.4.2.html#fig_4.6">4.6</a></REF>)
	
      
      is
      elegant, but it is inefficient because in processing the second query of
      the <kbd>and</kbd> we must scan the data base for each
      frame produced by the first query.  If the data base has
      $N$ elements, and a typical query produces a
      number of output frames proportional to $N$
      (say $N/k$), then scanning the data base for
      each frame produced by the first query will require
      $N^{2}/k$ calls to the pattern matcher.
      Another approach would be to process the two clauses of the
      <kbd>and</kbd> separately, then look for all pairs of
      output frames that are compatible.  If each query produces
      $N/k$ output frames, then this means that we
      must perform $N^{2}/k^{2}$ compatibility
      checks—a factor of $k$ fewer than the
      number of matches required in our current  method.
      <p></p>
      Devise an implementation of <kbd>and</kbd> that uses
      this strategy.  You  must implement a
      
	
	function
      
      that takes two frames as inputs, checks whether the bindings in the
      frames are compatible, and, if so, produces a frame that merges the two
      sets of bindings.  This operation is similar to unification.
      
    
      <div class="Solution">
      <div class="solution_btn"><button class="btn btn-secondary solution_btn" href="#no_solution_96_6_div" data-toggle="collapse">Add solution</button></div>
      <div class="solution_content collapse" id="no_solution_96_6_div">There is currently no solution available for this exercise. This textbook adaptation is a community effort. Do consider contributing by providing a solution for this exercise, using a Pull Request in <a address="https://github.com/source-academy/sicp" href="https://github.com/source-academy/sicp">Github</a>.</div>
      </div>
    
</EXERCISE></div>


    
    <div class="permalink">
    <a name="ex_4.75" class="permalink"></a><EXERCISE><b><a class="exercise-number permalink" id="ex_4.75">Exercise 4.75 </a></b> 
  
      
      
      
      
      
      In section&nbsp;<REF NAME="sec:math-logic"><a class="superscript" id="4.4.4-sec-link-4.4.3" href="./4.4.3.html">4.4.3</a></REF> we saw that
      <kbd>not</kbd> and
      
	
	<kbd>javascript_value</kbd>
	
      
      can cause the query language to give <QUOTE>wrong</QUOTE> answers if
      these filtering operations are applied to frames in which variables
      are unbound.  Devise a way to fix this shortcoming.  One idea is to
      perform the filtering in a <QUOTE>delayed</QUOTE> manner by appending to
      the frame a <QUOTE>promise</QUOTE> to filter that is fulfilled only when
      enough variables have been bound to make the operation possible.  We could
      wait to perform filtering until all other operations have been performed.
      However, for efficiency's sake, we would like to perform filtering
      as soon as possible so as to cut down on the number of intermediate frames
      generated.
      
    
      <div class="Solution">
      <div class="solution_btn"><button class="btn btn-secondary solution_btn" href="#no_solution_96_7_div" data-toggle="collapse">Add solution</button></div>
      <div class="solution_content collapse" id="no_solution_96_7_div">There is currently no solution available for this exercise. This textbook adaptation is a community effort. Do consider contributing by providing a solution for this exercise, using a Pull Request in <a address="https://github.com/source-academy/sicp" href="https://github.com/source-academy/sicp">Github</a>.</div>
      </div>
    
</EXERCISE></div>


    
    <div class="permalink">
    <a name="ex_4.76" class="permalink"></a><EXERCISE><b><a class="exercise-number permalink" id="ex_4.76">Exercise 4.76 </a></b> 
  
      
      Redesign the query language as a nondeterministic program to be
      implemented using the evaluator of
      section&nbsp;<REF NAME="sec:nondeterministic-evaluation"><a class="superscript" id="4.4.4-sec-link-4.3" href="./4.3.html">4.3</a></REF>, rather than as a stream
      process.  In this approach, each query will produce a single answer
      (rather than the stream of all answers) and the user can type
      
	
	<kbd>retry</kbd>
	
      
      to see more answers.  You should find that much of the mechanism we built
      in this section is subsumed by nondeterministic search and backtracking.
      You will probably also find, however, that your new query language has
      subtle differences in behavior from the one implemented here.  Can you
      find examples that illustrate this difference?
      
    
      <div class="Solution">
      <div class="solution_btn"><button class="btn btn-secondary solution_btn" href="#no_solution_96_8_div" data-toggle="collapse">Add solution</button></div>
      <div class="solution_content collapse" id="no_solution_96_8_div">There is currently no solution available for this exercise. This textbook adaptation is a community effort. Do consider contributing by providing a solution for this exercise, using a Pull Request in <a address="https://github.com/source-academy/sicp" href="https://github.com/source-academy/sicp">Github</a>.</div>
      </div>
    
</EXERCISE></div>



    
    <div class="permalink">
    <a name="ex_4.77" class="permalink"></a><EXERCISE><b><a class="exercise-number permalink" id="ex_4.77">Exercise 4.77 </a></b> 
  
      
      
      When we implemented the
      
	
	JavaScript
      
      evaluator in section&nbsp;<REF NAME="sec:mc-eval"><a class="superscript" id="4.4.4-sec-link-4.1" href="./4.1.html">4.1</a></REF>, we saw how to use
      local environments to avoid name conflicts between the parameters of
      
	
	functions.
      
      For example, in evaluating
      <div class='snippet' id='javascript_96_63_div'><div class='pre-prettyprint'><pre class='prettyprint eval' title='Evaluate Javascript program'onclick="window.open('http://source-academy.github.io/playground#chap=4&prgrm=PTAEGUEkGEAVQFLlAFgHTpQKCwMwK4B2AxgC4CWA9oaAM4CO+AhgE4CmAFAB4CUoA3llDDQ7UvhY0uoAFSguAbiwBfPETJUatfAFsA+pVx6GzdrW4AaUAE8+gkaLbjJdRq069QAalenOtpVVtfUNjNzMOAGYrFB4FIA')">function square(x) {
    return x * x;
}
function sum_of_squares(x, y) {
    return square(x) + square(y);
}
sum_of_squares(3, 4);
</pre></div></div>
      there is no confusion between the <kbd>x</kbd> in
      <kbd>square</kbd> and the <kbd>x</kbd>
      in
      
	
	<kbd>sum_of_squares</kbd>,
	
      
      because we evaluate the body of each
      
	
	function
      
      in an environment that is specially constructed to contain
      bindings for the local
      
	
	names.
      
      In the query system, we used a
      different strategy to avoid name conflicts in applying rules.  Each
      time we apply a rule we rename the variables with new names that are
      guaranteed to be unique.  The analogous strategy for the
      
	
	JavaScript
      
      evaluator would be to do away with local environments and simply
      rename the variables in the body of a
      
	
	function
      
      each time we apply the
      
	
	function.
      
      <p></p>
      Implement for the query language a rule-application method that uses
      environments rather than renaming.  See if you can build on your
      environment structure to create constructs in the query language for
      dealing with large systems, such as the rule analog of
      block-structured
      
	
      functions.
      Can you relate any of this to the problem of making deductions in a
      context (e.g., <QUOTE>If I supposed that $P$
      were true, then I would be able to deduce $A$
      and $B$.</QUOTE>) as a method of problem
      solving?  (This problem is open-ended.)
      
      
      
      
      
    
      <div class="Solution">
      <div class="solution_btn"><button class="btn btn-secondary solution_btn" href="#no_solution_96_9_div" data-toggle="collapse">Add solution</button></div>
      <div class="solution_content collapse" id="no_solution_96_9_div">There is currently no solution available for this exercise. This textbook adaptation is a community effort. Do consider contributing by providing a solution for this exercise, using a Pull Request in <a address="https://github.com/source-academy/sicp" href="https://github.com/source-academy/sicp">Github</a>.</div>
      </div>
    
</EXERCISE></div>

  
<hr>

    <div class='footnote'>
      <a class='footnote-number' id='footnote-1' href='#footnote-link-1'>[1] </a>
    <FOOTNOTE>
    In general,
      unifying
      
	
	
	  with an expression involving
	  <kbd>$y</kbd>
	
      
      
      
	
	<kbd>$y</kbd>
      
      would require our being able to find a fixed point of the equation
      
	
	
	  <kbd>$y</kbd>
	  $ = \textit{expression involving}$	  
	
      
      
	
	<kbd>$y</kbd>.
      
      
	
	
	  It is sometimes possible to syntactically form an expression that appears
	  to be the solution.  For example,
	  <kbd>$y</kbd>
	
      
      $=$
      
	
	<kbd>list("f", $y)</kbd>
	
      
      seems to have the fixed point
      
	
	
	  <kbd>list("f", list("f", list("f",</kbd>
	  …
	  <kbd>)))</kbd>,
	
      
      which we can produce by beginning with the expression
      
	
	<kbd>list("f", $y)</kbd>
	
      
      and repeatedly substituting
      
	
	<kbd>list("f", $y)</kbd>
	
      
      for
      
	
	<kbd>$y</kbd>.
      
      Unfortunately, not every such equation has a meaningful fixed point.  The
      issues that arise here are similar to the issues of manipulating 
      
      infinite series in mathematics.  For example, we know that 2 is the
      solution to the equation $y = 1 + y/2$.
      Beginning with the expression $1 + y/2$ and
      repeatedly substituting $1 + y/2$ for
      $y$ gives
      
        \[ 2 = y = 1 + y/2 = 1 + (1+y/2)/2 = 1 + 1/2 + y/4 =\cdots, \]
      
      which leads to
      
        \[ 2 = 1 + 1/2 + 1/4 + 1/8 +\cdots. \]
      
      However, if we try the same manipulation beginning with the
      observation that $-1$ is the solution to the
      equation $y = 1 + 2y$, we obtain
      
        \[ -1 = y = 1 + 2y = 1 + 2(1 + 2y) = 1 + 2 + 4y = \cdots, \]
      
      which leads to 
      
        \[ -1 = 1 + 2 + 4 + 8 +\cdots. \]
      
      Although the formal manipulations used in deriving these two equations
      are identical, the first result is a valid assertion about infinite
      series but the second is not.  Similarly, for our unification results,
      reasoning with an arbitrary syntactically constructed expression may
      lead to errors.
    </FOOTNOTE></div>

    
</div></div>

    <div class='nav'>
  
        <a class='btn btn-secondary btn-nav' href='./4.4.3.html'>&lt; Previous</a>
    
    <div style='flex-grow: 1;'></div>
  
        <a class='btn btn-secondary btn-nav' id='98' href='./5.html'>Next &gt;</a>
      </div>
    <div class='chapter_sign'>
      4.4.4&nbsp;&nbsp;
    Implementing the Query System
  
    </div>
    <script> var chapter_id = 97; </script>
    <script> var chapter_path = "chapters/4.4.4.html"; </script>
    <div class='next-page'></div>
    </div>
    </div> <!-- /.container -->
    </body></html>